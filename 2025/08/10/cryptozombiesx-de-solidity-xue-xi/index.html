
  <!DOCTYPE html>
  <html lang="en"  
    
      data-theme-mode="auto"
    
  >
  <head>
  
  <meta charset="utf-8">
  

  

  

  <script>window.REIMU_CONFIG = {};window.REIMU_CONFIG.icon_font = '4552607_0khxww3tj3q9';window.REIMU_CONFIG.clipboard_tips = {"success":{"en":"å¤åˆ¶æˆåŠŸ","zh-CN":"å¤åˆ¶æˆåŠŸ","zh-TW":"è¤‡è£½æˆåŠŸ (*^â–½^*)","ja":"ã‚³ãƒ”ãƒ¼æˆåŠŸ (*^â–½^*)","pt-BR":"Copiado com sucesso (*^â–½^*)"},"fail":{"en":"å¤åˆ¶å¤±è´¥","zh-CN":"å¤åˆ¶å¤±è´¥","zh-TW":"è¤‡è£½å¤±æ•— (ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","ja":"ã‚³ãƒ”ãƒ¼å¤±æ•— (ï¾ŸâŠ¿ï¾Ÿ)ï¾‚","pt-BR":"Falha ao copiar (ï¾ŸâŠ¿ï¾Ÿ)ï¾‚"},"copyright":{"enable":false,"count":50,"license_type":"by-nc-sa"}};window.REIMU_CONFIG.clipboard_tips.copyright.content = 'All articles on this blog are licensed under the BY-NC-SA license agreement unless otherwise stated. Please indicate the source when reprinting!';window.REIMU_CONFIG.code_block = {"expand":true};window.REIMU_CONFIG.base = 'http://example.com';</script>
  
  <title>
    CryptoZombiesxçš„Solidityå­¦ä¹  |
    
    mX1@0_blog
  </title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  
  
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin><link rel="preload" as="style" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap"><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:400,400italic,700,700italic%7CNoto%20Serif%20SC:400,400italic,700,700italic&display=swap" media="print" onload="this.media&#x3D;&#39;all&#39;">
  
  
    <link rel="preload" href="//at.alicdn.com/t/c/font_4552607_0khxww3tj3q9.woff2" as="font" type="font/woff2" crossorigin="anonymous">
  
  
    
<link rel="stylesheet" href="/css/loader.css">

  
  
    <meta name="description" content="CryptoZombiesxçš„solidityå­¦ä¹ Solidity: Beginner to Intermediate Smart Contractslesson1 æ­å»ºåƒµå°¸å·¥å‚ç¬¬2ç« : åˆçº¦ä»æœ€åŸºæœ¬çš„å¼€å§‹å…¥æ‰‹: Solidity çš„ä»£ç éƒ½åŒ…è£¹åœ¨åˆçº¦é‡Œé¢. ä¸€ä»½åˆçº¦å°±æ˜¯ä»¥å¤ªåº”å¸åº”ç”¨çš„åŸºæœ¬æ¨¡å—ï¼Œ æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½å±äºä¸€ä»½åˆçº¦, å®ƒæ˜¯ä½ æ‰€æœ‰åº”ç”¨çš„èµ·ç‚¹. ä¸€ä»½åä¸º HelloWorld çš„ç©ºåˆçº¦å¦‚ä¸‹:">
<meta property="og:type" content="article">
<meta property="og:title" content="CryptoZombiesxçš„Solidityå­¦ä¹ ">
<meta property="og:url" content="http://example.com/2025/08/10/cryptozombiesx-de-solidity-xue-xi/index.html">
<meta property="og:site_name" content="mX1@0_blog">
<meta property="og:description" content="CryptoZombiesxçš„solidityå­¦ä¹ Solidity: Beginner to Intermediate Smart Contractslesson1 æ­å»ºåƒµå°¸å·¥å‚ç¬¬2ç« : åˆçº¦ä»æœ€åŸºæœ¬çš„å¼€å§‹å…¥æ‰‹: Solidity çš„ä»£ç éƒ½åŒ…è£¹åœ¨åˆçº¦é‡Œé¢. ä¸€ä»½åˆçº¦å°±æ˜¯ä»¥å¤ªåº”å¸åº”ç”¨çš„åŸºæœ¬æ¨¡å—ï¼Œ æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½å±äºä¸€ä»½åˆçº¦, å®ƒæ˜¯ä½ æ‰€æœ‰åº”ç”¨çš„èµ·ç‚¹. ä¸€ä»½åä¸º HelloWorld çš„ç©ºåˆçº¦å¦‚ä¸‹:">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2025-08-10T15:38:00.671Z">
<meta property="article:modified_time" content="2025-08-20T09:38:52.963Z">
<meta property="article:author" content="mX1@0">
<meta property="article:tag" content="æ™ºèƒ½åˆçº¦">
<meta property="article:tag" content="Solidity">
<meta property="article:tag" content="ç¼–ç¨‹è¯­è¨€">
<meta name="twitter:card" content="summary">
  
  
  
    <link rel="shortcut icon" href="/images/%E5%9B%BE1.jpg">
  
  
<link rel="stylesheet" href="/css/style.css">

  <link rel="preload" as="style" onload="this.onload&#x3D;null;this.rel&#x3D;&#39;stylesheet&#39;" href="https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.css" integrity="sha384-IfxC36XL&#x2F;toUyJ939C73PcgMuRzAZuIzZxE38drsmO5p6jD7ei+Zx&#x2F;1oA&#x2F;0l8ysE" crossorigin="anonymous">
  
  
  
  
    
<script src="https://npm.webcache.cn/pace-js@1.2.4/pace.min.js" integrity="sha384-k6YtvFUEIuEFBdrLKJ3YAUbBki333tj1CSUisai5Cswsg9wcLNaPzsTHDswp4Az8" crossorigin="anonymous"></script>

  
  
    
<link rel="stylesheet" href="https://npm.webcache.cn/@reimujs/aos@0.1.2/dist/aos.css" integrity="sha384-GMRP93c6Hkz9JVKGAuRR3nTS7M07RwPgTFenXiosjq2VbVgvdDNcz1g6Mkj8AONa" crossorigin="anonymous">

  
  
  
<meta name="generator" content="Hexo 7.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
</head>

  <body>
    
    
  <div id='loader'>
    <div class="loading-left-bg loading-bg"></div>
    <div class="loading-right-bg loading-bg"></div>
    <div class="spinner-box">
      <div class="loading-taichi rotate">
        
          <svg width="150" height="150" viewBox="0 0 1024 1024" class="icon" version="1.1" xmlns="https://www.w3.org/2000/svg" shape-rendering="geometricPrecision">
            <path d="M303.5 432A80 80 0 0 1 291.5 592A80 80 0 0 1 303.5 432z" fill="var(--red-1, #ff5252)" />
            <path d="M512 65A447 447 0 0 1 512 959L512 929A417 417 0 0 0 512 95A417 417 0 0 0 512 929L512 959A447 447 0 0 1 512 65z 
           M512 95A417 417 0 0 1 929 512A208.5 208.5 0 0 1 720.5 720.5L720.5 592A80 80 0 0 0 720.5 432A80 80 0 0 0 720.5 592L720.5 720.5A208.5 208.5 0 0 1 512 512A208.5 208.5 0 0 0 303.5 303.5A208.5 208.5 0 0 0 95 512A417 417 0 0 1 512 95z" fill="var(--red-1, #ff5252)" />
          </svg>
        
      </div>
      
      
        
      
      <div class="loading-word">åŠ è½½ä¸­...</div>
    </div>
  </div>
  </div>
  <script>
    var time = null;
    var startLoading = () => {
      time = Date.now();
      document.getElementById('loader').classList.remove("loading");
    }
    var endLoading = () => {
      if (!time) {
        document.body.style.overflow = 'auto';
        document.getElementById('loader').classList.add("loading");
      } else {
        if (Date.now() - time > 500) {
          time = null;
          document.body.style.overflow = 'auto';
          document.getElementById('loader').classList.add("loading");
        } else {
          setTimeout(endLoading, 500 - (Date.now() - time));
          time = null;
        }
      }
    }
    window.addEventListener('DOMContentLoaded', endLoading);
    document.getElementById('loader').addEventListener('click', endLoading);
  </script>

<div id="copy-tooltip" style="pointer-events: none; opacity: 0; transition: all 0.2s ease; position: fixed;top: 50%;left: 50%;z-index: 999;transform: translate(-50%, -50%);color: white;background: rgba(0, 0, 0, 0.5);padding: 10px 15px;border-radius: 10px;">
</div>
<div id="heatmap-tooltip"></div>


    <div id="container">
      <div id="wrap">
        <div id="header-nav">
  <nav id="main-nav">
    
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
             
              &#xe62b;
             
          </div>
          <a class="main-nav-link" href="/">é¦–é¡µ</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
             
              &#xe62b;
             
          </div>
          <a class="main-nav-link" href="/archives">å½’ç±»</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
             
              &#xe62b;
             
          </div>
          <a class="main-nav-link" href="/about">å…³äº</a>
        </span>
      
        <span class="main-nav-link-wrap">
          <div class="main-nav-icon icon rotate">
             
              &#xe62b;
             
          </div>
          <a class="main-nav-link" href="/friend">å‹é“¾</a>
        </span>
      
    
    <a id="main-nav-toggle" class="nav-icon"></a>
  </nav>
  <nav id="sub-nav">
    
    
    
  </nav>
  
</div>
<header id="header">
  
    
      
        <picture>
          
        </picture>
        
          <img  fetchpriority="high" src="/images/%E7%8E%9B%E8%8E%8E%E6%8B%89%E8%92%82.jpg" alt="CryptoZombiesxçš„Solidityå­¦ä¹ ">
        
      
    
  
  <div id="header-outer">
    <div id="header-title">
      
        
        
          <a href="/" id="logo">
            <h1 data-aos="slide-up">CryptoZombiesxçš„Solidityå­¦ä¹ </h1>
          </a>
        
      
      
        
        <h2 id="subtitle-wrap" data-aos="slide-down">
          
        </h2>
      
    </div>
  </div>
</header>

        <div id="content" class="sidebar-left"  >
          <aside id="sidebar">
  
  
  
  <div class="sidebar-wrapper wrap-sticky">
    <div class="sidebar-wrap" data-aos="fade-up">
      
        
          <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CryptoZombiesx%E7%9A%84solidity%E5%AD%A6%E4%B9%A0"><span class="toc-text">CryptoZombiesxçš„solidityå­¦ä¹ </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Solidity-Beginner-to-Intermediate-Smart-Contracts"><span class="toc-text">Solidity: Beginner to Intermediate Smart Contracts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson1-%E6%90%AD%E5%BB%BA%E5%83%B5%E5%B0%B8%E5%B7%A5%E5%8E%82"><span class="toc-text">lesson1 æ­å»ºåƒµå°¸å·¥å‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E5%90%88%E7%BA%A6"><span class="toc-text">ç¬¬2ç« : åˆçº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F%E5%92%8C%E6%95%B4%E6%95%B0"><span class="toc-text">ç¬¬3ç« : çŠ¶æ€å˜é‡å’Œæ•´æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-text">ç¬¬4ç« : æ•°å­¦è¿ç®—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">ç¬¬5ç« : ç»“æ„ä½“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E6%95%B0%E7%BB%84"><span class="toc-text">ç¬¬6ç« : æ•°ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-text">ç¬¬7ç« : å®šä¹‰å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E4%BD%BF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%95%B0%E7%BB%84"><span class="toc-text">ç¬¬8ç« : ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E7%A7%81%E6%9C%89-%E5%85%AC%E5%85%B1%E5%87%BD%E6%95%B0"><span class="toc-text">ç¬¬9ç« : ç§æœ‰ &#x2F; å…¬å…±å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%87%BD%E6%95%B0%E7%9A%84%E6%9B%B4%E5%A4%9A%E5%B1%9E%E6%80%A7"><span class="toc-text">ç¬¬10ç« : å‡½æ•°çš„æ›´å¤šå±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-Keccak256-%E5%92%8C-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">ç¬¬11ç« : Keccak256 å’Œ ç±»å‹è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-text">ç¬¬12ç« : æ”¾åœ¨ä¸€èµ·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E4%BA%8B%E4%BB%B6"><span class="toc-text">ç¬¬13ç« : äº‹ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC14%E7%AB%A0-Web3-js"><span class="toc-text">ç¬¬14ç« : Web3.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson2-%E5%83%B5%E5%B0%B8%E6%94%BB%E5%87%BB%E4%BA%BA%E7%B1%BB"><span class="toc-text">lesson2 åƒµå°¸æ”»å‡»äººç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E6%98%A0%E5%B0%84%EF%BC%88Mapping%EF%BC%89%E5%92%8C%E5%9C%B0%E5%9D%80%EF%BC%88Address%EF%BC%89"><span class="toc-text">ç¬¬2ç« : æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-Msg-sender"><span class="toc-text">ç¬¬3ç« : Msg.sender</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-Require"><span class="toc-text">ç¬¬4ç« : Require</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E7%BB%A7%E6%89%BF%EF%BC%88Inheritance%EF%BC%89"><span class="toc-text">ç¬¬5ç« : ç»§æ‰¿ï¼ˆInheritanceï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E5%BC%95%E5%85%A5%EF%BC%88Import%EF%BC%89"><span class="toc-text">ç¬¬6ç« : å¼•å…¥ï¼ˆImportï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-Storage%E4%B8%8EMemory"><span class="toc-text">ç¬¬7ç« : Storageä¸Memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E5%83%B5%E5%B0%B8%E7%9A%84DNA"><span class="toc-text">ç¬¬8ç« : åƒµå°¸çš„DNA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-text">ç¬¬9ç« : æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%90%83%E4%BB%80%E4%B9%88"><span class="toc-text">ç¬¬10ç« : åƒµå°¸åƒä»€ä¹ˆ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="toc-text">ç¬¬11ç« : ä½¿ç”¨æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-%E5%A4%84%E7%90%86%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">ç¬¬12ç« : å¤„ç†å¤šè¿”å›å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E5%A5%96%E5%8A%B1-Kitty-%E5%9F%BA%E5%9B%A0"><span class="toc-text">ç¬¬13ç« : å¥–åŠ±: Kitty åŸºå› </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC14%E7%AB%A0-%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-text">ç¬¬14ç« : æ”¾åœ¨ä¸€èµ·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson3-%E9%AB%98%E7%BA%A7-Solidity-%E7%90%86%E8%AE%BA"><span class="toc-text">lesson3 é«˜çº§ Solidity ç†è®º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E6%99%BA%E8%83%BD%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%B0%B8%E5%9B%BA%E6%80%A7"><span class="toc-text">ç¬¬1ç« : æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-Ownable-Contracts"><span class="toc-text">ç¬¬2ç« : Ownable Contracts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-onlyOwner-%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-text">ç¬¬3ç« : onlyOwner å‡½æ•°ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-Gas"><span class="toc-text">ç¬¬4ç« : Gas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E6%97%B6%E9%97%B4%E5%8D%95%E4%BD%8D"><span class="toc-text">ç¬¬5ç« : æ—¶é—´å•ä½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%86%B7%E5%8D%B4"><span class="toc-text">ç¬¬6ç« : åƒµå°¸å†·å´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E5%85%AC%E6%9C%89%E5%87%BD%E6%95%B0%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">ç¬¬7ç« : å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BA%86%E8%A7%A3%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-text">ç¬¬8ç« : è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E5%83%B5%E5%B0%B8%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-text">ç¬¬9ç« : åƒµå°¸ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%88%A9%E7%94%A8-%E2%80%98View%E2%80%99-%E5%87%BD%E6%95%B0%E8%8A%82%E7%9C%81-Gas"><span class="toc-text">ç¬¬10ç« : åˆ©ç”¨ â€˜Viewâ€™ å‡½æ•°èŠ‚çœ Gas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E5%AD%98%E5%82%A8%E9%9D%9E%E5%B8%B8%E6%98%82%E8%B4%B5"><span class="toc-text">ç¬¬11ç« : å­˜å‚¨éå¸¸æ˜‚è´µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-For-%E5%BE%AA%E7%8E%AF"><span class="toc-text">ç¬¬12ç« : For å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-text">ç¬¬13ç« : æ”¾åœ¨ä¸€èµ·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson4-%E5%83%B5%E5%B0%B8%E4%BD%9C%E6%88%98%E7%B3%BB%E7%BB%9F"><span class="toc-text">lesson4 åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E5%8F%AF%E6%94%AF%E4%BB%98"><span class="toc-text">ç¬¬1ç« : å¯æ”¯ä»˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E6%8F%90%E7%8E%B0"><span class="toc-text">ç¬¬2ç« : æç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E5%83%B5%E5%B0%B8%E6%88%98%E6%96%97"><span class="toc-text">ç¬¬3ç« : åƒµå°¸æˆ˜æ–—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-text">ç¬¬4ç« : éšæœºæ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%AF%B9%E6%88%98"><span class="toc-text">ç¬¬5ç« : åƒµå°¸å¯¹æˆ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E9%87%8D%E6%9E%84%E9%80%9A%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-text">ç¬¬6ç« : é‡æ„é€šç”¨é€»è¾‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E6%9B%B4%E5%A4%9A%E9%87%8D%E6%9E%84"><span class="toc-text">ç¬¬7ç« : æ›´å¤šé‡æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E5%9B%9E%E5%88%B0%E6%94%BB%E5%87%BB%EF%BC%81"><span class="toc-text">ç¬¬8ç« : å›åˆ°æ”»å‡»ï¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E5%83%B5%E5%B0%B8%E7%9A%84%E8%BE%93%E8%B5%A2"><span class="toc-text">ç¬¬9ç« : åƒµå°¸çš„è¾“èµ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%83%B5%E5%B0%B8%E8%83%9C%E5%88%A9%E4%BA%86-%F0%9F%98%84"><span class="toc-text">ç¬¬10ç« : åƒµå°¸èƒœåˆ©äº† ğŸ˜„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%A4%B1%E8%B4%A5-%F0%9F%98%9E"><span class="toc-text">ç¬¬11ç« : åƒµå°¸å¤±è´¥ ğŸ˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson5-ERC721-%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81"><span class="toc-text">lesson5 ERC721 æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E7%9A%84%E4%BB%A3%E5%B8%81"><span class="toc-text">ç¬¬1ç« : ä»¥å¤ªåŠä¸Šçš„ä»£å¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-ERC721-%E6%A0%87%E5%87%86-%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-text">ç¬¬2ç« : ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-balanceOf-%E5%92%8C-ownerOf"><span class="toc-text">ç¬¬3ç« : balanceOf å’Œ ownerOf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E9%87%8D%E6%9E%84"><span class="toc-text">ç¬¬4ç« : é‡æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-ERC721-%E8%BD%AC%E7%A7%BB%E6%A0%87%E5%87%86"><span class="toc-text">ç¬¬5ç« : ERC721: è½¬ç§»æ ‡å‡†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-ERC721-%E8%BD%AC%E7%A7%BB-%E7%BB%AD"><span class="toc-text">ç¬¬6ç« : ERC721: è½¬ç§»-ç»­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-ERC721-%E6%89%B9%E5%87%86"><span class="toc-text">ç¬¬7ç« : ERC721: æ‰¹å‡†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-ERC721-takeOwnership"><span class="toc-text">ç¬¬8ç« : ERC721: takeOwnership</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E9%A2%84%E9%98%B2%E6%BA%A2%E5%87%BA"><span class="toc-text">ç¬¬9ç« : é¢„é˜²æº¢å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-SafeMath-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="toc-text">ç¬¬10ç« : SafeMath ç¬¬äºŒéƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-SafeMath-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86"><span class="toc-text">ç¬¬11ç« : SafeMath ç¬¬ä¸‰éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-SafeMath-%E7%AC%AC4%E9%83%A8%E5%88%86"><span class="toc-text">ç¬¬12ç« : SafeMath ç¬¬4éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E6%B3%A8%E9%87%8A"><span class="toc-text">ç¬¬13ç« : æ³¨é‡Š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="toc-text">æ€»ç»“ä¸€ä¸‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson6-%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E5%92%8C-Web3-js"><span class="toc-text">lesson6 åº”ç”¨å‰ç«¯å’Œ Web3.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E4%BB%8B%E7%BB%8D-Web3-js"><span class="toc-text">ç¬¬1ç« : ä»‹ç» Web3.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-Web3-%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-text">ç¬¬2ç« : Web3 æä¾›è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E5%92%8C%E5%90%88%E7%BA%A6%E5%AF%B9%E8%AF%9D"><span class="toc-text">ç¬¬3ç« : å’Œåˆçº¦å¯¹è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E8%B0%83%E7%94%A8%E5%92%8C%E5%90%88%E7%BA%A6%E5%87%BD%E6%95%B0"><span class="toc-text">ç¬¬4ç« : è°ƒç”¨å’Œåˆçº¦å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-MetaMask-%E5%92%8C%E8%B4%A6%E6%88%B7"><span class="toc-text">ç¬¬5ç« : MetaMask å’Œè´¦æˆ·</span></a></li></ol></li></ol></li></ol>
      
  </div>
</div>
</div>
          <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="mX1@0" class="lazyload">
  <div class="sidebar-author-name">mX1@0</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Post</div>
    <div class="sidebar-state-number">54</div>
  </div>
  <div class="sidebar-state-category">
    <div>Category</div>
    <div class="sidebar-state-number">25</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tag</div>
    <div class="sidebar-state-number">65</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-twitter sidebar-social-icon">
      <a href=https://x.com/0xMx1a0 itemprop="url" target="_blank" aria-label="twitter" rel="noopener external nofollow noreferrer"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="é¦–é¡µ"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">é¦–é¡µ</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="å½’ç±»"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">å½’ç±»</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="å…³äº"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">å…³äº</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="å‹é“¾"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">å‹é“¾</div>
      </div>
    
  
</div>
</div>
        
      
      
        
          <div class="sidebar-btn-wrapper" style="position:static">
            <div class="sidebar-toc-btn current"></div>
            <div class="sidebar-common-btn"></div>
          </div>
        
      
    </div>
  </div>

  <div class="sidebar-widget">
  
  </div>
  
</aside>

          <section id="main"><article id="post-CryptoZombiesxçš„Solidityå­¦ä¹ " class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-inner" data-aos="fade-up">
    <div class="article-meta">
      <div class="article-date">
  <span class="article-date-link" data-aos="zoom-in">
    <time datetime="2025-08-10T15:38:00.671Z" itemprop="datePublished">2025-08-10</time>
    <time style="display: none;" id="post-update-time">2025-08-20</time>
  </span>
</div>

      
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" data-aos="zoom-in">ç¼–ç¨‹è¯­è¨€</a>
  </div>


    </div>
    <div class="hr-line"></div>
    

    <div class="e-content article-entry" itemprop="articleBody">
      
      
        <h1 id="CryptoZombiesxçš„solidityå­¦ä¹ "><a href="#CryptoZombiesxçš„solidityå­¦ä¹ " class="headerlink" title="CryptoZombiesxçš„solidityå­¦ä¹ "></a>CryptoZombiesxçš„solidityå­¦ä¹ </h1><h2 id="Solidity-Beginner-to-Intermediate-Smart-Contracts"><a href="#Solidity-Beginner-to-Intermediate-Smart-Contracts" class="headerlink" title="Solidity: Beginner to Intermediate Smart Contracts"></a>Solidity: Beginner to Intermediate Smart Contracts</h2><h2 id="lesson1-æ­å»ºåƒµå°¸å·¥å‚"><a href="#lesson1-æ­å»ºåƒµå°¸å·¥å‚" class="headerlink" title="lesson1 æ­å»ºåƒµå°¸å·¥å‚"></a>lesson1 æ­å»ºåƒµå°¸å·¥å‚</h2><h3 id="ç¬¬2ç« -åˆçº¦"><a href="#ç¬¬2ç« -åˆçº¦" class="headerlink" title="ç¬¬2ç« : åˆçº¦"></a>ç¬¬2ç« : åˆçº¦</h3><p>ä»æœ€åŸºæœ¬çš„å¼€å§‹å…¥æ‰‹:</p>
<p>Solidity çš„ä»£ç éƒ½åŒ…è£¹åœ¨<strong>åˆçº¦</strong>é‡Œé¢. ä¸€ä»½<code>åˆçº¦</code>å°±æ˜¯ä»¥å¤ªåº”å¸åº”ç”¨çš„åŸºæœ¬æ¨¡å—ï¼Œ æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½å±äºä¸€ä»½åˆçº¦, å®ƒæ˜¯ä½ æ‰€æœ‰åº”ç”¨çš„èµ·ç‚¹.</p>
<p>ä¸€ä»½åä¸º <code>HelloWorld</code> çš„ç©ºåˆçº¦å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract HelloWorld {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>ç‰ˆæœ¬æŒ‡ä»¤</strong></p>
<p>æ‰€æœ‰çš„ Solidity æºç éƒ½å¿…é¡»å† ä»¥ â€œversion pragmaâ€ â€” æ ‡æ˜ Solidity ç¼–è¯‘å™¨çš„ç‰ˆæœ¬. ä»¥é¿å…å°†æ¥æ–°çš„ç¼–è¯‘å™¨å¯èƒ½ç ´åä½ çš„ä»£ç ã€‚</p>
<p>ä¾‹å¦‚: <code>pragma solidity ^0.4.19;</code> (å½“å‰ Solidity çš„æœ€æ–°ç‰ˆæœ¬æ˜¯ 0.4.19).</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œ ä¸‹é¢å°±æ˜¯ä¸€ä¸ªæœ€åŸºæœ¬çš„åˆçº¦ â€” æ¯æ¬¡å»ºç«‹ä¸€ä¸ªæ–°çš„é¡¹ç›®æ—¶çš„ç¬¬ä¸€æ®µä»£ç :</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract HelloWorld {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ä¸ºäº†å»ºç«‹æˆ‘ä»¬çš„åƒµå°¸éƒ¨é˜Ÿï¼Œ è®©æˆ‘ä»¬å…ˆå»ºç«‹ä¸€ä¸ªåŸºç¡€åˆçº¦ï¼Œç§°ä¸º <code>ZombieFactory</code>ã€‚</p>
<ol>
<li>åœ¨å³è¾¹çš„è¾“å…¥æ¡†é‡Œè¾“å…¥ <code>0.4.19</code>ï¼Œæˆ‘ä»¬çš„åˆçº¦åŸºäºè¿™ä¸ªç‰ˆæœ¬çš„ç¼–è¯‘å™¨ã€‚</li>
<li>å»ºç«‹ä¸€ä¸ªç©ºåˆçº¦ <code>ZombieFactory</code>ã€‚</li>
</ol>
<p>ä¸€åˆ‡å®Œæ¯•ï¼Œç‚¹å‡»ä¸‹é¢ â€œç­”æ¡ˆâ€ . å¦‚æœæ²¡æ•ˆæœï¼Œç‚¹å‡» â€œæç¤ºâ€ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬3ç« -çŠ¶æ€å˜é‡å’Œæ•´æ•°"><a href="#ç¬¬3ç« -çŠ¶æ€å˜é‡å’Œæ•´æ•°" class="headerlink" title="ç¬¬3ç« : çŠ¶æ€å˜é‡å’Œæ•´æ•°"></a>ç¬¬3ç« : çŠ¶æ€å˜é‡å’Œæ•´æ•°</h3><p>çœŸæ£’ï¼æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„åˆçº¦åšäº†ä¸€ä¸ªå¤–å£³ï¼Œ ä¸‹é¢å­¦ä¹  Solidity ä¸­å¦‚ä½•ä½¿ç”¨å˜é‡ã€‚</p>
<p><strong>çŠ¶æ€å˜é‡</strong>æ˜¯è¢«æ°¸ä¹…åœ°ä¿å­˜åœ¨åˆçº¦ä¸­ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬è¢«å†™å…¥ä»¥å¤ªå¸åŒºå—é“¾ä¸­. æƒ³è±¡æˆå†™å…¥ä¸€ä¸ªæ•°æ®åº“ã€‚</p>
<p>ä¾‹å­:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">contract Example {</span><br><span class="line">  // è¿™ä¸ªæ— ç¬¦å·æ•´æ•°å°†ä¼šæ°¸ä¹…çš„è¢«ä¿å­˜åœ¨åŒºå—é“¾ä¸­</span><br><span class="line">  uint myUnsignedInteger = 100;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œå®šä¹‰ <code>myUnsignedInteger</code> ä¸º <code>uint</code> ç±»å‹ï¼Œå¹¶èµ‹å€¼100ã€‚</p>
<p><strong>æ— ç¬¦å·æ•´æ•°: <code>uint</code></strong></p>
<p><code>uint</code> æ— ç¬¦å·æ•°æ®ç±»å‹ï¼Œ æŒ‡<strong>å…¶å€¼ä¸èƒ½æ˜¯è´Ÿæ•°</strong>ï¼Œå¯¹äºæœ‰ç¬¦å·çš„æ•´æ•°å­˜åœ¨åä¸º <code>int</code> çš„æ•°æ®ç±»å‹ã€‚</p>
<blockquote>
<p>æ³¨: Solidityä¸­ï¼Œ <code>uint</code> å®é™…ä¸Šæ˜¯ <code>uint256</code>ä»£åè¯ï¼Œ ä¸€ä¸ª256ä½çš„æ— ç¬¦å·æ•´æ•°ã€‚ä½ ä¹Ÿå¯ä»¥å®šä¹‰ä½æ•°å°‘çš„uints â€” <code>uint8</code>ï¼Œ <code>uint16</code>ï¼Œ <code>uint32</code>ï¼Œ ç­‰â€¦â€¦ ä½†ä¸€èˆ¬æ¥è®²ä½ æ„¿æ„ä½¿ç”¨ç®€å•çš„ <code>uint</code>ï¼Œ é™¤éåœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œè¿™æˆ‘ä»¬åé¢ä¼šè®²ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬çš„åƒµå°¸DNAå°†ç”±ä¸€ä¸ªåå…­ä½æ•°å­—ç»„æˆã€‚</p>
<p>å®šä¹‰ <code>dnaDigits</code> ä¸º <code>uint</code> æ•°æ®ç±»å‹, å¹¶èµ‹å€¼ <code>16</code>ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬4ç« -æ•°å­¦è¿ç®—"><a href="#ç¬¬4ç« -æ•°å­¦è¿ç®—" class="headerlink" title="ç¬¬4ç« : æ•°å­¦è¿ç®—"></a>ç¬¬4ç« : æ•°å­¦è¿ç®—</h3><p>åœ¨ Solidity ä¸­ï¼Œæ•°å­¦è¿ç®—å¾ˆç›´è§‚æ˜äº†ï¼Œä¸å…¶å®ƒç¨‹åºè®¾è®¡è¯­è¨€ç›¸åŒ:</p>
<ul>
<li>åŠ æ³•: <code>x + y</code></li>
<li>å‡æ³•: <code>x - y</code>,</li>
<li>ä¹˜æ³•: <code>x * y</code></li>
<li>é™¤æ³•: <code>x / y</code></li>
<li>å–æ¨¡ / æ±‚ä½™: <code>x % y</code> <em>(ä¾‹å¦‚, <code>13 % 5</code> ä½™ <code>3</code>, å› ä¸º13é™¤ä»¥5ï¼Œä½™3)</em></li>
</ul>
<p>Solidity è¿˜æ”¯æŒ *<strong>ä¹˜æ–¹æ“ä½œ*</strong> (å¦‚ï¼šx çš„ yæ¬¡æ–¹ï¼‰ // ä¾‹å¦‚ï¼š 5 ** 2 = 25</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint x = 5 ** 2; // equal to 5^2 = 25</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ä¸ºäº†ä¿è¯æˆ‘ä»¬çš„åƒµå°¸çš„DNAåªå«æœ‰16ä¸ªå­—ç¬¦ï¼Œæˆ‘ä»¬å…ˆé€ ä¸€ä¸ª<code>uint</code>æ•°æ®ï¼Œè®©å®ƒç­‰äº10^16ã€‚è¿™æ ·ä¸€æ¥ä»¥åæˆ‘ä»¬å¯ä»¥ç”¨æ¨¡è¿ç®—ç¬¦ <code>%</code> æŠŠä¸€ä¸ªæ•´æ•°å˜æˆ16ä½ã€‚</p>
<ol>
<li>å»ºç«‹ä¸€ä¸ª<code>uint</code>ç±»å‹çš„å˜é‡ï¼Œåå­—å«<code>dnaModulus</code>, ä»¤å…¶ç­‰äº <strong>10 çš„ <code>dnaDigits</code> æ¬¡æ–¹</strong>.</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬5ç« -ç»“æ„ä½“"><a href="#ç¬¬5ç« -ç»“æ„ä½“" class="headerlink" title="ç¬¬5ç« : ç»“æ„ä½“"></a>ç¬¬5ç« : ç»“æ„ä½“</h3><p>æœ‰æ—¶ä½ éœ€è¦æ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼ŒSolidity æä¾›äº† <strong>ç»“æ„ä½“</strong>:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">struct Person {</span><br><span class="line">  uint age;</span><br><span class="line">  string name;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç»“æ„ä½“å…è®¸ä½ ç”Ÿæˆä¸€ä¸ªæ›´å¤æ‚çš„æ•°æ®ç±»å‹ï¼Œå®ƒæœ‰å¤šä¸ªå±æ€§ã€‚</p>
<blockquote>
<p>æ³¨ï¼šæˆ‘ä»¬åˆšåˆšå¼•è¿›äº†ä¸€ä¸ªæ–°ç±»å‹, <code>string</code>ã€‚ å­—ç¬¦ä¸²ç”¨äºä¿å­˜ä»»æ„é•¿åº¦çš„ UTF-8 ç¼–ç æ•°æ®ã€‚ å¦‚ï¼š <code>string greeting = "Hello world!"</code>ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>åœ¨æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€äº›åƒµå°¸ï¼æ¯ä¸ªåƒµå°¸å°†æ‹¥æœ‰å¤šä¸ªå±æ€§ï¼Œæ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªå±•ç¤ºç»“æ„ä½“çš„å®Œç¾ä¾‹å­ã€‚</p>
<ol>
<li>å»ºç«‹ä¸€ä¸ª<code>struct</code> å‘½åä¸º <code>Zombie</code>.</li>
<li>æˆ‘ä»¬çš„ <code>Zombie</code> ç»“æ„ä½“æœ‰ä¸¤ä¸ªå±æ€§ï¼š <code>name</code> (ç±»å‹ä¸º <code>string</code>), å’Œ <code>dna</code> (ç±»å‹ä¸º <code>uint</code>)ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬6ç« -æ•°ç»„"><a href="#ç¬¬6ç« -æ•°ç»„" class="headerlink" title="ç¬¬6ç« : æ•°ç»„"></a>ç¬¬6ç« : æ•°ç»„</h3><p>å¦‚æœä½ æƒ³å»ºç«‹ä¸€ä¸ªé›†åˆï¼Œå¯ä»¥ç”¨ <strong>æ•°ç»„</strong>è¿™æ ·çš„æ•°æ®ç±»å‹. Solidity æ”¯æŒä¸¤ç§æ•°ç»„: <strong>é™æ€</strong>æ•°ç»„å’Œ<strong>åŠ¨æ€</strong>æ•°ç»„:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// å›ºå®šé•¿åº¦ä¸º2çš„é™æ€æ•°ç»„:</span><br><span class="line">uint[2] fixedArray;</span><br><span class="line">// å›ºå®šé•¿åº¦ä¸º5çš„stringç±»å‹çš„é™æ€æ•°ç»„:</span><br><span class="line">string[5] stringArray;</span><br><span class="line">// åŠ¨æ€æ•°ç»„ï¼Œé•¿åº¦ä¸å›ºå®šï¼Œå¯ä»¥åŠ¨æ€æ·»åŠ å…ƒç´ :</span><br><span class="line">uint[] dynamicArray;</span><br></pre></td></tr></tbody></table></figure>

<p>ä½ ä¹Ÿå¯ä»¥å»ºç«‹ä¸€ä¸ª <strong>ç»“æ„ä½“</strong>ç±»å‹çš„æ•°ç»„ ä¾‹å¦‚ï¼Œä¸Šä¸€ç« æåˆ°çš„ <code>Person</code>:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person[] people; // è¿™æ˜¯åŠ¨æ€æ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä¸æ–­æ·»åŠ å…ƒç´ </span><br></pre></td></tr></tbody></table></figure>

<p>è®°ä½ï¼šçŠ¶æ€å˜é‡è¢«æ°¸ä¹…ä¿å­˜åœ¨åŒºå—é“¾ä¸­ã€‚æ‰€ä»¥åœ¨ä½ çš„åˆçº¦ä¸­åˆ›å»ºåŠ¨æ€æ•°ç»„æ¥ä¿å­˜æˆç»“æ„çš„æ•°æ®æ˜¯éå¸¸æœ‰æ„ä¹‰çš„ã€‚</p>
<p><strong>å…¬å…±æ•°ç»„</strong></p>
<p>ä½ å¯ä»¥å®šä¹‰ <code>public</code> æ•°ç»„, Solidity ä¼šè‡ªåŠ¨åˆ›å»º <strong>getter</strong> æ–¹æ³•. è¯­æ³•å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Person[] public people;</span><br></pre></td></tr></tbody></table></figure>

<p>å…¶å®ƒçš„åˆçº¦å¯ä»¥ä»è¿™ä¸ªæ•°ç»„è¯»å–æ•°æ®ï¼ˆä½†ä¸èƒ½å†™å…¥æ•°æ®ï¼‰ï¼Œæ‰€ä»¥è¿™åœ¨åˆçº¦ä¸­æ˜¯ä¸€ä¸ªæœ‰ç”¨çš„ä¿å­˜å…¬å…±æ•°æ®çš„æ¨¡å¼ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ä¸ºäº†æŠŠä¸€ä¸ªåƒµå°¸éƒ¨é˜Ÿä¿å­˜åœ¨æˆ‘ä»¬çš„APPé‡Œï¼Œå¹¶ä¸”èƒ½å¤Ÿè®©å…¶å®ƒAPPçœ‹åˆ°è¿™äº›åƒµå°¸ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¬å…±æ•°ç»„ã€‚</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªæ•°æ®ç±»å‹ä¸º <code>Zombie</code> çš„ç»“æ„ä½“æ•°ç»„ï¼Œç”¨ <code>public</code> ä¿®é¥°ï¼Œå‘½åä¸ºï¼š<code>zombies</code>.</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬7ç« -å®šä¹‰å‡½æ•°"><a href="#ç¬¬7ç« -å®šä¹‰å‡½æ•°" class="headerlink" title="ç¬¬7ç« : å®šä¹‰å‡½æ•°"></a>ç¬¬7ç« : å®šä¹‰å‡½æ•°</h3><p>åœ¨ Solidity ä¸­å‡½æ•°å®šä¹‰çš„å¥æ³•å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function eatHamburgers(string _name, uint _amount) {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ˜¯ä¸€ä¸ªåä¸º <code>eatHamburgers</code> çš„å‡½æ•°ï¼Œå®ƒæ¥å—ä¸¤ä¸ªå‚æ•°ï¼šä¸€ä¸ª <code>string</code>ç±»å‹çš„ å’Œ ä¸€ä¸ª <code>uint</code>ç±»å‹çš„ã€‚ç°åœ¨å‡½æ•°å†…éƒ¨è¿˜æ˜¯ç©ºçš„ã€‚</p>
<blockquote>
<p>æ³¨ï¼š: ä¹ æƒ¯ä¸Šå‡½æ•°é‡Œçš„å˜é‡éƒ½æ˜¯ä»¥(<code>_</code>)å¼€å¤´ (ä½†ä¸æ˜¯ç¡¬æ€§è§„å®š) ä»¥åŒºåˆ«å…¨å±€å˜é‡ã€‚æˆ‘ä»¬æ•´ä¸ªæ•™ç¨‹éƒ½ä¼šæ²¿ç”¨è¿™ä¸ªä¹ æƒ¯ã€‚</p>
</blockquote>
<p>æˆ‘ä»¬çš„å‡½æ•°å®šä¹‰å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eatHamburgers("vitalik", 100);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>åœ¨æˆ‘ä»¬çš„åº”ç”¨é‡Œï¼Œæˆ‘ä»¬è¦èƒ½åˆ›å»ºä¸€äº›åƒµå°¸ï¼Œè®©æˆ‘ä»¬å†™ä¸€ä¸ªå‡½æ•°åšè¿™ä»¶äº‹å§ï¼</p>
<ol>
<li>å»ºç«‹ä¸€ä¸ªå‡½æ•° <code>createZombie</code>ã€‚ å®ƒæœ‰ä¸¤ä¸ªå‚æ•°: <strong>_name</strong> (ç±»å‹ä¸º<code>string</code>), å’Œ <strong>_dna</strong> (ç±»å‹ä¸º<code>uint</code>)ã€‚</li>
</ol>
<p>æš‚æ—¶è®©å‡½æ•°ç©ºç€â€”â€”æˆ‘ä»¬åœ¨åé¢ä¼šå¢åŠ å†…å®¹ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function createZombie(string _name, uint _dna) {</span><br><span class="line"></span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬8ç« -ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„"><a href="#ç¬¬8ç« -ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„" class="headerlink" title="ç¬¬8ç« : ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„"></a>ç¬¬8ç« : ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„</h3><p><strong>åˆ›å»ºæ–°çš„ç»“æ„ä½“</strong></p>
<p>è¿˜è®°å¾—ä¸Šä¸ªä¾‹å­ä¸­çš„ <code>Person</code> ç»“æ„å—ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">struct Person {</span><br><span class="line">  uint age;</span><br><span class="line">  string name;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">Person[] public people;</span><br></pre></td></tr></tbody></table></figure>

<p>ç°åœ¨æˆ‘ä»¬å­¦ä¹ åˆ›å»ºæ–°çš„ <code>Person</code> ç»“æ„ï¼Œç„¶åæŠŠå®ƒåŠ å…¥åˆ°åä¸º <code>people</code> çš„æ•°ç»„ä¸­.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// åˆ›å»ºä¸€ä¸ªæ–°çš„Person:</span><br><span class="line">Person satoshi = Person(172, "Satoshi");</span><br><span class="line"></span><br><span class="line">// å°†æ–°åˆ›å»ºçš„satoshiæ·»åŠ è¿›peopleæ•°ç»„:</span><br><span class="line">people.push(satoshi);</span><br></pre></td></tr></tbody></table></figure>

<p>ä½ ä¹Ÿå¯ä»¥ä¸¤æ­¥å¹¶ä¸€æ­¥ï¼Œç”¨ä¸€è¡Œä»£ç æ›´ç®€æ´:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">people.push(Person(16, "Vitalik"));</span><br></pre></td></tr></tbody></table></figure>

<blockquote>
<p>æ³¨ï¼š<code>array.push()</code> åœ¨æ•°ç»„çš„ <strong>å°¾éƒ¨</strong> åŠ å…¥æ–°å…ƒç´  ï¼Œæ‰€ä»¥å…ƒç´ åœ¨æ•°ç»„ä¸­çš„é¡ºåºå°±æ˜¯æˆ‘ä»¬æ·»åŠ çš„é¡ºåºï¼Œ å¦‚:</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uint[] numbers;</span><br><span class="line">numbers.push(5);</span><br><span class="line">numbers.push(10);</span><br><span class="line">numbers.push(15);</span><br><span class="line">// The `numbers` array is now equal to [5, 10, 15]</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>è®©æˆ‘ä»¬åˆ›å»ºåä¸ºcreateZombieçš„å‡½æ•°æ¥åšç‚¹å„¿ä»€ä¹ˆå§ã€‚</p>
<ol>
<li>åœ¨å‡½æ•°ä½“é‡Œæ–°åˆ›å»ºä¸€ä¸ª <code>Zombie</code>ï¼Œ ç„¶åæŠŠå®ƒåŠ å…¥ <code>zombies</code> æ•°ç»„ä¸­ã€‚ æ–°åˆ›å»ºçš„åƒµå°¸çš„ <code>name</code> å’Œ <code>dna</code>ï¼Œæ¥è‡ªäºå‡½æ•°çš„å‚æ•°ã€‚</li>
<li>è®©æˆ‘ä»¬ç”¨ä¸€è¡Œä»£ç ç®€æ´åœ°å®Œæˆå®ƒã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function createZombie(string _name, uint _dna) {</span><br><span class="line">        zombies.push(Zombie(_name, _dna));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬9ç« -ç§æœ‰-å…¬å…±å‡½æ•°"><a href="#ç¬¬9ç« -ç§æœ‰-å…¬å…±å‡½æ•°" class="headerlink" title="ç¬¬9ç« : ç§æœ‰ / å…¬å…±å‡½æ•°"></a>ç¬¬9ç« : ç§æœ‰ / å…¬å…±å‡½æ•°</h3><p>Solidity å®šä¹‰çš„å‡½æ•°çš„å±æ€§é»˜è®¤ä¸º<code>å…¬å…±</code>ã€‚ è¿™å°±æ„å‘³ç€ä»»ä½•ä¸€æ–¹ (æˆ–å…¶å®ƒåˆçº¦) éƒ½å¯ä»¥è°ƒç”¨ä½ åˆçº¦é‡Œçš„å‡½æ•°ã€‚</p>
<p>æ˜¾ç„¶ï¼Œä¸æ˜¯ä»€ä¹ˆæ—¶å€™éƒ½éœ€è¦è¿™æ ·ï¼Œè€Œä¸”è¿™æ ·çš„åˆçº¦æ˜“äºå—åˆ°æ”»å‡»ã€‚ æ‰€ä»¥å°†è‡ªå·±çš„å‡½æ•°å®šä¹‰ä¸º<code>ç§æœ‰</code>æ˜¯ä¸€ä¸ªå¥½çš„ç¼–ç¨‹ä¹ æƒ¯ï¼Œåªæœ‰å½“ä½ éœ€è¦å¤–éƒ¨ä¸–ç•Œè°ƒç”¨å®ƒæ—¶æ‰å°†å®ƒè®¾ç½®ä¸º<code>å…¬å…±</code>ã€‚</p>
<p>å¦‚ä½•å®šä¹‰ä¸€ä¸ªç§æœ‰çš„å‡½æ•°å‘¢ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">uint[] numbers;</span><br><span class="line"></span><br><span class="line">function _addToArray(uint _number) private {</span><br><span class="line">  numbers.push(_number);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ„å‘³ç€åªæœ‰æˆ‘ä»¬åˆçº¦ä¸­çš„å…¶å®ƒå‡½æ•°æ‰èƒ½å¤Ÿè°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œç»™ <code>numbers</code> æ•°ç»„æ·»åŠ æ–°æˆå‘˜ã€‚</p>
<p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨**<u>å‡½æ•°åå­—åé¢ä½¿ç”¨å…³é”®å­— <code>private</code> å³å¯</u><strong>ã€‚</strong><u>å’Œå‡½æ•°çš„å‚æ•°ç±»ä¼¼ï¼Œç§æœ‰å‡½æ•°çš„åå­—ç”¨(<code>_</code>)èµ·å§‹ã€‚</u>**</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬åˆçº¦çš„å‡½æ•° <code>createZombie</code> çš„é»˜è®¤å±æ€§æ˜¯å…¬å…±çš„ï¼Œè¿™æ„å‘³ç€ä»»ä½•ä¸€æ–¹éƒ½å¯ä»¥è°ƒç”¨å®ƒå»åˆ›å»ºä¸€ä¸ªåƒµå°¸ã€‚ å’±ä»¬æ¥æŠŠå®ƒå˜æˆç§æœ‰å§ï¼</p>
<ol>
<li>å˜ <code>createZombie</code> ä¸ºç§æœ‰å‡½æ•°ï¼Œä¸è¦å¿˜è®°éµå®ˆå‘½åçš„è§„çŸ©å“¦ï¼</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) private {</span><br><span class="line">        zombies.push(Zombie(_name, _dna));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬10ç« -å‡½æ•°çš„æ›´å¤šå±æ€§"><a href="#ç¬¬10ç« -å‡½æ•°çš„æ›´å¤šå±æ€§" class="headerlink" title="ç¬¬10ç« : å‡½æ•°çš„æ›´å¤šå±æ€§"></a>ç¬¬10ç« : å‡½æ•°çš„æ›´å¤šå±æ€§</h3><p>æœ¬ç« ä¸­æˆ‘ä»¬å°†å­¦ä¹ å‡½æ•°çš„è¿”å›å€¼å’Œä¿®é¥°ç¬¦ã€‚</p>
<p><strong>è¿”å›å€¼</strong></p>
<p>è¦æƒ³å‡½æ•°è¿”å›ä¸€ä¸ªæ•°å€¼ï¼ŒæŒ‰å¦‚ä¸‹å®šä¹‰ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">string greeting = "What's up dog";</span><br><span class="line"></span><br><span class="line">function sayHello() public returns (string) {</span><br><span class="line">  return greeting;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>Solidity é‡Œï¼Œå‡½æ•°çš„å®šä¹‰é‡Œå¯åŒ…å«è¿”å›å€¼çš„æ•°æ®ç±»å‹(å¦‚æœ¬ä¾‹ä¸­ <code>string</code>)ã€‚</p>
<p><strong>å‡½æ•°çš„ä¿®é¥°ç¬¦</strong></p>
<p>ä¸Šé¢çš„å‡½æ•°å®é™…ä¸Šæ²¡æœ‰æ”¹å˜ Solidity é‡Œçš„çŠ¶æ€ï¼Œå³ï¼Œå®ƒæ²¡æœ‰æ”¹å˜ä»»ä½•å€¼æˆ–è€…å†™ä»»ä½•ä¸œè¥¿ã€‚</p>
<p>è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥æŠŠå‡½æ•°å®šä¹‰ä¸º <strong>view</strong>, æ„å‘³ç€å®ƒåªèƒ½è¯»å–æ•°æ®ä¸èƒ½æ›´æ”¹æ•°æ®:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function sayHello() public view returns (string) {</span><br></pre></td></tr></tbody></table></figure>

<p>Solidity è¿˜æ”¯æŒ <strong>pure</strong> å‡½æ•°, è¡¨æ˜è¿™ä¸ªå‡½æ•°ç”šè‡³éƒ½ä¸è®¿é—®åº”ç”¨é‡Œçš„æ•°æ®ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function _multiply(uint a, uint b) private pure returns (uint) {</span><br><span class="line">  return a * b;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><u><strong>è¿™ä¸ªå‡½æ•°ç”šè‡³éƒ½ä¸è¯»å–åº”ç”¨é‡Œçš„çŠ¶æ€ â€” å®ƒçš„è¿”å›å€¼å®Œå…¨å–å†³äºå®ƒçš„è¾“å…¥å‚æ•°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬æŠŠå‡½æ•°å®šä¹‰ä¸º pure.</strong></u></p>
<blockquote>
<p>æ³¨ï¼šå¯èƒ½å¾ˆéš¾è®°ä½ä½•æ—¶æŠŠå‡½æ•°æ ‡è®°ä¸º pure/viewã€‚ å¹¸è¿çš„æ˜¯ï¼Œ Solidity ç¼–è¾‘å™¨ä¼šç»™å‡ºæç¤ºï¼Œæé†’ä½ ä½¿ç”¨è¿™äº›ä¿®é¥°ç¬¦ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æƒ³å»ºç«‹ä¸€ä¸ªå¸®åŠ©å‡½æ•°ï¼Œå®ƒæ ¹æ®ä¸€ä¸ªå­—ç¬¦ä¸²éšæœºç”Ÿæˆä¸€ä¸ªDNAæ•°æ®ã€‚</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª <code>private</code> å‡½æ•°ï¼Œå‘½åä¸º <code>_generateRandomDna</code>ã€‚å®ƒåªæ¥æ”¶ä¸€ä¸ªè¾“å…¥å˜é‡ <code>_str</code> (ç±»å‹ <code>string</code>), è¿”å›ä¸€ä¸ª <code>uint</code> ç±»å‹çš„æ•°å€¼ã€‚</li>
<li>æ­¤å‡½æ•°åªè¯»å–æˆ‘ä»¬åˆçº¦ä¸­çš„ä¸€äº›å˜é‡ï¼Œæ‰€ä»¥æ ‡è®°ä¸º<code>view</code>ã€‚</li>
<li>å‡½æ•°å†…éƒ¨æš‚æ—¶ç•™ç©ºï¼Œä»¥åæˆ‘ä»¬å†æ·»åŠ ä»£ç ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) private {</span><br><span class="line">        zombies.push(Zombie(_name, _dna));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) {</span><br><span class="line">        </span><br><span class="line">    }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬11ç« -Keccak256-å’Œ-ç±»å‹è½¬æ¢"><a href="#ç¬¬11ç« -Keccak256-å’Œ-ç±»å‹è½¬æ¢" class="headerlink" title="ç¬¬11ç« : Keccak256 å’Œ ç±»å‹è½¬æ¢"></a>ç¬¬11ç« : Keccak256 å’Œ ç±»å‹è½¬æ¢</h3><p>å¦‚ä½•è®© <code>_generateRandomDna</code> å‡½æ•°è¿”å›ä¸€ä¸ªå…¨(åŠ) éšæœºçš„ <code>uint</code>?</p>
<p>Ethereum å†…éƒ¨æœ‰ä¸€ä¸ªæ•£åˆ—å‡½æ•°<code>keccak256</code>ï¼Œå®ƒç”¨äº†SHA3ç‰ˆæœ¬ã€‚ä¸€ä¸ªæ•£åˆ—å‡½æ•°åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä¸€ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ª256ä½çš„16è¿›åˆ¶æ•°å­—ã€‚å­—ç¬¦ä¸²çš„ä¸€ä¸ªå¾®å°å˜åŒ–ä¼šå¼•èµ·æ•£åˆ—æ•°æ®æå¤§å˜åŒ–ã€‚</p>
<p>è¿™åœ¨ Ethereum ä¸­æœ‰å¾ˆå¤šåº”ç”¨ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬åªæ˜¯ç”¨å®ƒé€ ä¸€ä¸ªä¼ªéšæœºæ•°ã€‚</p>
<p>ä¾‹å­:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//6e91ec6b618bb462a4a6ee5aa2cb0e9cf30f7a052bb467b0ba58b8748c00d2e5</span><br><span class="line">keccak256("aaaab");</span><br><span class="line">//b1f078126895a1424524de5321b339ab00408010b7cf0e6ed451514981e58aa9</span><br><span class="line">keccak256("aaaac");</span><br></pre></td></tr></tbody></table></figure>

<p>æ˜¾è€Œæ˜“è§ï¼Œè¾“å…¥å­—ç¬¦ä¸²åªæ”¹å˜äº†ä¸€ä¸ªå­—æ¯ï¼Œè¾“å‡ºå°±å·²ç»å¤©å£¤ä¹‹åˆ«äº†ã€‚</p>
<blockquote>
<p>æ³¨: åœ¨åŒºå—é“¾ä¸­<strong>å®‰å…¨åœ°</strong>äº§ç”Ÿä¸€ä¸ªéšæœºæ•°æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜ï¼Œ æœ¬ä¾‹çš„æ–¹æ³•ä¸å®‰å…¨ï¼Œä½†æ˜¯åœ¨æˆ‘ä»¬çš„Zombie DNAç®—æ³•é‡Œä¸æ˜¯é‚£ä¹ˆé‡è¦ï¼Œå·²ç»å¾ˆå¥½åœ°æ»¡è¶³æˆ‘ä»¬çš„éœ€è¦äº†ã€‚</p>
</blockquote>
<p><strong>ç±»å‹è½¬æ¢</strong></p>
<p>æœ‰æ—¶ä½ éœ€è¦å˜æ¢æ•°æ®ç±»å‹ã€‚ä¾‹å¦‚:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">uint8 a = 5;</span><br><span class="line">uint b = 6;</span><br><span class="line">// å°†ä¼šæŠ›å‡ºé”™è¯¯ï¼Œå› ä¸º a * b è¿”å› uint, è€Œä¸æ˜¯ uint8:</span><br><span class="line">uint8 c = a * b;</span><br><span class="line">// æˆ‘ä»¬éœ€è¦å°† b è½¬æ¢ä¸º uint8:</span><br><span class="line">uint8 c = a * uint8(b);</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸Šé¢, <code>a * b</code> è¿”å›ç±»å‹æ˜¯ <code>uint</code>, ä½†æ˜¯å½“æˆ‘ä»¬å°è¯•ç”¨ <code>uint8</code> ç±»å‹æ¥æ”¶æ—¶, å°±ä¼šé€ æˆæ½œåœ¨çš„é”™è¯¯ã€‚å¦‚æœæŠŠå®ƒçš„æ•°æ®ç±»å‹è½¬æ¢ä¸º <code>uint8</code>, å°±å¯ä»¥äº†ï¼Œç¼–è¯‘å™¨ä¹Ÿä¸ä¼šå‡ºé”™ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ç»™ <code>_generateRandomDna</code> å‡½æ•°æ·»åŠ ä»£ç ! å®ƒåº”è¯¥å®Œæˆå¦‚ä¸‹åŠŸèƒ½:</p>
<ol>
<li>ç¬¬ä¸€è¡Œä»£ç å– <code>_str</code> çš„ <code>keccak256</code> æ•£åˆ—å€¼ç”Ÿæˆä¸€ä¸ªä¼ªéšæœºåå…­è¿›åˆ¶æ•°ï¼Œç±»å‹è½¬æ¢ä¸º <code>uint</code>, æœ€åä¿å­˜åœ¨ç±»å‹ä¸º <code>uint</code> åä¸º <code>rand</code> çš„å˜é‡ä¸­ã€‚</li>
<li>æˆ‘ä»¬åªæƒ³è®©æˆ‘ä»¬çš„DNAçš„é•¿åº¦ä¸º16ä½ (è¿˜è®°å¾— <code>dnaModulus</code>?)ã€‚æ‰€ä»¥ç¬¬äºŒè¡Œä»£ç åº”è¯¥ <code>return</code> ä¸Šé¢è®¡ç®—çš„æ•°å€¼å¯¹ <code>dnaModulus</code> æ±‚ä½™æ•°(<code>%</code>)ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) private {</span><br><span class="line">        zombies.push(Zombie(_name, _dna));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) {</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬12ç« -æ”¾åœ¨ä¸€èµ·"><a href="#ç¬¬12ç« -æ”¾åœ¨ä¸€èµ·" class="headerlink" title="ç¬¬12ç« : æ”¾åœ¨ä¸€èµ·"></a>ç¬¬12ç« : æ”¾åœ¨ä¸€èµ·</h3><p>æˆ‘ä»¬å°±å¿«å®Œæˆæˆ‘ä»¬çš„éšæœºåƒµå°¸åˆ¶é€ å™¨äº†ï¼Œæ¥å†™ä¸€ä¸ªå…¬å…±çš„å‡½æ•°æŠŠæ‰€æœ‰çš„éƒ¨ä»¶è¿æ¥èµ·æ¥ã€‚</p>
<p>å†™ä¸€ä¸ªå…¬å…±å‡½æ•°ï¼Œå®ƒæœ‰ä¸€ä¸ªå‚æ•°ï¼Œç”¨æ¥æ¥æ”¶åƒµå°¸çš„åå­—ï¼Œä¹‹åç”¨å®ƒç”Ÿæˆåƒµå°¸çš„DNAã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>åˆ›å»ºä¸€ä¸ª <code>public</code> å‡½æ•°ï¼Œå‘½åä¸º <code>createRandomZombie</code>. å®ƒå°†è¢«ä¼ å…¥ä¸€ä¸ªå˜é‡ <code>_name</code> (æ•°æ®ç±»å‹æ˜¯ <code>string</code>)ã€‚ *(æ³¨: å®šä¹‰å…¬å…±å‡½æ•° <code>public</code> å’Œå®šä¹‰ä¸€ä¸ªç§æœ‰ <code>private</code> å‡½æ•°çš„åšæ³•ä¸€æ ·)*ã€‚</li>
<li>å‡½æ•°çš„ç¬¬ä¸€è¡Œåº”è¯¥è°ƒç”¨ <code>_generateRandomDna</code> å‡½æ•°ï¼Œä¼ å…¥ <code>_name</code> å‚æ•°, ç»“æœä¿å­˜åœ¨ä¸€ä¸ªç±»å‹ä¸º <code>uint</code> çš„å˜é‡é‡Œï¼Œå‘½åä¸º <code>randDna</code>ã€‚</li>
<li>ç¬¬äºŒè¡Œè°ƒç”¨ <code>_createZombie</code> å‡½æ•°ï¼Œ ä¼ å…¥å‚æ•°ï¼š <code>_name</code> å’Œ <code>randDna</code>ã€‚</li>
<li>æ•´ä¸ªå‡½æ•°åº”è¯¥æ˜¯4è¡Œä»£ç  (åŒ…æ‹¬å‡½æ•°çš„ç»“æŸç¬¦å· <code>}</code> )ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line"></span><br><span class="line">    // è¿™é‡Œå»ºç«‹äº‹ä»¶</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) private {</span><br><span class="line">        zombies.push(Zombie(_name, _dna));</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) {</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function createRandomZombie(string _name) public {</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬13ç« -äº‹ä»¶"><a href="#ç¬¬13ç« -äº‹ä»¶" class="headerlink" title="ç¬¬13ç« : äº‹ä»¶"></a>ç¬¬13ç« : äº‹ä»¶</h3><p>æˆ‘ä»¬çš„åˆçº¦å‡ ä¹å°±è¦å®Œæˆäº†ï¼è®©æˆ‘ä»¬åŠ ä¸Šä¸€ä¸ª<strong>äº‹ä»¶</strong>.</p>
<p><strong>äº‹ä»¶</strong> æ˜¯åˆçº¦å’ŒåŒºå—é“¾é€šè®¯çš„ä¸€ç§æœºåˆ¶ã€‚ä½ çš„å‰ç«¯åº”ç”¨â€œç›‘å¬â€æŸäº›äº‹ä»¶ï¼Œå¹¶åšå‡ºååº”ã€‚</p>
<p>ä¾‹å­:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">// è¿™é‡Œå»ºç«‹äº‹ä»¶</span><br><span class="line">event IntegersAdded(uint x, uint y, uint result);</span><br><span class="line"></span><br><span class="line">function add(uint _x, uint _y) public {</span><br><span class="line">  uint result = _x + _y;</span><br><span class="line">  //è§¦å‘äº‹ä»¶ï¼Œé€šçŸ¥app</span><br><span class="line">  IntegersAdded(_x, _y, result);</span><br><span class="line">  return result;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä½ çš„ app å‰ç«¯å¯ä»¥ç›‘å¬è¿™ä¸ªäº‹ä»¶ã€‚JavaScript å®ç°å¦‚ä¸‹:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">YourContract.IntegersAdded(function(error, result) {</span><br><span class="line">  // å¹²äº›äº‹</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æƒ³æ¯å½“ä¸€ä¸ªåƒµå°¸åˆ›é€ å‡ºæ¥æ—¶ï¼Œæˆ‘ä»¬çš„å‰ç«¯éƒ½èƒ½ç›‘å¬åˆ°è¿™ä¸ªäº‹ä»¶ï¼Œå¹¶å°†å®ƒæ˜¾ç¤ºå‡ºæ¥ã€‚</p>
<p>1ã€‚ å®šä¹‰ä¸€ä¸ª <code>äº‹ä»¶</code> å«åš <code>NewZombie</code>ã€‚ å®ƒæœ‰3ä¸ªå‚æ•°: <code>zombieId</code> (<code>uint</code>)ï¼Œ <code>name</code> (<code>string</code>)ï¼Œ å’Œ <code>dna</code> (<code>uint</code>)ã€‚</p>
<p>2ã€‚ ä¿®æ”¹ <code>_createZombie</code> å‡½æ•°ä½¿å¾—å½“æ–°åƒµå°¸é€ å‡ºæ¥å¹¶åŠ å…¥ <code>zombies</code>æ•°ç»„åï¼Œç”Ÿæˆäº‹ä»¶<code>NewZombie</code>ã€‚</p>
<p>3ã€‚ éœ€è¦å®šä¹‰åƒµå°¸<code>id</code>ã€‚ <code>array.push()</code> è¿”å›æ•°ç»„çš„é•¿åº¦ç±»å‹æ˜¯<code>uint</code> - å› ä¸ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•æ˜¯ 0ï¼Œ <code>array.push() - 1</code> å°†æ˜¯æˆ‘ä»¬åŠ å…¥çš„åƒµå°¸çš„ç´¢å¼•ã€‚ <code>zombies.push() - 1</code> å°±æ˜¯ <code>id</code>ï¼Œæ•°æ®ç±»å‹æ˜¯ <code>uint</code>ã€‚åœ¨ä¸‹ä¸€è¡Œä¸­ä½ å¯ä»¥æŠŠå®ƒç”¨åˆ° <code>NewZombie</code> äº‹ä»¶ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">contract ZombieFactory {</span><br><span class="line">	</span><br><span class="line">	// è¿™é‡Œå»ºç«‹äº‹ä»¶</span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    Zombie[] public zombies;</span><br><span class="line"></span><br><span class="line">    function _createZombie(string _name, uint _dna) private {</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna)) - 1;</span><br><span class="line">        //// è¿™é‡Œè§¦å‘äº‹ä»¶</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function _generateRandomDna(string _str) private view returns (uint) {</span><br><span class="line">        uint rand = uint(keccak256(_str));</span><br><span class="line">        return rand % dnaModulus;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    function createRandomZombie(string _name) public {</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬14ç« -Web3-js"><a href="#ç¬¬14ç« -Web3-js" class="headerlink" title="ç¬¬14ç« : Web3.js"></a>ç¬¬14ç« : Web3.js</h3><p>æˆ‘ä»¬çš„ Solidity åˆçº¦å®Œå·¥äº†ï¼ ç°åœ¨æˆ‘ä»¬è¦å†™ä¸€æ®µ JavaScript å‰ç«¯ä»£ç æ¥è°ƒç”¨è¿™ä¸ªåˆçº¦ã€‚</p>
<p>ä»¥å¤ªåŠæœ‰ä¸€ä¸ª JavaScript åº“ï¼Œåä¸º<strong>Web3.js</strong>ã€‚</p>
<p>åœ¨åé¢çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä»¬ä¼šè¿›ä¸€æ­¥åœ°æ•™ä½ å¦‚ä½•å®‰è£…ä¸€ä¸ªåˆçº¦ï¼Œå¦‚ä½•è®¾ç½®Web3.jsã€‚ ä½†æ˜¯ç°åœ¨æˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥äº†è§£ Web3.js æ˜¯å¦‚ä½•å’Œæˆ‘ä»¬å‘å¸ƒçš„åˆçº¦äº¤äº’çš„å§ã€‚</p>
<p>å¦‚æœä¸‹é¢çš„ä»£ç ä½ ä¸èƒ½å…¨éƒ½ç†è§£ï¼Œä¸ç”¨æ‹…å¿ƒã€‚</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸‹é¢æ˜¯è°ƒç”¨åˆçº¦çš„æ–¹å¼:</span></span><br><span class="line"><span class="keyword">var</span> abi = <span class="comment">/* abiæ˜¯ç”±ç¼–è¯‘å™¨ç”Ÿæˆçš„ */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ZombieFactoryContract</span> = web3.<span class="property">eth</span>.<span class="title function_">contract</span>(abi)</span><br><span class="line"><span class="keyword">var</span> contractAddress = <span class="comment">/* å‘å¸ƒä¹‹ååœ¨ä»¥å¤ªåŠä¸Šç”Ÿæˆçš„åˆçº¦åœ°å€ */</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">ZombieFactory</span> = <span class="title class_">ZombieFactoryContract</span>.<span class="title function_">at</span>(contractAddress)</span><br><span class="line"><span class="comment">// `ZombieFactory` èƒ½è®¿é—®å…¬å…±çš„å‡½æ•°ä»¥åŠäº‹ä»¶</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸä¸ªç›‘å¬æ–‡æœ¬è¾“å…¥çš„ç›‘å¬å™¨:</span></span><br><span class="line">$(<span class="string">"#ourButton"</span>).<span class="title function_">click</span>(<span class="keyword">function</span>(<span class="params">e</span>) {</span><br><span class="line">  <span class="keyword">var</span> name = $(<span class="string">"#nameInput"</span>).<span class="title function_">val</span>()</span><br><span class="line">  <span class="comment">//è°ƒç”¨åˆçº¦çš„ `createRandomZombie` å‡½æ•°:</span></span><br><span class="line">  <span class="title class_">ZombieFactory</span>.<span class="title function_">createRandomZombie</span>(name)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç›‘å¬ `NewZombie` äº‹ä»¶, å¹¶ä¸”æ›´æ–°UI</span></span><br><span class="line"><span class="keyword">var</span> event = <span class="title class_">ZombieFactory</span>.<span class="title class_">NewZombie</span>(<span class="keyword">function</span>(<span class="params">error, result</span>) {</span><br><span class="line">  <span class="keyword">if</span> (error) <span class="keyword">return</span></span><br><span class="line">  <span class="title function_">generateZombie</span>(result.<span class="property">zombieId</span>, result.<span class="property">name</span>, result.<span class="property">dna</span>)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·å– Zombie çš„ dna, æ›´æ–°å›¾åƒ</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateZombie</span>(<span class="params">id, name, dna</span>) {</span><br><span class="line">  <span class="keyword">let</span> dnaStr = <span class="title class_">String</span>(dna)</span><br><span class="line">  <span class="comment">// å¦‚æœdnaå°‘äº16ä½,åœ¨å®ƒå‰é¢ç”¨0è¡¥ä¸Š</span></span><br><span class="line">  <span class="keyword">while</span> (dnaStr.<span class="property">length</span> &lt; <span class="number">16</span>)</span><br><span class="line">    dnaStr = <span class="string">"0"</span> + dnaStr</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> zombieDetails = {</span><br><span class="line">    <span class="comment">// å‰ä¸¤ä½æ•°æ„æˆå¤´éƒ¨.æˆ‘ä»¬å¯èƒ½æœ‰7ç§å¤´éƒ¨, æ‰€ä»¥ % 7</span></span><br><span class="line">    <span class="comment">// å¾—åˆ°çš„æ•°åœ¨0-6,å†åŠ ä¸Š1,æ•°çš„èŒƒå›´å˜æˆ1-7</span></span><br><span class="line">    <span class="comment">// é€šè¿‡è¿™æ ·è®¡ç®—ï¼š</span></span><br><span class="line">    <span class="attr">headChoice</span>: dnaStr.<span class="title function_">substring</span>(<span class="number">0</span>, <span class="number">2</span>) % <span class="number">7</span> + <span class="number">1</span>ï¼Œ</span><br><span class="line">    <span class="comment">// æˆ‘ä»¬å¾—åˆ°çš„å›¾ç‰‡åç§°ä»head1.png åˆ° head7.png</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¥ä¸‹æ¥çš„ä¸¤ä½æ•°æ„æˆçœ¼ç›, çœ¼ç›å˜åŒ–å°±å¯¹11å–æ¨¡:</span></span><br><span class="line">    <span class="attr">eyeChoice</span>: dnaStr.<span class="title function_">substring</span>(<span class="number">2</span>, <span class="number">4</span>) % <span class="number">11</span> + <span class="number">1</span>,</span><br><span class="line">    <span class="comment">// å†æ¥ä¸‹æ¥çš„ä¸¤ä½æ•°æ„æˆè¡£æœï¼Œè¡£æœå˜åŒ–å°±å¯¹6å–æ¨¡:</span></span><br><span class="line">    <span class="attr">shirtChoice</span>: dnaStr.<span class="title function_">substring</span>(<span class="number">4</span>, <span class="number">6</span>) % <span class="number">6</span> + <span class="number">1</span>,</span><br><span class="line">    <span class="comment">//æœ€å6ä½æ§åˆ¶é¢œè‰². ç”¨cssé€‰æ‹©å™¨: hue-rotateæ¥æ›´æ–°</span></span><br><span class="line">    <span class="comment">// 360åº¦:</span></span><br><span class="line">    <span class="attr">skinColorChoice</span>: <span class="built_in">parseInt</span>(dnaStr.<span class="title function_">substring</span>(<span class="number">6</span>, <span class="number">8</span>) / <span class="number">100</span> * <span class="number">360</span>),</span><br><span class="line">    <span class="attr">eyeColorChoice</span>: <span class="built_in">parseInt</span>(dnaStr.<span class="title function_">substring</span>(<span class="number">8</span>, <span class="number">10</span>) / <span class="number">100</span> * <span class="number">360</span>),</span><br><span class="line">    <span class="attr">clothesColorChoice</span>: <span class="built_in">parseInt</span>(dnaStr.<span class="title function_">substring</span>(<span class="number">10</span>, <span class="number">12</span>) / <span class="number">100</span> * <span class="number">360</span>),</span><br><span class="line">    <span class="attr">zombieName</span>: name,</span><br><span class="line">    <span class="attr">zombieDescription</span>: <span class="string">"A Level 1 CryptoZombie"</span>,</span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">return</span> zombieDetails</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬çš„ JavaScript æ‰€åšçš„å°±æ˜¯è·å–ç”±<code>zombieDetails</code> äº§ç”Ÿçš„æ•°æ®, å¹¶ä¸”åˆ©ç”¨æµè§ˆå™¨é‡Œçš„ JavaScript ç¥å¥‡åŠŸèƒ½ (æˆ‘ä»¬ç”¨ Vue.js)ï¼Œç½®æ¢å‡ºå›¾åƒä»¥åŠä½¿ç”¨CSSè¿‡æ»¤å™¨ã€‚åœ¨åé¢çš„è¯¾ç¨‹ä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ°å…¨éƒ¨çš„ä»£ç ã€‚</p>
<h2 id="lesson2-åƒµå°¸æ”»å‡»äººç±»"><a href="#lesson2-åƒµå°¸æ”»å‡»äººç±»" class="headerlink" title="lesson2 åƒµå°¸æ”»å‡»äººç±»"></a>lesson2 åƒµå°¸æ”»å‡»äººç±»</h2><h3 id="ç¬¬2ç« -æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰"><a href="#ç¬¬2ç« -æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰" class="headerlink" title="ç¬¬2ç« : æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰"></a>ç¬¬2ç« : æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰</h3><p>æˆ‘ä»¬é€šè¿‡ç»™æ•°æ®åº“ä¸­çš„åƒµå°¸æŒ‡å®šâ€œä¸»äººâ€ï¼Œ æ¥æ”¯æŒâ€œå¤šç©å®¶â€æ¨¡å¼ã€‚</p>
<p>å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬éœ€è¦å¼•å…¥2ä¸ªæ–°çš„æ•°æ®ç±»å‹ï¼š<code>mapping</code>ï¼ˆæ˜ å°„ï¼‰ å’Œ <code>address</code>ï¼ˆåœ°å€ï¼‰ã€‚</p>
<p><strong>Addresses ï¼ˆåœ°å€ï¼‰</strong></p>
<p>ä»¥å¤ªåŠåŒºå—é“¾ç”± <strong>_ account _</strong> (è´¦æˆ·)ç»„æˆï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦æˆ·ã€‚ä¸€ä¸ªå¸æˆ·çš„ä½™é¢æ˜¯ <strong><em>ä»¥å¤ª</em></strong> ï¼ˆåœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šä½¿ç”¨çš„å¸ç§ï¼‰ï¼Œä½ å¯ä»¥å’Œå…¶ä»–å¸æˆ·ä¹‹é—´æ”¯ä»˜å’Œæ¥å—ä»¥å¤ªå¸ï¼Œå°±åƒä½ çš„é“¶è¡Œå¸æˆ·å¯ä»¥ç”µæ±‡èµ„é‡‘åˆ°å…¶ä»–é“¶è¡Œå¸æˆ·ä¸€æ ·ã€‚</p>
<p>æ¯ä¸ªå¸æˆ·éƒ½æœ‰ä¸€ä¸ªâ€œåœ°å€â€ï¼Œä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆé“¶è¡Œè´¦å·ã€‚è¿™æ˜¯è´¦æˆ·å”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼Œå®ƒçœ‹èµ·æ¥é•¿è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x0cE446255506E92DF41614C46F1d6df9Cc969183</span><br></pre></td></tr></tbody></table></figure>

<p>ï¼ˆè¿™æ˜¯ CryptoZombies å›¢é˜Ÿçš„åœ°å€ï¼Œå¦‚æœä½ å–œæ¬¢ CryptoZombies çš„è¯ï¼Œè¯·æ‰“èµæˆ‘ä»¬ä¸€äº›ä»¥å¤ªå¸ï¼ğŸ˜‰ï¼‰</p>
<p>æˆ‘ä»¬å°†åœ¨åé¢çš„è¯¾ç¨‹ä¸­ä»‹ç»åœ°å€çš„ç»†èŠ‚ï¼Œç°åœ¨ä½ åªéœ€è¦äº†è§£<strong>åœ°å€å±äºç‰¹å®šç”¨æˆ·ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„</strong>ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŒ‡å®šâ€œåœ°å€â€ä½œä¸ºåƒµå°¸ä¸»äººçš„ IDã€‚å½“ç”¨æˆ·é€šè¿‡ä¸æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºäº¤äº’æ¥åˆ›å»ºæ–°çš„åƒµå°¸æ—¶ï¼Œæ–°åƒµå°¸çš„æ‰€æœ‰æƒè¢«è®¾ç½®åˆ°è°ƒç”¨è€…çš„ä»¥å¤ªåŠåœ°å€ä¸‹ã€‚</p>
<p><strong>Mappingï¼ˆæ˜ å°„ï¼‰</strong></p>
<p>åœ¨ç¬¬1è¯¾ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°äº† <strong>ç»“æ„ä½“</strong> å’Œ <strong>æ•°ç»„</strong> ã€‚ <strong>æ˜ å°„</strong> æ˜¯å¦ä¸€ç§åœ¨ Solidity ä¸­å­˜å‚¨æœ‰ç»„ç»‡æ•°æ®çš„æ–¹æ³•ã€‚</p>
<p>æ˜ å°„æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">//å¯¹äºé‡‘èåº”ç”¨ç¨‹åºï¼Œå°†ç”¨æˆ·çš„ä½™é¢ä¿å­˜åœ¨ä¸€ä¸ª uintç±»å‹çš„å˜é‡ä¸­ï¼š</span><br><span class="line">mapping (address =&gt; uint) public accountBalance;</span><br><span class="line">//æˆ–è€…å¯ä»¥ç”¨æ¥é€šè¿‡userId å­˜å‚¨/æŸ¥æ‰¾çš„ç”¨æˆ·å</span><br><span class="line">mapping (uint =&gt; string) userIdToName;</span><br></pre></td></tr></tbody></table></figure>

<p>æ˜ å°„æœ¬è´¨ä¸Šæ˜¯å­˜å‚¨å’ŒæŸ¥æ‰¾æ•°æ®æ‰€ç”¨çš„<strong>é”®-å€¼å¯¹</strong>ã€‚åœ¨ç¬¬ä¸€ä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ª <code>address</code>ï¼Œå€¼æ˜¯ä¸€ä¸ª <code>uint</code>ï¼Œåœ¨ç¬¬äºŒä¸ªä¾‹å­ä¸­ï¼Œé”®æ˜¯ä¸€ä¸ª<code>uint</code>ï¼Œå€¼æ˜¯ä¸€ä¸ª <code>string</code>ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ä¸ºäº†å­˜å‚¨åƒµå°¸çš„æ‰€æœ‰æƒï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨åˆ°ä¸¤ä¸ªæ˜ å°„ï¼šä¸€ä¸ªè®°å½•åƒµå°¸æ‹¥æœ‰è€…çš„åœ°å€ï¼Œå¦ä¸€ä¸ªè®°å½•æŸåœ°å€æ‰€æ‹¥æœ‰åƒµå°¸çš„æ•°é‡ã€‚</p>
<p>1.åˆ›å»ºä¸€ä¸ªå«åš <code>zombieToOwner</code> çš„æ˜ å°„ã€‚å…¶é”®æ˜¯ä¸€ä¸ª<code>uint</code>ï¼ˆæˆ‘ä»¬å°†æ ¹æ®å®ƒçš„ id å­˜å‚¨å’ŒæŸ¥æ‰¾åƒµå°¸ï¼‰ï¼Œå€¼ä¸º <code>address</code>ã€‚æ˜ å°„å±æ€§ä¸º<code>public</code>ã€‚</p>
<p>2.åˆ›å»ºä¸€ä¸ªåä¸º <code>ownerZombieCount</code> çš„æ˜ å°„ï¼Œå…¶ä¸­é”®æ˜¯ <code>address</code>ï¼Œå€¼æ˜¯ <code>uint</code>ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œå®šä¹‰æ˜ å°„</span><br><span class="line">mapping (uint =&gt; address ) public zombieToOwner;</span><br><span class="line">mapping ( address =&gt; uint) ownerZombieCount;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬3ç« -Msg-sender"><a href="#ç¬¬3ç« -Msg-sender" class="headerlink" title="ç¬¬3ç« : Msg.sender"></a>ç¬¬3ç« : Msg.sender</h3><p>ç°åœ¨æœ‰äº†ä¸€å¥—æ˜ å°„æ¥è®°å½•åƒµå°¸çš„æ‰€æœ‰æƒäº†ï¼Œæˆ‘ä»¬å¯ä»¥ä¿®æ”¹ <code>_createZombie</code> æ–¹æ³•æ¥è¿ç”¨å®ƒä»¬ã€‚</p>
<p>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦ç”¨åˆ° <code>msg.sender</code>ã€‚</p>
<p><strong>msg.sender</strong></p>
<p>åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸€äº›å…¨å±€å˜é‡å¯ä»¥è¢«æ‰€æœ‰å‡½æ•°è°ƒç”¨ã€‚ å…¶ä¸­ä¸€ä¸ªå°±æ˜¯ <code>msg.sender</code>ï¼Œå®ƒæŒ‡çš„æ˜¯å½“å‰è°ƒç”¨è€…ï¼ˆæˆ–æ™ºèƒ½åˆçº¦ï¼‰çš„ <code>address</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼ŒåŠŸèƒ½æ‰§è¡Œå§‹ç»ˆéœ€è¦ä»å¤–éƒ¨è°ƒç”¨è€…å¼€å§‹ã€‚ ä¸€ä¸ªåˆçº¦åªä¼šåœ¨åŒºå—é“¾ä¸Šä»€ä¹ˆä¹Ÿä¸åšï¼Œé™¤éæœ‰äººè°ƒç”¨å…¶ä¸­çš„å‡½æ•°ã€‚æ‰€ä»¥ <code>msg.sender</code>æ€»æ˜¯å­˜åœ¨çš„ã€‚</p>
</blockquote>
<p>ä»¥ä¸‹æ˜¯ä½¿ç”¨ <code>msg.sender</code> æ¥æ›´æ–° <code>mapping</code> çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">mapping (address =&gt; uint) favoriteNumber;</span><br><span class="line"></span><br><span class="line">function setMyNumber(uint _myNumber) public {</span><br><span class="line">  // æ›´æ–°æˆ‘ä»¬çš„ `favoriteNumber` æ˜ å°„æ¥å°† `_myNumber`å­˜å‚¨åœ¨ `msg.sender`åä¸‹</span><br><span class="line">  favoriteNumber[msg.sender] = _myNumber;</span><br><span class="line">  // å­˜å‚¨æ•°æ®è‡³æ˜ å°„çš„æ–¹æ³•å’Œå°†æ•°æ®å­˜å‚¨åœ¨æ•°ç»„ç›¸ä¼¼</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function whatIsMyNumber() public view returns (uint) {</span><br><span class="line">  // æ‹¿åˆ°å­˜å‚¨åœ¨è°ƒç”¨è€…åœ°å€åä¸‹çš„å€¼</span><br><span class="line">  // è‹¥è°ƒç”¨è€…è¿˜æ²¡è°ƒç”¨ setMyNumberï¼Œ åˆ™å€¼ä¸º `0`</span><br><span class="line">  return favoriteNumber[msg.sender];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿™ä¸ªå°å°çš„ä¾‹å­ä¸­ï¼Œä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨ <code>setMyNumber</code> åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å­˜ä¸‹ä¸€ä¸ª <code>uint</code> å¹¶ä¸”ä¸ä»–ä»¬çš„åœ°å€ç›¸ç»‘å®šã€‚ ç„¶åï¼Œä»–ä»¬è°ƒç”¨ <code>whatIsMyNumber</code> å°±ä¼šè¿”å›ä»–ä»¬å­˜å‚¨çš„ <code>uint</code>ã€‚</p>
<p>ä½¿ç”¨ <code>msg.sender</code> å¾ˆå®‰å…¨ï¼Œå› ä¸ºå®ƒå…·æœ‰ä»¥å¤ªåŠåŒºå—é“¾çš„å®‰å…¨ä¿éšœ â€”â€” é™¤éçªƒå–ä¸ä»¥å¤ªåŠåœ°å€ç›¸å…³è”çš„ç§é’¥ï¼Œå¦åˆ™æ˜¯æ²¡æœ‰åŠæ³•ä¿®æ”¹å…¶ä»–äººçš„æ•°æ®çš„ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æ¥ä¿®æ”¹ç¬¬1è¯¾çš„ <code>_createZombie</code> æ–¹æ³•ï¼Œå°†åƒµå°¸åˆ†é…ç»™å‡½æ•°è°ƒç”¨è€…å§ã€‚</p>
<ol>
<li>é¦–å…ˆï¼Œåœ¨å¾—åˆ°æ–°çš„åƒµå°¸ <code>id</code> åï¼Œæ›´æ–° <code>zombieToOwner</code> æ˜ å°„ï¼Œåœ¨ <code>id</code> ä¸‹é¢å­˜å…¥ <code>msg.sender</code>ã€‚</li>
<li>ç„¶åï¼Œæˆ‘ä»¬ä¸ºè¿™ä¸ª <code>msg.sender</code> åä¸‹çš„ <code>ownerZombieCount</code> åŠ  1ã€‚</li>
</ol>
<p>è·Ÿåœ¨ JavaScript ä¸­ä¸€æ ·ï¼Œ åœ¨ Solidity ä¸­ä½ ä¹Ÿå¯ä»¥ç”¨ <code>++</code> ä½¿ <code>uint</code> é€’å¢ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uint number = 0;</span><br><span class="line">number++;</span><br><span class="line">// `number` ç°åœ¨æ˜¯ `1`äº†</span><br></pre></td></tr></tbody></table></figure>

<p>ä¿®æ”¹ä¸¤è¡Œä»£ç å³å¯ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">function _createZombie(string _name, uint _dna) private {</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna)) - 1;</span><br><span class="line">        // ä»è¿™é‡Œå¼€å§‹</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬4ç« -Require"><a href="#ç¬¬4ç« -Require" class="headerlink" title="ç¬¬4ç« : Require"></a>ç¬¬4ç« : Require</h3><p>åœ¨ç¬¬ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬æˆåŠŸè®©ç”¨æˆ·é€šè¿‡è°ƒç”¨ <code>createRandomZombie</code>å‡½æ•° å¹¶è¾“å…¥ä¸€ä¸ªåå­—æ¥åˆ›å»ºæ–°çš„åƒµå°¸ã€‚ ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·èƒ½æŒç»­è°ƒç”¨è¿™ä¸ªå‡½æ•°æ¥åˆ›å»ºå‡ºæ— é™å¤šä¸ªåƒµå°¸åŠ å…¥ä»–ä»¬çš„å†›å›¢ï¼Œè¿™æ¸¸æˆå°±å¤ªæ²¡æ„æ€äº†ï¼</p>
<p>äºæ˜¯ï¼Œæˆ‘ä»¬ä½œå‡ºé™å®šï¼šæ¯ä¸ªç©å®¶åªèƒ½è°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå‡½æ•°ã€‚ è¿™æ ·ä¸€æ¥ï¼Œæ–°ç©å®¶å¯ä»¥åœ¨åˆšå¼€å§‹ç©æ¸¸æˆæ—¶é€šè¿‡è°ƒç”¨å®ƒï¼Œä¸ºå…¶å†›å›¢åˆ›å»ºåˆå§‹åƒµå°¸ã€‚</p>
<p>æˆ‘ä»¬æ€æ ·æ‰èƒ½é™å®šæ¯ä¸ªç©å®¶åªè°ƒç”¨ä¸€æ¬¡è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿ</p>
<p>ç­”æ¡ˆæ˜¯ä½¿ç”¨<code>require</code>ã€‚ <code>require</code>ä½¿å¾—å‡½æ•°åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“ä¸æ»¡è¶³æŸäº›æ¡ä»¶æ—¶æŠ›å‡ºé”™è¯¯ï¼Œå¹¶åœæ­¢æ‰§è¡Œï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function sayHiToVitalik(string _name) public returns (string) {</span><br><span class="line">  // æ¯”è¾ƒ _name æ˜¯å¦ç­‰äº "Vitalik". å¦‚æœä¸æˆç«‹ï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶ç»ˆæ­¢ç¨‹åº</span><br><span class="line">  // (æ•²é»‘æ¿: Solidity å¹¶ä¸æ”¯æŒåŸç”Ÿçš„å­—ç¬¦ä¸²æ¯”è¾ƒ, æˆ‘ä»¬åªèƒ½é€šè¿‡æ¯”è¾ƒ</span><br><span class="line">  // ä¸¤å­—ç¬¦ä¸²çš„ keccak256 å“ˆå¸Œå€¼æ¥è¿›è¡Œåˆ¤æ–­)</span><br><span class="line">  require(keccak256(_name) == keccak256("Vitalik"));</span><br><span class="line">  // å¦‚æœè¿”å› true, è¿è¡Œå¦‚ä¸‹è¯­å¥</span><br><span class="line">  return "Hi!";</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœä½ è¿™æ ·è°ƒç”¨å‡½æ•° <code>sayHiToVitalikï¼ˆâ€œVitalikâ€ï¼‰</code> ,å®ƒä¼šè¿”å›â€œHiï¼â€ã€‚è€Œå¦‚æœè°ƒç”¨çš„æ—¶å€™ä½¿ç”¨äº†å…¶ä»–å‚æ•°ï¼Œå®ƒåˆ™ä¼šæŠ›å‡ºé”™è¯¯å¹¶åœæ­¢æ‰§è¡Œã€‚</p>
<p>å› æ­¤ï¼Œåœ¨è°ƒç”¨ä¸€ä¸ªå‡½æ•°ä¹‹å‰ï¼Œç”¨ <code>require</code> éªŒè¯å‰ç½®æ¡ä»¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>åœ¨æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆä¸­ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·é€šè¿‡åå¤è°ƒç”¨ <code>createRandomZombie</code> æ¥çµ¦ä»–ä»¬çš„å†›é˜Ÿåˆ›å»ºæ— é™å¤šä¸ªåƒµå°¸ â€”â€” è¿™å°†ä½¿å¾—æ¸¸æˆéå¸¸æ— èŠã€‚</p>
<p>æˆ‘ä»¬ä½¿ç”¨äº† <code>require</code> æ¥ç¡®ä¿è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨æ¯ä¸ªç”¨æˆ·ç¬¬ä¸€æ¬¡è°ƒç”¨å®ƒçš„æ—¶å€™æ‰§è¡Œï¼Œç”¨ä»¥åˆ›å»ºåˆå§‹åƒµå°¸ã€‚</p>
<ol>
<li>åœ¨ <code>createRandomZombie</code> çš„å‰é¢æ”¾ç½® <code>require</code> è¯­å¥ã€‚ ä½¿å¾—å‡½æ•°å…ˆæ£€æŸ¥ <code>ownerZombieCount [msg.sender]</code> çš„å€¼ä¸º <code>0</code> ï¼Œä¸ç„¶å°±æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨ Solidity ä¸­ï¼Œå…³é”®è¯æ”¾ç½®çš„é¡ºåºå¹¶ä¸é‡è¦</p>
<ul>
<li>è™½ç„¶å‚æ•°çš„ä¸¤ä¸ªä½ç½®æ˜¯ç­‰æ•ˆçš„ã€‚ ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„ç­”æ¡ˆæ£€æŸ¥å™¨æ¯”è¾ƒå‘†æ¿ï¼Œå®ƒåªèƒ½è®¤å®šå…¶ä¸­ä¸€ä¸ªä¸ºæ­£ç¡®ç­”æ¡ˆ</li>
<li>äºæ˜¯åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°±çº¦å®šæŠŠ<code>ownerZombieCount [msg.sender]</code>æ”¾å‰é¢å§</li>
</ul>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function createRandomZombie(string _name) public {</span><br><span class="line">        // start here</span><br><span class="line">        require(ownerZombieCount[msg.sender] == 0);</span><br><span class="line">        uint randDna = _generateRandomDna(_name);</span><br><span class="line">        _createZombie(_name, randDna);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬5ç« -ç»§æ‰¿ï¼ˆInheritanceï¼‰"><a href="#ç¬¬5ç« -ç»§æ‰¿ï¼ˆInheritanceï¼‰" class="headerlink" title="ç¬¬5ç« : ç»§æ‰¿ï¼ˆInheritanceï¼‰"></a>ç¬¬5ç« : ç»§æ‰¿ï¼ˆInheritanceï¼‰</h3><p>æˆ‘ä»¬çš„æ¸¸æˆä»£ç è¶Šæ¥è¶Šé•¿ã€‚ å½“ä»£ç è¿‡äºå†—é•¿çš„æ—¶å€™ï¼Œæœ€å¥½å°†ä»£ç å’Œé€»è¾‘åˆ†æ‹†åˆ°å¤šä¸ªä¸åŒçš„åˆçº¦ä¸­ï¼Œä»¥ä¾¿äºç®¡ç†ã€‚</p>
<p>æœ‰ä¸ªè®© Solidity çš„ä»£ç æ˜“äºç®¡ç†çš„åŠŸèƒ½ï¼Œå°±æ˜¯åˆçº¦ *<strong>inheritance*</strong> (ç»§æ‰¿)ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contract Doge {</span><br><span class="line">  function catchphrase() public returns (string) {</span><br><span class="line">    return "So Wow CryptoDoge";</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">contract BabyDoge is Doge {</span><br><span class="line">  function anotherCatchphrase() public returns (string) {</span><br><span class="line">    return "Such Moon BabyDoge";</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç”±äº <code>BabyDoge</code> æ˜¯ä» <code>Doge</code> é‚£é‡Œ *<strong>inherits*</strong> ï¼ˆç»§æ‰¿)è¿‡æ¥çš„ã€‚ è¿™æ„å‘³ç€å½“ä½ ç¼–è¯‘å’Œéƒ¨ç½²äº† <code>BabyDoge</code>ï¼Œå®ƒå°†å¯ä»¥è®¿é—® <code>catchphrase()</code> å’Œ <code>anotherCatchphrase()</code>å’Œå…¶ä»–æˆ‘ä»¬åœ¨ <code>Doge</code> ä¸­å®šä¹‰çš„å…¶ä»–å…¬å…±å‡½æ•°ã€‚</p>
<p>è¿™å¯ä»¥ç”¨äºé€»è¾‘ç»§æ‰¿ï¼ˆæ¯”å¦‚è¡¨è¾¾å­ç±»çš„æ—¶å€™ï¼Œ<code>Cat</code> æ˜¯ä¸€ç§ <code>Animal</code>ï¼‰ã€‚ ä½†ä¹Ÿå¯ä»¥ç®€å•åœ°å°†ç±»ä¼¼çš„é€»è¾‘ç»„åˆåˆ°ä¸åŒçš„åˆçº¦ä¸­ä»¥ç»„ç»‡ä»£ç ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†è¦ä¸ºåƒµå°¸å®ç°å„ç§åŠŸèƒ½ï¼Œè®©å®ƒå¯ä»¥â€œçŒé£Ÿâ€å’Œâ€œç¹æ®–â€ã€‚ é€šè¿‡å°†è¿™äº›è¿ç®—æ”¾åˆ°çˆ¶ç±» <code>ZombieFactory</code> ä¸­ï¼Œä½¿å¾—æ‰€æœ‰ <code>ZombieFactory</code> çš„ç»§æ‰¿è€…åˆçº¦éƒ½å¯ä»¥ä½¿ç”¨è¿™äº›æ–¹æ³•ã€‚</p>
<ol>
<li>åœ¨ <code>ZombieFactory</code> ä¸‹åˆ›å»ºä¸€ä¸ªå« <code>ZombieFeeding</code> çš„åˆçº¦ï¼Œå®ƒæ˜¯ç»§æ‰¿è‡ª `ZombieFactory åˆçº¦çš„ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// Start here</span><br><span class="line">contract ZombieFeeding is ZombieFactory {</span><br><span class="line">    </span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬6ç« -å¼•å…¥ï¼ˆImportï¼‰"><a href="#ç¬¬6ç« -å¼•å…¥ï¼ˆImportï¼‰" class="headerlink" title="ç¬¬6ç« : å¼•å…¥ï¼ˆImportï¼‰"></a>ç¬¬6ç« : å¼•å…¥ï¼ˆImportï¼‰</h3><p>å“‡ï¼ä½ æœ‰æ²¡æœ‰æ³¨æ„åˆ°ï¼Œæˆ‘ä»¬åªæ˜¯æ¸…ç†äº†ä¸‹å³è¾¹çš„ä»£ç ï¼Œç°åœ¨ä½ çš„ç¼–è¾‘å™¨çš„é¡¶éƒ¨å°±å¤šäº†ä¸ªé€‰é¡¹å¡ã€‚ å°è¯•ç‚¹å‡»å®ƒçš„æ ‡ç­¾ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆå§ï¼</p>
<p>ä»£ç å·²ç»å¤Ÿé•¿äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒåˆ†æˆå¤šä¸ªæ–‡ä»¶ä»¥ä¾¿äºç®¡ç†ã€‚ é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“ Solidity é¡¹ç›®ä¸­çš„ä»£ç å¤ªé•¿çš„æ—¶å€™æˆ‘ä»¬å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚</p>
<p>åœ¨ Solidity ä¸­ï¼Œå½“ä½ æœ‰å¤šä¸ªæ–‡ä»¶å¹¶ä¸”æƒ³æŠŠä¸€ä¸ªæ–‡ä»¶å¯¼å…¥å¦ä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ <code>import</code> è¯­å¥ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import "./someothercontract.sol";</span><br><span class="line"></span><br><span class="line">contract newContract is SomeOtherContract {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·å½“æˆ‘ä»¬åœ¨åˆçº¦ï¼ˆcontractï¼‰ç›®å½•ä¸‹æœ‰ä¸€ä¸ªåä¸º <code>someothercontract.sol</code> çš„æ–‡ä»¶ï¼ˆ <code>./</code> å°±æ˜¯åŒä¸€ç›®å½•çš„æ„æ€ï¼‰ï¼Œå®ƒå°±ä¼šè¢«ç¼–è¯‘å™¨å¯¼å…¥ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ç°åœ¨æˆ‘ä»¬å·²ç»å»ºç«‹äº†ä¸€ä¸ªå¤šæ–‡ä»¶æ¶æ„ï¼Œå¹¶ç”¨ <code>import</code> æ¥è¯»å–æ¥è‡ªå¦ä¸€ä¸ªæ–‡ä»¶ä¸­åˆçº¦çš„å†…å®¹ï¼š</p>
<p>1.å°† <code>zombiefactory.sol</code> å¯¼å…¥åˆ°æˆ‘ä»¬çš„æ–°æ–‡ä»¶ <code>zombiefeeding.sol</code> ä¸­ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// put import statement here</span><br><span class="line">import "./zombiefactory.sol";</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬7ç« -Storageä¸Memory"><a href="#ç¬¬7ç« -Storageä¸Memory" class="headerlink" title="ç¬¬7ç« : Storageä¸Memory"></a>ç¬¬7ç« : Storageä¸Memory</h3><p>åœ¨ Solidity ä¸­ï¼Œæœ‰ä¸¤ä¸ªåœ°æ–¹å¯ä»¥å­˜å‚¨å˜é‡ â€”â€” <code>storage</code> æˆ– <code>memory</code>ã€‚</p>
<p><strong>Storage</strong> å˜é‡æ˜¯æŒ‡**<u>æ°¸ä¹…å­˜å‚¨</u><strong>åœ¨åŒºå—é“¾ä¸­çš„å˜é‡ã€‚ <strong>Memory</strong> å˜é‡åˆ™æ˜¯</strong><u>ä¸´æ—¶çš„</u>**ï¼Œå½“å¤–éƒ¨å‡½æ•°å¯¹æŸåˆçº¦è°ƒç”¨å®Œæˆæ—¶ï¼Œå†…å­˜å‹å˜é‡å³è¢«ç§»é™¤ã€‚ ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆå­˜å‚¨åœ¨ä½ ç”µè„‘çš„ç¡¬ç›˜æˆ–æ˜¯RAMä¸­æ•°æ®çš„å…³ç³»ã€‚</p>
<p>å¤§å¤šæ•°æ—¶å€™ä½ éƒ½ç”¨ä¸åˆ°è¿™äº›å…³é”®å­—ï¼Œé»˜è®¤æƒ…å†µä¸‹ Solidity ä¼šè‡ªåŠ¨å¤„ç†å®ƒä»¬ã€‚ çŠ¶æ€å˜é‡ï¼ˆåœ¨å‡½æ•°ä¹‹å¤–å£°æ˜çš„å˜é‡ï¼‰é»˜è®¤ä¸ºâ€œå­˜å‚¨â€å½¢å¼ï¼Œå¹¶æ°¸ä¹…å†™å…¥åŒºå—é“¾ï¼›è€Œåœ¨å‡½æ•°å†…éƒ¨å£°æ˜çš„å˜é‡æ˜¯â€œå†…å­˜â€å‹çš„ï¼Œå®ƒä»¬å‡½æ•°è°ƒç”¨ç»“æŸåæ¶ˆå¤±ã€‚</p>
<p>ç„¶è€Œä¹Ÿæœ‰ä¸€äº›æƒ…å†µä¸‹ï¼Œä½ éœ€è¦æ‰‹åŠ¨å£°æ˜å­˜å‚¨ç±»å‹ï¼Œä¸»è¦ç”¨äºå¤„ç†å‡½æ•°å†…çš„ <strong>ç»“æ„ä½“</strong> å’Œ <strong>æ•°ç»„</strong> æ—¶ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">contract SandwichFactory {</span><br><span class="line">  struct Sandwich {</span><br><span class="line">    string name;</span><br><span class="line">    string status;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  Sandwich[] sandwiches;</span><br><span class="line"></span><br><span class="line">  function eatSandwich(uint _index) public {</span><br><span class="line">    // Sandwich mySandwich = sandwiches[_index];</span><br><span class="line"></span><br><span class="line">    // ^ çœ‹ä¸Šå»å¾ˆç›´æ¥ï¼Œä¸è¿‡ Solidity å°†ä¼šç»™å‡ºè­¦å‘Š</span><br><span class="line">    // å‘Šè¯‰ä½ åº”è¯¥æ˜ç¡®åœ¨è¿™é‡Œå®šä¹‰ `storage` æˆ–è€… `memory`ã€‚</span><br><span class="line"></span><br><span class="line">    // æ‰€ä»¥ä½ åº”è¯¥æ˜ç¡®å®šä¹‰ `storage`:</span><br><span class="line">    Sandwich storage mySandwich = sandwiches[_index];</span><br><span class="line">    // ...è¿™æ · `mySandwich` æ˜¯æŒ‡å‘ `sandwiches[_index]`çš„æŒ‡é’ˆ</span><br><span class="line">    // åœ¨å­˜å‚¨é‡Œï¼Œå¦å¤–...</span><br><span class="line">    mySandwich.status = "Eaten!";</span><br><span class="line">    // ...è¿™å°†æ°¸ä¹…æŠŠ `sandwiches[_index]` å˜ä¸ºåŒºå—é“¾ä¸Šçš„å­˜å‚¨</span><br><span class="line"></span><br><span class="line">    // å¦‚æœä½ åªæƒ³è¦ä¸€ä¸ªå‰¯æœ¬ï¼Œå¯ä»¥ä½¿ç”¨`memory`:</span><br><span class="line">    Sandwich memory anotherSandwich = sandwiches[_index + 1];</span><br><span class="line">    // ...è¿™æ · `anotherSandwich` å°±ä»…ä»…æ˜¯ä¸€ä¸ªå†…å­˜é‡Œçš„å‰¯æœ¬äº†</span><br><span class="line">    // å¦å¤–</span><br><span class="line">    anotherSandwich.status = "Eaten!";</span><br><span class="line">    // ...å°†ä»…ä»…ä¿®æ”¹ä¸´æ—¶å˜é‡ï¼Œå¯¹ `sandwiches[_index + 1]` æ²¡æœ‰ä»»ä½•å½±å“</span><br><span class="line">    // ä¸è¿‡ä½ å¯ä»¥è¿™æ ·åš:</span><br><span class="line">    sandwiches[_index + 1] = anotherSandwich;</span><br><span class="line">    // ...å¦‚æœä½ æƒ³æŠŠå‰¯æœ¬çš„æ”¹åŠ¨ä¿å­˜å›åŒºå—é“¾å­˜å‚¨</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>å¦‚æœä½ è¿˜æ²¡æœ‰å®Œå…¨ç†è§£ç©¶ç«Ÿåº”è¯¥ä½¿ç”¨å“ªä¸€ä¸ªï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒ â€”â€” åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰ä½ ä½•æ—¶ä½¿ç”¨ <code>storage</code> æˆ–æ˜¯ <code>memory</code>ï¼Œå¹¶ä¸”å½“ä½ ä¸å¾—ä¸ä½¿ç”¨åˆ°è¿™äº›å…³é”®å­—çš„æ—¶å€™ï¼ŒSolidity ç¼–è¯‘å™¨ä¹Ÿå‘è­¦ç¤ºæé†’ä½ çš„ã€‚</p>
<p>ç°åœ¨ï¼Œåªè¦çŸ¥é“åœ¨æŸäº›åœºåˆä¸‹ä¹Ÿéœ€è¦ä½ æ˜¾å¼åœ°å£°æ˜ <code>storage</code> æˆ– <code>memory</code>å°±å¤Ÿäº†ï¼</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æ˜¯æ—¶å€™ç»™æˆ‘ä»¬çš„åƒµå°¸å¢åŠ â€œçŒé£Ÿâ€å’Œâ€œç¹æ®–â€åŠŸèƒ½äº†ï¼</p>
<p>å½“ä¸€ä¸ªåƒµå°¸çŒé£Ÿå…¶ä»–ç”Ÿç‰©ä½“æ—¶ï¼Œå®ƒè‡ªèº«çš„DNAå°†ä¸çŒç‰©ç”Ÿç‰©çš„DNAç»“åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªæ–°çš„åƒµå°¸DNAã€‚</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>feedAndMultiply</code> çš„å‡½æ•°ã€‚ ä½¿ç”¨ä¸¤ä¸ªå‚æ•°ï¼š<code>_zombieId</code>ï¼ˆ <code>uint</code>ç±»å‹ ï¼‰å’Œ<code>_targetDna</code> ï¼ˆä¹Ÿæ˜¯ <code>uint</code> ç±»å‹ï¼‰ã€‚ è®¾ç½®å±æ€§ä¸º <code>public</code> çš„ã€‚</li>
<li>æˆ‘ä»¬ä¸å¸Œæœ›åˆ«äººç”¨æˆ‘ä»¬çš„åƒµå°¸å»æ•çŒã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®ä¿å¯¹è‡ªå·±åƒµå°¸çš„æ‰€æœ‰æƒã€‚ é€šè¿‡æ·»åŠ ä¸€ä¸ª<code>require</code> è¯­å¥æ¥ç¡®ä¿ <code>msg.sender</code> åªèƒ½æ˜¯è¿™ä¸ªåƒµå°¸çš„ä¸»äººï¼ˆç±»ä¼¼äºæˆ‘ä»¬åœ¨ <code>createRandomZombie</code> å‡½æ•°ä¸­åšè¿‡çš„é‚£æ ·ï¼‰ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šåŒæ ·ï¼Œå› ä¸ºæˆ‘ä»¬çš„ç­”æ¡ˆæ£€æŸ¥å™¨æ¯”è¾ƒå‘†èŒï¼Œåªè®¤è¯†æŠŠ <code>msg.sender</code> æ”¾åœ¨å‰é¢çš„ç­”æ¡ˆï¼Œå¦‚æœä½ åˆ‡æ¢äº†å‚æ•°çš„é¡ºåºï¼Œå®ƒå°±ä¸è®¤å¾—äº†ã€‚ ä½†ä½ æ­£å¸¸ç¼–ç æ—¶ï¼Œå¦‚ä½•å®‰æ’å‚æ•°é¡ºåºéƒ½æ˜¯æ­£ç¡®çš„ã€‚</p>
</blockquote>
<ol>
<li>ä¸ºäº†è·å–è¿™ä¸ªåƒµå°¸çš„DNAï¼Œæˆ‘ä»¬çš„å‡½æ•°éœ€è¦å£°æ˜ä¸€ä¸ªåä¸º <code>myZombie</code> æ•°æ®ç±»å‹ä¸º<code>Zombie</code>çš„æœ¬åœ°å˜é‡ï¼ˆè¿™æ˜¯ä¸€ä¸ª <code>storage</code> å‹çš„æŒ‡é’ˆï¼‰ã€‚ å°†å…¶å€¼è®¾å®šä¸ºåœ¨ <code>zombies</code> æ•°ç»„ä¸­ç´¢å¼•ä¸º<code>_zombieId</code>æ‰€æŒ‡å‘çš„å€¼ã€‚</li>
</ol>
<p>åˆ°ç›®å‰ä¸ºæ­¢ï¼ŒåŒ…æ‹¬å‡½æ•°ç»“æŸç¬¦ <code>}</code> çš„é‚£ä¸€è¡Œï¼Œ æ€»å…±4è¡Œä»£ç ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// Start here</span><br><span class="line">    function feedAndMultiply(uint _zombieId, uint _targetDna) public{</span><br><span class="line">        require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">        Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬8ç« -åƒµå°¸çš„DNA"><a href="#ç¬¬8ç« -åƒµå°¸çš„DNA" class="headerlink" title="ç¬¬8ç« : åƒµå°¸çš„DNA"></a>ç¬¬8ç« : åƒµå°¸çš„DNA</h3><p>æˆ‘ä»¬æ¥æŠŠ <code>feedAndMultiply</code> å‡½æ•°å†™å®Œå§ã€‚</p>
<p>è·å–æ–°çš„åƒµå°¸DNAçš„å…¬å¼å¾ˆç®€å•ï¼šè®¡ç®—çŒé£Ÿåƒµå°¸DNAå’Œè¢«çŒåƒµå°¸DNAä¹‹é—´çš„å¹³å‡å€¼ã€‚</p>
<p>ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function testDnaSplicing() public {</span><br><span class="line">  uint zombieDna = 2222222222222222;</span><br><span class="line">  uint targetDna = 4444444444444444;</span><br><span class="line">  uint newZombieDna = (zombieDna + targetDna) / 2;</span><br><span class="line">  // newZombieDna å°†ç­‰äº 3333333333333333</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä»¥åï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è®©å‡½æ•°å˜å¾—æ›´å¤æ‚äº›ï¼Œæ¯”æ–¹ç»™æ–°çš„åƒµå°¸çš„ DNA å¢åŠ ä¸€äº›éšæœºæ€§ä¹‹ç±»çš„ã€‚ä½†ç°åœ¨å…ˆä»æœ€ç®€å•çš„å¼€å§‹ â€”â€” ä»¥åè¿˜å¯ä»¥å›æ¥å®Œå–„å®ƒå˜›ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>é¦–å…ˆæˆ‘ä»¬ç¡®ä¿ <code>_targetDna</code> ä¸é•¿äº16ä½ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½® <code>_targetDna</code> ä¸º <code>_targetDna ï¼… dnaModulus</code> ï¼Œå¹¶ä¸”åªå–å…¶æœ€å16ä½æ•°å­—ã€‚</li>
<li>æ¥ä¸‹æ¥ä¸ºæˆ‘ä»¬çš„å‡½æ•°å£°æ˜ä¸€ä¸ªåå« <code>newDna</code> çš„ <code>uint</code>ç±»å‹çš„å˜é‡ï¼Œå¹¶å°†å…¶å€¼è®¾ç½®ä¸º <code>myZombie</code>çš„ DNA å’Œ <code>_targetDna</code> çš„å¹³å‡å€¼ï¼ˆå¦‚ä¸Šä¾‹æ‰€ç¤ºï¼‰ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šæ‚¨å¯ä»¥ç”¨ <code>myZombie.name</code> æˆ– <code>myZombie.dna</code> è®¿é—® <code>myZombie</code> çš„å±æ€§ã€‚</p>
</blockquote>
<ol>
<li>ä¸€æ—¦æˆ‘ä»¬è®¡ç®—å‡ºæ–°çš„DNAï¼Œå†è°ƒç”¨ <code>_createZombie</code> å°±å¯ä»¥ç”Ÿæˆæ–°çš„åƒµå°¸äº†ã€‚å¦‚æœä½ å¿˜äº†è°ƒç”¨è¿™ä¸ªå‡½æ•°æ‰€éœ€è¦çš„å‚æ•°ï¼Œå¯ä»¥æŸ¥çœ‹ <code>zombiefactory.sol</code> é€‰é¡¹å¡ã€‚è¯·æ³¨æ„ï¼Œéœ€è¦å…ˆç»™å®ƒå‘½åï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬æŠŠæ–°çš„åƒµå°¸çš„åå­—è®¾ä¸º<code>NoName</code> - æˆ‘ä»¬å›å¤´å¯ä»¥ç¼–å†™ä¸€ä¸ªå‡½æ•°æ¥æ›´æ”¹åƒµå°¸çš„åå­—ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šå¯¹äº Solidity é«˜æ‰‹ï¼Œä½ å¯èƒ½ä¼šæ³¨æ„åˆ°æˆ‘ä»¬çš„ä»£ç å­˜åœ¨ä¸€ä¸ªé—®é¢˜ã€‚åˆ«æ‹…å¿ƒï¼Œä¸‹ä¸€ç« ä¼šè§£å†³è¿™ä¸ªé—®é¢˜çš„ ;ï¼‰</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function feedAndMultiply(uint _zombieId, uint _targetDna) public {</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    // start here</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    _createZombie("NoName", newDna);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬9ç« -æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§"><a href="#ç¬¬9ç« -æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§" class="headerlink" title="ç¬¬9ç« : æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§"></a>ç¬¬9ç« : æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§</h3><p><strong>æˆ‘ä»¬ä¸Šä¸€è¯¾çš„ä»£ç æœ‰é—®é¢˜ï¼</strong></p>
<p>ç¼–è¯‘çš„æ—¶å€™ç¼–è¯‘å™¨å°±ä¼šæŠ¥é”™ã€‚</p>
<p>é”™è¯¯åœ¨äºï¼Œæˆ‘ä»¬å°è¯•ä» <code>ZombieFeeding</code> ä¸­è°ƒç”¨ <code>_createZombie</code> å‡½æ•°ï¼Œä½† <code>_createZombie</code> å´æ˜¯ <code>ZombieFactory</code> çš„ <code>private</code> ï¼ˆç§æœ‰ï¼‰å‡½æ•°ã€‚è¿™æ„å‘³ç€ä»»ä½•ç»§æ‰¿è‡ª <code>ZombieFactory</code> çš„å­åˆçº¦éƒ½ä¸èƒ½è®¿é—®å®ƒã€‚</p>
<p><strong>internal å’Œ external</strong></p>
<p>é™¤ <code>public</code> å’Œ <code>private</code> å±æ€§ä¹‹å¤–ï¼ŒSolidity è¿˜ä½¿ç”¨äº†å¦å¤–ä¸¤ä¸ªæè¿°å‡½æ•°å¯è§æ€§çš„ä¿®é¥°è¯ï¼š<code>internal</code>ï¼ˆå†…éƒ¨ï¼‰ å’Œ <code>external</code>ï¼ˆå¤–éƒ¨ï¼‰ã€‚</p>
<p><code>internal</code> å’Œ <code>private</code> ç±»ä¼¼ï¼Œä¸è¿‡ï¼Œ å¦‚æœæŸä¸ªåˆçº¦ç»§æ‰¿è‡ªå…¶çˆ¶åˆçº¦ï¼Œè¿™ä¸ªåˆçº¦å³å¯ä»¥è®¿é—®çˆ¶åˆçº¦ä¸­å®šä¹‰çš„â€œå†…éƒ¨â€å‡½æ•°ã€‚ï¼ˆå˜¿ï¼Œè¿™å¬èµ·æ¥æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„é‚£æ ·ï¼ï¼‰ã€‚</p>
<p><code>external</code> ä¸<code>public</code> ç±»ä¼¼ï¼Œåªä¸è¿‡è¿™äº›å‡½æ•°åªèƒ½åœ¨åˆçº¦ä¹‹å¤–è°ƒç”¨ - å®ƒä»¬ä¸èƒ½è¢«åˆçº¦å†…çš„å…¶ä»–å‡½æ•°è°ƒç”¨ã€‚ç¨åæˆ‘ä»¬å°†è®¨è®ºä»€ä¹ˆæ—¶å€™ä½¿ç”¨ <code>external</code> å’Œ <code>public</code>ã€‚</p>
<p>å£°æ˜å‡½æ•° <code>internal</code> æˆ– <code>external</code> ç±»å‹çš„è¯­æ³•ï¼Œä¸å£°æ˜ <code>private</code> å’Œ <code>public</code>ç±» å‹ç›¸åŒï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">contract Sandwich {</span><br><span class="line">  uint private sandwichesEaten = 0;</span><br><span class="line"></span><br><span class="line">  function eat() internal {</span><br><span class="line">    sandwichesEaten++;</span><br><span class="line">  }</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">contract BLT is Sandwich {</span><br><span class="line">  uint private baconSandwichesEaten = 0;</span><br><span class="line"></span><br><span class="line">  function eatWithBacon() public returns (string) {</span><br><span class="line">    baconSandwichesEaten++;</span><br><span class="line">    // å› ä¸ºeat() æ˜¯internal çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬èƒ½åœ¨è¿™é‡Œè°ƒç”¨</span><br><span class="line">    eat();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>å°† <code>_createZombie()</code> å‡½æ•°çš„å±æ€§ä» <code>private</code> æ”¹ä¸º <code>internal</code> ï¼Œ ä½¿å¾—å…¶ä»–çš„åˆçº¦ä¹Ÿèƒ½è®¿é—®åˆ°å®ƒã€‚</p>
<p> æˆ‘ä»¬å·²ç»æˆåŠŸæŠŠä½ çš„æ³¨æ„åŠ›é›†ä¸­åœ¨åˆ°<code>zombiefactory.sol</code>è¿™ä¸ªé€‰é¡¹å¡ä¸Šå•¦ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œä¿®æ”¹å‡½æ•°çš„åŠŸèƒ½</span><br><span class="line">    function _createZombie(string _name, uint _dna) internal {</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna)) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬10ç« -åƒµå°¸åƒä»€ä¹ˆ"><a href="#ç¬¬10ç« -åƒµå°¸åƒä»€ä¹ˆ" class="headerlink" title="ç¬¬10ç« : åƒµå°¸åƒä»€ä¹ˆ?"></a>ç¬¬10ç« : åƒµå°¸åƒä»€ä¹ˆ?</h3><p>æ˜¯æ—¶å€™è®©æˆ‘ä»¬çš„åƒµå°¸å»æ•çŒï¼ é‚£åƒµå°¸æœ€å–œæ¬¢çš„é£Ÿç‰©æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>Crypto åƒµå°¸å–œæ¬¢åƒçš„æ˜¯â€¦</p>
<p><strong>CryptoKittiesï¼</strong> ğŸ˜±ğŸ˜±ğŸ˜±</p>
<p>ï¼ˆæ­£ç»ç‚¹ï¼Œæˆ‘å¯ä¸æ˜¯å¼€ç©ç¬‘ğŸ˜†ï¼‰</p>
<p>ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬è¦è¯»å‡º CryptoKitties æ™ºèƒ½åˆçº¦ä¸­çš„ kittyDnaã€‚è¿™äº›æ•°æ®æ˜¯å…¬å¼€å­˜å‚¨åœ¨åŒºå—é“¾ä¸Šçš„ã€‚åŒºå—é“¾æ˜¯ä¸æ˜¯å¾ˆé…·ï¼Ÿ</p>
<p>åˆ«æ‹…å¿ƒ â€”â€” æˆ‘ä»¬çš„æ¸¸æˆå¹¶ä¸ä¼šä¼¤å®³åˆ°ä»»ä½•çœŸæ­£çš„CryptoKittyã€‚ æˆ‘ä»¬åª <em>è¯»å–</em> CryptoKitties æ•°æ®ï¼Œä½†å´æ— æ³•åœ¨ç‰©ç†ä¸Šåˆ é™¤å®ƒã€‚</p>
<p><strong>ä¸å…¶ä»–åˆçº¦çš„äº¤äº’</strong></p>
<p>å¦‚æœæˆ‘ä»¬çš„åˆçº¦éœ€è¦å’ŒåŒºå—é“¾ä¸Šçš„å…¶ä»–çš„åˆçº¦ä¼šè¯ï¼Œåˆ™éœ€å…ˆå®šä¹‰ä¸€ä¸ª <strong>interface</strong> (æ¥å£)ã€‚</p>
<p>å…ˆä¸¾ä¸€ä¸ªç®€å•çš„æ —å­ã€‚ å‡è®¾åœ¨åŒºå—é“¾ä¸Šæœ‰è¿™ä¹ˆä¸€ä¸ªåˆçº¦ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contract LuckyNumber {</span><br><span class="line">  mapping(address =&gt; uint) numbers;</span><br><span class="line"></span><br><span class="line">  function setNum(uint _num) public {</span><br><span class="line">    numbers[msg.sender] = _num;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function getNum(address _myAddress) public view returns (uint) {</span><br><span class="line">    return numbers[_myAddress];</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ˜¯ä¸ªå¾ˆç®€å•çš„åˆçº¦ï¼Œæ‚¨å¯ä»¥ç”¨å®ƒå­˜å‚¨è‡ªå·±çš„å¹¸è¿å·ç ï¼Œå¹¶å°†å…¶ä¸æ‚¨çš„ä»¥å¤ªåŠåœ°å€å…³è”ã€‚ è¿™æ ·å…¶ä»–äººå°±å¯ä»¥é€šè¿‡æ‚¨çš„åœ°å€æŸ¥æ‰¾æ‚¨çš„å¹¸è¿å·ç äº†ã€‚</p>
<p>ç°åœ¨å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¤–éƒ¨åˆçº¦ï¼Œä½¿ç”¨ <code>getNum</code> å‡½æ•°å¯è¯»å–å…¶ä¸­çš„æ•°æ®ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰ <code>LuckyNumber</code> åˆçº¦çš„ <strong>interface</strong> ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract NumberInterface {</span><br><span class="line">  function getNum(address _myAddress) public view returns (uint);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¯·æ³¨æ„ï¼Œè¿™ä¸ªè¿‡ç¨‹è™½ç„¶çœ‹èµ·æ¥åƒåœ¨å®šä¹‰ä¸€ä¸ªåˆçº¦ï¼Œä½†å…¶å®å†…é‡Œä¸åŒï¼š</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬åªå£°æ˜äº†è¦ä¸ä¹‹äº¤äº’çš„å‡½æ•° â€”â€” åœ¨æœ¬ä¾‹ä¸­ä¸º <code>getNum</code> â€”â€” åœ¨å…¶ä¸­æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨åˆ°ä»»ä½•å…¶ä»–çš„å‡½æ•°æˆ–çŠ¶æ€å˜é‡ã€‚</p>
<p>å…¶æ¬¡ï¼Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä½¿ç”¨å¤§æ‹¬å·ï¼ˆ<code>{</code> å’Œ <code>}</code>ï¼‰å®šä¹‰å‡½æ•°ä½“ï¼Œæˆ‘ä»¬å•å•ç”¨åˆ†å·ï¼ˆ<code>;</code>ï¼‰ç»“æŸäº†å‡½æ•°å£°æ˜ã€‚è¿™ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªåˆçº¦æ¡†æ¶ã€‚</p>
<p>ç¼–è¯‘å™¨å°±æ˜¯é è¿™äº›ç‰¹å¾è®¤å‡ºå®ƒæ˜¯ä¸€ä¸ªæ¥å£çš„ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ app ä»£ç ä¸­ä½¿ç”¨è¿™ä¸ªæ¥å£ï¼Œåˆçº¦å°±çŸ¥é“å…¶ä»–åˆçº¦çš„å‡½æ•°æ˜¯æ€æ ·çš„ï¼Œåº”è¯¥å¦‚ä½•è°ƒç”¨ï¼Œä»¥åŠå¯æœŸå¾…ä»€ä¹ˆç±»å‹çš„è¿”å›å€¼ã€‚</p>
<p>åœ¨ä¸‹ä¸€è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†çœŸæ­£è°ƒç”¨å…¶ä»–åˆçº¦çš„å‡½æ•°ã€‚ç›®å‰æˆ‘ä»¬åªè¦å£°æ˜ä¸€ä¸ªæ¥å£ï¼Œç”¨äºè°ƒç”¨ CryptoKitties åˆçº¦å°±è¡Œäº†ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å·²ç»ä¸ºä½ æŸ¥çœ‹è¿‡äº† CryptoKitties çš„æºä»£ç ï¼Œå¹¶ä¸”æ‰¾åˆ°äº†ä¸€ä¸ªåä¸º <code>getKitty</code>çš„å‡½æ•°ï¼Œå®ƒè¿”å›æ‰€æœ‰çš„åŠ å¯†çŒ«çš„æ•°æ®ï¼ŒåŒ…æ‹¬å®ƒçš„â€œåŸºå› â€ï¼ˆæˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆè¦ç”¨å®ƒç”Ÿæˆæ–°çš„åƒµå°¸ï¼‰ã€‚</p>
<p>è¯¥å‡½æ•°å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">) {</span><br><span class="line">    Kitty storage kit = kitties[_id];</span><br><span class="line"></span><br><span class="line">    // if this variable is 0 then it's not gestating</span><br><span class="line">    isGestating = (kit.siringWithId != 0);</span><br><span class="line">    isReady = (kit.cooldownEndBlock &lt;= block.number);</span><br><span class="line">    cooldownIndex = uint256(kit.cooldownIndex);</span><br><span class="line">    nextActionAt = uint256(kit.cooldownEndBlock);</span><br><span class="line">    siringWithId = uint256(kit.siringWithId);</span><br><span class="line">    birthTime = uint256(kit.birthTime);</span><br><span class="line">    matronId = uint256(kit.matronId);</span><br><span class="line">    sireId = uint256(kit.sireId);</span><br><span class="line">    generation = uint256(kit.generation);</span><br><span class="line">    genes = kit.genes;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªå‡½æ•°çœ‹èµ·æ¥è·Ÿæˆ‘ä»¬ä¹ æƒ¯çš„å‡½æ•°ä¸å¤ªä¸€æ ·ã€‚ å®ƒç«Ÿç„¶è¿”å›äº†â€¦ä¸€å †ä¸åŒçš„å€¼ï¼ å¦‚æœæ‚¨ç”¨è¿‡ JavaScript ä¹‹ç±»çš„ç¼–ç¨‹è¯­è¨€ï¼Œä¸€å®šä¼šæ„Ÿåˆ°å¥‡æ€ª â€”â€” åœ¨ Solidityä¸­ï¼Œæ‚¨å¯ä»¥è®©ä¸€ä¸ªå‡½æ•°è¿”å›å¤šä¸ªå€¼ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬çŸ¥é“è¿™ä¸ªå‡½æ•°é•¿ä»€ä¹ˆæ ·çš„äº†ï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥åˆ›å»ºä¸€ä¸ªæ¥å£ï¼š</p>
<p>1.å®šä¹‰ä¸€ä¸ªåä¸º <code>KittyInterface</code> çš„æ¥å£ã€‚ è¯·æ³¨æ„ï¼Œå› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº† <code>contract</code> å…³é”®å­—ï¼Œ è¿™è¿‡ç¨‹çœ‹èµ·æ¥å°±åƒåˆ›å»ºä¸€ä¸ªæ–°çš„åˆçº¦ä¸€æ ·ã€‚</p>
<p>2.åœ¨interfaceé‡Œå®šä¹‰äº† <code>getKitty</code> å‡½æ•°ï¼ˆä¸è¿‡æ˜¯å¤åˆ¶/ç²˜è´´ä¸Šé¢çš„å‡½æ•°ï¼Œä½†åœ¨ <code>returns</code> è¯­å¥ä¹‹åç”¨åˆ†å·ï¼Œè€Œä¸æ˜¯å¤§æ‹¬å·å†…çš„æ‰€æœ‰å†…å®¹ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// Create KittyInterface here</span><br><span class="line">contract KittyInterface {</span><br><span class="line">    function getKitty(uint256 _id) external view returns (</span><br><span class="line">    bool isGestating,</span><br><span class="line">    bool isReady,</span><br><span class="line">    uint256 cooldownIndex,</span><br><span class="line">    uint256 nextActionAt,</span><br><span class="line">    uint256 siringWithId,</span><br><span class="line">    uint256 birthTime,</span><br><span class="line">    uint256 matronId,</span><br><span class="line">    uint256 sireId,</span><br><span class="line">    uint256 generation,</span><br><span class="line">    uint256 genes</span><br><span class="line">    );</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬11ç« -ä½¿ç”¨æ¥å£"><a href="#ç¬¬11ç« -ä½¿ç”¨æ¥å£" class="headerlink" title="ç¬¬11ç« : ä½¿ç”¨æ¥å£"></a>ç¬¬11ç« : ä½¿ç”¨æ¥å£</h3><p>ç»§ç»­å‰é¢ <code>NumberInterface</code> çš„ä¾‹å­ï¼Œæˆ‘ä»¬æ—¢ç„¶å°†æ¥å£å®šä¹‰ä¸ºï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract NumberInterface {</span><br><span class="line">  function getNum(address _myAddress) public view returns (uint);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å¯ä»¥åœ¨åˆçº¦ä¸­è¿™æ ·ä½¿ç”¨ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">contract MyContract {</span><br><span class="line">  address NumberInterfaceAddress = 0xab38...;</span><br><span class="line">  // ^ è¿™æ˜¯FavoriteNumberåˆçº¦åœ¨ä»¥å¤ªåŠä¸Šçš„åœ°å€</span><br><span class="line">  NumberInterface numberContract = NumberInterface(NumberInterfaceAddress);</span><br><span class="line">  // ç°åœ¨å˜é‡ `numberContract` æŒ‡å‘å¦ä¸€ä¸ªåˆçº¦å¯¹è±¡</span><br><span class="line"></span><br><span class="line">  function someFunction() public {</span><br><span class="line">    // ç°åœ¨æˆ‘ä»¬å¯ä»¥è°ƒç”¨åœ¨é‚£ä¸ªåˆçº¦ä¸­å£°æ˜çš„ `getNum`å‡½æ•°:</span><br><span class="line">    uint num = numberContract.getNum(msg.sender);</span><br><span class="line">    // ...åœ¨è¿™å„¿ä½¿ç”¨ `num`å˜é‡åšäº›ä»€ä¹ˆ</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªè¦å°†æ‚¨åˆçº¦çš„å¯è§æ€§è®¾ç½®ä¸º<code>public</code>(å…¬å…±)æˆ–<code>external</code>(å¤–éƒ¨)ï¼Œå®ƒä»¬å°±å¯ä»¥ä¸ä»¥å¤ªåŠåŒºå—é“¾ä¸Šçš„ä»»ä½•å…¶ä»–åˆçº¦è¿›è¡Œäº¤äº’ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æ¥å»ºä¸ªè‡ªå·±çš„åˆçº¦å»è¯»å–å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦â€“ CryptoKitties çš„å†…å®¹å§ï¼</p>
<ol>
<li>æˆ‘å·²ç»å°†ä»£ç ä¸­ CryptoKitties åˆçº¦çš„åœ°å€ä¿å­˜åœ¨ä¸€ä¸ªåä¸º <code>ckAddress</code> çš„å˜é‡ä¸­ã€‚åœ¨ä¸‹ä¸€è¡Œä¸­ï¼Œè¯·åˆ›å»ºä¸€ä¸ªåä¸º <code>kittyContract</code> çš„ KittyInterfaceï¼Œå¹¶ç”¨ <code>ckAddress</code> ä¸ºå®ƒåˆå§‹åŒ– â€”â€” å°±åƒæˆ‘ä»¬ä¸º <code>numberContract</code>æ‰€åšçš„ä¸€æ ·ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">contract ZombieFeeding is ZombieFactory {</span><br><span class="line"></span><br><span class="line">  address ckAddress = 0x06012c8cf97BEaD5deAe237070F9587f8E7A266d;</span><br><span class="line">  // Initialize kittyContract here using `ckAddress` from above</span><br><span class="line">    KittyInterface kittyContract = KittyInterface(ckAddress);</span><br><span class="line"></span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna) public {</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    _createZombie("NoName", newDna);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬12ç« -å¤„ç†å¤šè¿”å›å€¼"><a href="#ç¬¬12ç« -å¤„ç†å¤šè¿”å›å€¼" class="headerlink" title="ç¬¬12ç« : å¤„ç†å¤šè¿”å›å€¼"></a>ç¬¬12ç« : å¤„ç†å¤šè¿”å›å€¼</h3><p><code>getKitty</code> æ˜¯æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç¬¬ä¸€ä¸ªè¿”å›å¤šä¸ªå€¼çš„å‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹çœ‹æ˜¯å¦‚ä½•å¤„ç†çš„ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function multipleReturns() internal returns(uint a, uint b, uint c) {</span><br><span class="line">  return (1, 2, 3);</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">function processMultipleReturns() external {</span><br><span class="line">  uint a;</span><br><span class="line">  uint b;</span><br><span class="line">  uint c;</span><br><span class="line">  // è¿™æ ·æ¥åšæ‰¹é‡èµ‹å€¼:</span><br><span class="line">  (a, b, c) = multipleReturns();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// æˆ–è€…å¦‚æœæˆ‘ä»¬åªæƒ³è¿”å›å…¶ä¸­ä¸€ä¸ªå˜é‡:</span><br><span class="line">function getLastReturnValue() external {</span><br><span class="line">  uint c;</span><br><span class="line">  // å¯ä»¥å¯¹å…¶ä»–å­—æ®µç•™ç©º:</span><br><span class="line">  (,,c) = multipleReturns();</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æ˜¯æ—¶å€™ä¸ CryptoKitties åˆçº¦äº¤äº’èµ·æ¥äº†ï¼</p>
<p>æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œä» kitty åˆçº¦ä¸­è·å–å®ƒçš„åŸºå› ï¼š</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ªåä¸º <code>feedOnKitty</code> çš„å‡½æ•°ã€‚å®ƒéœ€è¦2ä¸ª <code>uint</code> ç±»å‹çš„å‚æ•°ï¼Œ<code>_zombieId</code> å’Œ<code>_kittyId</code> ï¼Œè¿™æ˜¯ä¸€ä¸ª <code>public</code> ç±»å‹çš„å‡½æ•°ã€‚</p>
</li>
<li><p>å‡½æ•°é¦–å…ˆè¦å£°æ˜ä¸€ä¸ªåä¸º <code>kittyDna</code> çš„ <code>uint</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šåœ¨æˆ‘ä»¬çš„ <code>KittyInterface</code> ä¸­ï¼Œ<code>genes</code> æ˜¯ä¸€ä¸ª <code>uint256</code> ç±»å‹çš„å˜é‡ï¼Œä½†æ˜¯å¦‚æœä½ è®°å¾—ï¼Œæˆ‘ä»¬åœ¨ç¬¬ä¸€è¯¾ä¸­æåˆ°è¿‡ï¼Œ<code>uint</code> æ˜¯ <code>uint256</code> çš„åˆ«åï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬æ˜¯ä¸€å›äº‹ã€‚</p>
</blockquote>
</li>
<li><p>è¿™ä¸ªå‡½æ•°æ¥ä¸‹æ¥è°ƒç”¨ <code>kittyContract.getKitty</code>å‡½æ•°, ä¼ å…¥ <code>_kittyId</code> ï¼Œå°†è¿”å›çš„ <code>genes</code> å­˜å‚¨åœ¨ <code>kittyDna</code> ä¸­ã€‚è®°ä½ â€”â€” <code>getKitty</code> ä¼šè¿”å›ä¸€å¤§å †å˜é‡ã€‚ ï¼ˆç¡®åˆ‡åœ°è¯´10ä¸ª - æˆ‘å·²ç»ä¸ºä½ æ•°è¿‡äº†ï¼Œä¸é”™å§ï¼ï¼‰ã€‚ä½†æ˜¯æˆ‘ä»¬åªå…³å¿ƒæœ€åä¸€ä¸ªâ€“ <code>genes</code>ã€‚æ•°é€—å·çš„æ—¶å€™å°å¿ƒç‚¹å“¦ï¼</p>
</li>
<li><p>æœ€åï¼Œå‡½æ•°è°ƒç”¨äº† <code>feedAndMultiply</code> ï¼Œå¹¶ä¼ å…¥äº† <code>_zombieId</code> å’Œ <code>kittyDna</code> ä¸¤ä¸ªå‚æ•°ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// define function here</span><br><span class="line">    function feedOnKitty(uint _zombieId, uint _kittyId) public{</span><br><span class="line">        uint kittyDna;</span><br><span class="line">        (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">        feedAndMultiply(_zombieId,kittyDna);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬13ç« -å¥–åŠ±-Kitty-åŸºå› "><a href="#ç¬¬13ç« -å¥–åŠ±-Kitty-åŸºå› " class="headerlink" title="ç¬¬13ç« : å¥–åŠ±: Kitty åŸºå› "></a>ç¬¬13ç« : å¥–åŠ±: Kitty åŸºå› </h3><p>æˆ‘ä»¬çš„åŠŸèƒ½é€»è¾‘ä¸»ä½“å·²ç»å®Œæˆäº†â€¦ç°åœ¨è®©æˆ‘ä»¬æ¥æ·»ä¸€ä¸ªå¥–åŠ±åŠŸèƒ½å§ã€‚</p>
<p>è¿™æ ·å§ï¼Œç»™ä»å°çŒ«åˆ¶é€ å‡ºçš„åƒµå°¸æ·»åŠ äº›ç‰¹å¾ï¼Œä»¥æ˜¾ç¤ºä»–ä»¬æ˜¯çŒ«åƒµå°¸ã€‚</p>
<p>è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œå’±ä»¬åœ¨æ–°åƒµå°¸çš„DNAä¸­æ·»åŠ ä¸€äº›ç‰¹æ®Šçš„å°çŒ«ä»£ç ã€‚</p>
<p>è¿˜è®°å¾—å—ï¼Œç¬¬ä¸€è¯¾ä¸­æˆ‘ä»¬æåˆ°ï¼Œæˆ‘ä»¬ç›®å‰åªä½¿ç”¨16ä½DNAçš„å‰12ä½æ•°æ¥æŒ‡å®šåƒµå°¸çš„å¤–è§‚ã€‚æ‰€ä»¥ç°åœ¨æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æœ€å2ä¸ªæ•°å­—æ¥å¤„ç†â€œç‰¹æ®Šâ€çš„ç‰¹å¾ã€‚</p>
<p>è¿™æ ·å§ï¼ŒæŠŠçŒ«åƒµå°¸DNAçš„æœ€åä¸¤ä¸ªæ•°å­—è®¾å®šä¸º<code>99</code>ï¼ˆå› ä¸ºçŒ«æœ‰9æ¡å‘½ï¼‰ã€‚æ‰€ä»¥åœ¨æˆ‘ä»¬è¿™ä¹ˆæ¥å†™ä»£ç ï¼š<code>å¦‚æœ</code>è¿™ä¸ªåƒµå°¸æ˜¯ä¸€åªçŒ«å˜æ¥çš„ï¼Œå°±å°†å®ƒDNAçš„æœ€åä¸¤ä½æ•°å­—è®¾ç½®ä¸º<code>99</code>ã€‚</p>
<p><strong>if è¯­å¥</strong></p>
<p>ifè¯­å¥çš„è¯­æ³•åœ¨ Solidity ä¸­ï¼Œä¸åœ¨ JavaScript ä¸­å·®ä¸å¤šï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function eatBLT(string sandwich) public {</span><br><span class="line">  // çœ‹æ¸…æ¥šäº†ï¼Œå½“æˆ‘ä»¬æ¯”è¾ƒå­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œéœ€è¦æ¯”è¾ƒä»–ä»¬çš„ keccak256 å“ˆå¸Œç </span><br><span class="line">  if (keccak256(sandwich) == keccak256("BLT")) {</span><br><span class="line">    eat();</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>è®©æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„åƒµå°¸ä»£ç ä¸­å®ç°å°çŒ«çš„åŸºå› ã€‚</p>
<ol>
<li><p>é¦–å…ˆï¼Œæˆ‘ä»¬ä¿®æ”¹ä¸‹ <code>feedAndMultiply</code> å‡½æ•°çš„å®šä¹‰ï¼Œç»™å®ƒä¼ å…¥ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¸€æ¡åä¸º <code>_species</code> çš„å­—ç¬¦ä¸²ã€‚</p>
</li>
<li><p>æ¥ä¸‹æ¥ï¼Œåœ¨æˆ‘ä»¬è®¡ç®—å‡ºæ–°çš„åƒµå°¸çš„DNAä¹‹åï¼Œæ·»åŠ ä¸€ä¸ª <code>if</code> è¯­å¥æ¥æ¯”è¾ƒ <code>_species</code> å’Œå­—ç¬¦ä¸² <code>"kitty"</code> çš„ <code>keccak256</code> å“ˆå¸Œå€¼ã€‚</p>
</li>
<li><p>åœ¨ <code>if</code> è¯­å¥ä¸­ï¼Œæˆ‘ä»¬ç”¨ <code>99</code> æ›¿æ¢äº†æ–°åƒµå°¸DNAçš„æœ€åä¸¤ä½æ•°å­—ã€‚å¯ä»¥è¿™ä¹ˆåšï¼š<code>newDna = newDna - newDna % 100 + 99;</code>ã€‚</p>
<blockquote>
<p>è§£é‡Šï¼šå‡è®¾ <code>newDna</code> æ˜¯ <code>334455</code>ã€‚é‚£ä¹ˆ <code>newDna % 100</code> æ˜¯ <code>55</code>ï¼Œæ‰€ä»¥ <code>newDna - newDna % 100</code> å¾—åˆ° <code>334400</code>ã€‚æœ€ååŠ ä¸Š <code>99</code> å¯å¾—åˆ° <code>334499</code>ã€‚</p>
</blockquote>
</li>
<li><p>æœ€åï¼Œæˆ‘ä»¬ä¿®æ”¹äº† <code>feedOnKitty</code> ä¸­çš„å‡½æ•°è°ƒç”¨ã€‚å½“å®ƒè°ƒç”¨ <code>feedAndMultiply</code> æ—¶ï¼Œå¢åŠ  <code>â€œkittyâ€</code> ä½œä¸ºæœ€åä¸€ä¸ªå‚æ•°ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">// è¿™é‡Œä¿®æ”¹å‡½æ•°å®šä¹‰</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) public {</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    // è¿™é‡Œå¢åŠ ä¸€ä¸ª if è¯­å¥</span><br><span class="line">    if(keccak256(_species) == keccak256("kitty")){</span><br><span class="line">        newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    }</span><br><span class="line">    _createZombie("NoName", newDna);</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function feedOnKitty(uint _zombieId, uint _kittyId) public {</span><br><span class="line">    uint kittyDna;</span><br><span class="line">    (,,,,,,,,,kittyDna) = kittyContract.getKitty(_kittyId);</span><br><span class="line">    // å¹¶ä¿®æ”¹å‡½æ•°è°ƒç”¨</span><br><span class="line">    feedAndMultiply(_zombieId, kittyDna,"kitty");</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬14ç« -æ”¾åœ¨ä¸€èµ·"><a href="#ç¬¬14ç« -æ”¾åœ¨ä¸€èµ·" class="headerlink" title="ç¬¬14ç« : æ”¾åœ¨ä¸€èµ·"></a>ç¬¬14ç« : æ”¾åœ¨ä¸€èµ·</h3><p>è‡³æ­¤ï¼Œä½ å·²ç»å­¦å®Œç¬¬äºŒè¯¾äº†ï¼</p>
<p>æŸ¥çœ‹ä¸‹â†’_â†’çš„æ¼”ç¤ºï¼Œçœ‹çœ‹ä»–ä»¬æ€ä¹ˆè¿è¡Œèµ·æ¥å¾—å§ã€‚ç»§ç»­ï¼Œä½ è‚¯å®šç­‰ä¸åŠçœ‹å®Œè¿™ä¸€é¡µğŸ˜‰ã€‚ç‚¹å‡»å°çŒ«ï¼Œæ”»å‡»ï¼çœ‹åˆ°ä½ æ–©è·ä¸€ä¸ªæ–°çš„å°çŒ«åƒµå°¸äº†å§ï¼</p>
<p><strong>JavaScript å®ç°</strong></p>
<p>æˆ‘ä»¬åªç”¨ç¼–è¯‘å’Œéƒ¨ç½² <code>ZombieFeeding</code>ï¼Œå°±å¯ä»¥å°†è¿™ä¸ªåˆçº¦éƒ¨ç½²åˆ°ä»¥å¤ªåŠäº†ã€‚æˆ‘ä»¬æœ€ç»ˆå®Œæˆçš„è¿™ä¸ªåˆçº¦ç»§æ‰¿è‡ª <code>ZombieFactory</code>ï¼Œå› æ­¤å®ƒå¯ä»¥è®¿é—®è‡ªå·±å’Œçˆ¶è¾ˆåˆçº¦ä¸­çš„æ‰€æœ‰ public æ–¹æ³•ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¸æˆ‘ä»¬çš„åˆšéƒ¨ç½²çš„åˆçº¦è¿›è¡Œäº¤äº’çš„ä¾‹å­ï¼Œ è¿™ä¸ªä¾‹å­ä½¿ç”¨äº† JavaScript å’Œ web3.jsï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">var abi = /* abi generated by the compiler */</span><br><span class="line">var ZombieFeedingContract = web3.eth.contract(abi)</span><br><span class="line">var contractAddress = /* our contract address on Ethereum after deploying */</span><br><span class="line">var ZombieFeeding = ZombieFeedingContract.at(contractAddress)</span><br><span class="line"></span><br><span class="line">// å‡è®¾æˆ‘ä»¬æœ‰æˆ‘ä»¬çš„åƒµå°¸IDå’Œè¦æ”»å‡»çš„çŒ«å’ªID</span><br><span class="line">let zombieId = 1;</span><br><span class="line">let kittyId = 1;</span><br><span class="line"></span><br><span class="line">// è¦æ‹¿åˆ°çŒ«å’ªçš„DNAï¼Œæˆ‘ä»¬éœ€è¦è°ƒç”¨å®ƒçš„APIã€‚è¿™äº›æ•°æ®ä¿å­˜åœ¨å®ƒä»¬çš„æœåŠ¡å™¨ä¸Šè€Œä¸æ˜¯åŒºå—é“¾ä¸Šã€‚</span><br><span class="line">// å¦‚æœä¸€åˆ‡éƒ½åœ¨åŒºå—é“¾ä¸Šï¼Œæˆ‘ä»¬å°±ä¸ç”¨æ‹…å¿ƒå®ƒä»¬çš„æœåŠ¡å™¨æŒ‚äº†ï¼Œæˆ–è€…å®ƒä»¬ä¿®æ”¹äº†APIï¼Œ</span><br><span class="line">// æˆ–è€…å› ä¸ºä¸å–œæ¬¢æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆè€Œå°æ€äº†æˆ‘ä»¬</span><br><span class="line">let apiUrl = "https://api.cryptokitties.co/kitties/" + kittyId</span><br><span class="line">$.get(apiUrl, function(data) {</span><br><span class="line">  let imgUrl = data.image_url</span><br><span class="line">  // ä¸€äº›æ˜¾ç¤ºå›¾ç‰‡çš„ä»£ç </span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">// å½“ç”¨æˆ·ç‚¹å‡»ä¸€åªçŒ«å’ªçš„æ—¶å€™:</span><br><span class="line">$(".kittyImage").click(function(e) {</span><br><span class="line">  // è°ƒç”¨æˆ‘ä»¬åˆçº¦çš„ `feedOnKitty` å‡½æ•°</span><br><span class="line">  ZombieFeeding.feedOnKitty(zombieId, kittyId)</span><br><span class="line">})</span><br><span class="line"></span><br><span class="line">// ä¾¦å¬æ¥è‡ªæˆ‘ä»¬åˆçº¦çš„æ–°åƒµå°¸äº‹ä»¶å¥½æ¥å¤„ç†</span><br><span class="line">ZombieFactory.NewZombie(function(error, result) {</span><br><span class="line">  if (error) return</span><br><span class="line">  // è¿™ä¸ªå‡½æ•°ç”¨æ¥æ˜¾ç¤ºåƒµå°¸:</span><br><span class="line">  generateZombie(result.zombieId, result.name, result.dna)</span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>é€‰æ‹©ä¸€åªä½ æƒ³çŒé£Ÿçš„å°çŒ«ã€‚ä½ è‡ªå®¶åƒµå°¸çš„ DNA ä¼šå’Œå°çŒ«çš„ DNA ç»“åˆï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„å°çŒ«åƒµå°¸ï¼ŒåŠ å…¥ä½ çš„å†›å›¢ï¼</p>
<p>çœ‹åˆ°æ–°åƒµå°¸ä¸Šé‚£å¯çˆ±çš„çŒ«å’ªè…¿äº†ä¹ˆï¼Ÿè¿™æ˜¯æ–°åƒµå°¸æœ€åDNAä¸­æœ€åä¸¤ä½æ•°å­— <code>99</code> çš„åŠŸåŠ³ï¼</p>
<p>ä½ æƒ³è¦çš„è¯éšæ—¶å¯ä»¥é‡æ–°å¼€å§‹ã€‚æ•è·äº†ä¸€åªçŒ«å’ªåƒµå°¸ï¼Œä½ ä¸€å®šå¾ˆé«˜å…´å§ï¼ï¼ˆä¸è¿‡ä½ åªèƒ½æŒæœ‰ä¸€åªï¼‰ï¼Œç»§ç»­å‰è¿›åˆ°ä¸‹ä¸€ç« ï¼Œå®Œæˆç¬¬äºŒè¯¾å§ï¼</p>
<h2 id="lesson3-é«˜çº§-Solidity-ç†è®º"><a href="#lesson3-é«˜çº§-Solidity-ç†è®º" class="headerlink" title="lesson3 é«˜çº§ Solidity ç†è®º"></a>lesson3 é«˜çº§ Solidity ç†è®º</h2><h3 id="ç¬¬1ç« -æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§"><a href="#ç¬¬1ç« -æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§" class="headerlink" title="ç¬¬1ç« : æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§"></a>ç¬¬1ç« : æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§</h3><p>åˆ°ç°åœ¨ä¸ºæ­¢ï¼Œæˆ‘ä»¬è®²çš„ Solidity å’Œå…¶ä»–è¯­è¨€æ²¡æœ‰è´¨çš„åŒºåˆ«ï¼Œå®ƒé•¿å¾—ä¹Ÿå¾ˆåƒ JavaScriptã€‚</p>
<p>ä½†æ˜¯ï¼Œåœ¨æœ‰å‡ ç‚¹ä»¥å¤ªåŠä¸Šçš„ DApp è·Ÿæ™®é€šçš„åº”ç”¨ç¨‹åºæœ‰ç€å¤©å£¤ä¹‹åˆ«ã€‚</p>
<p>ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä½ æŠŠæ™ºèƒ½åè®®ä¼ ä¸Šä»¥å¤ªåŠä¹‹åï¼Œå®ƒå°±å˜å¾—<strong>ä¸å¯æ›´æ”¹</strong>, è¿™ç§æ°¸å›ºæ€§æ„å‘³ç€ä½ çš„ä»£ç æ°¸è¿œä¸èƒ½è¢«è°ƒæ•´æˆ–æ›´æ–°ã€‚</p>
<p>ä½ ç¼–è¯‘çš„ç¨‹åºä¼šä¸€ç›´ï¼Œæ°¸ä¹…çš„ï¼Œä¸å¯æ›´æ”¹çš„ï¼Œå­˜åœ¨ä»¥å¤ªåŠä¸Šã€‚è¿™å°±æ˜¯ Solidity ä»£ç çš„å®‰å…¨æ€§å¦‚æ­¤é‡è¦çš„ä¸€ä¸ªåŸå› ã€‚å¦‚æœä½ çš„æ™ºèƒ½åè®®æœ‰ä»»ä½•æ¼æ´ï¼Œå³ä½¿ä½ å‘ç°äº†ä¹Ÿæ— æ³•è¡¥æ•‘ã€‚ä½ åªèƒ½è®©ä½ çš„ç”¨æˆ·ä»¬æ”¾å¼ƒè¿™ä¸ªæ™ºèƒ½åè®®ï¼Œç„¶åè½¬ç§»åˆ°ä¸€ä¸ªæ–°çš„ä¿®å¤åçš„åˆçº¦ä¸Šã€‚</p>
<p>ä½†è¿™æ°å¥½ä¹Ÿæ˜¯æ™ºèƒ½åˆçº¦çš„ä¸€å¤§ä¼˜åŠ¿ã€‚ä»£ç è¯´æ˜ä¸€åˆ‡ã€‚å¦‚æœä½ å»è¯»æ™ºèƒ½åˆçº¦çš„ä»£ç ï¼Œå¹¶éªŒè¯å®ƒï¼Œä½ ä¼šå‘ç°ï¼Œä¸€æ—¦å‡½æ•°è¢«å®šä¹‰ä¸‹æ¥ï¼Œæ¯ä¸€æ¬¡çš„è¿è¡Œï¼Œç¨‹åºéƒ½ä¼šä¸¥æ ¼éµç…§å‡½æ•°ä¸­åŸæœ‰çš„ä»£ç é€»è¾‘ä¸€ä¸ä¸è‹Ÿåœ°æ‰§è¡Œï¼Œå®Œå…¨ä¸ç”¨æ‹…å¿ƒå‡½æ•°è¢«äººç¯¡æ”¹è€Œå¾—åˆ°æ„å¤–çš„ç»“æœã€‚</p>
<p><strong>å¤–éƒ¨ä¾èµ–å…³ç³»</strong></p>
<p>åœ¨ç¬¬2è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†åŠ å¯†å°çŒ«ï¼ˆCryptoKittiesï¼‰åˆçº¦çš„åœ°å€ç¡¬ç¼–ç åˆ° DApp ä¸­å»äº†ã€‚æœ‰æ²¡æœ‰æƒ³è¿‡ï¼Œå¦‚æœåŠ å¯†å°çŒ«å‡ºäº†ç‚¹é—®é¢˜ï¼Œæ¯”æ–¹è¯´ï¼Œé›†ä½“æ¶ˆå¤±äº†ä¼šæ€ä¹ˆæ ·ï¼Ÿ è™½ç„¶è¿™ç§äº‹æƒ…å‡ ä¹ä¸å¯èƒ½å‘ç”Ÿï¼Œä½†æ˜¯ï¼Œå¦‚æœå°çŒ«æ²¡äº†ï¼Œæˆ‘ä»¬çš„ DApp ä¹Ÿä¼šéšä¹‹å¤±æ•ˆ â€“ å› ä¸ºæˆ‘ä»¬åœ¨ DApp çš„ä»£ç ä¸­ç”¨â€œç¡¬ç¼–ç â€çš„æ–¹å¼æŒ‡å®šäº†åŠ å¯†å°çŒ«çš„åœ°å€ï¼Œå¦‚æœè¿™ä¸ªæ ¹æ®åœ°å€æ‰¾ä¸åˆ°å°çŒ«ï¼Œæˆ‘ä»¬çš„åƒµå°¸ä¹Ÿå°±åƒä¸åˆ°å°çŒ«äº†ï¼Œè€ŒæŒ‰ç…§å‰é¢çš„æè¿°ï¼Œæˆ‘ä»¬å´æ²¡æ³•ä¿®æ”¹åˆçº¦å»åº”ä»˜è¿™ä¸ªå˜åŒ–ï¼</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ç¡¬ç¼–ç ï¼Œè€Œè¦é‡‡ç”¨â€œå‡½æ•°â€ï¼Œä»¥ä¾¿äº DApp çš„å…³é”®éƒ¨åˆ†å¯ä»¥ä»¥å‚æ•°å½¢å¼ä¿®æ”¹ã€‚</p>
<p>æ¯”æ–¹è¯´ï¼Œæˆ‘ä»¬ä¸å†ä¸€å¼€å§‹å°±æŠŠçŒç‰©åœ°å€ç»™å†™å…¥ä»£ç ï¼Œè€Œæ˜¯å†™ä¸ªå‡½æ•° <code>setKittyContractAddress</code>, è¿è¡Œæ—¶å†è®¾å®šçŒç‰©çš„åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥éšæ—¶å»é”å®šæ–°çš„çŒç‰©ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒåŠ å¯†å°çŒ«é›†ä½“æ¶ˆå¤±äº†ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>è¯·ä¿®æ”¹ç¬¬2è¯¾çš„ä»£ç ï¼Œä½¿å¾—å¯ä»¥é€šè¿‡ç¨‹åºæ›´æ”¹ CryptoKitties åˆçº¦åœ°å€ã€‚</p>
<ol>
<li>åˆ é™¤é‡‡ç”¨ç¡¬ç¼–ç  æ–¹å¼çš„ <code>ckAddress</code> ä»£ç è¡Œã€‚</li>
<li>ä¹‹å‰åˆ›å»º <code>kittyContract</code> å˜é‡çš„é‚£è¡Œä»£ç ï¼Œä¿®æ”¹ä¸ºå¯¹ <code>kittyContract</code> å˜é‡çš„å£°æ˜ â€“ æš‚æ—¶ä¸ç»™å®ƒæŒ‡å®šå…·ä½“çš„å®ä¾‹ã€‚</li>
<li>åˆ›å»ºåä¸º <code>setKittyContractAddress</code> çš„å‡½æ•°ï¼Œ å®ƒå¸¦ä¸€ä¸ªå‚æ•° <code>_address</code>ï¼ˆ<code>address</code>ç±»å‹ï¼‰ï¼Œ å¯è§æ€§è®¾ä¸º<code>external</code>ã€‚</li>
<li>åœ¨å‡½æ•°å†…éƒ¨ï¼Œæ·»åŠ ä¸€è¡Œä»£ç ï¼Œå°† <code>kittyContract</code> å˜é‡è®¾ç½®ä¸ºè¿”å›å€¼ï¼š<code>KittyInterfaceï¼ˆ_addressï¼‰</code>ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šä½ å¯èƒ½ä¼šæ³¨æ„åˆ°è¿™ä¸ªåŠŸèƒ½æœ‰ä¸ªå®‰å…¨æ¼æ´ï¼Œåˆ«æ‹…å¿ƒ - å’±ä»¬åˆ°ä¸‹ä¸€ç« é‡Œè§£å†³å®ƒ;ï¼‰</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">contract ZombieFeeding is ZombieFactory {</span><br><span class="line"></span><br><span class="line">  // 1. ç§»é™¤è¿™ä¸€è¡Œ:</span><br><span class="line">  //address ckAddress = 0x06012c8cf97BEaD5deAe237070F9587f8E7A266d;</span><br><span class="line">  // 2. åªå£°æ˜å˜é‡:</span><br><span class="line">  KittyInterface kittyContract;</span><br><span class="line"></span><br><span class="line">  // 3. å¢åŠ  setKittyContractAddress æ–¹æ³•</span><br><span class="line">  function setKittyContractAddress(address _address) external{</span><br><span class="line">    kittyContract = KittyInterface(_address);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬2ç« -Ownable-Contracts"><a href="#ç¬¬2ç« -Ownable-Contracts" class="headerlink" title="ç¬¬2ç« : Ownable Contracts"></a>ç¬¬2ç« : Ownable Contracts</h3><p>ä¸Šä¸€ç« ä¸­ï¼Œæ‚¨æœ‰æ²¡æœ‰å‘ç°ä»»ä½•å®‰å…¨æ¼æ´å‘¢ï¼Ÿ</p>
<p>å‘€ï¼<code>setKittyContractAddress</code> å¯è§æ€§å±…ç„¶ç”³æ˜ä¸ºâ€œå¤–éƒ¨çš„â€ï¼ˆ<code>external</code>ï¼‰ï¼Œå²‚ä¸æ˜¯ä»»ä½•äººéƒ½å¯ä»¥è°ƒç”¨å®ƒï¼ ä¹Ÿå°±æ˜¯è¯´ï¼Œä»»ä½•è°ƒç”¨è¯¥å‡½æ•°çš„äººéƒ½å¯ä»¥æ›´æ”¹ CryptoKitties åˆçº¦çš„åœ°å€ï¼Œä½¿å¾—å…¶ä»–äººéƒ½æ²¡æ³•å†è¿è¡Œæˆ‘ä»¬çš„ç¨‹åºäº†ã€‚</p>
<p>æˆ‘ä»¬ç¡®å®æ˜¯å¸Œæœ›è¿™ä¸ªåœ°å€èƒ½å¤Ÿåœ¨åˆçº¦ä¸­ä¿®æ”¹ï¼Œä½†æˆ‘å¯æ²¡è¯´è®©æ¯ä¸ªäººå»æ”¹å®ƒå‘€ã€‚</p>
<p>è¦å¯¹ä»˜è¿™æ ·çš„æƒ…å†µï¼Œé€šå¸¸çš„åšæ³•æ˜¯æŒ‡å®šåˆçº¦çš„â€œæ‰€æœ‰æƒâ€ - å°±æ˜¯è¯´ï¼Œç»™å®ƒæŒ‡å®šä¸€ä¸ªä¸»äººï¼ˆæ²¡é”™ï¼Œå°±æ˜¯æ‚¨ï¼‰ï¼Œåªæœ‰ä¸»äººå¯¹å®ƒäº«æœ‰ç‰¹æƒã€‚</p>
<p><strong>OpenZeppelinåº“çš„<code>Ownable</code> åˆçº¦</strong></p>
<p>ä¸‹é¢æ˜¯ä¸€ä¸ª <code>Ownable</code> åˆçº¦çš„ä¾‹å­ï¼š æ¥è‡ª <strong>_ OpenZeppelin _</strong> Solidity åº“çš„ <code>Ownable</code> åˆçº¦ã€‚ OpenZeppelin æ˜¯ä¸»æ‰“å®‰ä¿å’Œç¤¾åŒºå®¡æŸ¥çš„æ™ºèƒ½åˆçº¦åº“ï¼Œæ‚¨å¯ä»¥åœ¨è‡ªå·±çš„ DAppsä¸­å¼•ç”¨ã€‚ç­‰æŠŠè¿™ä¸€è¯¾å­¦å®Œï¼Œæ‚¨ä¸è¦å‚¬æˆ‘ä»¬å‘å¸ƒä¸‹ä¸€è¯¾ï¼Œæœ€å¥½åˆ©ç”¨è¿™ä¸ªæ—¶é—´æŠŠ OpenZeppelin çš„ç½‘ç«™çœ‹çœ‹ï¼Œä¿ç®¡æ‚¨ä¼šå­¦åˆ°å¾ˆå¤šä¸œè¥¿ï¼</p>
<p>æŠŠæ¥¼ä¸‹è¿™ä¸ªåˆçº¦è¯»è¯»é€šï¼Œæ˜¯ä¸æ˜¯è¿˜æœ‰äº›æ²¡è§è¿‡ä»£ç ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬éšåä¼šè§£é‡Šã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @title Ownable</span><br><span class="line"> * @dev The Ownable contract has an owner address, and provides basic authorization control</span><br><span class="line"> * functions, this simplifies the implementation of "user permissions".</span><br><span class="line"> */</span><br><span class="line">contract Ownable {</span><br><span class="line">  address public owner;</span><br><span class="line">  event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev The Ownable constructor sets the original `owner` of the contract to the sender</span><br><span class="line">   * account.</span><br><span class="line">   */</span><br><span class="line">  function Ownable() public {</span><br><span class="line">    owner = msg.sender;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Throws if called by any account other than the owner.</span><br><span class="line">   */</span><br><span class="line">  modifier onlyOwner() {</span><br><span class="line">    require(msg.sender == owner);</span><br><span class="line">    _;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">   * @dev Allows the current owner to transfer control of the contract to a newOwner.</span><br><span class="line">   * @param newOwner The address to transfer ownership to.</span><br><span class="line">   */</span><br><span class="line">  function transferOwnership(address newOwner) public onlyOwner {</span><br><span class="line">    require(newOwner != address(0));</span><br><span class="line">    OwnershipTransferred(owner, newOwner);</span><br><span class="line">    owner = newOwner;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸‹é¢æœ‰æ²¡æœ‰æ‚¨æ²¡å­¦è¿‡çš„ä¸œä¸œï¼Ÿ</p>
<ul>
<li>æ„é€ å‡½æ•°ï¼š<code>function Ownable()</code>æ˜¯ä¸€ä¸ª <strong>_ constructor_</strong> (æ„é€ å‡½æ•°)ï¼Œæ„é€ å‡½æ•°ä¸æ˜¯å¿…é¡»çš„ï¼Œå®ƒä¸åˆçº¦åŒåï¼Œæ„é€ å‡½æ•°ä¸€ç”Ÿä¸­å”¯ä¸€çš„ä¸€æ¬¡æ‰§è¡Œï¼Œå°±æ˜¯åœ¨åˆçº¦æœ€åˆè¢«åˆ›å»ºçš„æ—¶å€™ã€‚</li>
<li>å‡½æ•°ä¿®é¥°ç¬¦ï¼š<code>modifier onlyOwner()</code>ã€‚ ä¿®é¥°ç¬¦è·Ÿå‡½æ•°å¾ˆç±»ä¼¼ï¼Œä¸è¿‡æ˜¯ç”¨æ¥ä¿®é¥°å…¶ä»–å·²æœ‰å‡½æ•°ç”¨çš„ï¼Œ åœ¨å…¶ä»–è¯­å¥æ‰§è¡Œå‰ï¼Œä¸ºå®ƒæ£€æŸ¥ä¸‹å…ˆéªŒæ¡ä»¶ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥å†™ä¸ªä¿®é¥°ç¬¦ <code>onlyOwner</code> æ£€æŸ¥ä¸‹è°ƒç”¨è€…ï¼Œç¡®ä¿åªæœ‰åˆçº¦çš„ä¸»äººæ‰èƒ½è¿è¡Œæœ¬å‡½æ•°ã€‚æˆ‘ä»¬ä¸‹ä¸€ç« ä¸­ä¼šè¯¦ç»†è®²è¿°ä¿®é¥°ç¬¦ï¼Œä»¥åŠé‚£ä¸ªå¥‡æ€ªçš„<code>_;</code>ã€‚</li>
<li><code>indexed</code> å…³é”®å­—ï¼šåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬è¿˜ç”¨ä¸åˆ°å®ƒã€‚</li>
</ul>
<p>æ‰€ä»¥<code>Ownable</code> åˆçº¦åŸºæœ¬éƒ½ä¼šè¿™ä¹ˆå¹²ï¼š</p>
<ol>
<li>åˆçº¦åˆ›å»ºï¼Œæ„é€ å‡½æ•°å…ˆè¡Œï¼Œå°†å…¶ <code>owner</code> è®¾ç½®ä¸º<code>msg.sender</code>ï¼ˆå…¶éƒ¨ç½²è€…ï¼‰</li>
<li>ä¸ºå®ƒåŠ ä¸Šä¸€ä¸ªä¿®é¥°ç¬¦ <code>onlyOwner</code>ï¼Œå®ƒä¼šé™åˆ¶é™Œç”Ÿäººçš„è®¿é—®ï¼Œå°†è®¿é—®æŸäº›å‡½æ•°çš„æƒé™é”å®šåœ¨ <code>owner</code> ä¸Šã€‚</li>
<li>å…è®¸å°†åˆçº¦æ‰€æœ‰æƒè½¬è®©ç»™ä»–äººã€‚</li>
</ol>
<p><code>onlyOwner</code> ç®€ç›´äººè§äººçˆ±ï¼Œå¤§å¤šæ•°äººå¼€å‘è‡ªå·±çš„ Solidity DAppsï¼Œéƒ½æ˜¯ä»å¤åˆ¶/ç²˜è´´ <code>Ownable</code> å¼€å§‹çš„ï¼Œä»å®ƒå†ç»§æ‰¿å‡ºçš„å­ç±»ï¼Œå¹¶åœ¨ä¹‹ä¸Šè¿›è¡ŒåŠŸèƒ½å¼€å‘ã€‚</p>
<p>æ—¢ç„¶æˆ‘ä»¬æƒ³æŠŠ <code>setKittyContractAddress</code> é™åˆ¶ä¸º <code>onlyOwner</code> ï¼Œæˆ‘ä»¬ä¹Ÿè¦åšåŒæ ·çš„äº‹æƒ…ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>é¦–å…ˆï¼Œå°† <code>Ownable</code> åˆçº¦çš„ä»£ç å¤åˆ¶ä¸€ä»½åˆ°æ–°æ–‡ä»¶ <code>ownable.sol</code> ä¸­ã€‚ æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª <code>ZombieFactory</code>ï¼Œç»§æ‰¿ <code>Ownable</code>ã€‚</p>
<p>1.åœ¨ç¨‹åºä¸­å¯¼å…¥ <code>ownable.sol</code> çš„å†…å®¹ã€‚ å¦‚æœæ‚¨ä¸è®°å¾—æ€ä¹ˆåšäº†ï¼Œå‚è€ƒä¸‹ <code>zombiefeeding.sol</code>ã€‚</p>
<p>2.ä¿®æ”¹ <code>ZombieFactory</code> åˆçº¦ï¼Œ è®©å®ƒç»§æ‰¿è‡ª <code>Ownable</code>ã€‚ å¦‚æœæ‚¨ä¸è®°å¾—æ€ä¹ˆåšäº†ï¼Œçœ‹çœ‹ <code>zombiefeeding.sol</code>ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå¯¼å…¥</span><br><span class="line">import "./ownable.sol";</span><br><span class="line">// 2. åœ¨è¿™é‡Œç»§æ‰¿:</span><br><span class="line">contract ZombieFactory is Ownable{</span><br><span class="line"></span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬3ç« -onlyOwner-å‡½æ•°ä¿®é¥°ç¬¦"><a href="#ç¬¬3ç« -onlyOwner-å‡½æ•°ä¿®é¥°ç¬¦" class="headerlink" title="ç¬¬3ç« : onlyOwner å‡½æ•°ä¿®é¥°ç¬¦"></a>ç¬¬3ç« : onlyOwner å‡½æ•°ä¿®é¥°ç¬¦</h3><p>ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸ªåŸºæœ¬ç‰ˆçš„åˆçº¦ <code>ZombieFactory</code> äº†ï¼Œå®ƒç»§æ‰¿è‡ª <code>Ownable</code> æ¥å£ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ç»™ <code>ZombieFeeding</code> åŠ ä¸Š <code>onlyOwner</code> å‡½æ•°ä¿®é¥°ç¬¦ã€‚</p>
<p>è¿™å°±æ˜¯åˆçº¦ç»§æ‰¿çš„å·¥ä½œåŸç†ã€‚è®°å¾—ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ZombieFeeding æ˜¯ä¸ª ZombieFactory</span><br><span class="line">ZombieFactory æ˜¯ä¸ª Ownable</span><br></pre></td></tr></tbody></table></figure>

<p>å› æ­¤ <code>ZombieFeeding</code> ä¹Ÿæ˜¯ä¸ª <code>Ownable</code>, å¹¶å¯ä»¥é€šè¿‡ <code>Ownable</code> æ¥å£è®¿é—®çˆ¶ç±»ä¸­çš„å‡½æ•°/äº‹ä»¶/ä¿®é¥°ç¬¦ã€‚å¾€åï¼Œ<code>ZombieFeeding</code> çš„ç»§æ‰¿è€…åˆçº¦ä»¬åŒæ ·ä¹Ÿå¯ä»¥è¿™ä¹ˆå»¶ç»­ä¸‹å»ã€‚</p>
<p><strong>å‡½æ•°ä¿®é¥°ç¬¦</strong></p>
<p>å‡½æ•°ä¿®é¥°ç¬¦çœ‹èµ·æ¥è·Ÿå‡½æ•°æ²¡ä»€ä¹ˆä¸åŒï¼Œä¸è¿‡å…³é”®å­—<code>modifier</code> å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œè¿™æ˜¯ä¸ª<code>modifier(ä¿®é¥°ç¬¦)</code>ï¼Œè€Œä¸æ˜¯ä¸ª<code>function(å‡½æ•°)</code>ã€‚å®ƒä¸èƒ½åƒå‡½æ•°é‚£æ ·è¢«ç›´æ¥è°ƒç”¨ï¼Œåªèƒ½è¢«æ·»åŠ åˆ°å‡½æ•°å®šä¹‰çš„æœ«å°¾ï¼Œç”¨ä»¥æ”¹å˜å‡½æ•°çš„è¡Œä¸ºã€‚</p>
<p>å’±ä»¬ä»”ç»†è¯»è¯» <code>onlyOwner</code>:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @dev è°ƒç”¨è€…ä¸æ˜¯â€˜ä¸»äººâ€™ï¼Œå°±ä¼šæŠ›å‡ºå¼‚å¸¸</span><br><span class="line"> */</span><br><span class="line">modifier onlyOwner() {</span><br><span class="line">  require(msg.sender == owner);</span><br><span class="line">  _;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>onlyOwner</code> å‡½æ•°ä¿®é¥°ç¬¦æ˜¯è¿™ä¹ˆç”¨çš„ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">contract MyContract is Ownable {</span><br><span class="line">  event LaughManiacally(string laughter);</span><br><span class="line"></span><br><span class="line">  //æ³¨æ„ï¼ `onlyOwner`ä¸Šåœº :</span><br><span class="line">  function likeABoss() external onlyOwner {</span><br><span class="line">    LaughManiacally("Muahahahaha");</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„ <code>likeABoss</code> å‡½æ•°ä¸Šçš„ <code>onlyOwner</code> ä¿®é¥°ç¬¦ã€‚ å½“ä½ è°ƒç”¨ <code>likeABoss</code> æ—¶ï¼Œ<strong>é¦–å…ˆæ‰§è¡Œ</strong> <code>onlyOwner</code> ä¸­çš„ä»£ç ï¼Œ æ‰§è¡Œåˆ° <code>onlyOwner</code> ä¸­çš„ <code>_;</code> è¯­å¥æ—¶ï¼Œç¨‹åºå†è¿”å›å¹¶æ‰§è¡Œ <code>likeABoss</code> ä¸­çš„ä»£ç ã€‚</p>
<p>å¯è§ï¼Œå°½ç®¡å‡½æ•°ä¿®é¥°ç¬¦ä¹Ÿå¯ä»¥åº”ç”¨åˆ°å„ç§åœºåˆï¼Œä½†æœ€å¸¸è§çš„è¿˜æ˜¯æ”¾åœ¨å‡½æ•°æ‰§è¡Œä¹‹å‰æ·»åŠ å¿«é€Ÿçš„ <code>require</code>æ£€æŸ¥ã€‚</p>
<p>å› ä¸ºç»™å‡½æ•°æ·»åŠ äº†ä¿®é¥°ç¬¦ <code>onlyOwner</code>ï¼Œä½¿å¾—<strong>å”¯æœ‰åˆçº¦çš„ä¸»äºº</strong>ï¼ˆä¹Ÿå°±æ˜¯éƒ¨ç½²è€…ï¼‰æ‰èƒ½è°ƒç”¨å®ƒã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šä¸»äººå¯¹åˆçº¦äº«æœ‰çš„ç‰¹æƒå½“ç„¶æ˜¯æ­£å½“çš„ï¼Œä¸è¿‡ä¹Ÿå¯èƒ½è¢«æ¶æ„ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œä¸‡ä¸€ï¼Œä¸»äººæ·»åŠ äº†ä¸ªåé—¨ï¼Œå…è®¸ä»–å·èµ°åˆ«äººçš„åƒµå°¸å‘¢ï¼Ÿ</p>
</blockquote>
<blockquote>
<p>æ‰€ä»¥éå¸¸é‡è¦çš„æ˜¯ï¼Œéƒ¨ç½²åœ¨ä»¥å¤ªåŠä¸Šçš„ DAppï¼Œå¹¶ä¸èƒ½ä¿è¯å®ƒçœŸæ­£åšåˆ°å»ä¸­å¿ƒï¼Œä½ éœ€è¦é˜…è¯»å¹¶ç†è§£å®ƒçš„æºä»£ç ï¼Œæ‰èƒ½é˜²æ­¢å…¶ä¸­æ²¡æœ‰è¢«éƒ¨ç½²è€…æ¶æ„æ¤å…¥åé—¨ï¼›ä½œä¸ºå¼€å‘äººå‘˜ï¼Œå¦‚ä½•åšåˆ°æ—¢è¦ç»™è‡ªå·±ç•™ä¸‹ä¿®å¤ bug çš„ä½™åœ°ï¼Œåˆè¦å°½é‡åœ°æ”¾æƒç»™ä½¿ç”¨è€…ï¼Œä»¥ä¾¿è®©ä»–ä»¬æ”¾å¿ƒä½ ï¼Œä»è€Œæ„¿æ„æŠŠæ•°æ®æ”¾åœ¨ä½ çš„ DApp ä¸­ï¼Œè¿™ç¡®å®éœ€è¦ä¸ªå¾®å¦™çš„å¹³è¡¡ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ç°åœ¨æˆ‘ä»¬å¯ä»¥é™åˆ¶ç¬¬ä¸‰æ–¹å¯¹ <code>setKittyContractAddress</code>çš„è®¿é—®ï¼Œé™¤äº†æˆ‘ä»¬è‡ªå·±ï¼Œè°éƒ½æ— æ³•å»ä¿®æ”¹å®ƒã€‚</p>
<ol>
<li>å°† <code>onlyOwner</code> å‡½æ•°ä¿®é¥°ç¬¦æ·»åŠ åˆ° <code>setKittyContractAddress</code> ä¸­ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// ä¿®æ”¹è¿™ä¸ªå‡½æ•°:</span><br><span class="line">function setKittyContractAddress(address _address) external onlyOwner {</span><br><span class="line">  kittyContract = KittyInterface(_address);</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬4ç« -Gas"><a href="#ç¬¬4ç« -Gas" class="headerlink" title="ç¬¬4ç« : Gas"></a>ç¬¬4ç« : Gas</h3><p>å‰å®³ï¼ç°åœ¨æˆ‘ä»¬æ‡‚äº†å¦‚ä½•åœ¨ç¦æ­¢ç¬¬ä¸‰æ–¹ä¿®æ”¹æˆ‘ä»¬çš„åˆçº¦çš„åŒæ—¶ï¼Œç•™ä¸ªåé—¨ç»™å’±ä»¬è‡ªå·±å»ä¿®æ”¹ã€‚</p>
<p>è®©æˆ‘ä»¬æ¥çœ‹å¦ä¸€ç§ä½¿å¾— Solidity ç¼–ç¨‹è¯­è¨€ä¸ä¼—ä¸åŒçš„ç‰¹å¾ï¼š</p>
<p><strong>Gas - é©±åŠ¨ä»¥å¤ªåŠDAppsçš„èƒ½æº</strong></p>
<p>åœ¨ Solidity ä¸­ï¼Œä½ çš„ç”¨æˆ·æƒ³è¦æ¯æ¬¡æ‰§è¡Œä½ çš„ DApp éƒ½éœ€è¦æ”¯ä»˜ä¸€å®šçš„ ***gas***ï¼Œgas å¯ä»¥ç”¨ä»¥å¤ªå¸è´­ä¹°ï¼Œå› æ­¤ï¼Œç”¨æˆ·æ¯æ¬¡è·‘ DApp éƒ½å¾—èŠ±è´¹ä»¥å¤ªå¸ã€‚</p>
<p>ä¸€ä¸ª DApp æ”¶å–å¤šå°‘ gas å–å†³äºåŠŸèƒ½é€»è¾‘çš„å¤æ‚ç¨‹åº¦ã€‚æ¯ä¸ªæ“ä½œèƒŒåï¼Œéƒ½åœ¨è®¡ç®—å®Œæˆè¿™ä¸ªæ“ä½œæ‰€éœ€è¦çš„è®¡ç®—èµ„æºï¼Œï¼ˆæ¯”å¦‚ï¼Œå­˜å‚¨æ•°æ®å°±æ¯”åšä¸ªåŠ æ³•è¿ç®—è´µå¾—å¤šï¼‰ï¼Œ ä¸€æ¬¡æ“ä½œæ‰€éœ€è¦èŠ±è´¹çš„ *<strong>gas*</strong> ç­‰äºè¿™ä¸ªæ“ä½œèƒŒåçš„æ‰€æœ‰è¿ç®—èŠ±é”€çš„æ€»å’Œã€‚</p>
<p>ç”±äºè¿è¡Œä½ çš„ç¨‹åºéœ€è¦èŠ±è´¹ç”¨æˆ·çš„çœŸé‡‘ç™½é“¶ï¼Œåœ¨ä»¥å¤ªåŠä¸­ä»£ç çš„ç¼–ç¨‹è¯­è¨€ï¼Œæ¯”å…¶ä»–ä»»ä½•ç¼–ç¨‹è¯­è¨€éƒ½æ›´å¼ºè°ƒä¼˜åŒ–ã€‚åŒæ ·çš„åŠŸèƒ½ï¼Œä½¿ç”¨ç¬¨æ‹™çš„ä»£ç å¼€å‘çš„ç¨‹åºï¼Œæ¯”èµ·ç»è¿‡ç²¾å·§ä¼˜åŒ–çš„ä»£ç æ¥ï¼Œè¿è¡ŒèŠ±è´¹æ›´é«˜ï¼Œè¿™æ˜¾ç„¶ä¼šç»™æˆåƒä¸Šä¸‡çš„ç”¨æˆ·å¸¦æ¥å¤§é‡ä¸å¿…è¦çš„å¼€é”€ã€‚</p>
<p>*<em>ä¸ºä»€ä¹ˆè¦ç”¨ <em>gas* æ¥é©±åŠ¨ï¼Ÿ</em></em></p>
<p>ä»¥å¤ªåŠå°±åƒä¸€ä¸ªå·¨å¤§ã€ç¼“æ…¢ã€ä½†éå¸¸å®‰å…¨çš„ç”µè„‘ã€‚å½“ä½ è¿è¡Œä¸€ä¸ªç¨‹åºçš„æ—¶å€™ï¼Œç½‘ç»œä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åœ¨è¿›è¡Œç›¸åŒçš„è¿ç®—ï¼Œä»¥éªŒè¯å®ƒçš„è¾“å‡º â€”â€” è¿™å°±æ˜¯æ‰€è°“çš„â€œå»ä¸­å¿ƒåŒ–â€ ç”±äºæ•°ä»¥åƒè®¡çš„èŠ‚ç‚¹åŒæ—¶åœ¨éªŒè¯ç€æ¯ä¸ªåŠŸèƒ½çš„è¿è¡Œï¼Œè¿™å¯ä»¥ç¡®ä¿å®ƒçš„æ•°æ®ä¸ä¼šè¢«è¢«ç›‘æ§ï¼Œæˆ–è€…è¢«åˆ»æ„ä¿®æ”¹ã€‚</p>
<p>å¯èƒ½ä¼šæœ‰ç”¨æˆ·ç”¨æ— é™å¾ªç¯å µå¡ç½‘ç»œï¼ŒæŠ‘æˆ–ç”¨å¯†é›†è¿ç®—æ¥å ç”¨å¤§é‡çš„ç½‘ç»œèµ„æºï¼Œä¸ºäº†é˜²æ­¢è¿™ç§äº‹æƒ…çš„å‘ç”Ÿï¼Œä»¥å¤ªåŠçš„åˆ›å»ºè€…ä¸ºä»¥å¤ªåŠä¸Šçš„èµ„æºåˆ¶å®šäº†ä»·æ ¼ï¼Œæƒ³è¦åœ¨ä»¥å¤ªåŠä¸Šè¿ç®—æˆ–è€…å­˜å‚¨ï¼Œä½ éœ€è¦å…ˆä»˜è´¹ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœä½ ä½¿ç”¨ä¾§é“¾ï¼Œå€’æ˜¯ä¸ä¸€å®šéœ€è¦ä»˜è´¹ï¼Œæ¯”å¦‚å’±ä»¬åœ¨ Loom Network ä¸Šæ„å»ºçš„ CryptoZombies å°±å…è´¹ã€‚ä½ ä¸ä¼šæƒ³è¦åœ¨ä»¥å¤ªåŠä¸»ç½‘ä¸Šç©å„¿â€œé­”å…½ä¸–ç•Œâ€å§ï¼Ÿ - æ‰€éœ€è¦çš„ gas å¯èƒ½ä¼šä¹°åˆ°ä½ ç ´äº§ã€‚ä½†æ˜¯ä½ å¯ä»¥æ‰¾ä¸ªç®—æ³•ç†å¿µä¸åŒçš„ä¾§é“¾æ¥ç©å®ƒã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­å’±ä»¬ä¼šè®¨è®ºåˆ°ï¼Œä»€ä¹ˆæ ·çš„ DApp åº”è¯¥éƒ¨ç½²åœ¨å¤ªåŠä¸»é“¾ä¸Šï¼Œä»€ä¹ˆåˆæœ€å¥½æ”¾åœ¨ä¾§é“¾ã€‚</p>
</blockquote>
<p><strong>çœ gas çš„æ‹›æ•°ï¼šç»“æ„å°è£… ï¼ˆStruct packingï¼‰</strong></p>
<p>åœ¨ç¬¬1è¯¾ä¸­ï¼Œæˆ‘ä»¬æåˆ°é™¤äº†åŸºæœ¬ç‰ˆçš„ <code>uint</code> å¤–ï¼Œè¿˜æœ‰å…¶ä»–å˜ç§ <code>uint</code>ï¼š<code>uint8</code>ï¼Œ<code>uint16</code>ï¼Œ<code>uint32</code>ç­‰ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹æˆ‘ä»¬ä¸ä¼šè€ƒè™‘ä½¿ç”¨ <code>uint</code> å˜ç§ï¼Œå› ä¸ºæ— è®ºå¦‚ä½•å®šä¹‰ <code>uint</code>çš„å¤§å°ï¼ŒSolidity ä¸ºå®ƒä¿ç•™256ä½çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨ <code>uint8</code> è€Œä¸æ˜¯<code>uint</code>ï¼ˆ<code>uint256</code>ï¼‰ä¸ä¼šä¸ºä½ èŠ‚çœä»»ä½• gasã€‚</p>
<p>é™¤éï¼Œ<u><strong>æŠŠ <code>uint</code> ç»‘å®šåˆ° <code>struct</code> é‡Œé¢</strong></u>ã€‚</p>
<p>å¦‚æœä¸€ä¸ª <code>struct</code> ä¸­æœ‰å¤šä¸ª <code>uint</code>ï¼Œåˆ™å°½å¯èƒ½ä½¿ç”¨è¾ƒå°çš„ <code>uint</code>, Solidity ä¼šå°†è¿™äº› <code>uint</code> æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»è€Œå ç”¨è¾ƒå°‘çš„å­˜å‚¨ç©ºé—´ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">struct NormalStruct {</span><br><span class="line">  uint a;</span><br><span class="line">  uint b;</span><br><span class="line">  uint c;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">struct MiniMe {</span><br><span class="line">  uint32 a;</span><br><span class="line">  uint32 b;</span><br><span class="line">  uint c;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// å› ä¸ºä½¿ç”¨äº†ç»“æ„æ‰“åŒ…ï¼Œ`mini` æ¯” `normal` å ç”¨çš„ç©ºé—´æ›´å°‘</span><br><span class="line">NormalStruct normal = NormalStruct(10, 20, 30);</span><br><span class="line">MiniMe mini = MiniMe(10, 20, 30); </span><br></pre></td></tr></tbody></table></figure>

<p>æ‰€ä»¥ï¼Œå½“ <code>uint</code> å®šä¹‰åœ¨ä¸€ä¸ª <code>struct</code> ä¸­çš„æ—¶å€™ï¼Œå°½é‡ä½¿ç”¨æœ€å°çš„æ•´æ•°å­ç±»å‹ä»¥èŠ‚çº¦ç©ºé—´ã€‚ **<u>å¹¶ä¸”æŠŠåŒæ ·ç±»å‹çš„å˜é‡æ”¾ä¸€èµ·</u>**ï¼ˆå³åœ¨ struct ä¸­å°†æŠŠå˜é‡æŒ‰ç…§ç±»å‹ä¾æ¬¡æ”¾ç½®ï¼‰ï¼Œ<u>è¿™æ · Solidity å¯ä»¥å°†å­˜å‚¨ç©ºé—´æœ€å°åŒ–</u>ã€‚ä¾‹å¦‚ï¼Œæœ‰ä¸¤ä¸ª <code>struct</code>ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uint c; uint32 a; uint32 b;` å’Œ `uint32 a; uint c; uint32 b;</span><br></pre></td></tr></tbody></table></figure>

<p>å‰è€…æ¯”åè€…éœ€è¦çš„gasæ›´å°‘ï¼Œå› ä¸ºå‰è€…æŠŠ<code>uint32</code>æ”¾ä¸€èµ·äº†ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>åœ¨æœ¬è¯¾ä¸­ï¼Œå’±ä»¬ç»™åƒµå°¸æ·»2ä¸ªæ–°åŠŸèƒ½ï¼š<code>level</code> å’Œ <code>readyTime</code> - åè€…æ˜¯ç”¨æ¥å®ç°ä¸€ä¸ªâ€œå†·å´å®šæ—¶å™¨â€ï¼Œä»¥é™åˆ¶åƒµå°¸çŒé£Ÿçš„é¢‘ç‡ã€‚</p>
<p>è®©æˆ‘ä»¬å›åˆ° <code>zombiefactory.sol</code>ã€‚</p>
<ol>
<li>ä¸º <code>Zombie</code> ç»“æ„ä½“ æ·»åŠ ä¸¤ä¸ªå±æ€§ï¼š<code>level</code>ï¼ˆ<code>uint32</code>ï¼‰å’Œ<code>readyTime</code>ï¼ˆ<code>uint32</code>ï¼‰ã€‚å› ä¸ºå¸Œæœ›åŒç±»å‹æ•°æ®æ‰“æˆä¸€ä¸ªåŒ…ï¼Œæ‰€ä»¥æŠŠå®ƒä»¬æ”¾åœ¨ç»“æ„ä½“çš„æœ«å°¾ã€‚</li>
</ol>
<p>32ä½è¶³ä»¥ä¿å­˜åƒµå°¸çš„çº§åˆ«å’Œæ—¶é—´æˆ³äº†ï¼Œè¿™æ ·æ¯”èµ·ä½¿ç”¨æ™®é€šçš„<code>uint</code>ï¼ˆ256ä½ï¼‰ï¼Œå¯ä»¥æ›´ç´§å¯†åœ°å°è£…æ•°æ®ï¼Œä»è€Œä¸ºæˆ‘ä»¬çœç‚¹ gasã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">contract ZombieFactory is Ownable {</span><br><span class="line"></span><br><span class="line">    event NewZombie(uint zombieId, string name, uint dna);</span><br><span class="line"></span><br><span class="line">    uint dnaDigits = 16;</span><br><span class="line">    uint dnaModulus = 10 ** dnaDigits;</span><br><span class="line"></span><br><span class="line">    struct Zombie {</span><br><span class="line">        string name;</span><br><span class="line">        uint dna;</span><br><span class="line">        //åœ¨è¿™é‡Œæ·»åŠ æ•°æ®</span><br><span class="line">        uint32 level;</span><br><span class="line">        uint32 readyTime;</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬5ç« -æ—¶é—´å•ä½"><a href="#ç¬¬5ç« -æ—¶é—´å•ä½" class="headerlink" title="ç¬¬5ç« : æ—¶é—´å•ä½"></a>ç¬¬5ç« : æ—¶é—´å•ä½</h3><p><code>level</code> å±æ€§è¡¨ç¤ºåƒµå°¸çš„çº§åˆ«ã€‚ä»¥åï¼Œåœ¨æˆ‘ä»¬åˆ›å»ºçš„æˆ˜æ–—ç³»ç»Ÿä¸­ï¼Œæ‰“èƒœä»—çš„åƒµå°¸ä¼šé€æ¸å‡çº§å¹¶è·å¾—æ›´å¤šçš„èƒ½åŠ›ã€‚</p>
<p><code>readyTime</code> ç¨å¾®å¤æ‚ç‚¹ã€‚æˆ‘ä»¬å¸Œæœ›å¢åŠ ä¸€ä¸ªâ€œå†·å´å‘¨æœŸâ€ï¼Œè¡¨ç¤ºåƒµå°¸åœ¨ä¸¤æ¬¡çŒé£Ÿæˆ–æ”»å‡»ä¹‹ä¹‹é—´å¿…é¡»ç­‰å¾…çš„æ—¶é—´ã€‚å¦‚æœæ²¡æœ‰å®ƒï¼Œåƒµå°¸æ¯å¤©å¯èƒ½ä¼šæ”»å‡»å’Œç¹æ®–1,000æ¬¡ï¼Œè¿™æ ·æ¸¸æˆå°±å¤ªç®€å•äº†ã€‚</p>
<p>ä¸ºäº†è®°å½•åƒµå°¸åœ¨ä¸‹ä¸€æ¬¡è¿›å‡»å‰éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼Œæˆ‘ä»¬ä½¿ç”¨äº† Solidity çš„æ—¶é—´å•ä½ã€‚</p>
<p><strong>æ—¶é—´å•ä½</strong></p>
<p>Solidity ä½¿ç”¨è‡ªå·±çš„æœ¬åœ°æ—¶é—´å•ä½ã€‚</p>
<p>å˜é‡ <code>now</code> å°†è¿”å›å½“å‰çš„unixæ—¶é—´æˆ³ï¼ˆè‡ª1970å¹´1æœˆ1æ—¥ä»¥æ¥ç»è¿‡çš„ç§’æ•°ï¼‰ã€‚æˆ‘å†™è¿™å¥è¯æ—¶ unix æ—¶é—´æ˜¯ <code>1515527488</code>ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šUnixæ—¶é—´ä¼ ç»Ÿç”¨ä¸€ä¸ª32ä½çš„æ•´æ•°è¿›è¡Œå­˜å‚¨ã€‚è¿™ä¼šå¯¼è‡´â€œ2038å¹´â€é—®é¢˜ï¼Œå½“è¿™ä¸ª32ä½çš„unixæ—¶é—´æˆ³ä¸å¤Ÿç”¨ï¼Œäº§ç”Ÿæº¢å‡ºï¼Œä½¿ç”¨è¿™ä¸ªæ—¶é—´çš„é—ç•™ç³»ç»Ÿå°±éº»çƒ¦äº†ã€‚æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è®©æˆ‘ä»¬çš„ DApp è·‘å¤Ÿ20å¹´ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨64ä½æ•´æ•°è¡¨ç¤ºæ—¶é—´ï¼Œä½†ä¸ºæ­¤æˆ‘ä»¬çš„ç”¨æˆ·åˆå¾—æ”¯ä»˜æ›´å¤šçš„ gasã€‚çœŸæ˜¯ä¸ªä¸¤éš¾çš„è®¾è®¡å•Šï¼</p>
</blockquote>
<p>Solidity è¿˜åŒ…å«<code>ç§’(seconds)</code>ï¼Œ<code>åˆ†é’Ÿ(minutes)</code>ï¼Œ<code>å°æ—¶(hours)</code>ï¼Œ<code>å¤©(days)</code>ï¼Œ<code>å‘¨(weeks)</code> å’Œ <code>å¹´(years)</code> ç­‰æ—¶é—´å•ä½ã€‚å®ƒä»¬éƒ½ä¼šè½¬æ¢æˆå¯¹åº”çš„ç§’æ•°æ”¾å…¥ <code>uint</code> ä¸­ã€‚æ‰€ä»¥ <code>1åˆ†é’Ÿ</code> å°±æ˜¯ <code>60</code>ï¼Œ<code>1å°æ—¶</code>æ˜¯ <code>3600</code>ï¼ˆ60ç§’Ã—60åˆ†é’Ÿï¼‰ï¼Œ<code>1å¤©</code>æ˜¯<code>86400</code>ï¼ˆ24å°æ—¶Ã—60åˆ†é’ŸÃ—60ç§’ï¼‰ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p>
<p>ä¸‹é¢æ˜¯ä¸€äº›ä½¿ç”¨æ—¶é—´å•ä½çš„å®ç”¨æ¡ˆä¾‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">uint lastUpdated;</span><br><span class="line"></span><br><span class="line">// å°†â€˜ä¸Šæ¬¡æ›´æ–°æ—¶é—´â€™ è®¾ç½®ä¸º â€˜ç°åœ¨â€™</span><br><span class="line">function updateTimestamp() public {</span><br><span class="line">  lastUpdated = now;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// å¦‚æœåˆ°ä¸Šæ¬¡`updateTimestamp` è¶…è¿‡5åˆ†é’Ÿï¼Œè¿”å› 'true'</span><br><span class="line">// ä¸åˆ°5åˆ†é’Ÿè¿”å› 'false'</span><br><span class="line">function fiveMinutesHavePassed() public view returns (bool) {</span><br><span class="line">  return (now &gt;= (lastUpdated + 5 minutes));</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æœ‰äº†è¿™äº›å·¥å…·ï¼Œæˆ‘ä»¬å¯ä»¥ä¸ºåƒµå°¸è®¾å®šâ€œå†·é™æ—¶é—´â€åŠŸèƒ½ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>ç°åœ¨å’±ä»¬ç»™DAppæ·»åŠ ä¸€ä¸ªâ€œå†·å´å‘¨æœŸâ€çš„è®¾å®šï¼Œè®©åƒµå°¸ä¸¤æ¬¡æ”»å‡»æˆ–æ•çŒä¹‹é—´å¿…é¡»ç­‰å¾… <strong>1å¤©</strong>ã€‚</p>
<ol>
<li><p>å£°æ˜ä¸€ä¸ªåä¸º <code>cooldownTime</code> çš„<code>uint</code>ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º <code>1 days</code>ã€‚ï¼ˆæ²¡é”™ï¼Œâ€1 daysâ€œä½¿ç”¨äº†å¤æ•°ï¼Œ å¦åˆ™é€šä¸è¿‡ç¼–è¯‘å™¨ï¼‰</p>
</li>
<li><p>å› ä¸ºåœ¨ä¸Šä¸€ç« ä¸­æˆ‘ä»¬ç»™ <code>Zombie</code> ç»“æ„ä½“ä¸­æ·»åŠ  <code>level</code> å’Œ <code>readyTime</code> ä¸¤ä¸ªå‚æ•°ï¼Œæ‰€ä»¥ç°åœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„ <code>Zombie</code> ç»“æ„ä½“æ—¶ï¼Œéœ€è¦ä¿®æ”¹ <code>_createZombie()</code>ï¼Œåœ¨å…¶ä¸­æŠŠæ–°æ—§å‚æ•°éƒ½åˆå§‹åŒ–ä¸€ä¸‹ã€‚</p>
<p> ä¿®æ”¹ <code>zombies.push</code> é‚£ä¸€è¡Œï¼Œ æ·»åŠ åŠ 2ä¸ªå‚æ•°ï¼š<code>1</code>ï¼ˆè¡¨ç¤ºå½“å‰çš„ <code>level</code> ï¼‰å’Œ<code>uint32ï¼ˆnow + cooldownTimeï¼‰</code>ï¼ˆç°åœ¨+å†·å´æ—¶é—´ï¼Œè¡¨ç¤ºä¸‹æ¬¡å…è®¸æ”»å‡»çš„æ—¶é—´ <code>readyTime</code>ï¼‰ã€‚</p>
</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šå¿…é¡»ä½¿ç”¨ <code>uint32ï¼ˆ...ï¼‰</code> è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œå› ä¸º <code>now</code> è¿”å›ç±»å‹ <code>uint256</code>ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ˜ç¡®å°†å®ƒè½¬æ¢æˆä¸€ä¸ª <code>uint32</code> ç±»å‹çš„å˜é‡ã€‚</p>
</blockquote>
<p><code>now + cooldownTime</code> å°†ç­‰äºå½“å‰çš„unixæ—¶é—´æˆ³ï¼ˆä»¥ç§’ä¸ºå•ä½ï¼‰åŠ ä¸Šâ€1å¤©â€œé‡Œçš„ç§’æ•° - è¿™å°†ç­‰äºä»ç°åœ¨èµ·1å¤©åçš„unixæ—¶é—´æˆ³ã€‚ç„¶åæˆ‘ä»¬å°±æ¯”è¾ƒï¼Œçœ‹çœ‹è¿™ä¸ªåƒµå°¸çš„ <code>readyTime</code>æ˜¯å¦å¤§äº <code>now</code>ï¼Œä»¥å†³å®šå†æ¬¡å¯ç”¨åƒµå°¸çš„æ—¶æœºæœ‰æ²¡æœ‰åˆ°æ¥ã€‚</p>
<p>ä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†è®¨è®ºå¦‚ä½•é€šè¿‡ <code>readyTime</code> æ¥è§„èŒƒåƒµå°¸çš„è¡Œä¸ºã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå®šä¹‰ `cooldownTime`</span><br><span class="line">uint cooldownTime = 1 days;</span><br><span class="line">    </span><br><span class="line">function _createZombie(string _name, uint _dna) internal {</span><br><span class="line">        // 2. ä¿®æ”¹ä¸‹é¢è¿™è¡Œ:</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime))) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬6ç« -åƒµå°¸å†·å´"><a href="#ç¬¬6ç« -åƒµå°¸å†·å´" class="headerlink" title="ç¬¬6ç« : åƒµå°¸å†·å´"></a>ç¬¬6ç« : åƒµå°¸å†·å´</h3><p>ç°åœ¨ï¼Œ<code>Zombie</code> ç»“æ„ä½“ä¸­å®šä¹‰å¥½äº†ä¸€ä¸ª <code>readyTime</code> å±æ€§ï¼Œè®©æˆ‘ä»¬è·³åˆ° <code>zombiefeeding.sol</code>ï¼Œ å»å®ç°ä¸€ä¸ªâ€å†·å´å‘¨æœŸå®šæ—¶å™¨â€œã€‚</p>
<p>æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ä¿®æ”¹ <code>feedAndMultiply</code>ï¼š</p>
<ol>
<li>â€æ•çŒâ€œè¡Œä¸ºä¼šè§¦å‘åƒµå°¸çš„â€å†·å´å‘¨æœŸâ€œ</li>
<li>åƒµå°¸åœ¨è¿™æ®µâ€å†·å´å‘¨æœŸâ€œç»“æŸå‰ä¸å¯å†æ•çŒå°çŒ«</li>
</ol>
<p>è¿™å°†é™åˆ¶åƒµå°¸ï¼Œé˜²æ­¢å…¶æ— é™åˆ¶åœ°æ•çŒå°çŒ«æˆ–è€…æ•´å¤©ä¸åœåœ°ç¹æ®–ã€‚å°†æ¥ï¼Œå½“æˆ‘ä»¬å¢åŠ æˆ˜æ–—åŠŸèƒ½æ—¶ï¼Œæˆ‘ä»¬åŒæ ·ç”¨â€å†·å´å‘¨æœŸâ€œé™åˆ¶åƒµå°¸ä¹‹é—´æ‰“æ–—çš„é¢‘ç‡ã€‚</p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦å®šä¹‰ä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œè®¾ç½®å¹¶æ£€æŸ¥åƒµå°¸çš„ <code>readyTime</code>ã€‚</p>
<p><strong>å°†ç»“æ„ä½“ä½œä¸ºå‚æ•°ä¼ å…¥</strong></p>
<p>ç”±äºç»“æ„ä½“çš„å­˜å‚¨æŒ‡é’ˆå¯ä»¥ä»¥å‚æ•°çš„æ–¹å¼ä¼ é€’ç»™ä¸€ä¸ª <code>private</code> æˆ– <code>internal</code> çš„å‡½æ•°ï¼Œå› æ­¤ç»“æ„ä½“å¯ä»¥åœ¨å¤šä¸ªå‡½æ•°ä¹‹é—´ç›¸äº’ä¼ é€’ã€‚</p>
<p>éµå¾ªè¿™æ ·çš„è¯­æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function _doStuff(Zombie storage _zombie) internal {</span><br><span class="line">  // do stuff with _zombie</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å°†æŸåƒµå°¸çš„å¼•ç”¨ç›´æ¥ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°ï¼Œè€Œä¸ç”¨æ˜¯é€šè¿‡å‚æ•°ä¼ å…¥åƒµå°¸IDåï¼Œå‡½æ•°å†ä¾æ®IDå»æŸ¥æ‰¾ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>å…ˆå®šä¹‰ä¸€ä¸ª <code>_triggerCooldown</code> å‡½æ•°ã€‚å®ƒè¦æ±‚ä¸€ä¸ªå‚æ•°ï¼Œ<code>_zombie</code>ï¼Œè¡¨ç¤ºä¸€æŸä¸ªåƒµå°¸çš„å­˜å‚¨æŒ‡é’ˆã€‚è¿™ä¸ªå‡½æ•°å¯è§æ€§è®¾ç½®ä¸º <code>internal</code>ã€‚</li>
<li>åœ¨å‡½æ•°ä¸­ï¼ŒæŠŠ <code>_zombie.readyTime</code> è®¾ç½®ä¸º <code>uint32ï¼ˆnow + cooldownTimeï¼‰</code>ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>_isReady</code> çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯åä¸º <code>_zombie</code> çš„ <code>Zombie storage</code>ã€‚è¿™ä¸ªåŠŸèƒ½åªå…·æœ‰ <code>internal</code> å¯è§æ€§ï¼Œå¹¶è¿”å›ä¸€ä¸ª <code>bool</code> å€¼ã€‚</li>
<li>å‡½æ•°è®¡ç®—è¿”å›<code>(_zombie.readyTime &lt;= now)</code>ï¼Œå€¼ä¸º <code>true</code> æˆ– <code>false</code>ã€‚è¿™ä¸ªåŠŸèƒ½çš„ç›®çš„æ˜¯åˆ¤æ–­ä¸‹æ¬¡å…è®¸çŒé£Ÿçš„æ—¶é—´æ˜¯å¦å·²ç»åˆ°äº†ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå®šä¹‰ `_triggerCooldown` å‡½æ•°</span><br><span class="line">  function _triggerCooldown(Zombie storage _zombie) internal {</span><br><span class="line">    _zombie.readyTime = uint32(now + cooldownTime);</span><br><span class="line">  }</span><br><span class="line">  // 2. åœ¨è¿™é‡Œå®šä¹‰ `_isReady` å‡½æ•°</span><br><span class="line">  function _isReady(Zombie storage _zombie) internal view returns(bool){</span><br><span class="line">    return (_zombie.readyTime &lt;= now);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬7ç« -å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§"><a href="#ç¬¬7ç« -å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§" class="headerlink" title="ç¬¬7ç« : å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§"></a>ç¬¬7ç« : å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§</h3><p>ç°åœ¨æ¥ä¿®æ”¹ <code>feedAndMultiply</code> ï¼Œå®ç°å†·å´å‘¨æœŸã€‚</p>
<p>å›é¡¾ä¸€ä¸‹è¿™ä¸ªå‡½æ•°ï¼Œå‰ä¸€è¯¾ä¸Šæˆ‘ä»¬å°†å…¶å¯è§æ€§è®¾ç½®ä¸º<code>public</code>ã€‚ä½ å¿…é¡»ä»”ç»†åœ°æ£€æŸ¥æ‰€æœ‰å£°æ˜ä¸º <code>public</code> å’Œ <code>external</code>çš„å‡½æ•°ï¼Œä¸€ä¸ªä¸ªæ’é™¤ç”¨æˆ·æ»¥ç”¨å®ƒä»¬çš„å¯èƒ½ï¼Œè°¨é˜²å®‰å…¨æ¼æ´ã€‚è¯·è®°ä½ï¼Œå¦‚æœè¿™äº›å‡½æ•°æ²¡æœ‰ç±»ä¼¼ <code>onlyOwner</code> è¿™æ ·çš„å‡½æ•°ä¿®é¥°ç¬¦ï¼Œç”¨æˆ·èƒ½åˆ©ç”¨å„ç§å¯èƒ½çš„å‚æ•°å»è°ƒç”¨å®ƒä»¬ã€‚</p>
<p>æ£€æŸ¥å®Œè¿™ä¸ªå‡½æ•°ï¼Œç”¨æˆ·å°±å¯ä»¥ç›´æ¥è°ƒç”¨è¿™ä¸ªå®ƒï¼Œå¹¶ä¼ å…¥ä»–ä»¬æ‰€å¸Œæœ›çš„ <code>_targetDna</code> æˆ– <code>species</code> ã€‚æ‰“ä¸ªæ¸¸æˆè¿˜å¾—éµå¾ªè¿™ä¹ˆå¤šçš„è§„åˆ™ï¼Œè¿˜èƒ½ä¸èƒ½æ„‰å¿«åœ°ç©è€å•Šï¼</p>
<p>ä»”ç»†è§‚å¯Ÿï¼Œè¿™ä¸ªå‡½æ•°åªéœ€è¢« <code>feedOnKitty()</code> è°ƒç”¨ï¼Œå› æ­¤ï¼Œæƒ³è¦é˜²æ­¢æ¼æ´ï¼Œæœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯è®¾å…¶å¯è§æ€§ä¸º <code>internal</code>ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>ç›®å‰å‡½æ•° <code>feedAndMultiply</code> å¯è§æ€§ä¸º <code>public</code>ã€‚æˆ‘ä»¬å°†å…¶æ”¹ä¸º <code>internal</code> ä»¥ä¿éšœåˆçº¦å®‰å…¨ã€‚å› ä¸ºæˆ‘ä»¬ä¸å¸Œæœ›ç”¨æˆ·è°ƒç”¨å®ƒçš„æ—¶å€™å¡è¿›ä¸€å †ä¹±ä¸ƒå…«ç³Ÿçš„ DNAã€‚</li>
<li><code>feedAndMultiply</code> è¿‡ç¨‹éœ€è¦å‚è€ƒ <code>cooldownTime</code>ã€‚é¦–å…ˆï¼Œåœ¨æ‰¾åˆ° <code>myZombie</code> ä¹‹åï¼Œæ·»åŠ ä¸€ä¸ª <code>require</code> è¯­å¥æ¥æ£€æŸ¥ <code>_isReady()</code> å¹¶å°† <code>myZombie</code> ä¼ é€’ç»™å®ƒã€‚è¿™æ ·ç”¨æˆ·å¿…é¡»ç­‰åˆ°åƒµå°¸çš„ <code>å†·å´å‘¨æœŸ</code> ç»“æŸåæ‰èƒ½æ‰§è¡Œ <code>feedAndMultiply</code> åŠŸèƒ½ã€‚</li>
<li>åœ¨å‡½æ•°ç»“æŸæ—¶ï¼Œè°ƒç”¨ <code>_triggerCooldown(myZombie)</code>ï¼Œæ ‡æ˜æ•çŒè¡Œä¸ºè§¦å‘äº†åƒµå°¸æ–°çš„å†·å´å‘¨æœŸã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// 1. ä½¿è¿™ä¸ªå‡½æ•°çš„å¯è§æ€§ä¸º internal</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string species) internal {</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    // 2. åœ¨è¿™é‡Œä¸º `_isReady` å¢åŠ ä¸€ä¸ªæ£€æŸ¥</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(species) == keccak256("kitty")) {</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    }</span><br><span class="line">    _createZombie("NoName", newDna);</span><br><span class="line">    // 3. è°ƒç”¨ `_triggerCooldown`</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬8ç« -è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦"><a href="#ç¬¬8ç« -è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦" class="headerlink" title="ç¬¬8ç« : è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦"></a>ç¬¬8ç« : è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦</h3><p>ç›¸å½“ä¸é”™ï¼æˆ‘ä»¬çš„åƒµå°¸ç°åœ¨æœ‰äº†â€œå†·å´å®šæ—¶å™¨â€åŠŸèƒ½ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ·»åŠ ä¸€äº›è¾…åŠ©æ–¹æ³•ã€‚æˆ‘ä»¬ä¸ºæ‚¨åˆ›å»ºäº†ä¸€ä¸ªåä¸º <code>zombiehelper.sol</code> çš„æ–°æ–‡ä»¶ï¼Œå¹¶ä¸”å°† <code>zombiefeeding.sol</code> å¯¼å…¥å…¶ä¸­ï¼Œè¿™è®©æˆ‘ä»¬çš„ä»£ç æ›´æ•´æ´ã€‚</p>
<p>æˆ‘ä»¬æ‰“ç®—è®©åƒµå°¸åœ¨è¾¾åˆ°ä¸€å®šæ°´å¹³åï¼Œè·å¾—ç‰¹æ®Šèƒ½åŠ›ã€‚ä½†æ˜¯è¾¾åˆ°è¿™ä¸ªå°ç›®æ ‡ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å­¦ä¸€å­¦ä»€ä¹ˆæ˜¯â€œå‡½æ•°ä¿®é¥°ç¬¦â€ã€‚</p>
<p><strong>å¸¦å‚æ•°çš„å‡½æ•°ä¿®é¥°ç¬¦</strong></p>
<p>ä¹‹å‰æˆ‘ä»¬å·²ç»è¯»è¿‡ä¸€ä¸ªç®€å•çš„å‡½æ•°ä¿®é¥°ç¬¦äº†ï¼š<code>onlyOwner</code>ã€‚å‡½æ•°ä¿®é¥°ç¬¦ä¹Ÿå¯ä»¥å¸¦å‚æ•°ã€‚ä¾‹å¦‚ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// å­˜å‚¨ç”¨æˆ·å¹´é¾„çš„æ˜ å°„</span><br><span class="line">mapping (uint =&gt; uint) public age;</span><br><span class="line"></span><br><span class="line">// é™å®šç”¨æˆ·å¹´é¾„çš„ä¿®é¥°ç¬¦</span><br><span class="line">modifier olderThan(uint _age, uint _userId) {</span><br><span class="line">  require(age[_userId] &gt;= _age);</span><br><span class="line">  _;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// å¿…é¡»å¹´æ»¡16å‘¨å²æ‰å…è®¸å¼€è½¦ (è‡³å°‘åœ¨ç¾å›½æ˜¯è¿™æ ·çš„).</span><br><span class="line">// æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å‚æ•°è°ƒç”¨`olderThan` ä¿®é¥°ç¬¦:</span><br><span class="line">function driveCar(uint _userId) public olderThan(16, _userId) {</span><br><span class="line">  // å…¶ä½™çš„ç¨‹åºé€»è¾‘</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>çœ‹åˆ°äº†å§ï¼Œ <code>olderThan</code> ä¿®é¥°ç¬¦å¯ä»¥åƒå‡½æ•°ä¸€æ ·æ¥æ”¶å‚æ•°ï¼Œæ˜¯â€œå®¿ä¸»â€å‡½æ•° <code>driveCar</code> æŠŠå‚æ•°ä¼ é€’ç»™å®ƒçš„ä¿®é¥°ç¬¦çš„ã€‚</p>
<p>æ¥ï¼Œæˆ‘ä»¬è‡ªå·±ç”Ÿäº§ä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œé€šè¿‡ä¼ å…¥çš„<code>level</code>å‚æ•°æ¥é™åˆ¶åƒµå°¸ä½¿ç”¨æŸäº›ç‰¹æ®ŠåŠŸèƒ½ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>åœ¨<code>ZombieHelper</code> ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>aboveLevel</code> çš„<code>modifier</code>ï¼Œå®ƒæ¥æ”¶2ä¸ªå‚æ•°ï¼Œ <code>_level</code> (<code>uint</code>ç±»å‹) ä»¥åŠ <code>_zombieId</code> (<code>uint</code>ç±»å‹)ã€‚</li>
<li>è¿ç”¨å‡½æ•°é€»è¾‘ç¡®ä¿åƒµå°¸ <code>zombies[_zombieId].level</code> å¤§äºæˆ–ç­‰äº <code>_level</code>ã€‚</li>
<li>è®°ä½ï¼Œä¿®é¥°ç¬¦çš„æœ€åä¸€è¡Œä¸º <code>_;</code>ï¼Œè¡¨ç¤ºä¿®é¥°ç¬¦è°ƒç”¨ç»“æŸåè¿”å›ï¼Œå¹¶æ‰§è¡Œè°ƒç”¨å‡½æ•°ä½™ä¸‹çš„éƒ¨åˆ†ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import "./zombiefeeding.sol";</span><br><span class="line"></span><br><span class="line">contract ZombieHelper is ZombieFeeding {</span><br><span class="line"></span><br><span class="line">  // åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId){</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬9ç« -åƒµå°¸ä¿®é¥°ç¬¦"><a href="#ç¬¬9ç« -åƒµå°¸ä¿®é¥°ç¬¦" class="headerlink" title="ç¬¬9ç« : åƒµå°¸ä¿®é¥°ç¬¦"></a>ç¬¬9ç« : åƒµå°¸ä¿®é¥°ç¬¦</h3><p>ç°åœ¨è®©æˆ‘ä»¬è®¾è®¡ä¸€äº›ä½¿ç”¨ <code>aboveLevel</code> ä¿®é¥°ç¬¦çš„å‡½æ•°ã€‚</p>
<p>ä½œä¸ºæ¸¸æˆï¼Œæ‚¨å¾—æœ‰ä¸€äº›æªæ–½æ¿€åŠ±ç©å®¶ä»¬å»å‡çº§ä»–ä»¬çš„åƒµå°¸ï¼š</p>
<ul>
<li>2çº§ä»¥ä¸Šçš„åƒµå°¸ï¼Œç©å®¶å¯ç»™ä»–ä»¬æ”¹åã€‚</li>
<li>20çº§ä»¥ä¸Šçš„åƒµå°¸ï¼Œç©å®¶èƒ½ç»™ä»–ä»¬å®šåˆ¶çš„ DNAã€‚</li>
</ul>
<p>æ˜¯å®ç°è¿™äº›åŠŸèƒ½çš„æ—¶å€™äº†ã€‚ä»¥ä¸‹æ˜¯ä¸Šä¸€è¯¾çš„ç¤ºä¾‹ä»£ç ï¼Œä¾›å‚è€ƒï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">// å­˜å‚¨ç”¨æˆ·å¹´é¾„çš„æ˜ å°„</span><br><span class="line">mapping (uint =&gt; uint) public age;</span><br><span class="line"></span><br><span class="line">// é™å®šç”¨æˆ·å¹´é¾„çš„ä¿®é¥°ç¬¦</span><br><span class="line">modifier olderThan(uint _age, uint _userId) {</span><br><span class="line">  require (age[_userId] &gt;= _age);</span><br><span class="line">  _;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// å¿…é¡»å¹´æ»¡16å‘¨å²æ‰å…è®¸å¼€è½¦ (è‡³å°‘åœ¨ç¾å›½æ˜¯è¿™æ ·çš„).</span><br><span class="line">// æˆ‘ä»¬å¯ä»¥ç”¨å¦‚ä¸‹å‚æ•°è°ƒç”¨`olderThan` ä¿®é¥°ç¬¦:</span><br><span class="line">function driveCar(uint _userId) public olderThan(16, _userId) {</span><br><span class="line">  // å…¶ä½™çš„ç¨‹åºé€»è¾‘</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>changeName</code> çš„å‡½æ•°ã€‚å®ƒæ¥æ”¶2ä¸ªå‚æ•°ï¼š<code>_zombieId</code>ï¼ˆ<code>uint</code>ç±»å‹ï¼‰ä»¥åŠ <code>_newName</code>ï¼ˆ<code>string</code>ç±»å‹ï¼‰ï¼Œå¯è§æ€§ä¸º <code>external</code>ã€‚å®ƒå¸¦æœ‰ä¸€ä¸ª <code>aboveLevel</code> ä¿®é¥°ç¬¦ï¼Œè°ƒç”¨çš„æ—¶å€™é€šè¿‡ <code>_level</code> å‚æ•°ä¼ å…¥<code>2</code>ï¼Œ å½“ç„¶ï¼Œåˆ«å¿˜äº†åŒæ—¶ä¼  <code>_zombieId</code> å‚æ•°ã€‚</li>
<li>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œé¦–å…ˆæˆ‘ä»¬ç”¨ <code>require</code> è¯­å¥ï¼ŒéªŒè¯ <code>msg.sender</code> æ˜¯å¦å°±æ˜¯ <code>zombieToOwner [_zombieId]</code>ã€‚</li>
<li>ç„¶åå‡½æ•°å°† <code>zombies[_zombieId] .name</code> è®¾ç½®ä¸º <code>_newName</code>ã€‚</li>
<li>åœ¨ <code>changeName</code> ä¸‹åˆ›å»ºå¦ä¸€ä¸ªåä¸º <code>changeDna</code> çš„å‡½æ•°ã€‚å®ƒçš„å®šä¹‰å’Œå†…å®¹å‡ ä¹å’Œ <code>changeName</code> ç›¸åŒï¼Œä¸è¿‡å®ƒç¬¬äºŒä¸ªå‚æ•°æ˜¯ <code>_newDna</code>ï¼ˆ<code>uint</code>ç±»å‹ï¼‰ï¼Œåœ¨ä¿®é¥°ç¬¦ <code>aboveLevel</code> çš„ <code>_level</code> å‚æ•°ä¸­ä¼ é€’ <code>20</code> ã€‚ç°åœ¨ï¼Œä»–å¯ä»¥æŠŠåƒµå°¸çš„ <code>dna</code> è®¾ç½®ä¸º <code>_newDna</code> äº†ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId){</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId){</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬10ç« -åˆ©ç”¨-â€˜Viewâ€™-å‡½æ•°èŠ‚çœ-Gas"><a href="#ç¬¬10ç« -åˆ©ç”¨-â€˜Viewâ€™-å‡½æ•°èŠ‚çœ-Gas" class="headerlink" title="ç¬¬10ç« : åˆ©ç”¨ â€˜Viewâ€™ å‡½æ•°èŠ‚çœ Gas"></a>ç¬¬10ç« : åˆ©ç”¨ â€˜Viewâ€™ å‡½æ•°èŠ‚çœ Gas</h3><p>é…·ç‚«ï¼ç°åœ¨é«˜çº§åˆ«åƒµå°¸å¯ä»¥æ‹¥æœ‰ç‰¹æ®ŠæŠ€èƒ½äº†ï¼Œè¿™ä¸€å®šä¼šé¼“åŠ¨æˆ‘ä»¬çš„ç©å®¶å»æ‰“æ€ªå‡çº§çš„ã€‚ä½ å–œæ¬¢çš„è¯ï¼Œå›å¤´æˆ‘ä»¬è¿˜èƒ½æ·»åŠ æ›´å¤šçš„ç‰¹æ®ŠæŠ€èƒ½ã€‚</p>
<p>ç°åœ¨éœ€è¦æ·»åŠ çš„ä¸€ä¸ªåŠŸèƒ½æ˜¯ï¼šæˆ‘ä»¬çš„ DApp éœ€è¦ä¸€ä¸ªæ–¹æ³•æ¥æŸ¥çœ‹æŸç©å®¶çš„æ•´ä¸ªåƒµå°¸å†›å›¢ - æˆ‘ä»¬ç§°ä¹‹ä¸º <code>getZombiesByOwner</code>ã€‚</p>
<p>å®ç°è¿™ä¸ªåŠŸèƒ½åªéœ€ä»åŒºå—é“¾ä¸­è¯»å–æ•°æ®ï¼Œæ‰€ä»¥å®ƒå¯ä»¥æ˜¯ä¸€ä¸ª <code>view</code> å‡½æ•°ã€‚è¿™è®©æˆ‘ä»¬ä¸å¾—ä¸å›é¡¾ä¸€ä¸‹â€œgasä¼˜åŒ–â€è¿™ä¸ªé‡è¦è¯é¢˜ã€‚</p>
<p><strong>â€œviewâ€ å‡½æ•°ä¸èŠ± â€œgasâ€</strong></p>
<p>å½“ç©å®¶ä»å¤–éƒ¨è°ƒç”¨ä¸€ä¸ª<code>view</code>å‡½æ•°ï¼Œæ˜¯ä¸éœ€è¦æ”¯ä»˜ä¸€åˆ† gas çš„ã€‚</p>
<p>è¿™æ˜¯å› ä¸º <code>view</code> å‡½æ•°ä¸ä¼šçœŸæ­£æ”¹å˜åŒºå—é“¾ä¸Šçš„ä»»ä½•æ•°æ® - å®ƒä»¬åªæ˜¯è¯»å–ã€‚å› æ­¤ç”¨ <code>view</code> æ ‡è®°ä¸€ä¸ªå‡½æ•°ï¼Œæ„å‘³ç€å‘Šè¯‰ <code>web3.js</code>ï¼Œè¿è¡Œè¿™ä¸ªå‡½æ•°åªéœ€è¦æŸ¥è¯¢ä½ çš„æœ¬åœ°ä»¥å¤ªåŠèŠ‚ç‚¹ï¼Œè€Œä¸éœ€è¦åœ¨åŒºå—é“¾ä¸Šåˆ›å»ºä¸€ä¸ªäº‹åŠ¡ï¼ˆäº‹åŠ¡éœ€è¦è¿è¡Œåœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šï¼Œå› æ­¤èŠ±è´¹ gasï¼‰ã€‚</p>
<p>ç¨åæˆ‘ä»¬å°†ä»‹ç»å¦‚ä½•åœ¨è‡ªå·±çš„èŠ‚ç‚¹ä¸Šè®¾ç½® web3.jsã€‚ä½†ç°åœ¨ï¼Œä½ å…³é”®æ˜¯è¦è®°ä½ï¼Œåœ¨æ‰€èƒ½åªè¯»çš„å‡½æ•°ä¸Šæ ‡è®°ä¸Šè¡¨ç¤ºâ€œåªè¯»â€çš„â€œ<code>external view</code> å£°æ˜ï¼Œå°±èƒ½ä¸ºä½ çš„ç©å®¶å‡å°‘åœ¨ DApp ä¸­ gas ç”¨é‡ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå¦‚æœä¸€ä¸ª <code>view</code> å‡½æ•°åœ¨å¦ä¸€ä¸ªå‡½æ•°çš„å†…éƒ¨è¢«è°ƒç”¨ï¼Œè€Œè°ƒç”¨å‡½æ•°ä¸ <code>view</code> å‡½æ•°çš„ä¸å±äºåŒä¸€ä¸ªåˆçº¦ï¼Œä¹Ÿä¼šäº§ç”Ÿè°ƒç”¨æˆæœ¬ã€‚è¿™æ˜¯å› ä¸ºå¦‚æœä¸»è°ƒå‡½æ•°åœ¨ä»¥å¤ªåŠåˆ›å»ºäº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå®ƒä»ç„¶éœ€è¦é€ä¸ªèŠ‚ç‚¹å»éªŒè¯ã€‚æ‰€ä»¥æ ‡è®°ä¸º <code>view</code> çš„å‡½æ•°åªæœ‰åœ¨å¤–éƒ¨è°ƒç”¨æ—¶æ‰æ˜¯å…è´¹çš„ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æ¥å†™ä¸€ä¸ªâ€è¿”å›æŸç©å®¶çš„æ•´ä¸ªåƒµå°¸å†›å›¢â€œçš„å‡½æ•°ã€‚å½“æˆ‘ä»¬ä» <code>web3.js</code> ä¸­è°ƒç”¨å®ƒï¼Œå³å¯æ˜¾ç¤ºæŸä¸€ç©å®¶çš„ä¸ªäººèµ„æ–™é¡µã€‚</p>
<p>è¿™ä¸ªå‡½æ•°çš„é€»è¾‘æœ‰ç‚¹å¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦å¥½å‡ ä¸ªç« èŠ‚æ¥æè¿°å®ƒçš„å®ç°ã€‚</p>
<ol>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>getZombiesByOwner</code> çš„æ–°å‡½æ•°ã€‚å®ƒæœ‰ä¸€ä¸ªåä¸º <code>_owner</code> çš„ <code>address</code> ç±»å‹çš„å‚æ•°ã€‚</li>
<li>å°†å…¶ç”³æ˜ä¸º <code>external view</code> å‡½æ•°ï¼Œè¿™æ ·å½“ç©å®¶ä» <code>web3.js</code> ä¸­è°ƒç”¨å®ƒæ—¶ï¼Œä¸éœ€è¦èŠ±è´¹ä»»ä½• gasã€‚</li>
<li>å‡½æ•°éœ€è¦è¿”å›ä¸€ä¸ª<code>uint []</code>ï¼ˆ<code>uint</code>æ•°ç»„ï¼‰ã€‚</li>
</ol>
<p>å…ˆè¿™ä¹ˆå£°æ˜ç€ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« ä¸­å¡«å……å‡½æ•°ä½“ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œåˆ›å»ºä½ çš„å‡½æ•°</span><br><span class="line"> function getZombiesByOwner(address _owner) external view returns(uint[]){</span><br><span class="line"></span><br><span class="line"> }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬11ç« -å­˜å‚¨éå¸¸æ˜‚è´µ"><a href="#ç¬¬11ç« -å­˜å‚¨éå¸¸æ˜‚è´µ" class="headerlink" title="ç¬¬11ç« : å­˜å‚¨éå¸¸æ˜‚è´µ"></a>ç¬¬11ç« : å­˜å‚¨éå¸¸æ˜‚è´µ</h3><p>Solidity ä½¿ç”¨<code>storage</code>(å­˜å‚¨)æ˜¯ç›¸å½“æ˜‚è´µçš„ï¼Œâ€å†™å…¥â€œæ“ä½œå°¤å…¶è´µã€‚</p>
<p>è¿™æ˜¯å› ä¸ºï¼Œæ— è®ºæ˜¯å†™å…¥è¿˜æ˜¯æ›´æ”¹ä¸€æ®µæ•°æ®ï¼Œ è¿™éƒ½å°†æ°¸ä¹…æ€§åœ°å†™å…¥åŒºå—é“¾ã€‚â€æ°¸ä¹…æ€§â€œå•Šï¼éœ€è¦åœ¨å…¨çƒæ•°åƒä¸ªèŠ‚ç‚¹çš„ç¡¬ç›˜ä¸Šå­˜å…¥è¿™äº›æ•°æ®ï¼Œéšç€åŒºå—é“¾çš„å¢é•¿ï¼Œæ‹·è´ä»½æ•°æ›´å¤šï¼Œå­˜å‚¨é‡ä¹Ÿå°±è¶Šå¤§ã€‚è¿™æ˜¯éœ€è¦æˆæœ¬çš„ï¼</p>
<p>ä¸ºäº†é™ä½æˆæœ¬ï¼Œä¸åˆ°ä¸‡ä¸å¾—å·²ï¼Œé¿å…å°†æ•°æ®å†™å…¥å­˜å‚¨ã€‚è¿™ä¹Ÿä¼šå¯¼è‡´æ•ˆç‡ä½ä¸‹çš„ç¼–ç¨‹é€»è¾‘ - æ¯”å¦‚æ¯æ¬¡è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œéƒ½éœ€è¦åœ¨ <code>memory</code>(å†…å­˜) ä¸­é‡å»ºä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸æ˜¯ç®€å•åœ°å°†ä¸Šæ¬¡è®¡ç®—çš„æ•°ç»„ç»™å­˜å‚¨ä¸‹æ¥ä»¥ä¾¿å¿«é€ŸæŸ¥æ‰¾ã€‚</p>
<p>åœ¨å¤§å¤šæ•°ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œéå†å¤§æ•°æ®é›†åˆéƒ½æ˜¯æ˜‚è´µçš„ã€‚ä½†æ˜¯åœ¨ Solidity ä¸­ï¼Œä½¿ç”¨ä¸€ä¸ªæ ‡è®°äº†<code>external view</code>çš„å‡½æ•°ï¼Œéå†æ¯” <code>storage</code> è¦ä¾¿å®œå¤ªå¤šï¼Œå› ä¸º <code>view</code> å‡½æ•°ä¸ä¼šäº§ç”Ÿä»»ä½•èŠ±é”€ã€‚ ï¼ˆgaså¯æ˜¯çœŸé‡‘ç™½é“¶å•Šï¼ï¼‰ã€‚</p>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« è®¨è®º<code>for</code>å¾ªç¯ï¼Œç°åœ¨æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹çœ‹å¦‚ä½•å¦‚ä½•åœ¨å†…å­˜ä¸­å£°æ˜æ•°ç»„ã€‚</p>
<p><strong>åœ¨å†…å­˜ä¸­å£°æ˜æ•°ç»„</strong></p>
<p>åœ¨æ•°ç»„åé¢åŠ ä¸Š <code>memory</code>å…³é”®å­—ï¼Œ è¡¨æ˜è¿™ä¸ªæ•°ç»„æ˜¯ä»…ä»…åœ¨å†…å­˜ä¸­åˆ›å»ºï¼Œä¸éœ€è¦å†™å…¥å¤–éƒ¨å­˜å‚¨ï¼Œå¹¶ä¸”åœ¨å‡½æ•°è°ƒç”¨ç»“æŸæ—¶å®ƒå°±è§£æ•£äº†ã€‚ä¸åœ¨ç¨‹åºç»“æŸæ—¶æŠŠæ•°æ®ä¿å­˜è¿› <code>storage</code> çš„åšæ³•ç›¸æ¯”ï¼Œå†…å­˜è¿ç®—å¯ä»¥å¤§å¤§èŠ‚çœgaså¼€é”€ â€“ æŠŠè¿™æ•°ç»„æ”¾åœ¨<code>view</code>é‡Œç”¨ï¼Œå®Œå…¨ä¸ç”¨èŠ±é’±ã€‚</p>
<p>ä»¥ä¸‹æ˜¯ç”³æ˜ä¸€ä¸ªå†…å­˜æ•°ç»„çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function getArray() external pure returns(uint[]) {</span><br><span class="line">  // åˆå§‹åŒ–ä¸€ä¸ªé•¿åº¦ä¸º3çš„å†…å­˜æ•°ç»„</span><br><span class="line">  uint[] memory values = new uint[](3);</span><br><span class="line">  // èµ‹å€¼</span><br><span class="line">  values.push(1);</span><br><span class="line">  values.push(2);</span><br><span class="line">  values.push(3);</span><br><span class="line">  // è¿”å›æ•°ç»„</span><br><span class="line">  return values;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªå°ä¾‹å­å±•ç¤ºäº†ä¸€äº›è¯­æ³•è§„åˆ™ï¼Œä¸‹ä¸€ç« ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡ä¸€ä¸ªå®é™…ç”¨ä¾‹ï¼Œå±•ç¤ºå®ƒå’Œ <code>for</code> å¾ªç¯ç»“åˆçš„åšæ³•ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå†…å­˜æ•°ç»„ <strong>å¿…é¡»</strong> ç”¨é•¿åº¦å‚æ•°ï¼ˆåœ¨æœ¬ä¾‹ä¸­ä¸º<code>3</code>ï¼‰åˆ›å»ºã€‚ç›®å‰ä¸æ”¯æŒ <code>array.push()</code>ä¹‹ç±»çš„æ–¹æ³•è°ƒæ•´æ•°ç»„å¤§å°ï¼Œåœ¨æœªæ¥çš„ç‰ˆæœ¬å¯èƒ½ä¼šæ”¯æŒé•¿åº¦ä¿®æ”¹ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬è¦è¦åˆ›å»ºä¸€ä¸ªåä¸º <code>getZombiesByOwner</code> çš„å‡½æ•°ï¼Œå®ƒä»¥<code>uint []</code>æ•°ç»„çš„å½¢å¼è¿”å›æŸä¸€ç”¨æˆ·æ‰€æ‹¥æœ‰çš„æ‰€æœ‰åƒµå°¸ã€‚</p>
<ol>
<li>å£°æ˜ä¸€ä¸ªåä¸º<code>result</code>çš„<code>uint [] memory'</code> ï¼ˆå†…å­˜å˜é‡æ•°ç»„ï¼‰</li>
<li>å°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªæ–°çš„ <code>uint</code> ç±»å‹æ•°ç»„ã€‚æ•°ç»„çš„é•¿åº¦ä¸ºè¯¥ <code>_owner</code> æ‰€æ‹¥æœ‰çš„åƒµå°¸æ•°é‡ï¼Œè¿™å¯é€šè¿‡è°ƒç”¨ <code>ownerZombieCount [_ owner]</code> æ¥è·å–ã€‚</li>
<li>å‡½æ•°ç»“æŸï¼Œè¿”å› <code>result</code> ã€‚ç›®å‰å®ƒåªæ˜¯ä¸ªç©ºæ•°åˆ—ï¼Œæˆ‘ä»¬åˆ°ä¸‹ä¸€ç« å»å®ç°å®ƒã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns(uint[]) {</span><br><span class="line">    // åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    return result;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬12ç« -For-å¾ªç¯"><a href="#ç¬¬12ç« -For-å¾ªç¯" class="headerlink" title="ç¬¬12ç« : For å¾ªç¯"></a>ç¬¬12ç« : For å¾ªç¯</h3><p>åœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ï¼Œæˆ‘ä»¬æåˆ°è¿‡ï¼Œå‡½æ•°ä¸­ä½¿ç”¨çš„æ•°ç»„æ˜¯è¿è¡Œæ—¶åœ¨å†…å­˜ä¸­é€šè¿‡ <code>for</code> å¾ªç¯å®æ—¶æ„å»ºï¼Œè€Œä¸æ˜¯é¢„å…ˆå»ºç«‹åœ¨å­˜å‚¨ä¸­çš„ã€‚</p>
<p>ä¸ºä»€ä¹ˆè¦è¿™æ ·åšå‘¢ï¼Ÿ</p>
<p>ä¸ºäº†å®ç° <code>getZombiesByOwner</code> å‡½æ•°ï¼Œä¸€ç§â€œæ— è„‘å¼â€çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨ <code>ZombieFactory</code> ä¸­å­˜å…¥â€ä¸»äººâ€œå’Œâ€åƒµå°¸å†›å›¢â€œçš„æ˜ å°„ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapping (address =&gt; uint[]) public ownerToZombies</span><br></pre></td></tr></tbody></table></figure>

<p>ç„¶åæˆ‘ä»¬æ¯æ¬¡åˆ›å»ºæ–°åƒµå°¸æ—¶ï¼Œæ‰§è¡Œ <code>ownerToZombies [owner] .pushï¼ˆzombieIdï¼‰</code> å°†å…¶æ·»åŠ åˆ°ä¸»äººçš„åƒµå°¸æ•°ç»„ä¸­ã€‚è€Œ <code>getZombiesByOwner</code> å‡½æ•°ä¹Ÿéå¸¸ç®€å•ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns (uint[]) {</span><br><span class="line">  return ownerToZombies[_owner];</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>è¿™ä¸ªåšæ³•æœ‰é—®é¢˜</strong></p>
<p>åšæ³•å€’æ˜¯ç®€å•ã€‚å¯æ˜¯å¦‚æœæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå‡½æ•°æ¥æŠŠä¸€å¤´åƒµå°¸è½¬ç§»åˆ°å¦ä¸€ä¸ªä¸»äººåä¸‹ï¼ˆæˆ‘ä»¬ä¸€å®šä¼šåœ¨åé¢çš„è¯¾ç¨‹ä¸­å®ç°çš„ï¼‰ï¼Œåˆä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p>
<p>è¿™ä¸ªâ€œæ¢ä¸»â€å‡½æ•°è¦åšåˆ°ï¼š</p>
<p>1.å°†åƒµå°¸pushåˆ°æ–°ä¸»äººçš„ <code>ownerToZombies</code> æ•°ç»„ä¸­ï¼Œ 2.ä»æ—§ä¸»çš„ <code>ownerToZombies</code> æ•°ç»„ä¸­ç§»é™¤åƒµå°¸ï¼Œ 3.å°†æ—§ä¸»åƒµå°¸æ•°ç»„ä¸­â€œæ¢ä¸»åƒµå°¸â€ä¹‹åçš„çš„æ¯å¤´åƒµå°¸éƒ½å¾€å‰æŒªä¸€ä½ï¼ŒæŠŠæŒªèµ°â€œæ¢ä¸»åƒµå°¸â€åç•™ä¸‹çš„â€œç©ºæ§½â€å¡«ä¸Šï¼Œ 4.å°†æ•°ç»„é•¿åº¦å‡1ã€‚</p>
<p>ä½†æ˜¯ç¬¬ä¸‰æ­¥å®åœ¨æ˜¯å¤ªè´µäº†ï¼å› ä¸ºæ¯æŒªåŠ¨ä¸€å¤´åƒµå°¸ï¼Œæˆ‘ä»¬éƒ½è¦æ‰§è¡Œä¸€æ¬¡å†™æ“ä½œã€‚å¦‚æœä¸€ä¸ªä¸»äººæœ‰20å¤´åƒµå°¸ï¼Œè€Œç¬¬ä¸€å¤´è¢«æŒªèµ°äº†ï¼Œé‚£ä¸ºäº†ä¿æŒæ•°ç»„çš„é¡ºåºï¼Œæˆ‘ä»¬å¾—åš19ä¸ªå†™æ“ä½œã€‚</p>
<p>ç”±äºå†™å…¥å­˜å‚¨æ˜¯ Solidity ä¸­æœ€è´¹ gas çš„æ“ä½œä¹‹ä¸€ï¼Œä½¿å¾—æ¢ä¸»å‡½æ•°çš„æ¯æ¬¡è°ƒç”¨éƒ½éå¸¸æ˜‚è´µã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œæ¯æ¬¡è°ƒç”¨çš„æ—¶å€™èŠ±è´¹çš„ gas éƒ½ä¸åŒï¼å…·ä½“è¿˜å–å†³äºç”¨æˆ·åœ¨åŸä¸»å†›å›¢ä¸­çš„åƒµå°¸å¤´æ•°ï¼Œä»¥åŠç§»èµ°çš„åƒµå°¸æ‰€åœ¨çš„ä½ç½®ã€‚ä»¥è‡³äºç”¨æˆ·éƒ½ä¸çŸ¥é“åº”è¯¥æ”¯ä»˜å¤šå°‘ gasã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠæ•°ç»„ä¸­æœ€åä¸€ä¸ªåƒµå°¸å¾€å‰æŒªæ¥å¡«è¡¥ç©ºæ§½ï¼Œå¹¶å°†æ•°ç»„é•¿åº¦å‡å°‘ä¸€ã€‚ä½†è¿™æ ·æ¯åšä¸€ç¬”äº¤æ˜“ï¼Œéƒ½ä¼šæ”¹å˜åƒµå°¸å†›å›¢çš„ç§©åºã€‚</p>
</blockquote>
<p>ç”±äºä»å¤–éƒ¨è°ƒç”¨ä¸€ä¸ª <code>view</code> å‡½æ•°æ˜¯å…è´¹çš„ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ <code>getZombiesByOwner</code> å‡½æ•°ä¸­ç”¨ä¸€ä¸ªforå¾ªç¯éå†æ•´ä¸ªåƒµå°¸æ•°ç»„ï¼ŒæŠŠå±äºæŸä¸ªä¸»äººçš„åƒµå°¸æŒ‘å‡ºæ¥æ„å»ºå‡ºåƒµå°¸æ•°ç»„ã€‚é‚£ä¹ˆæˆ‘ä»¬çš„ <code>transfer</code> å‡½æ•°å°†ä¼šä¾¿å®œå¾—å¤šï¼Œå› ä¸ºæˆ‘ä»¬ä¸éœ€è¦æŒªåŠ¨å­˜å‚¨é‡Œçš„åƒµå°¸æ•°ç»„é‡æ–°æ’åºï¼Œæ€»ä½“ä¸Šè¿™ä¸ªæ–¹æ³•ä¼šæ›´ä¾¿å®œï¼Œè™½ç„¶æœ‰ç‚¹åç›´è§‰ã€‚</p>
<p><strong>ä½¿ç”¨ <code>for</code> å¾ªç¯</strong></p>
<p><code>for</code>å¾ªç¯çš„è¯­æ³•åœ¨ Solidity å’Œ JavaScript ä¸­ç±»ä¼¼ã€‚</p>
<p>æ¥çœ‹ä¸€ä¸ªåˆ›å»ºå¶æ•°æ•°ç»„çš„ä¾‹å­ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function getEvens() pure external returns(uint[]) {</span><br><span class="line">  uint[] memory evens = new uint[](5);</span><br><span class="line">  // åœ¨æ–°æ•°ç»„ä¸­è®°å½•åºåˆ—å·</span><br><span class="line">  uint counter = 0;</span><br><span class="line">  // åœ¨å¾ªç¯ä»1è¿­ä»£åˆ°10ï¼š</span><br><span class="line">  for (uint i = 1; i &lt;= 10; i++) {</span><br><span class="line">    // å¦‚æœ `i` æ˜¯å¶æ•°...</span><br><span class="line">    if (i % 2 == 0) {</span><br><span class="line">      // æŠŠå®ƒåŠ å…¥å¶æ•°æ•°ç»„</span><br><span class="line">      evens[counter] = i;</span><br><span class="line">      //ç´¢å¼•åŠ ä¸€ï¼Œ æŒ‡å‘ä¸‹ä¸€ä¸ªç©ºçš„â€˜evenâ€™</span><br><span class="line">      counter++;</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">  return evens;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªå‡½æ•°å°†è¿”å›ä¸€ä¸ªå½¢ä¸º <code>[2,4,6,8,10]</code> çš„æ•°ç»„ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å›åˆ° <code>getZombiesByOwner</code> å‡½æ•°ï¼Œ é€šè¿‡ä¸€æ¡ <code>for</code> å¾ªç¯æ¥éå† DApp ä¸­æ‰€æœ‰çš„åƒµå°¸ï¼Œ å°†ç»™å®šçš„â€˜ç”¨æˆ·idâ€™ä¸æ¯å¤´åƒµå°¸çš„â€˜ä¸»äººâ€™è¿›è¡Œæ¯”è¾ƒï¼Œå¹¶åœ¨å‡½æ•°è¿”å›ä¹‹å‰å°†å®ƒä»¬æ¨é€åˆ°æˆ‘ä»¬çš„<code>result</code> æ•°ç»„ä¸­ã€‚</p>
<p>1.å£°æ˜ä¸€ä¸ªå˜é‡ <code>counter</code>ï¼Œå±æ€§ä¸º <code>uint</code>ï¼Œè®¾å…¶å€¼ä¸º <code>0</code> ã€‚æˆ‘ä»¬ç”¨è¿™ä¸ªå˜é‡ä½œä¸º <code>result</code> æ•°ç»„çš„ç´¢å¼•ã€‚</p>
<p>2.å£°æ˜ä¸€ä¸ª <code>for</code> å¾ªç¯ï¼Œ ä» <code>uint i = 0</code> åˆ° <code>i &lt;zombies.length</code>ã€‚å®ƒå°†éå†æ•°ç»„ä¸­çš„æ¯ä¸€å¤´åƒµå°¸ã€‚</p>
<p>3.åœ¨æ¯ä¸€è½® <code>for</code> å¾ªç¯ä¸­ï¼Œç”¨ä¸€ä¸ª <code>if</code> è¯­å¥æ¥æ£€æŸ¥ <code>zombieToOwner [i]</code> æ˜¯å¦ç­‰äº <code>_owner</code>ã€‚è¿™ä¼šæ¯”è¾ƒä¸¤ä¸ªåœ°å€æ˜¯å¦åŒ¹é…ã€‚</p>
<p>4.åœ¨ <code>if</code> è¯­å¥ä¸­ï¼š</p>
<ol>
<li>é€šè¿‡å°† <code>result [counter]</code> è®¾ç½®ä¸º <code>i</code>ï¼Œå°†åƒµå°¸IDæ·»åŠ åˆ° <code>result</code> æ•°ç»„ä¸­ã€‚</li>
<li>å°†counteråŠ 1ï¼ˆå‚è§ä¸Šé¢çš„forå¾ªç¯ç¤ºä¾‹ï¼‰ã€‚</li>
</ol>
<p>å°±æ˜¯è¿™æ · - è¿™ä¸ªå‡½æ•°èƒ½è¿”å› <code>_owner</code> æ‰€æ‹¥æœ‰çš„åƒµå°¸æ•°ç»„ï¼Œä¸èŠ±ä¸€åˆ†é’± gasã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner) external view returns(uint[]) {</span><br><span class="line">    uint[] memory result = new uint[](ownerZombieCount[_owner]);</span><br><span class="line">    // åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">    uint counter = 0;</span><br><span class="line">    for(uint i = 0; i &lt;zombies.length; i++){</span><br><span class="line">      if(zombieToOwner[i] == _owner){</span><br><span class="line">        result[counter] = i;</span><br><span class="line">        counter++;</span><br><span class="line">      }</span><br><span class="line">    }</span><br><span class="line">    return result;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬13ç« -æ”¾åœ¨ä¸€èµ·"><a href="#ç¬¬13ç« -æ”¾åœ¨ä¸€èµ·" class="headerlink" title="ç¬¬13ç« : æ”¾åœ¨ä¸€èµ·"></a>ç¬¬13ç« : æ”¾åœ¨ä¸€èµ·</h3><p>æ­å–œæ‚¨å•Šï¼Œå±…ç„¶æŠŠç¬¬ä¸‰è¯¾ä¹Ÿå­¦å®Œäº†ï¼</p>
<p><strong>è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼š</strong></p>
<ul>
<li>æ·»åŠ äº†ä¸€ç§æ–°æ–¹æ³•æ¥ä¿®æ”¹CryptoKittiesåˆçº¦</li>
<li>å­¦ä¼šä½¿ç”¨ <code>onlyOwner</code> è¿›è¡Œè°ƒç”¨æƒé™é™åˆ¶</li>
<li>äº†è§£äº† gas å’Œ gas çš„ä¼˜åŒ–</li>
<li>ä¸ºåƒµå°¸æ·»åŠ äº† â€œçº§åˆ«â€ å’Œ â€œå†·å´å‘¨æœŸâ€å±æ€§</li>
<li>å½“åƒµå°¸è¾¾åˆ°ä¸€å®šçº§åˆ«æ—¶ï¼Œå…è®¸ä¿®æ”¹åƒµå°¸çš„åå­—å’Œ DNA</li>
<li>æœ€åï¼Œå®šä¹‰äº†ä¸€ä¸ªå‡½æ•°ï¼Œç”¨ä»¥è¿”å›æŸä¸ªç©å®¶çš„åƒµå°¸å†›å›¢</li>
</ul>
<p><strong>é¢†å¥–æ—¶é—´</strong></p>
<p>ä½œä¸ºå®Œæˆç¬¬ä¸‰è¯¾çš„å¥–åŠ±ï¼Œæ‚¨çš„ä¸¤ä¸ªåƒµå°¸éƒ½å·²ç»å‡çº§äº†ï¼</p>
<p>ç°åœ¨ NoNameï¼ˆä½ åœ¨ç¬¬2è¯¾åˆ›å»ºçš„å°çŒ«åƒµå°¸ï¼‰å·²ç»å‡çº§åˆ°ç¬¬2çº§ï¼Œä½ å¯ä»¥è°ƒç”¨ <code>changeName</code> ç»™å®ƒå–ä¸ªåå­—ã€‚ ç»ˆäºä¸å†æ˜¯æ— åä¹‹è¾ˆäº†ï¼</p>
<p>å»ç»™æ‚¨çš„ NoName å–ä¸ªåå­—å§ï¼Œç­‰ä½ åšå®Œä¸‹ä¸€ç« ï¼Œæœ¬è¯¾ç¨‹å°±ç»“æŸäº†ã€‚</p>
<h2 id="lesson4-åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ"><a href="#lesson4-åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ" class="headerlink" title="lesson4 åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ"></a>lesson4 åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</h2><h3 id="ç¬¬1ç« -å¯æ”¯ä»˜"><a href="#ç¬¬1ç« -å¯æ”¯ä»˜" class="headerlink" title="ç¬¬1ç« : å¯æ”¯ä»˜"></a>ç¬¬1ç« : å¯æ”¯ä»˜</h3><p>æˆªè‡³ç›®å‰ï¼Œæˆ‘ä»¬åªæ¥è§¦åˆ°å¾ˆå°‘çš„ <strong>å‡½æ•°ä¿®é¥°ç¬¦</strong>ã€‚ è¦è®°ä½æ‰€æœ‰çš„ä¸œè¥¿å¾ˆéš¾ï¼Œæ‰€ä»¥æˆ‘ä»¬æ¥ä¸ªæ¦‚è§ˆï¼š</p>
<ol>
<li>æˆ‘ä»¬æœ‰å†³å®šå‡½æ•°ä½•æ—¶å’Œè¢«è°è°ƒç”¨çš„å¯è§æ€§ä¿®é¥°ç¬¦: <code>private</code> æ„å‘³ç€å®ƒåªèƒ½è¢«åˆçº¦å†…éƒ¨è°ƒç”¨ï¼› <code>internal</code> å°±åƒ <code>private</code> ä½†æ˜¯ä¹Ÿèƒ½è¢«ç»§æ‰¿çš„åˆçº¦è°ƒç”¨ï¼› <code>external</code> åªèƒ½ä»åˆçº¦å¤–éƒ¨è°ƒç”¨ï¼›æœ€å <code>public</code> å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è°ƒç”¨ï¼Œä¸ç®¡æ˜¯å†…éƒ¨è¿˜æ˜¯å¤–éƒ¨ã€‚</li>
<li>æˆ‘ä»¬ä¹Ÿæœ‰çŠ¶æ€ä¿®é¥°ç¬¦ï¼Œ å‘Šè¯‰æˆ‘ä»¬å‡½æ•°å¦‚ä½•å’ŒåŒºå—é“¾äº¤äº’: <code>view</code> å‘Šè¯‰æˆ‘ä»¬è¿è¡Œè¿™ä¸ªå‡½æ•°ä¸ä¼šæ›´æ”¹å’Œä¿å­˜ä»»ä½•æ•°æ®ï¼› <code>pure</code> å‘Šè¯‰æˆ‘ä»¬è¿™ä¸ªå‡½æ•°ä¸ä½†ä¸ä¼šå¾€åŒºå—é“¾å†™æ•°æ®ï¼Œå®ƒç”šè‡³ä¸ä»åŒºå—é“¾è¯»å–æ•°æ®ã€‚è¿™ä¸¤ç§åœ¨è¢«ä»åˆçº¦å¤–éƒ¨è°ƒç”¨çš„æ—¶å€™éƒ½ä¸èŠ±è´¹ä»»ä½•gasï¼ˆä½†æ˜¯å®ƒä»¬åœ¨è¢«å†…éƒ¨å…¶ä»–å‡½æ•°è°ƒç”¨çš„æ—¶å€™å°†ä¼šè€—è´¹gasï¼‰ã€‚</li>
<li>ç„¶åæˆ‘ä»¬æœ‰äº†è‡ªå®šä¹‰çš„ <code>modifiers</code>ï¼Œä¾‹å¦‚åœ¨ç¬¬ä¸‰è¯¾å­¦ä¹ çš„: <code>onlyOwner</code> å’Œ <code>aboveLevel</code>ã€‚ å¯¹äºè¿™äº›ä¿®é¥°ç¬¦æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰å…¶å¯¹å‡½æ•°çš„çº¦æŸé€»è¾‘ã€‚</li>
</ol>
<p>è¿™äº›ä¿®é¥°ç¬¦å¯ä»¥åŒæ—¶ä½œç”¨äºä¸€ä¸ªå‡½æ•°å®šä¹‰ä¸Šï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function test() external view onlyOwner anotherModifier { /* ... */ }</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿™ä¸€ç« ï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸ªæ–°çš„ä¿®é¥°ç¬¦ <code>payable</code>.</p>
<p><strong><code>payable</code> ä¿®é¥°ç¬¦</strong></p>
<p><code>payable</code> æ–¹æ³•æ˜¯è®© Solidity å’Œä»¥å¤ªåŠå˜å¾—å¦‚æ­¤é…·çš„ä¸€éƒ¨åˆ† â€”â€” å®ƒä»¬æ˜¯ä¸€ç§å¯ä»¥æ¥æ”¶ä»¥å¤ªçš„ç‰¹æ®Šå‡½æ•°ã€‚</p>
<p>å…ˆæ”¾ä¸€ä¸‹ã€‚å½“ä½ åœ¨è°ƒç”¨ä¸€ä¸ªæ™®é€šç½‘ç«™æœåŠ¡å™¨ä¸Šçš„APIå‡½æ•°çš„æ—¶å€™ï¼Œä½ æ— æ³•ç”¨ä½ çš„å‡½æ•°ä¼ é€ç¾å…ƒâ€”â€”ä½ ä¹Ÿä¸èƒ½ä¼ é€æ¯”ç‰¹å¸ã€‚</p>
<p>ä½†æ˜¯åœ¨ä»¥å¤ªåŠä¸­ï¼Œ å› ä¸ºé’± (<em>ä»¥å¤ª</em>), æ•°æ® (<em>äº‹åŠ¡è´Ÿè½½</em>)ï¼Œ ä»¥åŠåˆçº¦ä»£ç æœ¬èº«éƒ½å­˜åœ¨äºä»¥å¤ªåŠã€‚ä½ å¯ä»¥åœ¨åŒæ—¶è°ƒç”¨å‡½æ•° <strong>å¹¶</strong>ä»˜é’±ç»™å¦å¤–ä¸€ä¸ªåˆçº¦ã€‚</p>
<p>è¿™å°±å…è®¸å‡ºç°å¾ˆå¤šæœ‰è¶£çš„é€»è¾‘ï¼Œ æ¯”å¦‚å‘ä¸€ä¸ªåˆçº¦è¦æ±‚æ”¯ä»˜ä¸€å®šçš„é’±æ¥è¿è¡Œä¸€ä¸ªå‡½æ•°ã€‚</p>
<p><strong>æ¥çœ‹ä¸ªä¾‹å­</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">contract OnlineStore {</span><br><span class="line">  function buySomething() external payable {</span><br><span class="line">    // æ£€æŸ¥ä»¥ç¡®å®š0.001ä»¥å¤ªå‘é€å‡ºå»æ¥è¿è¡Œå‡½æ•°:</span><br><span class="line">    require(msg.value == 0.001 ether);</span><br><span class="line">    // å¦‚æœä¸ºçœŸï¼Œä¸€äº›ç”¨æ¥å‘å‡½æ•°è°ƒç”¨è€…å‘é€æ•°å­—å†…å®¹çš„é€»è¾‘</span><br><span class="line">    transferThing(msg.sender);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿™é‡Œï¼Œ<code>msg.value</code> æ˜¯ä¸€ç§å¯ä»¥æŸ¥çœ‹å‘åˆçº¦å‘é€äº†å¤šå°‘ä»¥å¤ªçš„æ–¹æ³•ï¼Œå¦å¤– <code>ether</code> æ˜¯ä¸€ä¸ªå…§å»ºå•å…ƒã€‚</p>
<p>è¿™é‡Œå‘ç”Ÿçš„äº‹æ˜¯ï¼Œä¸€äº›äººä¼šä» web3.js è°ƒç”¨è¿™ä¸ªå‡½æ•° (ä»DAppçš„å‰ç«¯)ï¼Œ åƒè¿™æ · :</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å‡è®¾ `OnlineStore` åœ¨ä»¥å¤ªåŠä¸ŠæŒ‡å‘ä½ çš„åˆçº¦:</span><br><span class="line">OnlineStore.buySomething().send(from: web3.eth.defaultAccount, value: web3.utils.toWei(0.001))</span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„è¿™ä¸ª <code>value</code> å­—æ®µï¼Œ JavaScript è°ƒç”¨æ¥æŒ‡å®šå‘é€å¤šå°‘(0.001)<code>ä»¥å¤ª</code>ã€‚å¦‚æœæŠŠäº‹åŠ¡æƒ³è±¡æˆä¸€ä¸ªä¿¡å°ï¼Œä½ å‘é€åˆ°å‡½æ•°çš„å‚æ•°å°±æ˜¯ä¿¡çš„å†…å®¹ã€‚ æ·»åŠ ä¸€ä¸ª <code>value</code> å¾ˆåƒåœ¨ä¿¡å°é‡Œé¢æ”¾é’± â€”â€” ä¿¡ä»¶å†…å®¹å’Œé’±åŒæ—¶å‘é€ç»™äº†æ¥æ”¶è€…ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š å¦‚æœä¸€ä¸ªå‡½æ•°æ²¡æ ‡è®°ä¸º<code>payable</code>ï¼Œ è€Œä½ å°è¯•åˆ©ç”¨ä¸Šé¢çš„æ–¹æ³•å‘é€ä»¥å¤ªï¼Œå‡½æ•°å°†æ‹’ç»ä½ çš„äº‹åŠ¡ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æ¥åœ¨åƒµå°¸æ¸¸æˆé‡Œé¢åˆ›å»ºä¸€ä¸ª<code>payable</code> å‡½æ•°ã€‚</p>
<p>å‡å®šåœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼Œç©å®¶å¯ä»¥é€šè¿‡æ”¯ä»˜ETHæ¥å‡çº§ä»–ä»¬çš„åƒµå°¸ã€‚ETHå°†å­˜å‚¨åœ¨ä½ æ‹¥æœ‰çš„åˆçº¦ä¸­ â€”â€” ä¸€ä¸ªç®€å•æ˜äº†çš„ä¾‹å­ï¼Œå‘ä½ å±•ç¤ºä½ å¯ä»¥é€šè¿‡è‡ªå·±çš„æ¸¸æˆèµšé’±ã€‚</p>
<ol>
<li>å®šä¹‰ä¸€ä¸ª <code>uint</code> ï¼Œå‘½åä¸º <code>levelUpFee</code>, å°†å€¼è®¾å®šä¸º <code>0.001 ether</code>ã€‚</li>
<li>å®šä¹‰ä¸€ä¸ªåä¸º <code>levelUp</code> çš„å‡½æ•°ã€‚ å®ƒå°†æ¥æ”¶ä¸€ä¸ª <code>uint</code> å‚æ•° <code>_zombieId</code>ã€‚ å‡½æ•°åº”è¯¥ä¿®é¥°ä¸º <code>external</code> ä»¥åŠ <code>payable</code>ã€‚</li>
<li>è¿™ä¸ªå‡½æ•°é¦–å…ˆåº”è¯¥ <code>require</code> ç¡®ä¿ <code>msg.value</code> ç­‰äº <code>levelUpFee</code>ã€‚</li>
<li>ç„¶åå®ƒåº”è¯¥å¢åŠ åƒµå°¸çš„ <code>level</code>: <code>zombies[_zombieId].level++</code>ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå®šä¹‰ levelUpFee</span><br><span class="line">  uint levelUpFee = 0.001 ether;</span><br><span class="line"></span><br><span class="line">  modifier aboveLevel(uint _level, uint _zombieId) {</span><br><span class="line">    require(zombies[_zombieId].level &gt;= _level);</span><br><span class="line">    _;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // 2. åœ¨è¿™é‡Œæ’å…¥ levelUp å‡½æ•° </span><br><span class="line">  function levelUp(uint _zombieId) external payable {</span><br><span class="line">    require(msg.value == levelUpFee);</span><br><span class="line">    zombies[_zombieId].level++;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬2ç« -æç°"><a href="#ç¬¬2ç« -æç°" class="headerlink" title="ç¬¬2ç« : æç°"></a>ç¬¬2ç« : æç°</h3><p>åœ¨ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬å­¦ä¹ äº†å¦‚ä½•å‘åˆçº¦å‘é€ä»¥å¤ªï¼Œé‚£ä¹ˆåœ¨å‘é€ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>åœ¨ä½ å‘é€ä»¥å¤ªä¹‹åï¼Œå®ƒå°†è¢«å­˜å‚¨è¿›ä»¥åˆçº¦çš„ä»¥å¤ªåŠè´¦æˆ·ä¸­ï¼Œ å¹¶å†»ç»“åœ¨å“ªé‡Œ â€”â€” é™¤éä½ æ·»åŠ ä¸€ä¸ªå‡½æ•°æ¥ä»åˆçº¦ä¸­æŠŠä»¥å¤ªæç°ã€‚</p>
<p>ä½ å¯ä»¥å†™ä¸€ä¸ªå‡½æ•°æ¥ä»åˆçº¦ä¸­æç°ä»¥å¤ªï¼Œç±»ä¼¼è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">contract GetPaid is Ownable {</span><br><span class="line">  function withdraw() external onlyOwner {</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„æˆ‘ä»¬ä½¿ç”¨ <code>Ownable</code> åˆçº¦ä¸­çš„ <code>owner</code> å’Œ <code>onlyOwner</code>ï¼Œå‡å®šå®ƒå·²ç»è¢«å¼•å…¥äº†ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <code>transfer</code> å‡½æ•°å‘ä¸€ä¸ªåœ°å€å‘é€ä»¥å¤ªï¼Œ ç„¶å <code>this.balance</code> å°†è¿”å›å½“å‰åˆçº¦å­˜å‚¨äº†å¤šå°‘ä»¥å¤ªã€‚ æ‰€ä»¥å¦‚æœ100ä¸ªç”¨æˆ·æ¯äººå‘æˆ‘ä»¬æ”¯ä»˜1ä»¥å¤ªï¼Œ <code>this.balance</code> å°†æ˜¯100ä»¥å¤ªã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡ <code>transfer</code> å‘ä»»ä½•ä»¥å¤ªåŠåœ°å€ä»˜é’±ã€‚ æ¯”å¦‚ï¼Œä½ å¯ä»¥æœ‰ä¸€ä¸ªå‡½æ•°åœ¨ <code>msg.sender</code> è¶…é¢ä»˜æ¬¾çš„æ—¶å€™ç»™ä»–ä»¬é€€é’±ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint itemFee = 0.001 ether;</span><br><span class="line">msg.sender.transfer(msg.value - itemFee);</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ–è€…åœ¨ä¸€ä¸ªæœ‰å–å®¶å’Œå–å®¶çš„åˆçº¦ä¸­ï¼Œ ä½ å¯ä»¥æŠŠå–å®¶çš„åœ°å€å­˜å‚¨èµ·æ¥ï¼Œ å½“æœ‰äººä¹°äº†å®ƒçš„ä¸œè¥¿çš„æ—¶å€™ï¼ŒæŠŠä¹°å®¶æ”¯ä»˜çš„é’±å‘é€ç»™å®ƒ <code>seller.transfer(msg.value)</code>ã€‚</p>
<p>æœ‰å¾ˆå¤šä¾‹å­æ¥å±•ç¤ºä»€ä¹ˆè®©ä»¥å¤ªåŠç¼–ç¨‹å¦‚æ­¤ä¹‹é…· â€”â€” ä½ å¯ä»¥æ‹¥æœ‰ä¸€ä¸ªä¸è¢«ä»»ä½•äººæ§åˆ¶çš„å»ä¸­å¿ƒåŒ–å¸‚åœºã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>åœ¨æˆ‘ä»¬çš„åˆçº¦é‡Œåˆ›å»ºä¸€ä¸ª <code>withdraw</code> å‡½æ•°ï¼Œå®ƒåº”è¯¥å‡ ä¹å’Œä¸Šé¢çš„<code>GetPaid</code>ä¸€æ ·ã€‚</p>
</li>
<li><p>ä»¥å¤ªçš„ä»·æ ¼åœ¨è¿‡å»å‡ å¹´å†…ç¿»äº†åå‡ å€ï¼Œåœ¨æˆ‘ä»¬å†™è¿™ä¸ªæ•™ç¨‹çš„æ—¶å€™ 0.01 ä»¥å¤ªç›¸å½“äº1ç¾å…ƒï¼Œå¦‚æœå®ƒå†ç¿»åå€ 0.001 ä»¥å¤ªå°†æ˜¯10ç¾å…ƒï¼Œé‚£æˆ‘ä»¬çš„æ¸¸æˆå°±å¤ªè´µäº†ã€‚</p>
<p> æ‰€ä»¥æˆ‘ä»¬åº”è¯¥å†åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸æˆ‘ä»¬ä»¥åˆçº¦æ‹¥æœ‰è€…çš„èº«ä»½æ¥è®¾ç½® <code>levelUpFee</code>ã€‚</p>
<p> a. åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œåä¸º <code>setLevelUpFee</code>ï¼Œ å…¶æ¥æ”¶ä¸€ä¸ªå‚æ•° <code>uint _fee</code>ï¼Œæ˜¯ <code>external</code> å¹¶ä½¿ç”¨ä¿®é¥°ç¬¦ <code>onlyOwner</code>ã€‚</p>
<p> b. è¿™ä¸ªå‡½æ•°åº”è¯¥è®¾ç½® <code>levelUpFee</code> ç­‰äº <code>_fee</code>ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œåˆ›å»º withdraw å‡½æ•°</span><br><span class="line">  function withdraw() external onlyOwner {</span><br><span class="line">    owner.transfer(this.balance);</span><br><span class="line">  }</span><br><span class="line">  // 2. åœ¨è¿™é‡Œåˆ›å»º setLevelUpFee å‡½æ•° </span><br><span class="line">  function setLevelUpFee(uint _fee) external onlyOwner {</span><br><span class="line">    levelUpFee = _fee;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬3ç« -åƒµå°¸æˆ˜æ–—"><a href="#ç¬¬3ç« -åƒµå°¸æˆ˜æ–—" class="headerlink" title="ç¬¬3ç« : åƒµå°¸æˆ˜æ–—"></a>ç¬¬3ç« : åƒµå°¸æˆ˜æ–—</h3><p>åœ¨æˆ‘ä»¬å­¦ä¹ äº†å¯æ”¯ä»˜å‡½æ•°å’Œåˆçº¦ä½™é¢ä¹‹åï¼Œæ˜¯æ—¶å€™ä¸ºåƒµå°¸æˆ˜æ–—æ·»åŠ åŠŸèƒ½äº†ã€‚</p>
<p>éµå¾ªä¸Šä¸€ç« çš„æ ¼å¼ï¼Œæˆ‘ä»¬æ–°å»ºä¸€ä¸ªæ”»å‡»åŠŸèƒ½åˆçº¦ï¼Œå¹¶å°†ä»£ç æ”¾è¿›æ–°çš„æ–‡ä»¶ä¸­ï¼Œå¼•å…¥ä¸Šä¸€ä¸ªåˆçº¦ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>å†æ¥æ–°å»ºä¸€ä¸ªåˆçº¦å§ã€‚ç†Ÿèƒ½ç”Ÿå·§ã€‚</p>
<p>å¦‚æœä½ ä¸è®°å¾—æ€ä¹ˆåšäº†, æŸ¥çœ‹ä¸€ä¸‹ <code>zombiehelper.sol</code> â€” ä¸è¿‡æœ€å¥½å…ˆè¯•ç€åšä¸€ä¸‹ï¼Œæ£€æŸ¥ä¸€ä¸‹ä½ æŒæ¡çš„æƒ…å†µã€‚</p>
<ol>
<li>åœ¨æ–‡ä»¶å¼€å¤´å®šä¹‰ Solidity çš„ç‰ˆæœ¬ <code>^0.4.19</code>.</li>
<li><code>import</code> è‡ª <code>zombiehelper.sol</code> .</li>
<li>å£°æ˜ä¸€ä¸ªæ–°çš„ <code>contract</code>ï¼Œå‘½åä¸º <code>ZombieBattle</code>ï¼Œ ç»§æ‰¿è‡ª<code>ZombieHelper</code>ã€‚å‡½æ•°ä½“å°±å…ˆç©ºç€å§ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import "./zombiehelper.sol";</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬4ç« -éšæœºæ•°"><a href="#ç¬¬4ç« -éšæœºæ•°" class="headerlink" title="ç¬¬4ç« : éšæœºæ•°"></a>ç¬¬4ç« : éšæœºæ•°</h3><p>ä½ å¤ªæ£’äº†ï¼æ¥ä¸‹æ¥æˆ‘ä»¬æ¢³ç†ä¸€ä¸‹æˆ˜æ–—é€»è¾‘ã€‚</p>
<p>ä¼˜ç§€çš„æ¸¸æˆéƒ½éœ€è¦ä¸€äº›éšæœºå…ƒç´ ï¼Œé‚£ä¹ˆæˆ‘ä»¬åœ¨ Solidity é‡Œå¦‚ä½•ç”Ÿæˆéšæœºæ•°å‘¢ï¼Ÿ</p>
<p>çœŸæ­£çš„ç­”æ¡ˆæ˜¯ä½ ä¸èƒ½ï¼Œæˆ–è€…æœ€èµ·ç ï¼Œä½ æ— æ³•å®‰å…¨åœ°åšåˆ°è¿™ä¸€ç‚¹ã€‚</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ä¸ºä»€ä¹ˆ</p>
<p><strong>ç”¨ <code>keccak256</code> æ¥åˆ¶é€ éšæœºæ•°</strong></p>
<p>Solidity ä¸­æœ€å¥½çš„éšæœºæ•°ç”Ÿæˆå™¨æ˜¯ <code>keccak256</code> å“ˆå¸Œå‡½æ•°.</p>
<p>æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥ç”Ÿæˆä¸€äº›éšæœºæ•°</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// ç”Ÿæˆä¸€ä¸ª0åˆ°100çš„éšæœºæ•°:</span><br><span class="line">uint randNonce = 0;</span><br><span class="line">uint random = uint(keccak256(now, msg.sender, randNonce)) % 100;</span><br><span class="line">randNonce++;</span><br><span class="line">uint random2 = uint(keccak256(now, msg.sender, randNonce)) % 100;</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªæ–¹æ³•é¦–å…ˆæ‹¿åˆ° <code>now</code> çš„æ—¶é—´æˆ³ã€ <code>msg.sender</code>ã€ ä»¥åŠä¸€ä¸ªè‡ªå¢æ•° <code>nonce</code> ï¼ˆä¸€ä¸ªä»…ä¼šè¢«ä½¿ç”¨ä¸€æ¬¡çš„æ•°ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ä¼šå¯¹ç›¸åŒçš„è¾“å…¥å€¼è°ƒç”¨ä¸€æ¬¡ä»¥ä¸Šå“ˆå¸Œå‡½æ•°äº†ï¼‰ã€‚</p>
<p>ç„¶ååˆ©ç”¨ <code>keccak</code> æŠŠè¾“å…¥çš„å€¼è½¬å˜ä¸ºä¸€ä¸ªå“ˆå¸Œå€¼, å†å°†å“ˆå¸Œå€¼è½¬æ¢ä¸º <code>uint</code>, ç„¶ååˆ©ç”¨ <code>% 100</code> æ¥å–æœ€åä¸¤ä½, å°±ç”Ÿæˆäº†ä¸€ä¸ª0åˆ°100ä¹‹é—´éšæœºæ•°äº†ã€‚</p>
<p><strong>è¿™ä¸ªæ–¹æ³•å¾ˆå®¹æ˜“è¢«ä¸è¯šå®çš„èŠ‚ç‚¹æ”»å‡»</strong></p>
<p>åœ¨ä»¥å¤ªåŠä¸Š, å½“ä½ åœ¨å’Œä¸€ä¸ªåˆçº¦ä¸Šè°ƒç”¨å‡½æ•°çš„æ—¶å€™, ä½ ä¼šæŠŠå®ƒå¹¿æ’­ç»™ä¸€ä¸ªèŠ‚ç‚¹æˆ–è€…åœ¨ç½‘ç»œä¸Šçš„ *<strong>transaction*</strong> èŠ‚ç‚¹ä»¬ã€‚ ç½‘ç»œä¸Šçš„èŠ‚ç‚¹å°†æ”¶é›†å¾ˆå¤šäº‹åŠ¡, è¯•ç€æˆä¸ºç¬¬ä¸€ä¸ªè§£å†³è®¡ç®—å¯†é›†å‹æ•°å­¦é—®é¢˜çš„äººï¼Œä½œä¸ºâ€œå·¥ä½œè¯æ˜â€ï¼Œç„¶åå°†â€œå·¥ä½œè¯æ˜â€(Proof of Work, PoW)å’Œäº‹åŠ¡ä¸€èµ·ä½œä¸ºä¸€ä¸ª *<strong>block*</strong> å‘å¸ƒåœ¨ç½‘ç»œä¸Šã€‚</p>
<p>ä¸€æ—¦ä¸€ä¸ªèŠ‚ç‚¹è§£å†³äº†ä¸€ä¸ªPoW, å…¶ä»–èŠ‚ç‚¹å°±ä¼šåœæ­¢å°è¯•è§£å†³è¿™ä¸ª PoW, å¹¶éªŒè¯å…¶ä»–èŠ‚ç‚¹çš„äº‹åŠ¡åˆ—è¡¨æ˜¯æœ‰æ•ˆçš„ï¼Œç„¶åæ¥å—è¿™ä¸ªèŠ‚ç‚¹è½¬è€Œå°è¯•è§£å†³ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚</p>
<p><strong>è¿™å°±è®©æˆ‘ä»¬çš„éšæœºæ•°å‡½æ•°å˜å¾—å¯åˆ©ç”¨äº†</strong></p>
<p>æˆ‘ä»¬å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¡¬å¸ç¿»è½¬åˆçº¦â€”â€”æ­£é¢ä½ èµ¢åŒå€é’±ï¼Œåé¢ä½ è¾“æ‰æ‰€æœ‰çš„é’±ã€‚å‡å¦‚å®ƒä½¿ç”¨ä¸Šé¢çš„æ–¹æ³•æ¥å†³å®šæ˜¯æ­£é¢è¿˜æ˜¯åé¢ (<code>random &gt;= 50</code> ç®—æ­£é¢, <code>random &lt; 50</code> ç®—åé¢)ã€‚</p>
<p>å¦‚æœæˆ‘æ­£è¿è¡Œä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘å¯ä»¥ <strong>åªå¯¹æˆ‘è‡ªå·±çš„èŠ‚ç‚¹</strong> å‘å¸ƒä¸€ä¸ªäº‹åŠ¡ï¼Œä¸”ä¸åˆ†äº«å®ƒã€‚ æˆ‘å¯ä»¥è¿è¡Œç¡¬å¸ç¿»è½¬æ–¹æ³•æ¥å·çª¥æˆ‘çš„è¾“èµ¢ â€” å¦‚æœæˆ‘è¾“äº†ï¼Œæˆ‘å°±ä¸æŠŠè¿™ä¸ªäº‹åŠ¡åŒ…å«è¿›æˆ‘è¦è§£å†³çš„ä¸‹ä¸€ä¸ªåŒºå—ä¸­å»ã€‚æˆ‘å¯ä»¥ä¸€ç›´è¿è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œç›´åˆ°æˆ‘èµ¢å¾—äº†ç¡¬å¸ç¿»è½¬å¹¶è§£å†³äº†ä¸‹ä¸€ä¸ªåŒºå—ï¼Œç„¶åè·åˆ©ã€‚</p>
<p><strong>æ‰€ä»¥æˆ‘ä»¬è¯¥å¦‚ä½•åœ¨ä»¥å¤ªåŠä¸Šå®‰å…¨åœ°ç”Ÿæˆéšæœºæ•°å‘¢</strong></p>
<p>å› ä¸ºåŒºå—é“¾çš„å…¨éƒ¨å†…å®¹å¯¹æ‰€æœ‰å‚ä¸è€…æ¥è¯´æ˜¯é€æ˜çš„ï¼Œ è¿™å°±è®©è¿™ä¸ªé—®é¢˜å˜å¾—å¾ˆéš¾ï¼Œå®ƒçš„è§£å†³æ–¹æ³•ä¸åœ¨æœ¬è¯¾ç¨‹è®¨è®ºèŒƒå›´ï¼Œä½ å¯ä»¥é˜…è¯» <a target="_blank" rel="noopener" href="https://ethereum.stackexchange.com/questions/191/how-can-i-securely-generate-a-random-number-in-my-smart-contract">è¿™ä¸ª StackOverflow ä¸Šçš„è®¨è®º</a> æ¥è·å¾—ä¸€äº›ä¸»æ„ã€‚ ä¸€ä¸ªæ–¹æ³•æ˜¯åˆ©ç”¨ *<strong>oracle*</strong> æ¥è®¿é—®ä»¥å¤ªåŠåŒºå—é“¾ä¹‹å¤–çš„éšæœºæ•°å‡½æ•°ã€‚</p>
<p>å½“ç„¶ï¼Œ å› ä¸ºç½‘ç»œä¸Šæˆåƒä¸Šä¸‡çš„ä»¥å¤ªåŠèŠ‚ç‚¹éƒ½åœ¨ç«äº‰è§£å†³ä¸‹ä¸€ä¸ªåŒºå—ï¼Œæˆ‘èƒ½æˆåŠŸè§£å†³ä¸‹ä¸€ä¸ªåŒºå—çš„å‡ ç‡éå¸¸ä¹‹ä½ã€‚ è¿™å°†èŠ±è´¹æˆ‘ä»¬å·¨å¤§çš„è®¡ç®—èµ„æºæ¥å¼€å‘è¿™ä¸ªè·åˆ©æ–¹æ³• â€” ä½†æ˜¯å¦‚æœå¥–åŠ±å¼‚å¸¸åœ°é«˜(æ¯”å¦‚æˆ‘å¯ä»¥åœ¨ç¡¬å¸ç¿»è½¬å‡½æ•°ä¸­èµ¢å¾— 1ä¸ªäº¿)ï¼Œ é‚£å°±å¾ˆå€¼å¾—å»æ”»å‡»äº†ã€‚</p>
<p>æ‰€ä»¥å°½ç®¡è¿™ä¸ªæ–¹æ³•åœ¨ä»¥å¤ªåŠä¸Šä¸å®‰å…¨ï¼Œåœ¨å®é™…ä¸­ï¼Œé™¤éæˆ‘ä»¬çš„éšæœºå‡½æ•°æœ‰ä¸€å¤§ç¬”é’±åœ¨ä¸Šé¢ï¼Œä½ æ¸¸æˆçš„ç”¨æˆ·ä¸€èˆ¬æ˜¯æ²¡æœ‰è¶³å¤Ÿçš„èµ„æºå»æ”»å‡»çš„ã€‚</p>
<p>å› ä¸ºåœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨ç¼–å†™ä¸€ä¸ªç®€å•çš„æ¸¸æˆæ¥åšæ¼”ç¤ºï¼Œä¹Ÿæ²¡æœ‰çœŸæ­£çš„é’±åœ¨é‡Œé¢ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šæ¥å—è¿™ä¸ªä¸è¶³ä¹‹å¤„ï¼Œä½¿ç”¨è¿™ä¸ªç®€å•çš„éšæœºæ•°ç”Ÿæˆå‡½æ•°ã€‚ä½†æ˜¯è¦è°¨è®°å®ƒæ˜¯ä¸å®‰å…¨çš„ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æ¥å®ç°ä¸€ä¸ªéšæœºæ•°ç”Ÿæˆå‡½æ•°ï¼Œå¥½æ¥è®¡ç®—æˆ˜æ–—çš„ç»“æœã€‚è™½ç„¶è¿™ä¸ªå‡½æ•°ä¸€ç‚¹å„¿ä¹Ÿä¸å®‰å…¨ã€‚</p>
<ol>
<li>ç»™æˆ‘ä»¬åˆçº¦ä¸€ä¸ªåä¸º <code>randNonce</code> çš„ <code>uint</code>ï¼Œå°†å…¶å€¼è®¾ç½®ä¸º <code>0</code>ã€‚</li>
<li>å»ºç«‹ä¸€ä¸ªå‡½æ•°ï¼Œå‘½åä¸º <code>randMod</code> (random-modulus)ã€‚å®ƒå°†ä½œä¸º<code>internal</code> å‡½æ•°ï¼Œä¼ å…¥ä¸€ä¸ªåä¸º <code>_modulus</code>çš„ <code>uint</code>ï¼Œå¹¶ <code>returns</code> ä¸€ä¸ª <code>uint</code>ã€‚</li>
<li>è¿™ä¸ªå‡½æ•°é¦–å…ˆå°†ä¸º <code>randNonce</code>åŠ ä¸€ï¼Œ (ä½¿ç”¨ <code>randNonce++</code> è¯­å¥)ã€‚</li>
<li>æœ€åï¼Œå®ƒåº”è¯¥ (åœ¨ä¸€è¡Œä»£ç ä¸­) è®¡ç®— <code>now</code>, <code>msg.sender</code>, ä»¥åŠ <code>randNonce</code> çš„ <code>keccak256</code> å“ˆå¸Œå€¼å¹¶è½¬æ¢ä¸º <code>uint</code>â€”â€” æœ€å <code>return</code> <code>% _modulus</code> çš„å€¼ã€‚ ï¼ˆå¤©! å¬èµ·æ¥å¤ªæ‹—å£äº†ã€‚å¦‚æœä½ æœ‰ç‚¹ç†è§£ä¸è¿‡æ¥ï¼Œçœ‹ä¸€ä¸‹æˆ‘ä»¬ä¸Šé¢è®¡ç®—éšæœºæ•°çš„ä¾‹å­ï¼Œå®ƒä»¬çš„é€»è¾‘éå¸¸ç›¸ä¼¼ï¼‰</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">contract ZombieBattle is ZombieHelper {</span><br><span class="line">  // åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">  uint randNonce = 0;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint){</span><br><span class="line">    randNonce++;</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬5ç« -åƒµå°¸å¯¹æˆ˜"><a href="#ç¬¬5ç« -åƒµå°¸å¯¹æˆ˜" class="headerlink" title="ç¬¬5ç« : åƒµå°¸å¯¹æˆ˜"></a>ç¬¬5ç« : åƒµå°¸å¯¹æˆ˜</h3><p>æˆ‘ä»¬çš„åˆçº¦å·²ç»æœ‰äº†ä¸€äº›éšæœºæ€§çš„æ¥æºï¼Œå¯ä»¥ç”¨è¿›æˆ‘ä»¬çš„åƒµå°¸æˆ˜æ–—ä¸­å»è®¡ç®—ç»“æœã€‚</p>
<p>æˆ‘ä»¬çš„åƒµå°¸æˆ˜æ–—çœ‹èµ·æ¥å°†æ˜¯è¿™ä¸ªæµç¨‹ï¼š</p>
<ul>
<li>ä½ é€‰æ‹©ä¸€ä¸ªè‡ªå·±çš„åƒµå°¸ï¼Œç„¶åé€‰æ‹©ä¸€ä¸ªå¯¹æ‰‹çš„åƒµå°¸å»æ”»å‡»ã€‚</li>
<li>å¦‚æœä½ æ˜¯æ”»å‡»æ–¹ï¼Œä½ å°†æœ‰70%çš„å‡ ç‡è·èƒœï¼Œé˜²å®ˆæ–¹å°†æœ‰30%çš„å‡ ç‡è·èƒœã€‚</li>
<li>æ‰€æœ‰çš„åƒµå°¸ï¼ˆæ”»å®ˆåŒæ–¹ï¼‰éƒ½å°†æœ‰ä¸€ä¸ª <code>winCount</code> å’Œä¸€ä¸ª <code>lossCount</code>ï¼Œè¿™ä¸¤ä¸ªå€¼éƒ½å°†æ ¹æ®æˆ˜æ–—ç»“æœå¢é•¿ã€‚</li>
<li>è‹¥æ”»å‡»æ–¹è·èƒœï¼Œè¿™ä¸ªåƒµå°¸å°†å‡çº§å¹¶äº§ç”Ÿä¸€ä¸ªæ–°åƒµå°¸ã€‚</li>
<li>å¦‚æœæ”»å‡»æ–¹å¤±è´¥ï¼Œé™¤äº†å¤±è´¥æ¬¡æ•°å°†åŠ ä¸€å¤–ï¼Œä»€ä¹ˆéƒ½ä¸ä¼šå‘ç”Ÿã€‚</li>
<li>æ— è®ºè¾“èµ¢ï¼Œå½“å‰åƒµå°¸çš„å†·å´æ—¶é—´éƒ½å°†è¢«æ¿€æ´»ã€‚</li>
</ul>
<p>è¿™æœ‰ä¸€å¤§å †çš„é€»è¾‘éœ€è¦å¤„ç†ï¼Œæˆ‘ä»¬å°†æŠŠè¿™äº›æ­¥éª¤åˆ†è§£åˆ°æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­å»ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>ç»™æˆ‘ä»¬åˆçº¦ä¸€ä¸ª <code>uint</code> ç±»å‹çš„å˜é‡ï¼Œå‘½åä¸º <code>attackVictoryProbability</code>, å°†å…¶å€¼è®¾å®šä¸º <code>70</code>ã€‚</li>
<li>åˆ›å»ºä¸€ä¸ªåä¸º <code>attack</code>çš„å‡½æ•°ã€‚å®ƒå°†ä¼ å…¥ä¸¤ä¸ªå‚æ•°: <code>_zombieId</code> (<code>uint</code> ç±»å‹) ä»¥åŠ <code>_targetId</code> (ä¹Ÿæ˜¯ <code>uint</code>)ã€‚å®ƒå°†æ˜¯ä¸€ä¸ª <code>external</code> å‡½æ•°ã€‚</li>
</ol>
<p>å‡½æ•°ä½“å…ˆç•™ç©ºå§ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œåˆ›å»º attackVictoryProbability</span><br><span class="line">  uint attackVictoryProbability = 70;</span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external{</span><br><span class="line">    </span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬6ç« -é‡æ„é€šç”¨é€»è¾‘"><a href="#ç¬¬6ç« -é‡æ„é€šç”¨é€»è¾‘" class="headerlink" title="ç¬¬6ç« : é‡æ„é€šç”¨é€»è¾‘"></a>ç¬¬6ç« : é‡æ„é€šç”¨é€»è¾‘</h3><p>ä¸ç®¡è°è°ƒç”¨æˆ‘ä»¬çš„ <code>attack</code> å‡½æ•° â€”â€” æˆ‘ä»¬æƒ³ç¡®ä¿ç”¨æˆ·çš„ç¡®æ‹¥æœ‰ä»–ä»¬ç”¨æ¥æ”»å‡»çš„åƒµå°¸ã€‚å¦‚æœä½ èƒ½ç”¨å…¶ä»–äººçš„åƒµå°¸æ¥æ”»å‡»å°†æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„å®‰å…¨é—®é¢˜ã€‚</p>
<p>ä½ èƒ½æƒ³ä¸€ä¸‹æˆ‘ä»¬å¦‚ä½•æ·»åŠ ä¸€ä¸ªæ£€æŸ¥æ­¥éª¤æ¥çœ‹çœ‹è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„äººå°±æ˜¯ä»–ä»¬ä¼ å…¥çš„ <code>_zombieId</code> çš„æ‹¥æœ‰è€…ä¹ˆï¼Ÿ</p>
<p>æƒ³ä¸€æƒ³ï¼Œçœ‹çœ‹ä½ èƒ½ä¸èƒ½è‡ªå·±æ‰¾åˆ°ä¸€äº›ç­”æ¡ˆã€‚</p>
<p>èŠ±ç‚¹æ—¶é—´â€¦â€¦ å‚è€ƒæˆ‘ä»¬å‰é¢è¯¾ç¨‹çš„ä»£ç æ¥è·å¾—çµæ„Ÿã€‚</p>
<p>ç­”æ¡ˆåœ¨ä¸‹é¢ï¼Œåœ¨ä½ æœ‰ä¸€äº›æƒ³æ³•ä¹‹å‰ä¸è¦ç»§ç»­é˜…è¯»ã€‚</p>
<p><strong>ç­”æ¡ˆ</strong></p>
<p>æˆ‘ä»¬åœ¨å‰é¢çš„è¯¾ç¨‹é‡Œé¢å·²ç»åšè¿‡å¾ˆå¤šæ¬¡è¿™æ ·çš„æ£€æŸ¥äº†ã€‚ åœ¨ <code>changeName()</code>, <code>changeDna()</code>, å’Œ <code>feedAndMultiply()</code>é‡Œï¼Œæˆ‘ä»¬åšè¿‡è¿™æ ·çš„æ£€æŸ¥ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">require(msg.sender == zombieToOwner[_zombieId]);</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™å’Œæˆ‘ä»¬ <code>attack</code> å‡½æ•°å°†è¦ç”¨åˆ°çš„æ£€æŸ¥é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚ æ­£å› æˆ‘ä»¬è¦å¤šæ¬¡è°ƒç”¨è¿™ä¸ªæ£€æŸ¥é€»è¾‘ï¼Œè®©æˆ‘ä»¬æŠŠå®ƒç§»åˆ°å®ƒè‡ªå·±çš„ <code>modifier</code> ä¸­æ¥æ¸…ç†ä»£ç å¹¶é¿å…é‡å¤ç¼–ç ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å›åˆ°äº† <code>zombiefeeding.sol</code>ï¼Œ å› ä¸ºè¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡è°ƒç”¨æ£€æŸ¥é€»è¾‘çš„åœ°æ–¹ã€‚è®©æˆ‘ä»¬æŠŠå®ƒé‡æ„è¿›å®ƒè‡ªå·±çš„ <code>modifier</code>ã€‚</p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ª <code>modifier</code>ï¼Œ å‘½åä¸º <code>ownerOf</code>ã€‚å®ƒå°†ä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œ <code>_zombieId</code> (ä¸€ä¸ª <code>uint</code>)ã€‚</p>
<p> å®ƒçš„å‡½æ•°ä½“åº”è¯¥ <code>require</code> <code>msg.sender</code> ç­‰äº <code>zombieToOwner[_zombieId]</code>ï¼Œ ç„¶åç»§ç»­è¿™ä¸ªå‡½æ•°å‰©ä¸‹çš„å†…å®¹ã€‚ å¦‚æœä½ å¿˜è®°äº†ä¿®é¥°ç¬¦çš„å†™æ³•ï¼Œå¯ä»¥å‚è€ƒ <code>zombiehelper.sol</code>ã€‚</p>
</li>
<li><p>å°†è¿™ä¸ªå‡½æ•°çš„ <code>feedAndMultiply</code> å®šä¹‰ä¿®æ”¹ä¸ºå…¶ä½¿ç”¨ä¿®é¥°ç¬¦ <code>ownerOf</code>ã€‚</p>
</li>
<li><p>ç°åœ¨æˆ‘ä»¬ä½¿ç”¨ <code>modifier</code>äº†ï¼Œä½ å¯ä»¥åˆ é™¤è¿™è¡Œäº†ï¼š <code>require(msg.sender == zombieToOwner[_zombieId]);</code></p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œåˆ›å»º modifier</span><br><span class="line">  modifier ownerOf(uint _zombieId){</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  }</span><br><span class="line">  </span><br><span class="line">  // 2. åœ¨å‡½æ•°å®šä¹‰æ—¶å¢åŠ  modifier :</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal ownerOf(_zombieId){</span><br><span class="line">    // 3. ç§»é™¤è¿™ä¸€è¡Œ</span><br><span class="line">    //require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256("kitty")) {</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    }</span><br><span class="line">    _createZombie("NoName", newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬7ç« -æ›´å¤šé‡æ„"><a href="#ç¬¬7ç« -æ›´å¤šé‡æ„" class="headerlink" title="ç¬¬7ç« : æ›´å¤šé‡æ„"></a>ç¬¬7ç« : æ›´å¤šé‡æ„</h3><p>åœ¨ <code>zombiehelper.sol</code>é‡Œæœ‰å‡ å¤„åœ°æ–¹ï¼Œéœ€è¦æˆ‘ä»¬å®ç°æˆ‘ä»¬æ–°çš„ <code>modifier</code>â€”â€” <code>ownerOf</code>ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>ä¿®æ”¹ <code>changeName()</code> ä½¿å…¶ä½¿ç”¨ <code>ownerOf</code></li>
<li>ä¿®æ”¹ <code>changeDna()</code> ä½¿å…¶ä½¿ç”¨ <code>ownerOf</code></li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 1. ä½¿ç”¨ `ownerOf` ä¿®æ”¹è¿™ä¸ªå‡½æ•°:</span><br><span class="line">  function changeName(uint _zombieId, string _newName) external aboveLevel(2, _zombieId) ownerOf(_zombieId){</span><br><span class="line">    //require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].name = _newName;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // 2. å¯¹è¿™ä¸ªå‡½æ•°åšåŒæ ·çš„äº‹:</span><br><span class="line">  function changeDna(uint _zombieId, uint _newDna) external aboveLevel(20, _zombieId) ownerOf(_zombieId){</span><br><span class="line">    //require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    zombies[_zombieId].dna = _newDna;</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬8ç« -å›åˆ°æ”»å‡»ï¼"><a href="#ç¬¬8ç« -å›åˆ°æ”»å‡»ï¼" class="headerlink" title="ç¬¬8ç« : å›åˆ°æ”»å‡»ï¼"></a>ç¬¬8ç« : å›åˆ°æ”»å‡»ï¼</h3><p>é‡æ„å®Œæˆäº†ï¼Œå›åˆ° <code>zombieattack.sol</code>ã€‚</p>
<p>ç»§ç»­æ¥å®Œå–„æˆ‘ä»¬çš„ <code>attack</code> å‡½æ•°ï¼Œ ç°åœ¨æˆ‘ä»¬æœ‰äº† <code>ownerOf</code> ä¿®é¥°ç¬¦æ¥ç”¨äº†ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>å°† <code>ownerOf</code> ä¿®é¥°ç¬¦æ·»åŠ åˆ° <code>attack</code> æ¥ç¡®ä¿è°ƒç”¨è€…æ‹¥æœ‰<code>_zombieId</code>.</p>
</li>
<li><p>æˆ‘ä»¬çš„å‡½æ•°æ‰€éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹å°±æ˜¯è·å¾—ä¸€ä¸ªåŒæ–¹åƒµå°¸çš„ <code>storage</code> æŒ‡é’ˆï¼Œ è¿™æ ·æˆ‘ä»¬æ‰èƒ½å¾ˆæ–¹ä¾¿å’Œå®ƒä»¬äº¤äº’ï¼š</p>
<p> a. å®šä¹‰ä¸€ä¸ª <code>Zombie storage</code> å‘½åä¸º <code>myZombie</code>ï¼Œä½¿å…¶å€¼ç­‰äº <code>zombies[_zombieId]</code>ã€‚</p>
<p> b. å®šä¹‰ä¸€ä¸ª <code>Zombie storage</code> å‘½åä¸º <code>enemyZombie</code>ï¼Œ ä½¿å…¶å€¼ç­‰äº <code>zombies[_targetId]</code>ã€‚</p>
</li>
<li><p>æˆ‘ä»¬å°†ç”¨ä¸€ä¸ª0åˆ°100çš„éšæœºæ•°æ¥ç¡®å®šæˆ‘ä»¬çš„æˆ˜æ–—ç»“æœã€‚ å®šä¹‰ä¸€ä¸ª <code>uint</code>ï¼Œå‘½åä¸º <code>rand</code>ï¼Œ è®¾å®šå…¶å€¼ç­‰äº <code>randMod</code> å‡½æ•°çš„è¿”å›å€¼ï¼Œæ­¤å‡½æ•°ä¼ å…¥ <code>100</code>ä½œä¸ºå‚æ•°ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå¢åŠ  modifier</span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId){</span><br><span class="line">    // 2. åœ¨è¿™é‡Œå¼€å§‹å®šä¹‰å‡½æ•°</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬9ç« -åƒµå°¸çš„è¾“èµ¢"><a href="#ç¬¬9ç« -åƒµå°¸çš„è¾“èµ¢" class="headerlink" title="ç¬¬9ç« : åƒµå°¸çš„è¾“èµ¢"></a>ç¬¬9ç« : åƒµå°¸çš„è¾“èµ¢</h3><p>å¯¹æˆ‘ä»¬çš„åƒµå°¸æ¸¸æˆæ¥è¯´ï¼Œæˆ‘ä»¬å°†è¦è¿½è¸ªæˆ‘ä»¬çš„åƒµå°¸è¾“èµ¢äº†å¤šå°‘åœºã€‚æœ‰äº†è¿™ä¸ªæˆ‘ä»¬å¯ä»¥åœ¨æ¸¸æˆé‡Œç»´æŠ¤ä¸€ä¸ª â€œåƒµå°¸æ’è¡Œæ¦œâ€ã€‚</p>
<p>æœ‰å¤šç§æ–¹æ³•åœ¨æˆ‘ä»¬çš„DAppé‡Œé¢ä¿å­˜ä¸€ä¸ªæ•°å€¼ â€” ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„æ˜ å°„ï¼Œä½œä¸ºä¸€ä¸ªâ€œæ’è¡Œæ¦œâ€ç»“æ„ä½“ï¼Œæˆ–è€…ä¿å­˜åœ¨ <code>Zombie</code> ç»“æ„ä½“å†…ã€‚</p>
<p>æ¯ä¸ªæ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç¼ºç‚¹ï¼Œå–å†³äºæˆ‘ä»¬æ‰“ç®—å¦‚ä½•å’Œè¿™äº›æ•°æ®æ‰“äº¤é“ã€‚åœ¨è¿™ä¸ªæ•™ç¨‹ä¸­ï¼Œç®€å•èµ·è§æˆ‘ä»¬å°†è¿™ä¸ªçŠ¶æ€ä¿å­˜åœ¨ <code>Zombie</code> ç»“æ„ä½“ä¸­ï¼Œå°†å…¶å‘½åä¸º <code>winCount</code> å’Œ <code>lossCount</code>ã€‚</p>
<p>æˆ‘ä»¬è·³å› <code>zombiefactory.sol</code>, å°†è¿™äº›å±æ€§æ·»åŠ è¿› <code>Zombie</code> ç»“æ„ä½“.</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>ä¿®æ”¹ <code>Zombie</code> ç»“æ„ä½“ï¼Œæ·»åŠ ä¸¤ä¸ªå±æ€§:</p>
<p> a. <code>winCount</code>, ä¸€ä¸ª <code>uint16</code></p>
<p> b. <code>lossCount</code>, ä¹Ÿæ˜¯ä¸€ä¸ª <code>uint16</code></p>
<blockquote>
<p>æ³¨æ„ï¼š è®°ä½, å› ä¸ºæˆ‘ä»¬èƒ½åœ¨ç»“æ„ä½“ä¸­åŒ…è£…<code>uint</code>, æˆ‘ä»¬æ‰“ç®—ç”¨é€‚åˆæˆ‘ä»¬çš„æœ€å°çš„ <code>uint</code>ã€‚ ä¸€ä¸ª <code>uint8</code> å¤ªå°äº†ï¼Œ å› ä¸º 2^8 = 256 â€”â€” å¦‚æœæˆ‘ä»¬çš„åƒµå°¸æ¯å¤©éƒ½ä½œæˆ˜ï¼Œä¸åˆ°ä¸€å¹´å°±æº¢å‡ºäº†ã€‚ä½†æ˜¯ 2^16 = 65536 ï¼ˆ<code>uint16</code>ï¼‰â€”â€” é™¤éä¸€ä¸ªåƒµå°¸è¿ç»­179å¹´æ¯å¤©ä½œæˆ˜ï¼Œå¦åˆ™æˆ‘ä»¬å°±æ˜¯å®‰å…¨çš„ã€‚</p>
</blockquote>
</li>
<li><p>ç°åœ¨æˆ‘ä»¬çš„ <code>Zombie</code> ç»“æ„ä½“æœ‰äº†æ–°çš„å±æ€§ï¼Œ æˆ‘ä»¬éœ€è¦ä¿®æ”¹ <code>_createZombie()</code> ä¸­çš„å‡½æ•°å®šä¹‰ã€‚</p>
<p> ä¿®æ”¹åƒµå°¸ç”Ÿæˆå®šä¹‰ï¼Œè®©æ¯ä¸ªæ–°åƒµå°¸éƒ½æœ‰ <code>0</code> èµ¢å’Œ <code>0</code> è¾“ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">struct Zombie {</span><br><span class="line">      string name;</span><br><span class="line">      uint dna;</span><br><span class="line">      uint32 level;</span><br><span class="line">      uint32 readyTime;</span><br><span class="line">      // 1. åœ¨è¿™é‡Œæ·»åŠ æ–°çš„å±æ€§</span><br><span class="line">      uint16 winCount;</span><br><span class="line">      uint16 lossCount;</span><br><span class="line">    }</span><br><span class="line">function _createZombie(string _name, uint _dna) internal {</span><br><span class="line">        // 2. åœ¨è¿™é‡Œä¿®æ”¹ä¿®æ”¹æ–°åƒµå°¸çš„åˆ›å»º:</span><br><span class="line">        uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime),0,0)) - 1;</span><br><span class="line">        zombieToOwner[id] = msg.sender;</span><br><span class="line">        ownerZombieCount[msg.sender]++;</span><br><span class="line">        NewZombie(id, _name, _dna);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬10ç« -åƒµå°¸èƒœåˆ©äº†-ğŸ˜„"><a href="#ç¬¬10ç« -åƒµå°¸èƒœåˆ©äº†-ğŸ˜„" class="headerlink" title="ç¬¬10ç« : åƒµå°¸èƒœåˆ©äº† ğŸ˜„"></a>ç¬¬10ç« : åƒµå°¸èƒœåˆ©äº† ğŸ˜„</h3><p>æœ‰äº† <code>winCount</code> å’Œ <code>lossCount</code>ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®åƒµå°¸å“ªä¸ªåƒµå°¸èµ¢äº†æˆ˜æ–—æ¥æ›´æ–°å®ƒä»¬äº†ã€‚</p>
<p>åœ¨ç¬¬å…­ç« æˆ‘ä»¬è®¡ç®—å‡ºæ¥ä¸€ä¸ª0åˆ°100çš„éšæœºæ•°ã€‚ç°åœ¨è®©æˆ‘ä»¬ç”¨é‚£ä¸ªæ•°æ¥å†³å®šé‚£è°èµ¢äº†æˆ˜æ–—ï¼Œå¹¶ä»¥æ­¤æ›´æ–°æˆ‘ä»¬çš„çŠ¶æ€ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>åˆ›å»ºä¸€ä¸ª <code>if</code> è¯­å¥æ¥æ£€æŸ¥ <code>rand</code> æ˜¯ä¸æ˜¯ *<strong>å°äºæˆ–è€…ç­‰äº*</strong> <code>attackVictoryProbability</code>ã€‚</p>
</li>
<li><p>å¦‚æœä»¥ä¸Šæ¡ä»¶ä¸º <code>true</code>ï¼Œ æˆ‘ä»¬çš„åƒµå°¸å°±èµ¢äº†ï¼æ‰€ä»¥ï¼š</p>
<p> a. å¢åŠ  <code>myZombie</code> çš„ <code>winCount</code>ã€‚</p>
<p> b. å¢åŠ  <code>myZombie</code> çš„ <code>level</code>ã€‚ (å‡çº§äº†å•¦!!!!!!!)</p>
<p> c. å¢åŠ  <code>enemyZombie</code> çš„ <code>lossCount</code>. (è¾“å®¶!!!!!! ğŸ˜« ğŸ˜« ğŸ˜«)</p>
<p> d. è¿è¡Œ <code>feedAndMultiply</code> å‡½æ•°ã€‚ åœ¨ <code>zombiefeeding.sol</code> é‡ŒæŸ¥çœ‹è°ƒç”¨å®ƒçš„è¯­å¥ã€‚ å¯¹äºç¬¬ä¸‰ä¸ªå‚æ•° (<code>_species</code>)ï¼Œä¼ å…¥å­—ç¬¦ä¸² â€œzombieâ€. ï¼ˆç°åœ¨å®ƒå®é™…ä¸Šä»€ä¹ˆéƒ½ä¸åšï¼Œä¸è¿‡åœ¨ç¨åï¼Œ å¦‚æœæˆ‘ä»¬æ„¿æ„ï¼Œå¯ä»¥æ·»åŠ é¢å¤–çš„æ–¹æ³•ï¼Œç”¨æ¥åˆ¶é€ åƒµå°¸å˜çš„åƒµå°¸ï¼‰ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) {</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    // åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">    if(rand &lt;= attackVictoryProbability){</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, "zombie");</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬11ç« -åƒµå°¸å¤±è´¥-ğŸ˜"><a href="#ç¬¬11ç« -åƒµå°¸å¤±è´¥-ğŸ˜" class="headerlink" title="ç¬¬11ç« : åƒµå°¸å¤±è´¥ ğŸ˜"></a>ç¬¬11ç« : åƒµå°¸å¤±è´¥ ğŸ˜</h3><p>æˆ‘ä»¬å·²ç»ç¼–å†™äº†ä½ çš„åƒµå°¸èµ¢äº†ä¹‹åä¼šå‘ç”Ÿä»€ä¹ˆï¼Œ è¯¥çœ‹çœ‹ <strong>è¾“äº†</strong> çš„æ—¶å€™è¦æ€ä¹ˆåšäº†ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„æ¸¸æˆä¸­ï¼Œåƒµå°¸è¾“äº†åå¹¶ä¸ä¼šé™çº§ â€”â€” åªæ˜¯ç®€å•åœ°ç»™ <code>lossCount</code> åŠ ä¸€ï¼Œå¹¶è§¦å‘å†·å´ï¼Œç­‰å¾…ä¸€å¤©åæ‰èƒ½å†æ¬¡å‚æˆ˜ã€‚</p>
<p>è¦å®ç°è¿™ä¸ªé€»è¾‘ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ª <code>else</code> è¯­å¥ã€‚</p>
<p><code>else</code> è¯­å¥å’Œ JavaScript ä»¥åŠå¾ˆå¤šå…¶ä»–è¯­è¨€çš„ else è¯­å¥ä¸€æ ·ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">if (zombieCoins[msg.sender] &gt; 100000000) {</span><br><span class="line">  // ä½ å¥½æœ‰é’±!!!</span><br><span class="line">} else {</span><br><span class="line">  // æˆ‘ä»¬éœ€è¦æ›´å¤šçš„åƒµå°¸å¸...</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>æ·»åŠ ä¸€ä¸ª <code>else</code> è¯­å¥ã€‚ è‹¥æˆ‘ä»¬çš„åƒµå°¸è¾“äº†ï¼š</p>
<p> a. å¢åŠ  <code>myZombie</code> çš„ <code>lossCount</code>ã€‚</p>
<p> b. å¢åŠ  <code>enemyZombie</code> çš„ <code>winCount</code>ã€‚</p>
</li>
<li><p>åœ¨ <code>else</code> æœ€åï¼Œ å¯¹ <code>myZombie</code> è¿è¡Œ <code>_triggerCooldown</code> æ–¹æ³•ã€‚è¿™è®©æ¯ä¸ªåƒµå°¸æ¯å¤©åªèƒ½å‚æˆ˜ä¸€æ¬¡ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">function attack(uint _zombieId, uint _targetId) external ownerOf(_zombieId) {</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    if (rand &lt;= attackVictoryProbability) {</span><br><span class="line">      myZombie.winCount++;</span><br><span class="line">      myZombie.level++;</span><br><span class="line">      enemyZombie.lossCount++;</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, "zombie");</span><br><span class="line">    } // åœ¨è¿™é‡Œå¼€å§‹</span><br><span class="line">    else{</span><br><span class="line">      myZombie.lossCount++;</span><br><span class="line">      enemyZombie.winCount++;</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    }</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h2 id="lesson5-ERC721-æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"><a href="#lesson5-ERC721-æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“" class="headerlink" title="lesson5 ERC721 æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“"></a>lesson5 ERC721 æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</h2><h3 id="ç¬¬1ç« -ä»¥å¤ªåŠä¸Šçš„ä»£å¸"><a href="#ç¬¬1ç« -ä»¥å¤ªåŠä¸Šçš„ä»£å¸" class="headerlink" title="ç¬¬1ç« : ä»¥å¤ªåŠä¸Šçš„ä»£å¸"></a>ç¬¬1ç« : ä»¥å¤ªåŠä¸Šçš„ä»£å¸</h3><p>è®©æˆ‘ä»¬æ¥èŠèŠ <strong>ä»£å¸</strong>.</p>
<p>å¦‚æœä½ å¯¹ä»¥å¤ªåŠçš„ä¸–ç•Œæœ‰ä¸€äº›äº†è§£ï¼Œä½ å¾ˆå¯èƒ½å¬è¿‡äººä»¬èŠåˆ°ä»£å¸â€”â€”å°¤å…¶æ˜¯ *<strong>ERC20 ä»£å¸*</strong>.</p>
<p>ä¸€ä¸ª <strong><em>ä»£å¸</em></strong> åœ¨ä»¥å¤ªåŠåŸºæœ¬ä¸Šå°±æ˜¯ä¸€ä¸ªéµå¾ªä¸€äº›å…±åŒè§„åˆ™çš„æ™ºèƒ½åˆçº¦â€”â€”å³å®ƒå®ç°äº†æ‰€æœ‰å…¶ä»–ä»£å¸åˆçº¦å…±äº«çš„ä¸€ç»„æ ‡å‡†å‡½æ•°ï¼Œä¾‹å¦‚ <code>transfer(address _to, uint256 _value)</code> å’Œ <code>balanceOf(address _owner)</code>.</p>
<p>åœ¨æ™ºèƒ½åˆçº¦å†…éƒ¨ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªæ˜ å°„ï¼Œ <code>mapping(address =&gt; uint256) balances</code>ï¼Œç”¨äºè¿½è¸ªæ¯ä¸ªåœ°å€è¿˜æœ‰å¤šå°‘ä½™é¢ã€‚</p>
<p>æ‰€ä»¥åŸºæœ¬ä¸Šä¸€ä¸ªä»£å¸åªæ˜¯ä¸€ä¸ªè¿½è¸ªè°æ‹¥æœ‰å¤šå°‘è¯¥ä»£å¸çš„åˆçº¦ï¼Œå’Œä¸€äº›å¯ä»¥è®©é‚£äº›ç”¨æˆ·å°†ä»–ä»¬çš„ä»£å¸è½¬ç§»åˆ°å…¶ä»–åœ°å€çš„å‡½æ•°ã€‚</p>
<p><strong>å®ƒä¸ºä»€ä¹ˆé‡è¦å‘¢ï¼Ÿ</strong></p>
<p>ç”±äºæ‰€æœ‰ ERC20 ä»£å¸å…±äº«å…·æœ‰ç›¸åŒåç§°çš„åŒä¸€ç»„å‡½æ•°ï¼Œå®ƒä»¬éƒ½å¯ä»¥ä»¥ç›¸åŒçš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚</p>
<p>è¿™æ„å‘³ç€å¦‚æœä½ æ„å»ºçš„åº”ç”¨ç¨‹åºèƒ½å¤Ÿä¸ä¸€ä¸ª ERC20 ä»£å¸è¿›è¡Œäº¤äº’ï¼Œé‚£ä¹ˆå®ƒå°±ä¹Ÿèƒ½å¤Ÿä¸ä»»ä½• ERC20 ä»£å¸è¿›è¡Œäº¤äº’ã€‚ è¿™æ ·ä¸€æ¥ï¼Œå°†æ¥ä½ å°±å¯ä»¥è½»æ¾åœ°å°†æ›´å¤šçš„ä»£å¸æ·»åŠ åˆ°ä½ çš„åº”ç”¨ä¸­ï¼Œè€Œæ— éœ€è¿›è¡Œè‡ªå®šä¹‰ç¼–ç ã€‚ ä½ å¯ä»¥ç®€å•åœ°æ’å…¥æ–°çš„ä»£å¸åˆçº¦åœ°å€ï¼Œç„¶åå“—å•¦ï¼Œä½ çš„åº”ç”¨ç¨‹åºæœ‰å¦ä¸€ä¸ªå®ƒå¯ä»¥ä½¿ç”¨çš„ä»£å¸äº†ã€‚</p>
<p>å…¶ä¸­ä¸€ä¸ªä¾‹å­å°±æ˜¯äº¤æ˜“æ‰€ã€‚ å½“äº¤æ˜“æ‰€æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œå®é™…ä¸Šå®ƒåªéœ€è¦æ·»åŠ ä¸ä¹‹å¯¹è¯çš„å¦ä¸€ä¸ªæ™ºèƒ½åˆçº¦ã€‚ ç”¨æˆ·å¯ä»¥è®©é‚£ä¸ªåˆçº¦å°†ä»£å¸å‘é€åˆ°äº¤æ˜“æ‰€çš„é’±åŒ…åœ°å€ï¼Œç„¶åäº¤æ˜“æ‰€å¯ä»¥è®©åˆçº¦åœ¨ç”¨æˆ·è¦æ±‚å–æ¬¾æ—¶å°†ä»£å¸å‘é€å›ç»™ä»–ä»¬ã€‚</p>
<p>äº¤æ˜“æ‰€åªéœ€è¦å®ç°è¿™ç§è½¬ç§»é€»è¾‘ä¸€æ¬¡ï¼Œç„¶åå½“å®ƒæƒ³è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ ERC20 ä»£å¸æ—¶ï¼Œåªéœ€å°†æ–°çš„åˆçº¦åœ°å€æ·»åŠ åˆ°å®ƒçš„æ•°æ®åº“å³å¯ã€‚</p>
<p><strong>å…¶ä»–ä»£å¸æ ‡å‡†</strong></p>
<p>å¯¹äºåƒè´§å¸ä¸€æ ·çš„ä»£å¸æ¥è¯´ï¼ŒERC20 ä»£å¸éå¸¸é…·ã€‚ ä½†æ˜¯è¦åœ¨æˆ‘ä»¬åƒµå°¸æ¸¸æˆä¸­ä»£è¡¨åƒµå°¸å°±å¹¶ä¸æ˜¯ç‰¹åˆ«æœ‰ç”¨ã€‚</p>
<p>é¦–å…ˆï¼Œåƒµå°¸ä¸åƒè´§å¸å¯ä»¥åˆ†å‰² â€”â€” æˆ‘å¯ä»¥å‘ç»™ä½  0.237 ä»¥å¤ªï¼Œä½†æ˜¯è½¬ç§»ç»™ä½  0.237 çš„åƒµå°¸å¬èµ·æ¥å°±æœ‰äº›æç¬‘ã€‚</p>
<p>å…¶æ¬¡ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰åƒµå°¸éƒ½æ˜¯å¹³ç­‰çš„ã€‚ ä½ çš„2çº§åƒµå°¸â€<strong>Steve</strong>â€œå®Œå…¨ä¸èƒ½ç­‰åŒäºæˆ‘732çº§çš„åƒµå°¸â€<strong>H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</strong>â€œã€‚ï¼ˆä½ å·®å¾—è¿œå‘¢ï¼Œ<em>Steve</em>ï¼‰ã€‚</p>
<p>æœ‰å¦ä¸€ä¸ªä»£å¸æ ‡å‡†æ›´é€‚åˆå¦‚ CryptoZombies è¿™æ ·çš„åŠ å¯†æ”¶è—å“â€”â€”å®ƒä»¬è¢«ç§°ä¸º*<strong>ERC721 ä»£å¸.*</strong></p>
<p>*<strong>ERC721 ä»£å¸*<strong>æ˜¯</strong>ä¸</strong>èƒ½äº’æ¢çš„ï¼Œå› ä¸ºæ¯ä¸ªä»£å¸éƒ½è¢«è®¤ä¸ºæ˜¯å”¯ä¸€ä¸”ä¸å¯åˆ†å‰²çš„ã€‚ ä½ åªèƒ½ä»¥æ•´ä¸ªå•ä½äº¤æ˜“å®ƒä»¬ï¼Œå¹¶ä¸”æ¯ä¸ªå•ä½éƒ½æœ‰å”¯ä¸€çš„ IDã€‚ è¿™äº›ç‰¹æ€§æ­£å¥½è®©æˆ‘ä»¬çš„åƒµå°¸å¯ä»¥ç”¨æ¥äº¤æ˜“ã€‚</p>
<blockquote>
<p>è¯·æ³¨æ„ï¼Œä½¿ç”¨åƒ ERC721 è¿™æ ·çš„æ ‡å‡†çš„ä¼˜åŠ¿å°±æ˜¯ï¼Œæˆ‘ä»¬ä¸å¿…åœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­å®ç°æ‹å–æˆ–æ‰˜ç®¡é€»è¾‘ï¼Œè¿™å†³å®šäº†ç©å®¶èƒ½å¤Ÿå¦‚ä½•äº¤æ˜“ï¼å‡ºå”®æˆ‘ä»¬çš„åƒµå°¸ã€‚ å¦‚æœæˆ‘ä»¬ç¬¦åˆè§„èŒƒï¼Œå…¶ä»–äººå¯ä»¥ä¸ºåŠ å¯†å¯äº¤æ˜“çš„ ERC721 èµ„äº§æ­å»ºä¸€ä¸ªäº¤æ˜“æ‰€å¹³å°ï¼Œæˆ‘ä»¬çš„ ERC721 åƒµå°¸å°†å¯ä»¥åœ¨è¯¥å¹³å°ä¸Šä½¿ç”¨ã€‚ æ‰€ä»¥ä½¿ç”¨ä»£å¸æ ‡å‡†ç›¸è¾ƒäºä½¿ç”¨ä½ è‡ªå·±çš„äº¤æ˜“é€»è¾‘æœ‰æ˜æ˜¾çš„å¥½å¤„ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« æ·±å…¥è®¨è®ºERC721çš„å®ç°ã€‚ ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬ä¸ºæœ¬è¯¾è®¾ç½®æˆ‘ä»¬çš„æ–‡ä»¶ç»“æ„ã€‚</p>
<p>æˆ‘ä»¬å°†æŠŠæ‰€æœ‰ERC721é€»è¾‘å­˜å‚¨åœ¨ä¸€ä¸ªå«<code>ZombieOwnership</code>çš„åˆçº¦ä¸­ã€‚</p>
<ol>
<li>åœ¨æ–‡ä»¶é¡¶éƒ¨å£°æ˜æˆ‘ä»¬<code>pragma</code>çš„ç‰ˆæœ¬ï¼ˆæ ¼å¼å‚è€ƒä¹‹å‰çš„è¯¾ç¨‹ï¼‰ã€‚</li>
<li>å°† <code>zombieattack.sol</code> <code>import</code> è¿›æ¥ã€‚</li>
<li>å£°æ˜ä¸€ä¸ªç»§æ‰¿ <code>ZombieAttack</code> çš„æ–°åˆçº¦ï¼Œ å‘½åä¸º<code>ZombieOwnership</code>ã€‚åˆçº¦çš„å…¶ä»–éƒ¨åˆ†å…ˆç•™ç©ºã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// ä»è¿™é‡Œå¼€å§‹</span><br><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import "./zombieattack.sol";</span><br><span class="line"></span><br><span class="line">contract ZombieOwnership is ZombieAttack{</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬2ç« -ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿"><a href="#ç¬¬2ç« -ERC721-æ ‡å‡†-å¤šé‡ç»§æ‰¿" class="headerlink" title="ç¬¬2ç« : ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿"></a>ç¬¬2ç« : ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</h3><p>è®©æˆ‘ä»¬æ¥çœ‹ä¸€çœ‹ ERC721 æ ‡å‡†ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">contract ERC721 {</span><br><span class="line">  event Transfer(address indexed _from, address indexed _to, uint256 _tokenId);</span><br><span class="line">  event Approval(address indexed _owner, address indexed _approved, uint256 _tokenId);</span><br><span class="line"></span><br><span class="line">  function balanceOf(address _owner) public view returns (uint256 _balance);</span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">  function takeOwnership(uint256 _tokenId) public;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ˜¯æˆ‘ä»¬éœ€è¦å®ç°çš„æ–¹æ³•åˆ—è¡¨ï¼Œæˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„ç« èŠ‚ä¸­é€ä¸ªå­¦ä¹ ã€‚</p>
<p>è™½ç„¶çœ‹èµ·æ¥å¾ˆå¤šï¼Œä½†ä¸è¦è¢«å“åˆ°äº†ï¼æˆ‘ä»¬åœ¨è¿™é‡Œå°±æ˜¯å‡†å¤‡å¸¦ç€ä½ ä¸€æ­¥ä¸€æ­¥äº†è§£å®ƒä»¬çš„ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š ERC721ç›®å‰æ˜¯ä¸€ä¸ª <em>è‰ç¨¿</em>ï¼Œè¿˜æ²¡æœ‰æ­£å¼å•†å®šçš„å®ç°ã€‚åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯ OpenZeppelin åº“ä¸­çš„å½“å‰ç‰ˆæœ¬ï¼Œä½†åœ¨æœªæ¥æ­£å¼å‘å¸ƒä¹‹å‰å®ƒå¯èƒ½ä¼šæœ‰æ›´æ”¹ã€‚ æ‰€ä»¥æŠŠè¿™ <strong>ä¸€ä¸ª</strong> å¯èƒ½çš„å®ç°å½“ä½œè€ƒè™‘ï¼Œä½†ä¸è¦æŠŠå®ƒä½œä¸º ERC721 ä»£å¸çš„å®˜æ–¹æ ‡å‡†ã€‚</p>
</blockquote>
<p><strong>å®ç°ä¸€ä¸ªä»£å¸åˆçº¦</strong></p>
<p>åœ¨å®ç°ä¸€ä¸ªä»£å¸åˆçº¦çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„æ˜¯å°†æ¥å£å¤åˆ¶åˆ°å®ƒè‡ªå·±çš„ Solidity æ–‡ä»¶å¹¶å¯¼å…¥å®ƒï¼Œ<code>import "./erc721.sol";</code>ã€‚ æ¥ç€ï¼Œè®©æˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿å®ƒï¼Œç„¶åæˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°å®šä¹‰æ¥é‡å†™æ¯ä¸ªæ–¹æ³•ã€‚</p>
<p>ä½†ç­‰ä¸€ä¸‹â€”â€” <code>ZombieOwnership</code>å·²ç»ç»§æ‰¿è‡ª <code>ZombieAttack</code>äº† â€”â€” å®ƒå¦‚ä½•èƒ½å¤Ÿä¹Ÿç»§æ‰¿äº <code>ERC721</code>å‘¢ï¼Ÿ</p>
<p>å¹¸è¿çš„æ˜¯åœ¨Solidityï¼Œä½ çš„åˆçº¦å¯ä»¥ç»§æ‰¿è‡ªå¤šä¸ªåˆçº¦ï¼Œå‚è€ƒå¦‚ä¸‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">contract SatoshiNakamoto is NickSzabo, HalFinney {</span><br><span class="line">  // å•§å•§å•§ï¼Œå®‡å®™çš„å¥¥ç§˜æ³„éœ²äº†</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æ­£å¦‚ä½ æ‰€è§ï¼Œå½“ä½¿ç”¨å¤šé‡ç»§æ‰¿çš„æ—¶å€™ï¼Œä½ åªéœ€è¦ç”¨é€—å· <code>,</code> æ¥éš”å¼€å‡ ä¸ªä½ æƒ³è¦ç»§æ‰¿çš„åˆçº¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„åˆçº¦ç»§æ‰¿è‡ª <code>NickSzabo</code> å’Œ <code>HalFinney</code>ã€‚</p>
<p>æ¥è¯•è¯•å§ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢ä¸ºä½ åˆ›å»ºäº†å¸¦ç€æ¥å£çš„ <code>erc721.sol</code> ã€‚</p>
<ol>
<li>å°† <code>erc721.sol</code> å¯¼å…¥åˆ° <code>zombieownership.sol</code></li>
<li>å£°æ˜ <code>ZombieOwnership</code> ç»§æ‰¿è‡ª <code>ZombieAttack</code> å’Œ <code>ERC721</code></li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import "./zombieattack.sol";</span><br><span class="line">// åœ¨è¿™é‡Œå¼•å…¥æ–‡ä»¶</span><br><span class="line">import "./erc721.sol";</span><br><span class="line">// åœ¨è¿™é‡Œå£°æ˜ ERC721 çš„ç»§æ‰¿</span><br><span class="line">contract ZombieOwnership is ZombieAttack, ERC721 {</span><br><span class="line"></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬3ç« -balanceOf-å’Œ-ownerOf"><a href="#ç¬¬3ç« -balanceOf-å’Œ-ownerOf" class="headerlink" title="ç¬¬3ç« : balanceOf å’Œ ownerOf"></a>ç¬¬3ç« : balanceOf å’Œ ownerOf</h3><p>å¤ªæ£’äº†ï¼Œæˆ‘ä»¬æ¥æ·±å…¥è®¨è®ºä¸€ä¸‹ ERC721 çš„å®ç°ã€‚</p>
<p>æˆ‘ä»¬å·²ç»æŠŠæ‰€æœ‰ä½ éœ€è¦åœ¨æœ¬è¯¾ä¸­å®ç°çš„å‡½æ•°çš„ç©ºå£³å¤åˆ¶å¥½äº†ã€‚</p>
<p>åœ¨æœ¬ç« èŠ‚ï¼Œæˆ‘ä»¬å°†å®ç°å¤´ä¸¤ä¸ªæ–¹æ³•ï¼š <code>balanceOf</code> å’Œ <code>ownerOf</code>ã€‚</p>
<p><strong><code>balanceOf</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function balanceOf(address _owner) public view returns (uint256 _balance);</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªå‡½æ•°åªéœ€è¦ä¸€ä¸ªä¼ å…¥ <code>address</code> å‚æ•°ï¼Œç„¶åè¿”å›è¿™ä¸ª <code>address</code> æ‹¥æœ‰å¤šå°‘ä»£å¸ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬çš„â€œä»£å¸â€æ˜¯åƒµå°¸ã€‚ä½ è¿˜è®°å¾—åœ¨æˆ‘ä»¬ DApp çš„å“ªé‡Œå­˜å‚¨äº†ä¸€ä¸ªä¸»äººæ‹¥æœ‰å¤šå°‘åªåƒµå°¸å—ï¼Ÿ</p>
<p> <strong><code>ownerOf</code></strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function ownerOf(uint256 _tokenId) public view returns (address _owner);</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™ä¸ªå‡½æ•°éœ€è¦ä¼ å…¥ä¸€ä¸ªä»£å¸ ID ä½œä¸ºå‚æ•° (æˆ‘ä»¬çš„æƒ…å†µå°±æ˜¯ä¸€ä¸ªåƒµå°¸ ID)ï¼Œç„¶åè¿”å›è¯¥ä»£å¸æ‹¥æœ‰è€…çš„ <code>address</code>ã€‚</p>
<p>åŒæ ·çš„ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬çš„ DApp é‡Œå·²ç»æœ‰ä¸€ä¸ª <code>mapping</code> (æ˜ å°„) å­˜å‚¨äº†è¿™ä¸ªä¿¡æ¯ï¼Œæ‰€ä»¥å¯¹æˆ‘ä»¬æ¥è¯´è¿™ä¸ªå®ç°éå¸¸ç›´æ¥æ¸…æ™°ã€‚æˆ‘ä»¬å¯ä»¥åªç”¨ä¸€è¡Œ <code>return</code> è¯­å¥æ¥å®ç°è¿™ä¸ªå‡½æ•°ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¦è®°å¾—ï¼Œ <code>uint256</code> ç­‰åŒäº<code>uint</code>ã€‚æˆ‘ä»¬ä»è¯¾ç¨‹çš„å¼€å§‹ä¸€ç›´åœ¨ä»£ç ä¸­ä½¿ç”¨ <code>uint</code>ï¼Œä½†ä»ç°åœ¨å¼€å§‹æˆ‘ä»¬å°†åœ¨è¿™é‡Œç”¨ <code>uint256</code>ï¼Œå› ä¸ºæˆ‘ä»¬ç›´æ¥ä»è§„èŒƒä¸­å¤åˆ¶ç²˜è´´ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘å°†è®©ä½ æ¥å†³å®šå¦‚ä½•å®ç°è¿™ä¸¤ä¸ªå‡½æ•°ã€‚</p>
<p>æ¯ä¸ªå‡½æ•°çš„ä»£ç éƒ½åº”è¯¥åªæœ‰1è¡Œ <code>return</code> è¯­å¥ã€‚çœ‹çœ‹æˆ‘ä»¬åœ¨ä¹‹å‰è¯¾ç¨‹ä¸­å†™çš„ä»£ç ï¼Œæƒ³æƒ³æˆ‘ä»¬éƒ½æŠŠè¿™ä¸ªæ•°æ®å­˜å‚¨åœ¨å“ªã€‚å¦‚æœä½ è§‰å¾—æœ‰å›°éš¾ï¼Œä½ å¯ä»¥ç‚¹â€œæˆ‘è¦çœ‹ç­”æ¡ˆâ€çš„æŒ‰é’®æ¥è·å¾—å¸®åŠ©ã€‚</p>
<ol>
<li>å®ç° <code>balanceOf</code> æ¥è¿”å› <code>_owner</code> æ‹¥æœ‰çš„åƒµå°¸æ•°é‡ã€‚</li>
<li>å®ç° <code>ownerOf</code> æ¥è¿”å›æ‹¥æœ‰ ID ä¸º <code>_tokenId</code> åƒµå°¸çš„æ‰€æœ‰è€…çš„åœ°å€ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function balanceOf(address _owner) public view returns (uint256 _balance) {</span><br><span class="line">    // 1. åœ¨è¿™é‡Œè¿”å› `_owner` æ‹¥æœ‰çš„åƒµå°¸æ•°</span><br><span class="line">    return ownerZombieCount[_owner];</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function ownerOf(uint256 _tokenId) public view returns (address _owner) {</span><br><span class="line">    // 2. åœ¨è¿™é‡Œè¿”å› `_tokenId` çš„æ‰€æœ‰è€…</span><br><span class="line">    return zombieToOwner[_tokenId];</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬4ç« -é‡æ„"><a href="#ç¬¬4ç« -é‡æ„" class="headerlink" title="ç¬¬4ç« : é‡æ„"></a>ç¬¬4ç« : é‡æ„</h3><p>å˜¿å˜¿ï¼æˆ‘ä»¬åˆšåˆšçš„ä»£ç ä¸­å…¶å®æœ‰ä¸ªé”™è¯¯ï¼Œä»¥è‡³äºå…¶æ ¹æœ¬æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä½ å‘ç°äº†æ²¡ï¼Ÿ</p>
<p>åœ¨å‰ä¸€ä¸ªç« èŠ‚æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªå« <code>ownerOf</code> çš„å‡½æ•°ã€‚ä½†å¦‚æœä½ è¿˜è®°å¾—ç¬¬4è¯¾çš„å†…å®¹ï¼Œæˆ‘ä»¬åŒæ ·åœ¨<code>zombiefeeding.sol</code> é‡Œä»¥ <code>ownerOf</code> å‘½ååˆ›å»ºäº†ä¸€ä¸ª <code>modifier</code>ï¼ˆä¿®é¥°ç¬¦ï¼‰ã€‚</p>
<p>å¦‚æœä½ å°è¯•ç¼–è¯‘è¿™æ®µä»£ç ï¼Œç¼–è¯‘å™¨ä¼šç»™ä½ ä¸€ä¸ªé”™è¯¯è¯´ä½ ä¸èƒ½æœ‰ç›¸åŒåç§°çš„ä¿®é¥°ç¬¦å’Œå‡½æ•°ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬åº”è¯¥æŠŠåœ¨ <code>ZombieOwnership</code> é‡Œçš„å‡½æ•°åç§°æ”¹æˆåˆ«çš„å—ï¼Ÿ</p>
<p>ä¸ï¼Œæˆ‘ä»¬ä¸èƒ½é‚£æ ·åšï¼ï¼ï¼è¦è®°å¾—ï¼Œæˆ‘ä»¬æ­£åœ¨ç”¨ ERC721 ä»£å¸æ ‡å‡†ï¼Œæ„å‘³ç€å…¶ä»–åˆçº¦å°†æœŸæœ›æˆ‘ä»¬çš„åˆçº¦ä»¥è¿™äº›ç¡®åˆ‡çš„åç§°æ¥å®šä¹‰å‡½æ•°ã€‚è¿™å°±æ˜¯è¿™äº›æ ‡å‡†å®ç”¨çš„åŸå› â€”â€”å¦‚æœå¦ä¸€ä¸ªåˆçº¦çŸ¥é“æˆ‘ä»¬çš„åˆçº¦ç¬¦åˆ ERC721 æ ‡å‡†ï¼Œå®ƒå¯ä»¥ç›´æ¥ä¸æˆ‘ä»¬äº¤äº’ï¼Œè€Œæ— éœ€äº†è§£ä»»ä½•å…³äºæˆ‘ä»¬å†…éƒ¨å¦‚ä½•å®ç°çš„ç»†èŠ‚ã€‚</p>
<p>æ‰€ä»¥ï¼Œé‚£æ„å‘³ç€æˆ‘ä»¬å°†å¿…é¡»é‡æ„æˆ‘ä»¬ç¬¬4è¯¾ä¸­çš„ä»£ç ï¼Œå°† <code>modifier</code> çš„åç§°æ¢æˆåˆ«çš„ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å›åˆ°äº† <code>zombiefeeding.sol</code> ã€‚æˆ‘ä»¬å°†æŠŠ <code>modifier</code> çš„åç§°ä» <code>ownerOf</code> æ”¹æˆ <code>onlyOwnerOf</code>ã€‚</p>
<ol>
<li>æŠŠä¿®é¥°ç¬¦å®šä¹‰ä¸­çš„åç§°æ”¹æˆ <code>onlyOwnerOf</code></li>
<li>å¾€ä¸‹æ»‘åˆ°ä½¿ç”¨æ­¤ä¿®é¥°ç¬¦çš„å‡½æ•° <code>feedAndMultiply</code> ã€‚æˆ‘ä»¬ä¹Ÿéœ€è¦æ”¹è¿™é‡Œçš„åç§°ã€‚</li>
</ol>
<blockquote>
<p>æ³¨æ„ï¼šæˆ‘ä»¬åœ¨ <code>zombiehelper.sol</code> å’Œ <code>zombieattack.sol</code> é‡Œä¹Ÿä½¿ç”¨äº†è¿™ä¸ªä¿®é¥°ç¬¦ï¼Œä½†ä¸ºäº†ä¸åœ¨è¿™èŠ‚è¯¾çš„é‡æ„é‡ŒèŠ±å¤ªå¤šæ—¶é—´ï¼Œæˆ‘ä»¬å·²ç»å°†é‚£äº›æ–‡ä»¶é‡Œçš„ä¿®é¥°ç¬¦åç§°ä¸ºä½ æ”¹å¥½äº†ã€‚</p>
</blockquote>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">// 1. æŠŠä¿®é¥°ç¬¦åç§°æ”¹æˆ `onlyOwnerOf`</span><br><span class="line">  modifier onlyOwnerOf(uint _zombieId) {</span><br><span class="line">    require(msg.sender == zombieToOwner[_zombieId]);</span><br><span class="line">    _;</span><br><span class="line">  }</span><br><span class="line">// 2. è¿™é‡Œä¹Ÿè¦ä¿®æ”¹ä¿®é¥°ç¬¦çš„åç§°</span><br><span class="line">  function feedAndMultiply(uint _zombieId, uint _targetDna, string _species) internal onlyOwnerOf(_zombieId) {</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    require(_isReady(myZombie));</span><br><span class="line">    _targetDna = _targetDna % dnaModulus;</span><br><span class="line">    uint newDna = (myZombie.dna + _targetDna) / 2;</span><br><span class="line">    if (keccak256(_species) == keccak256("kitty")) {</span><br><span class="line">      newDna = newDna - newDna % 100 + 99;</span><br><span class="line">    }</span><br><span class="line">    _createZombie("NoName", newDna);</span><br><span class="line">    _triggerCooldown(myZombie);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬5ç« -ERC721-è½¬ç§»æ ‡å‡†"><a href="#ç¬¬5ç« -ERC721-è½¬ç§»æ ‡å‡†" class="headerlink" title="ç¬¬5ç« : ERC721: è½¬ç§»æ ‡å‡†"></a>ç¬¬5ç« : ERC721: è½¬ç§»æ ‡å‡†</h3><p>å¥½äº†ï¼Œæˆ‘ä»¬å°†å†²çªä¿®å¤äº†ï¼</p>
<p>ç°åœ¨æˆ‘ä»¬å°†é€šè¿‡å­¦ä¹ æŠŠæ‰€æœ‰æƒä»ä¸€ä¸ªäººè½¬ç§»ç»™å¦ä¸€ä¸ªäººæ¥ç»§ç»­æˆ‘ä»¬çš„ ERC721 è§„èŒƒçš„å®ç°ã€‚</p>
<p>æ³¨æ„ ERC721 è§„èŒƒæœ‰ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥è½¬ç§»ä»£å¸ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">function transfer(address _to, uint256 _tokenId) public;</span><br><span class="line"></span><br><span class="line">function approve(address _to, uint256 _tokenId) public;</span><br><span class="line">function takeOwnership(uint256 _tokenId) public;</span><br></pre></td></tr></tbody></table></figure>

<ol>
<li>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯ä»£å¸çš„æ‹¥æœ‰è€…è°ƒç”¨<code>transfer</code> æ–¹æ³•ï¼Œä¼ å…¥ä»–æƒ³è½¬ç§»åˆ°çš„ <code>address</code> å’Œä»–æƒ³è½¬ç§»çš„ä»£å¸çš„ <code>_tokenId</code>ã€‚</li>
<li>ç¬¬äºŒç§æ–¹æ³•æ˜¯ä»£å¸æ‹¥æœ‰è€…é¦–å…ˆè°ƒç”¨ <code>approve</code>ï¼Œç„¶åä¼ å…¥ä¸ä»¥ä¸Šç›¸åŒçš„å‚æ•°ã€‚æ¥ç€ï¼Œè¯¥åˆçº¦ä¼šå­˜å‚¨è°è¢«å…è®¸æå–ä»£å¸ï¼Œé€šå¸¸å­˜å‚¨åˆ°ä¸€ä¸ª <code>mapping (uint256 =&gt; address)</code> é‡Œã€‚ç„¶åï¼Œå½“æœ‰äººè°ƒç”¨ <code>takeOwnership</code> æ—¶ï¼Œåˆçº¦ä¼šæ£€æŸ¥ <code>msg.sender</code> æ˜¯å¦å¾—åˆ°æ‹¥æœ‰è€…çš„æ‰¹å‡†æ¥æå–ä»£å¸ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å°†ä»£å¸è½¬ç§»ç»™ä»–ã€‚</li>
</ol>
<p>ä½ æ³¨æ„åˆ°äº†å—ï¼Œ<code>transfer</code> å’Œ <code>takeOwnership</code> éƒ½å°†åŒ…å«ç›¸åŒçš„è½¬ç§»é€»è¾‘ï¼Œåªæ˜¯ä»¥ç›¸åçš„é¡ºåºã€‚ ï¼ˆä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„å‘é€è€…è°ƒç”¨å‡½æ•°ï¼›å¦ä¸€ç§æƒ…å†µæ˜¯ä»£å¸çš„æ¥æ”¶è€…è°ƒç”¨å®ƒï¼‰ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ªé€»è¾‘æŠ½è±¡æˆå®ƒè‡ªå·±çš„ç§æœ‰å‡½æ•° <code>_transfer</code>ï¼Œç„¶åç”±è¿™ä¸¤ä¸ªå‡½æ•°æ¥è°ƒç”¨å®ƒã€‚ è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†™é‡å¤çš„ä»£ç äº†ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>è®©æˆ‘ä»¬æ¥å®šä¹‰ <code>_transfer</code> çš„é€»è¾‘ã€‚</p>
<ol>
<li><p>å®šä¹‰ä¸€ä¸ªåä¸º <code>_transfer</code>çš„å‡½æ•°ã€‚å®ƒä¼šéœ€è¦3ä¸ªå‚æ•°ï¼š<code>address _from</code>ã€<code>address _to</code>å’Œ<code>uint256 _tokenId</code>ã€‚å®ƒåº”è¯¥æ˜¯ä¸€ä¸ª <code>ç§æœ‰</code> å‡½æ•°ã€‚</p>
</li>
<li><p>æˆ‘ä»¬æœ‰2ä¸ªæ˜ å°„ä¼šåœ¨æ‰€æœ‰æƒæ”¹å˜çš„æ—¶å€™æ”¹å˜ï¼š <code>ownerZombieCount</code> ï¼ˆè®°å½•ä¸€ä¸ªæ‰€æœ‰è€…æœ‰å¤šå°‘åªåƒµå°¸ï¼‰å’Œ <code>zombieToOwner</code> ï¼ˆè®°å½•ä»€ä¹ˆäººæ‹¥æœ‰ä»€ä¹ˆï¼‰ã€‚</p>
<p> æˆ‘ä»¬çš„å‡½æ•°éœ€è¦åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ä¸º <strong>æ¥æ”¶</strong> åƒµå°¸çš„äººï¼ˆ<code>address _to</code>ï¼‰å¢ åŠ <code>ownerZombieCount</code>ã€‚ä½¿ç”¨ <code>++</code> æ¥å¢åŠ ã€‚</p>
</li>
<li><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†éœ€è¦ä¸º <strong>å‘é€</strong> åƒµå°¸çš„äººï¼ˆ<code>address _from</code>ï¼‰<strong>å‡å°‘</strong><code>ownerZombieCount</code>ã€‚ä½¿ç”¨ <code>--</code> æ¥æ‰£å‡ã€‚</p>
</li>
<li><p>æœ€åï¼Œæˆ‘ä»¬å°†æ”¹å˜è¿™ä¸ª <code>_tokenId</code> çš„ <code>zombieToOwner</code> æ˜ å°„ï¼Œè¿™æ ·å®ƒç°åœ¨å°±ä¼šæŒ‡å‘ <code>_to</code>ã€‚</p>
</li>
<li><p>éª—ä½ çš„ï¼Œé‚£ä¸æ˜¯æœ€åä¸€æ­¥ã€‚æˆ‘ä»¬è¿˜éœ€è¦å†åšä¸€ä»¶äº‹æƒ…ã€‚</p>
<p> ERC721è§„èŒƒåŒ…å«äº†ä¸€ä¸ª <code>Transfer</code> äº‹ä»¶ã€‚è¿™ä¸ªå‡½æ•°çš„æœ€åä¸€è¡Œåº”è¯¥ç”¨æ­£ç¡®çš„å‚æ•°è§¦å‘<code>Transfer</code> â€”â€”æŸ¥çœ‹ <code>erc721.sol</code> çœ‹å®ƒæœŸæœ›ä¼ å…¥çš„å‚æ•°å¹¶åœ¨è¿™é‡Œå®ç°ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// åœ¨è¿™é‡Œå®šä¹‰ _transfer()</span><br><span class="line">    function _transfer(address _from, address _to, uint256 _tokenId) private{</span><br><span class="line">        ownerZombieCount[_to]++;</span><br><span class="line">        ownerZombieCount[_from]--;</span><br><span class="line">        zombieToOwner[_tokenId] = _to;</span><br><span class="line">        Transfer(_from, _to, _tokenId);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬6ç« -ERC721-è½¬ç§»-ç»­"><a href="#ç¬¬6ç« -ERC721-è½¬ç§»-ç»­" class="headerlink" title="ç¬¬6ç« : ERC721: è½¬ç§»-ç»­"></a>ç¬¬6ç« : ERC721: è½¬ç§»-ç»­</h3><p>å¤ªå¥½äº†ï¼åˆšæ‰é‚£æ˜¯æœ€éš¾çš„éƒ¨åˆ†â€”â€”ç°åœ¨å®ç°å…¬å…±çš„ <code>transfer</code> å‡½æ•°åº”è¯¥ååˆ†å®¹æ˜“ï¼Œå› ä¸ºæˆ‘ä»¬çš„ <code>_transfer</code> å‡½æ•°å‡ ä¹å·²ç»æŠŠæ‰€æœ‰çš„é‡æ´»éƒ½å¹²å®Œäº†ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>æˆ‘ä»¬æƒ³ç¡®ä¿åªæœ‰ä»£å¸æˆ–åƒµå°¸çš„æ‰€æœ‰è€…å¯ä»¥è½¬ç§»å®ƒã€‚è¿˜è®°å¾—æˆ‘ä»¬å¦‚ä½•é™åˆ¶åªæœ‰æ‰€æœ‰è€…æ‰èƒ½è®¿é—®æŸä¸ªåŠŸèƒ½å—ï¼Ÿ</p>
<p> æ²¡é”™ï¼Œæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ªä¿®é¥°ç¬¦èƒ½å¤Ÿå®Œæˆè¿™ä¸ªä»»åŠ¡äº†ã€‚æ‰€ä»¥å°†ä¿®é¥°ç¬¦ <code>onlyOwnerOf</code> æ·»åŠ åˆ°è¿™ä¸ªå‡½æ•°ä¸­ã€‚</p>
</li>
<li><p>ç°åœ¨è¯¥å‡½æ•°çš„æ­£æ–‡åªéœ€è¦ä¸€è¡Œä»£ç ã€‚å®ƒåªéœ€è¦è°ƒç”¨ <code>_transfer</code>ã€‚</p>
<p> è®°å¾—æŠŠ <code>msg.sender</code> ä½œä¸ºå‚æ•°ä¼ é€’è¿› <code>address _from</code>ã€‚</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œæ·»åŠ ä¿®é¥°ç¬¦</span><br><span class="line">  function transfer(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId){</span><br><span class="line">    // 2. åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•</span><br><span class="line">    _transfer(msg.sender, _to, _tokenId);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬7ç« -ERC721-æ‰¹å‡†"><a href="#ç¬¬7ç« -ERC721-æ‰¹å‡†" class="headerlink" title="ç¬¬7ç« : ERC721: æ‰¹å‡†"></a>ç¬¬7ç« : ERC721: æ‰¹å‡†</h3><p>ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å®ç° <code>approve</code>ã€‚</p>
<p>è®°ä½ï¼Œä½¿ç”¨ <code>approve</code> æˆ–è€… <code>takeOwnership</code> çš„æ—¶å€™ï¼Œè½¬ç§»æœ‰2ä¸ªæ­¥éª¤ï¼š</p>
<ol>
<li>ä½ ï¼Œä½œä¸ºæ‰€æœ‰è€…ï¼Œç”¨æ–°ä¸»äººçš„ <code>address</code> å’Œä½ å¸Œæœ›ä»–è·å–çš„ <code>_tokenId</code> æ¥è°ƒç”¨ <code>approve</code></li>
<li>æ–°ä¸»äººç”¨ <code>_tokenId</code> æ¥è°ƒç”¨ <code>takeOwnership</code>ï¼Œåˆçº¦ä¼šæ£€æŸ¥ç¡®ä¿ä»–è·å¾—äº†æ‰¹å‡†ï¼Œç„¶åæŠŠä»£å¸è½¬ç§»ç»™ä»–ã€‚</li>
</ol>
<p>å› ä¸ºè¿™å‘ç”Ÿåœ¨2ä¸ªå‡½æ•°çš„è°ƒç”¨ä¸­ï¼Œæ‰€ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®ç»“æ„æ¥å­˜å‚¨ä»€ä¹ˆäººè¢«æ‰¹å‡†è·å–ä»€ä¹ˆã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥å®šä¹‰ä¸€ä¸ªæ˜ å°„ <code>zombieApprovals</code>ã€‚å®ƒåº”è¯¥å°†ä¸€ä¸ª <code>uint</code> æ˜ å°„åˆ°ä¸€ä¸ª <code>address</code>ã€‚</p>
<p> è¿™æ ·ä¸€æ¥ï¼Œå½“æœ‰äººç”¨ä¸€ä¸ª <code>_tokenId</code> è°ƒç”¨ <code>takeOwnership</code> æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è¿™ä¸ªæ˜ å°„æ¥å¿«é€ŸæŸ¥æ‰¾è°è¢«æ‰¹å‡†è·å–é‚£ä¸ªä»£å¸ã€‚</p>
</li>
<li><p>åœ¨å‡½æ•° <code>approve</code> ä¸Šï¼Œ æˆ‘ä»¬æƒ³è¦ç¡®ä¿åªæœ‰ä»£å¸æ‰€æœ‰è€…å¯ä»¥æ‰¹å‡†æŸäººæ¥è·å–ä»£å¸ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦æ·»åŠ ä¿®é¥°ç¬¦ <code>onlyOwnerOf</code> åˆ° <code>approve</code>ã€‚</p>
</li>
<li><p>å‡½æ•°çš„æ­£æ–‡éƒ¨åˆ†ï¼Œå°† <code>_tokenId</code> çš„ <code>zombieApprovals</code> è®¾ç½®ä¸ºå’Œ <code>_to</code> ç›¸ç­‰ã€‚</p>
</li>
<li><p>æœ€åï¼Œåœ¨ ERC721 è§„èŒƒé‡Œæœ‰ä¸€ä¸ª <code>Approval</code> äº‹ä»¶ã€‚æ‰€ä»¥æˆ‘ä»¬åº”è¯¥åœ¨è¿™ä¸ªå‡½æ•°çš„æœ€åè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ï¼ˆå‚è€ƒ <code>erc721.sol</code> æ¥ç¡®è®¤ä¼ å…¥çš„å‚æ•°ï¼Œå¹¶ç¡®ä¿ <code>_owner</code> æ˜¯ <code>msg.sender</code>ï¼‰</p>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå®šä¹‰æ˜ å°„</span><br><span class="line">  mapping(uint =&gt; address) zombieApprovals;</span><br><span class="line">// 2. åœ¨è¿™é‡Œæ·»åŠ æ–¹æ³•ä¿®é¥°ç¬¦</span><br><span class="line">  function approve(address _to, uint256 _tokenId) public onlyOwnerOf(_tokenId){</span><br><span class="line">    // 3. åœ¨è¿™é‡Œå®šä¹‰æ–¹æ³•</span><br><span class="line">    zombieApprovals[_tokenId] = _to;</span><br><span class="line">    Approval(msg.sender, _to, _tokenId);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬8ç« -ERC721-takeOwnership"><a href="#ç¬¬8ç« -ERC721-takeOwnership" class="headerlink" title="ç¬¬8ç« : ERC721: takeOwnership"></a>ç¬¬8ç« : ERC721: takeOwnership</h3><p>å¤ªæ£’äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬å®Œæˆæœ€åä¸€ä¸ªå‡½æ•°æ¥ç»“æŸ ERC721 çš„å®ç°ã€‚ï¼ˆåˆ«æ‹…å¿ƒï¼Œè¿™åé¢æˆ‘ä»¬è¿˜ä¼šè®²æ›´å¤šå†…å®¹ğŸ˜‰ï¼‰</p>
<p>æœ€åä¸€ä¸ªå‡½æ•° <code>takeOwnership</code>ï¼Œ åº”è¯¥åªæ˜¯ç®€å•åœ°æ£€æŸ¥ä»¥ç¡®ä¿ <code>msg.sender</code> å·²ç»è¢«æ‰¹å‡†æ¥æå–è¿™ä¸ªä»£å¸æˆ–è€…åƒµå°¸ã€‚è‹¥ç¡®è®¤ï¼Œå°±è°ƒç”¨ <code>_transfer</code>ï¼›</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li><p>é¦–å…ˆï¼Œæˆ‘ä»¬è¦ç”¨ä¸€ä¸ª <code>require</code> å¥å¼æ¥æ£€æŸ¥ <code>_tokenId</code> çš„ <code>zombieApprovals</code> å’Œ <code>msg.sender</code> ç›¸ç­‰ã€‚</p>
<p> è¿™æ ·å¦‚æœ <code>msg.sender</code> æœªè¢«æˆæƒæ¥æå–è¿™ä¸ªä»£å¸ï¼Œå°†æŠ›å‡ºä¸€ä¸ªé”™è¯¯ã€‚</p>
</li>
<li><p>ä¸ºäº†è°ƒç”¨ <code>_transfer</code>ï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“ä»£å¸æ‰€æœ‰è€…çš„åœ°å€ï¼ˆå®ƒéœ€è¦ä¸€ä¸ª <code>_from</code> æ¥ä½œä¸ºå‚æ•°ï¼‰ã€‚å¹¸è¿çš„æ˜¯æˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ <code>ownerOf</code> å‡½æ•°ä¸­æ¥æ‰¾åˆ°è¿™ä¸ªå‚æ•°ã€‚</p>
<p> æ‰€ä»¥ï¼Œå®šä¹‰ä¸€ä¸ªåä¸º <code>owner</code> çš„ <code>address</code> å˜é‡ï¼Œå¹¶ä½¿å…¶ç­‰äº <code>ownerOf(_tokenId)</code>ã€‚</p>
</li>
<li><p>æœ€åï¼Œè°ƒç”¨ <code>_transfer</code>, å¹¶ä¼ å…¥æ‰€æœ‰å¿…é¡»çš„å‚æ•°ã€‚ï¼ˆåœ¨è¿™é‡Œä½ å¯ä»¥ç”¨ <code>msg.sender</code> ä½œä¸º <code>_to</code>ï¼Œ å› ä¸ºä»£å¸æ­£æ˜¯è¦å‘é€ç»™è°ƒç”¨è¿™ä¸ªå‡½æ•°çš„äººï¼‰ã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼š æˆ‘ä»¬å®Œå…¨å¯ä»¥ç”¨ä¸€è¡Œä»£ç æ¥å®ç°ç¬¬2ã€3ä¸¤æ­¥ã€‚ä½†æ˜¯åˆ†å¼€å†™ä¼šè®©ä»£ç æ›´æ˜“è¯»ã€‚ä¸€ç‚¹ä¸ªäººå»ºè®® :)</p>
</blockquote>
</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function takeOwnership(uint256 _tokenId) public {</span><br><span class="line">    // ä»è¿™é‡Œå¼€å§‹</span><br><span class="line">    require(msg.sender == zombieApprovals[_tokenId]);</span><br><span class="line">    address owner = ownerOf(_tokenId);</span><br><span class="line">    _transfer(owner, msg.sender, _tokenId);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬9ç« -é¢„é˜²æº¢å‡º"><a href="#ç¬¬9ç« -é¢„é˜²æº¢å‡º" class="headerlink" title="ç¬¬9ç« : é¢„é˜²æº¢å‡º"></a>ç¬¬9ç« : é¢„é˜²æº¢å‡º</h3><p>æ­å–œä½ ï¼Œæˆ‘ä»¬å®Œæˆäº† ERC721 çš„å®ç°ã€‚</p>
<p>å¹¶ä¸æ˜¯å¾ˆå¤æ‚ï¼Œå¯¹å§ï¼Ÿå¾ˆå¤šç±»ä¼¼çš„ä»¥å¤ªåŠæ¦‚å¿µï¼Œå½“ä½ åªå¬äººä»¬è°ˆè®ºå®ƒä»¬çš„æ—¶å€™ï¼Œä¼šè§‰å¾—å¾ˆå¤æ‚ã€‚æ‰€ä»¥æœ€ç®€å•çš„ç†è§£æ–¹å¼å°±æ˜¯ä½ è‡ªå·±æ¥å®ç°å®ƒã€‚</p>
<p>ä¸è¿‡è¦è®°ä½é‚£åªæ˜¯æœ€ç®€å•çš„å®ç°ã€‚è¿˜æœ‰å¾ˆå¤šçš„ç‰¹æ€§æˆ‘ä»¬ä¹Ÿè®¸æƒ³åŠ å…¥åˆ°æˆ‘ä»¬çš„å®ç°ä¸­æ¥ï¼Œæ¯”å¦‚ä¸€äº›é¢å¤–çš„æ£€æŸ¥ï¼Œæ¥ç¡®ä¿ç”¨æˆ·ä¸ä¼šä¸å°å¿ƒæŠŠä»–ä»¬çš„åƒµå°¸è½¬ç§»ç»™<code>0</code> åœ°å€ï¼ˆè¿™è¢«ç§°ä½œ â€œçƒ§å¸â€, åŸºæœ¬ä¸Šå°±æ˜¯æŠŠä»£å¸è½¬ç§»åˆ°ä¸€ä¸ªè°ä¹Ÿæ²¡æœ‰ç§é’¥çš„åœ°å€ï¼Œè®©è¿™ä¸ªä»£å¸æ°¸è¿œä¹Ÿæ— æ³•æ¢å¤ï¼‰ã€‚ æˆ–è€…åœ¨ DApp ä¸­åŠ å…¥ä¸€äº›åŸºæœ¬çš„æ‹å–é€»è¾‘ã€‚ï¼ˆä½ èƒ½æƒ³å‡ºä¸€äº›å®ç°çš„æ–¹æ³•ä¹ˆï¼Ÿï¼‰</p>
<p>ä½†æ˜¯ä¸ºäº†è®©æˆ‘ä»¬çš„è¯¾ç¨‹ä¸è‡³äºç¦»é¢˜å¤ªè¿œï¼Œæ‰€ä»¥æˆ‘ä»¬åªä¸“æ³¨äºä¸€äº›åŸºç¡€å®ç°ã€‚å¦‚æœä½ æƒ³å­¦ä¹ ä¸€äº›æ›´æ·±å±‚æ¬¡çš„å®ç°ï¼Œå¯ä»¥åœ¨è¿™ä¸ªæ•™ç¨‹ç»“æŸåï¼Œå»çœ‹çœ‹ OpenZeppelin çš„ ERC721 åˆçº¦ã€‚</p>
<p><strong>åˆçº¦å®‰å…¨å¢å¼º: æº¢å‡ºå’Œä¸‹æº¢</strong></p>
<p>æˆ‘ä»¬å°†æ¥å­¦ä¹ ä½ åœ¨ç¼–å†™æ™ºèƒ½åˆçº¦çš„æ—¶å€™éœ€è¦æ³¨æ„çš„ä¸€ä¸ªä¸»è¦çš„å®‰å…¨ç‰¹æ€§ï¼šé˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ã€‚</p>
<p>ä»€ä¹ˆæ˜¯ <strong><em>æº¢å‡º</em></strong> (*<strong>overflow*</strong>)?</p>
<p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª <code>uint8</code>, åªèƒ½å­˜å‚¨8 bitæ•°æ®ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬èƒ½å­˜å‚¨çš„æœ€å¤§æ•°å­—å°±æ˜¯äºŒè¿›åˆ¶ <code>11111111</code> (æˆ–è€…è¯´åè¿›åˆ¶çš„ 2^8 - 1 = 255).</p>
<p>æ¥çœ‹çœ‹ä¸‹é¢çš„ä»£ç ã€‚æœ€å <code>number</code> å°†ä¼šæ˜¯ä»€ä¹ˆå€¼ï¼Ÿ</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">uint8 number = 255;</span><br><span class="line">number++;</span><br></pre></td></tr></tbody></table></figure>

<p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯¼è‡´äº†æº¢å‡º â€” è™½ç„¶æˆ‘ä»¬åŠ äº†1ï¼Œ ä½†æ˜¯ <code>number</code> å‡ºä¹æ„æ–™åœ°ç­‰äº <code>0</code>äº†ã€‚ (å¦‚æœä½ ç»™äºŒè¿›åˆ¶ <code>11111111</code> åŠ 1, å®ƒå°†è¢«é‡ç½®ä¸º <code>00000000</code>ï¼Œå°±åƒé’Ÿè¡¨ä» <code>23:59</code> èµ°å‘ <code>00:00</code>)ã€‚</p>
<p>ä¸‹æº¢(<code>underflow</code>)ä¹Ÿç±»ä¼¼ï¼Œå¦‚æœä½ ä»ä¸€ä¸ªç­‰äº <code>0</code> çš„ <code>uint8</code> å‡å» <code>1</code>, å®ƒå°†å˜æˆ <code>255</code> (å› ä¸º <code>uint</code> æ˜¯æ— ç¬¦å·çš„ï¼Œå…¶ä¸èƒ½ç­‰äºè´Ÿæ•°)ã€‚</p>
<p>è™½ç„¶æˆ‘ä»¬åœ¨è¿™é‡Œä¸ä½¿ç”¨ <code>uint8</code>ï¼Œè€Œä¸”æ¯æ¬¡ç»™ä¸€ä¸ª <code>uint256</code> åŠ  <code>1</code> ä¹Ÿä¸å¤ªå¯èƒ½æº¢å‡º (2^256 çœŸçš„æ˜¯ä¸€ä¸ªå¾ˆå¤§çš„æ•°äº†)ï¼Œåœ¨æˆ‘ä»¬çš„åˆçº¦ä¸­æ·»åŠ ä¸€äº›ä¿æŠ¤æœºåˆ¶ä¾ç„¶æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œä»¥é˜²æˆ‘ä»¬çš„ DApp ä»¥åå‡ºç°ä»€ä¹ˆå¼‚å¸¸æƒ…å†µã€‚</p>
<p><strong>ä½¿ç”¨ SafeMath</strong></p>
<p>ä¸ºäº†é˜²æ­¢è¿™äº›æƒ…å†µï¼ŒOpenZeppelin å»ºç«‹äº†ä¸€ä¸ªå«åš SafeMath çš„ <strong><em>åº“</em></strong>(*<strong>library*</strong>)ï¼Œé»˜è®¤æƒ…å†µä¸‹å¯ä»¥é˜²æ­¢è¿™äº›é—®é¢˜ã€‚</p>
<p>ä¸è¿‡åœ¨æˆ‘ä»¬ä½¿ç”¨ä¹‹å‰â€¦â€¦ ä»€ä¹ˆå«åšåº“?</p>
<p>ä¸€ä¸ª**<em>åº“</em>** æ˜¯ Solidity ä¸­ä¸€ç§ç‰¹æ®Šçš„åˆçº¦ã€‚å…¶ä¸­ä¸€ä¸ªæœ‰ç”¨çš„åŠŸèƒ½æ˜¯ç»™åŸå§‹æ•°æ®ç±»å‹å¢åŠ ä¸€äº›æ–¹æ³•ã€‚</p>
<p>æ¯”å¦‚ï¼Œä½¿ç”¨ SafeMath åº“çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ <code>using SafeMath for uint256</code> è¿™æ ·çš„è¯­æ³•ã€‚ SafeMath åº“æœ‰å››ä¸ªæ–¹æ³• â€” <code>add</code>ï¼Œ <code>sub</code>ï¼Œ <code>mul</code>ï¼Œ ä»¥åŠ <code>div</code>ã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥è¿™æ ·æ¥è®© <code>uint256</code> è°ƒç”¨è¿™äº›æ–¹æ³•ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">using SafeMath for uint256;</span><br><span class="line"></span><br><span class="line">uint256 a = 5;</span><br><span class="line">uint256 b = a.add(3); // 5 + 3 = 8</span><br><span class="line">uint256 c = a.mul(2); // 5 * 2 = 10</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç« æ¥å­¦ä¹ è¿™äº›æ–¹æ³•ï¼Œä¸è¿‡ç°åœ¨æˆ‘ä»¬å…ˆå°† SafeMath åº“æ·»åŠ è¿›æˆ‘ä»¬çš„åˆçº¦ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å·²ç»å¸®ä½ æŠŠ OpenZeppelin çš„ <code>SafeMath</code> åº“åŒ…å«è¿› <code>safemath.sol</code>äº†ï¼Œå¦‚æœä½ æƒ³çœ‹ä¸€ä¸‹ä»£ç çš„è¯ï¼Œç°åœ¨å¯ä»¥çœ‹çœ‹ï¼Œä¸è¿‡æˆ‘ä»¬ä¸‹ä¸€ç« å°†æ·±å…¥è¿›å»ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬æ¥å‘Šè¯‰æˆ‘ä»¬çš„åˆçº¦è¦ä½¿ç”¨ SafeMathã€‚æˆ‘ä»¬å°†åœ¨æˆ‘ä»¬çš„ <code>ZombieFactory</code> é‡Œè°ƒç”¨ï¼Œè¿™æ˜¯æˆ‘ä»¬çš„åŸºç¡€åˆçº¦ â€” è¿™æ ·å…¶ä»–æ‰€æœ‰ç»§æ‰¿å‡ºå»çš„å­åˆçº¦éƒ½å¯ä»¥ä½¿ç”¨è¿™ä¸ªåº“äº†ã€‚</p>
<ol>
<li>å°† <code>safemath.sol</code> å¼•å…¥åˆ° <code>zombiefactory.sol</code>.</li>
<li>æ·»åŠ å®šä¹‰ï¼š <code>using SafeMath for uint256;</code>.</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// 1. åœ¨è¿™é‡Œå¼•å…¥</span><br><span class="line">import "./safemath.sol";</span><br><span class="line"></span><br><span class="line">contract ZombieFactory is Ownable {</span><br><span class="line"></span><br><span class="line">  // 2. åœ¨è¿™é‡Œå®šä¹‰ using safemath </span><br><span class="line">    using SafeMath for uint256;</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬10ç« -SafeMath-ç¬¬äºŒéƒ¨åˆ†"><a href="#ç¬¬10ç« -SafeMath-ç¬¬äºŒéƒ¨åˆ†" class="headerlink" title="ç¬¬10ç« : SafeMath ç¬¬äºŒéƒ¨åˆ†"></a>ç¬¬10ç« : SafeMath ç¬¬äºŒéƒ¨åˆ†</h3><p>æ¥çœ‹çœ‹ SafeMath çš„éƒ¨åˆ†ä»£ç :</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">library SafeMath {</span><br><span class="line"></span><br><span class="line">  function mul(uint256 a, uint256 b) internal pure returns (uint256) {</span><br><span class="line">    if (a == 0) {</span><br><span class="line">      return 0;</span><br><span class="line">    }</span><br><span class="line">    uint256 c = a * b;</span><br><span class="line">    assert(c / a == b);</span><br><span class="line">    return c;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function div(uint256 a, uint256 b) internal pure returns (uint256) {</span><br><span class="line">    // assert(b &gt; 0); // Solidity automatically throws when dividing by 0</span><br><span class="line">    uint256 c = a / b;</span><br><span class="line">    // assert(a == b * c + a % b); // There is no case in which this doesn't hold</span><br><span class="line">    return c;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function sub(uint256 a, uint256 b) internal pure returns (uint256) {</span><br><span class="line">    assert(b &lt;= a);</span><br><span class="line">    return a - b;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function add(uint256 a, uint256 b) internal pure returns (uint256) {</span><br><span class="line">    uint256 c = a + b;</span><br><span class="line">    assert(c &gt;= a);</span><br><span class="line">    return c;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>é¦–å…ˆæˆ‘ä»¬æœ‰äº† <code>library</code> å…³é”®å­— â€” åº“å’Œ <code>åˆçº¦</code>å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯åˆæœ‰ä¸€äº›ä¸åŒã€‚ å°±æˆ‘ä»¬çš„ç›®çš„è€Œè¨€ï¼Œåº“å…è®¸æˆ‘ä»¬ä½¿ç”¨ <code>using</code> å…³é”®å­—ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨æŠŠåº“çš„æ‰€æœ‰æ–¹æ³•æ·»åŠ ç»™ä¸€ä¸ªæ•°æ®ç±»å‹ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">using SafeMath for uint;</span><br><span class="line">// è¿™ä¸‹æˆ‘ä»¬å¯ä»¥ä¸ºä»»ä½• uint è°ƒç”¨è¿™äº›æ–¹æ³•äº†</span><br><span class="line">uint test = 2;</span><br><span class="line">test = test.mul(3); // test ç­‰äº 6 äº†</span><br><span class="line">test = test.add(5); // test ç­‰äº 11 äº†</span><br></pre></td></tr></tbody></table></figure>

<p>æ³¨æ„ <code>mul</code> å’Œ <code>add</code> å…¶å®éƒ½éœ€è¦ä¸¤ä¸ªå‚æ•°ã€‚ åœ¨æˆ‘ä»¬å£°æ˜äº† <code>using SafeMath for uint</code> åï¼Œæˆ‘ä»¬ç”¨æ¥è°ƒç”¨è¿™äº›æ–¹æ³•çš„ <code>uint</code> å°±è‡ªåŠ¨è¢«ä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ é€’è¿›å»äº†(åœ¨æ­¤ä¾‹ä¸­å°±æ˜¯ <code>test</code>)</p>
<p>æˆ‘ä»¬æ¥çœ‹çœ‹ <code>add</code> çš„æºä»£ç çœ‹ SafeMath åšäº†ä»€ä¹ˆ:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) {</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>åŸºæœ¬ä¸Š <code>add</code> åªæ˜¯åƒ <code>+</code> ä¸€æ ·å¯¹ä¸¤ä¸ª <code>uint</code> ç›¸åŠ ï¼Œ ä½†æ˜¯<u><strong>å®ƒç”¨ä¸€ä¸ª <code>assert</code> è¯­å¥æ¥ç¡®ä¿ç»“æœå¤§äº <code>a</code>ã€‚è¿™æ ·å°±é˜²æ­¢äº†æº¢å‡ºã€‚</strong></u></p>
<p><code>assert</code> å’Œ <code>require</code> ç›¸ä¼¼ï¼Œè‹¥ç»“æœä¸ºå¦å®ƒå°±ä¼šæŠ›å‡ºé”™è¯¯ã€‚ <code>assert</code> å’Œ <code>require</code> åŒºåˆ«åœ¨äºï¼Œ<u><strong><code>require</code> è‹¥å¤±è´¥åˆ™ä¼šè¿”è¿˜ç»™ç”¨æˆ·å‰©ä¸‹çš„ gasï¼Œ <code>assert</code> åˆ™ä¸ä¼š</strong></u>ã€‚æ‰€ä»¥å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œä½ å†™ä»£ç çš„æ—¶å€™ä¼šæ¯”è¾ƒå–œæ¬¢ <code>require</code>ï¼Œ<code>assert</code> åªåœ¨ä»£ç å¯èƒ½å‡ºç°ä¸¥é‡é”™è¯¯çš„æ—¶å€™ä½¿ç”¨ï¼Œæ¯”å¦‚ <code>uint</code> æº¢å‡ºã€‚</p>
<p>æ‰€ä»¥ç®€è€Œè¨€ä¹‹ï¼Œ SafeMath çš„ <code>add</code>ï¼Œ <code>sub</code>ï¼Œ <code>mul</code>ï¼Œ å’Œ <code>div</code> æ–¹æ³•åªåšç®€å•çš„å››åˆ™è¿ç®—ï¼Œç„¶ååœ¨å‘ç”Ÿæº¢å‡ºæˆ–ä¸‹æº¢çš„æ—¶å€™æŠ›å‡ºé”™è¯¯ã€‚</p>
<p><strong>åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œä½¿ç”¨ SafeMath</strong></p>
<p>ä¸ºäº†é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æˆ‘ä»¬çš„ä»£ç é‡Œæ‰¾ <code>+</code>ï¼Œ <code>-</code>ï¼Œ <code>*</code>ï¼Œ æˆ– <code>/</code>ï¼Œç„¶åæ›¿æ¢ä¸º <code>add</code>, <code>sub</code>, <code>mul</code>, <code>div</code>.</p>
<p>æ¯”å¦‚ï¼Œä¸å…¶è¿™æ ·åš:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myUint++;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬è¿™æ ·åšï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myUint = myUint.add(1);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>åœ¨ <code>ZombieOwnership</code> ä¸­æœ‰ä¸¤ä¸ªåœ°æ–¹ç”¨åˆ°äº†æ•°å­¦è¿ç®—ï¼Œæ¥æ›¿æ¢æˆ SafeMath æ–¹æ³•æŠŠã€‚</p>
<ol>
<li>å°† <code>++</code> æ›¿æ¢æˆ SafeMath æ–¹æ³•ã€‚</li>
<li>å°† <code>--</code> æ›¿æ¢æˆ SafeMath æ–¹æ³•ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">function _transfer(address _from, address _to, uint256 _tokenId) private {</span><br><span class="line">    // 1. æ›¿æ¢æˆ SafeMath çš„ `add`</span><br><span class="line">    //ownerZombieCount[_to]++;</span><br><span class="line">    ownerZombieCount[_to] = ownerZombieCount[_to].add(1);</span><br><span class="line">    // 2. æ›¿æ¢æˆ SafeMath çš„ `sub`</span><br><span class="line">    //ownerZombieCount[_from]--;</span><br><span class="line">    ownerZombieCount[_from] = ownerZombieCount[_from].sub(1);</span><br><span class="line">    zombieToOwner[_tokenId] = _to;</span><br><span class="line">    Transfer(_from, _to, _tokenId);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬11ç« -SafeMath-ç¬¬ä¸‰éƒ¨åˆ†"><a href="#ç¬¬11ç« -SafeMath-ç¬¬ä¸‰éƒ¨åˆ†" class="headerlink" title="ç¬¬11ç« : SafeMath ç¬¬ä¸‰éƒ¨åˆ†"></a>ç¬¬11ç« : SafeMath ç¬¬ä¸‰éƒ¨åˆ†</h3><p>å¤ªå¥½äº†ï¼Œè¿™ä¸‹æˆ‘ä»¬çš„ ERC721 å®ç°ä¸ä¼šæœ‰æº¢å‡ºæˆ–è€…ä¸‹æº¢äº†ã€‚</p>
<p>å›å¤´çœ‹çœ‹æˆ‘ä»¬åœ¨ä¹‹å‰è¯¾ç¨‹å†™çš„ä»£ç ï¼Œè¿˜æœ‰å…¶ä»–å‡ ä¸ªåœ°æ–¹ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´æº¢å‡ºæˆ–ä¸‹æº¢ã€‚</p>
<p>æ¯”å¦‚ï¼Œ åœ¨ ZombieAttack é‡Œé¢æˆ‘ä»¬æœ‰ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">myZombie.winCount++;</span><br><span class="line">myZombie.level++;</span><br><span class="line">enemyZombie.lossCount++;</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬åŒæ ·åº”è¯¥åœ¨è¿™äº›åœ°æ–¹é˜²æ­¢æº¢å‡ºã€‚ï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼Œæ€»æ˜¯ä½¿ç”¨ SafeMath è€Œä¸æ˜¯æ™®é€šæ•°å­¦è¿ç®—æ˜¯ä¸ªå¥½ä¸»æ„ï¼Œä¹Ÿè®¸åœ¨ä»¥å Solidity çš„æ–°ç‰ˆæœ¬é‡Œè¿™ç‚¹ä¼šè¢«é»˜è®¤å®ç°ï¼Œä½†æ˜¯ç°åœ¨æˆ‘ä»¬å¾—è‡ªå·±åœ¨ä»£ç é‡Œå®ç°è¿™äº›é¢å¤–çš„å®‰å…¨æªæ–½ï¼‰ã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬é‡åˆ°ä¸ªå°é—®é¢˜ â€” <code>winCount</code> å’Œ <code>lossCount</code> æ˜¯ <code>uint16</code>ï¼Œ è€Œ <code>level</code> æ˜¯ <code>uint32</code>ã€‚ æ‰€ä»¥å¦‚æœæˆ‘ä»¬ç”¨è¿™äº›ä½œä¸ºå‚æ•°ä¼ å…¥ SafeMath çš„ <code>add</code> æ–¹æ³•ã€‚ å®ƒå®é™…ä¸Šå¹¶ä¸ä¼šé˜²æ­¢æº¢å‡ºï¼Œå› ä¸ºå®ƒä¼šæŠŠè¿™äº›å˜é‡éƒ½è½¬æ¢æˆ <code>uint256</code>:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">function add(uint256 a, uint256 b) internal pure returns (uint256) {</span><br><span class="line">  uint256 c = a + b;</span><br><span class="line">  assert(c &gt;= a);</span><br><span class="line">  return c;</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line">// å¦‚æœæˆ‘ä»¬åœ¨`uint8` ä¸Šè°ƒç”¨ `.add`ã€‚å®ƒå°†ä¼šè¢«è½¬æ¢æˆ `uint256`.</span><br><span class="line">// æ‰€ä»¥å®ƒä¸ä¼šåœ¨ 2^8 æ—¶æº¢å‡ºï¼Œå› ä¸º 256 æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ `uint256`.</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬éœ€è¦å†å®ç°ä¸¤ä¸ªåº“æ¥é˜²æ­¢ <code>uint16</code> å’Œ <code>uint32</code> æº¢å‡ºæˆ–ä¸‹æº¢ã€‚æˆ‘ä»¬å¯ä»¥å°†å…¶å‘½åä¸º <code>SafeMath16</code> å’Œ <code>SafeMath32</code>ã€‚</p>
<p>ä»£ç å°†å’Œ SafeMath å®Œå…¨ç›¸åŒï¼Œé™¤äº†æ‰€æœ‰çš„ <code>uint256</code> å®ä¾‹éƒ½å°†è¢«æ›¿æ¢æˆ <code>uint32</code> æˆ– <code>uint16</code>ã€‚</p>
<p>æˆ‘ä»¬å·²ç»å°†è¿™äº›ä»£ç å¸®ä½ å†™å¥½äº†ï¼Œæ‰“å¼€ <code>safemath.sol</code> åˆçº¦çœ‹çœ‹ä»£ç å§ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬éœ€è¦åœ¨ ZombieFactory é‡Œä½¿ç”¨å®ƒä»¬ã€‚</p>
<p><strong>Putting it to the Test</strong></p>
<p>åˆ†é…ï¼š</p>
<ol>
<li>å£°æ˜æˆ‘ä»¬å°†ä¸º <code>uint32</code> ä½¿ç”¨<code>SafeMath32</code>ã€‚</li>
<li>å£°æ˜æˆ‘ä»¬å°†ä¸º <code>uint16</code> ä½¿ç”¨<code>SafeMath16</code>ã€‚</li>
<li>åœ¨ ZombieFactory é‡Œè¿˜æœ‰ä¸€å¤„æˆ‘ä»¬ä¹Ÿåº”è¯¥ä½¿ç”¨ SafeMath çš„æ–¹æ³•ï¼Œ æˆ‘ä»¬å·²ç»åœ¨é‚£é‡Œç•™äº†æ³¨é‡Šæé†’ä½ ã€‚</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">contract ZombieFactory is Ownable {</span><br><span class="line"></span><br><span class="line">  using SafeMath for uint256;</span><br><span class="line">  // 1. ä¸º uint32 å£°æ˜ ä½¿ç”¨ SafeMath32</span><br><span class="line">  // 2. ä¸º uint16 å£°æ˜ ä½¿ç”¨ SafeMath16</span><br><span class="line">  using SafeMath32 for uint32;</span><br><span class="line">  using SafeMath16 for uint16;</span><br><span class="line">  â€¦â€¦â€¦â€¦â€¦â€¦</span><br><span class="line">  function _createZombie(string _name, uint _dna) internal {</span><br><span class="line">    // æ³¨æ„: æˆ‘ä»¬é€‰æ‹©ä¸å¤„ç†2038å¹´é—®é¢˜ï¼Œæ‰€ä»¥ä¸ç”¨æ‹…å¿ƒ readyTime çš„æº¢å‡º</span><br><span class="line">    // åæ­£åœ¨2038å¹´æˆ‘ä»¬çš„APPæ—©å®Œè›‹äº†</span><br><span class="line">    uint id = zombies.push(Zombie(_name, _dna, 1, uint32(now + cooldownTime), 0, 0)) - 1;</span><br><span class="line">    zombieToOwner[id] = msg.sender;</span><br><span class="line">    // 3. åœ¨è¿™é‡Œä½¿ç”¨ SafeMath çš„ `add` æ–¹æ³•:</span><br><span class="line">    //ownerZombieCount[msg.sender]++;</span><br><span class="line">    ownerZombieCount[msg.sender] = ownerZombieCount[msg.sender].add(1);</span><br><span class="line">    NewZombie(id, _name, _dna);</span><br><span class="line">  }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬12ç« -SafeMath-ç¬¬4éƒ¨åˆ†"><a href="#ç¬¬12ç« -SafeMath-ç¬¬4éƒ¨åˆ†" class="headerlink" title="ç¬¬12ç« : SafeMath ç¬¬4éƒ¨åˆ†"></a>ç¬¬12ç« : SafeMath ç¬¬4éƒ¨åˆ†</h3><p>çœŸæ£’ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»ä¸ºæˆ‘ä»¬çš„ DApp é‡Œé¢ç”¨åˆ°çš„ <code>uint</code> æ•°æ®ç±»å‹éƒ½å®ç°äº† SafeMath äº†ã€‚</p>
<p>è®©æˆ‘ä»¬æŠŠ <code>ZombieAttack</code> é‡Œæ‰€æœ‰æ½œåœ¨çš„é—®é¢˜éƒ½ä¿®å¤äº†å§ã€‚ ï¼ˆå…¶å®åœ¨ <code>ZombieHelper</code> é‡Œä¹Ÿæœ‰ä¸€å¤„ <code>zombies[_zombieId].level++;</code> éœ€è¦ä¿®å¤ï¼Œä¸è¿‡æˆ‘ä»¬å·²ç»å¸®ä½ åšå¥½äº†ï¼Œè¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨å†æ¥ä¸€ç« äº† ğŸ˜‰ï¼‰ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æ”¾å¿ƒå¤§èƒ†å»å¯¹ <code>ZombieAttack</code> é‡Œæ‰€æœ‰çš„ <code>++</code> æ“ä½œéƒ½ä½¿ç”¨ SafeMath æ–¹æ³•å§ã€‚ä¸ºäº†æ–¹ä¾¿ä½ æ‰¾ï¼Œæˆ‘ä»¬å·²ç»åœ¨ç›¸åº”çš„åœ°æ–¹ç•™äº†æ³¨é‡Šç»™ä½ ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import "./zombiehelper.sol";</span><br><span class="line"></span><br><span class="line">contract ZombieBattle is ZombieHelper {</span><br><span class="line">  uint randNonce = 0;</span><br><span class="line">  uint attackVictoryProbability = 70;</span><br><span class="line"></span><br><span class="line">  function randMod(uint _modulus) internal returns(uint) {</span><br><span class="line">    // è¿™å„¿æœ‰ä¸€ä¸ª</span><br><span class="line">    //randNonce++;</span><br><span class="line">    randNonce = randNonce.add(1);</span><br><span class="line">    return uint(keccak256(now, msg.sender, randNonce)) % _modulus;</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  function attack(uint _zombieId, uint _targetId) external onlyOwnerOf(_zombieId) {</span><br><span class="line">    Zombie storage myZombie = zombies[_zombieId];</span><br><span class="line">    Zombie storage enemyZombie = zombies[_targetId];</span><br><span class="line">    uint rand = randMod(100);</span><br><span class="line">    if (rand &lt;= attackVictoryProbability) {</span><br><span class="line">      // è¿™é‡Œæœ‰ä¸‰ä¸ª</span><br><span class="line">      //myZombie.winCount++;</span><br><span class="line">      myZombie.winCount = myZombie.winCount.add(1);</span><br><span class="line">      //myZombie.level++;</span><br><span class="line">      myZombie.level = myZombie.level.add(1);</span><br><span class="line">      //enemyZombie.lossCount++;</span><br><span class="line">      enemyZombie.lossCount = enemyZombie.lossCount.add(1);</span><br><span class="line">      feedAndMultiply(_zombieId, enemyZombie.dna, "zombie");</span><br><span class="line">    } else {</span><br><span class="line">      // è¿™å„¿è¿˜æœ‰ä¿©å“¦</span><br><span class="line">      //myZombie.lossCount++;</span><br><span class="line">        myZombie.lossCount = myZombie.lossCount.add(1);</span><br><span class="line">      //enemyZombie.winCount++;</span><br><span class="line">        enemyZombie.winCount = enemyZombie.winCount.add(1);</span><br><span class="line">      _triggerCooldown(myZombie);</span><br><span class="line">    }</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬13ç« -æ³¨é‡Š"><a href="#ç¬¬13ç« -æ³¨é‡Š" class="headerlink" title="ç¬¬13ç« : æ³¨é‡Š"></a>ç¬¬13ç« : æ³¨é‡Š</h3><p>åƒµå°¸æ¸¸æˆçš„ Solidity ä»£ç ç»ˆäºå®Œæˆå•¦ã€‚</p>
<p>åœ¨ä»¥åçš„è¯¾ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠï¼Œä»¥åŠå¦‚ä½•å’Œ Web3.js äº¤äº’ã€‚</p>
<p>ä¸è¿‡åœ¨ä½ ç¦»å¼€ç¬¬äº”è¯¾ä¹‹å‰ï¼Œæˆ‘ä»¬æ¥è°ˆè°ˆå¦‚ä½• <strong>ç»™ä½ çš„ä»£ç æ·»åŠ æ³¨é‡Š</strong>.</p>
<p><strong>æ³¨é‡Šè¯­æ³•</strong></p>
<p>Solidity é‡Œçš„æ³¨é‡Šå’Œ JavaScript ç›¸åŒã€‚åœ¨æˆ‘ä»¬çš„è¯¾ç¨‹ä¸­ä½ å·²ç»çœ‹åˆ°äº†ä¸å°‘å•è¡Œæ³¨é‡Šäº†ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">// è¿™æ˜¯ä¸€ä¸ªå•è¡Œæ³¨é‡Šï¼Œå¯ä»¥ç†è§£ä¸ºç»™è‡ªå·±æˆ–è€…åˆ«äººçœ‹çš„ç¬”è®°</span><br></pre></td></tr></tbody></table></figure>

<p>åªè¦åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ ä¸€ä¸ª <code>//</code> å°±æ„å‘³ç€ä½ åœ¨æ³¨é‡Šã€‚å¦‚æ­¤ç®€å•æ‰€ä»¥ä½ åº”è¯¥ç»å¸¸è¿™ä¹ˆåšã€‚</p>
<p>ä¸è¿‡æˆ‘ä»¬ä¹ŸçŸ¥é“ä½ çš„æƒ³æ³•ï¼šæœ‰æ—¶å€™å•è¡Œæ³¨é‡Šæ˜¯ä¸å¤Ÿçš„ã€‚æ¯•ç«Ÿä½ ç”Ÿæ¥è¯ç—¨ã€‚</p>
<p>æ‰€ä»¥æˆ‘ä»¬æœ‰äº†å¤šè¡Œæ³¨é‡Šï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">contract CryptoZombies {</span><br><span class="line">  /* è¿™æ˜¯ä¸€ä¸ªå¤šè¡Œæ³¨é‡Šã€‚æˆ‘æƒ³å¯¹æ‰€æœ‰èŠ±æ—¶é—´æ¥å°è¯•è¿™ä¸ªç¼–ç¨‹è¯¾ç¨‹çš„äººè¯´å£°è°¢è°¢ã€‚</span><br><span class="line">  å®ƒæ˜¯å…è´¹çš„ï¼Œå¹¶å°†æ°¸è¿œå…è´¹ã€‚ä½†æ˜¯æˆ‘ä»¬ä¾ç„¶å€¾æ³¨äº†æˆ‘ä»¬çš„å¿ƒè¡€æ¥è®©å®ƒå˜å¾—æ›´å¥½ã€‚</span><br><span class="line"></span><br><span class="line">   è¦çŸ¥é“è¿™ä¾ç„¶åªæ˜¯åŒºå—é“¾å¼€å‘çš„å¼€å§‹è€Œå·²ï¼Œè™½ç„¶æˆ‘ä»¬å·²ç»èµ°äº†å¾ˆè¿œï¼Œ</span><br><span class="line">   ä»ç„¶æœ‰å¾ˆå¤šç§æ–¹å¼æ¥è®©æˆ‘ä»¬çš„ç¤¾åŒºå˜å¾—æ›´å¥½ã€‚</span><br><span class="line">   å¦‚æœæˆ‘ä»¬åœ¨å“ªä¸ªåœ°æ–¹å‡ºäº†é”™ï¼Œæ¬¢è¿åœ¨æˆ‘ä»¬çš„ github æäº¤ PR æˆ–è€… issue æ¥å¸®åŠ©æˆ‘ä»¬æ”¹è¿›ï¼š</span><br><span class="line">    https://github.com/loomnetwork/cryptozombie-lessons</span><br><span class="line"></span><br><span class="line">    æˆ–è€…ï¼Œå¦‚æœä½ æœ‰ä»»ä½•çš„æƒ³æ³•ã€å»ºè®®ç”šè‡³ä»…ä»…æƒ³å’Œæˆ‘ä»¬æ‰“å£°æ‹›å‘¼ï¼Œæ¬¢è¿æ¥æˆ‘ä»¬çš„ç”µæŠ¥ç¾¤ï¼š</span><br><span class="line">     https://t.me/loomnetworkdev</span><br><span class="line">  */</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>ç‰¹åˆ«æ˜¯ï¼Œæœ€å¥½ä¸ºä½ åˆçº¦ä¸­æ¯ä¸ªæ–¹æ³•æ·»åŠ æ³¨é‡Šæ¥è§£é‡Šå®ƒçš„é¢„æœŸè¡Œä¸ºã€‚è¿™æ ·å…¶ä»–å¼€å‘è€…ï¼ˆæˆ–è€…ä½ è‡ªå·±ï¼Œåœ¨6ä¸ªæœˆä»¥åå†å›åˆ°è¿™ä¸ªé¡¹ç›®ä¸­ï¼‰å¯ä»¥å¾ˆå¿«åœ°ç†è§£ä½ çš„ä»£ç è€Œä¸éœ€è¦é€è¡Œé˜…è¯»æ‰€æœ‰ä»£ç ã€‚</p>
<p>Solidity ç¤¾åŒºæ‰€ä½¿ç”¨çš„ä¸€ä¸ªæ ‡å‡†æ˜¯ä½¿ç”¨ä¸€ç§è¢«ç§°ä½œ *<strong>natspec*</strong> çš„æ ¼å¼ï¼Œçœ‹èµ·æ¥åƒè¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/// @title ä¸€ä¸ªç®€å•çš„åŸºç¡€è¿ç®—åˆçº¦</span><br><span class="line">/// @author H4XF13LD MORRIS ğŸ’¯ğŸ’¯ğŸ˜ğŸ’¯ğŸ’¯</span><br><span class="line">/// @notice ç°åœ¨ï¼Œè¿™ä¸ªåˆçº¦åªæ·»åŠ ä¸€ä¸ªä¹˜æ³•</span><br><span class="line">contract Math {</span><br><span class="line">  /// @notice ä¸¤ä¸ªæ•°ç›¸ä¹˜</span><br><span class="line">  /// @param x ç¬¬ä¸€ä¸ª uint</span><br><span class="line">  /// @param y  ç¬¬äºŒä¸ª uint</span><br><span class="line">  /// @return z  (x * y) çš„ç»“æœ</span><br><span class="line">  /// @dev ç°åœ¨è¿™ä¸ªæ–¹æ³•ä¸æ£€æŸ¥æº¢å‡º</span><br><span class="line">  function multiply(uint x, uint y) returns (uint z) {</span><br><span class="line">    // è¿™åªæ˜¯ä¸ªæ™®é€šçš„æ³¨é‡Šï¼Œä¸ä¼šè¢« natspec è§£é‡Š</span><br><span class="line">    z = x * y;</span><br><span class="line">  }</span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p><code>@title</code>ï¼ˆæ ‡é¢˜ï¼‰ å’Œ <code>@author</code> ï¼ˆä½œè€…ï¼‰å¾ˆç›´æ¥äº†.</p>
<p><code>@notice</code> ï¼ˆé¡»çŸ¥ï¼‰å‘ <strong>ç”¨æˆ·</strong> è§£é‡Šè¿™ä¸ªæ–¹æ³•æˆ–è€…åˆçº¦æ˜¯åšä»€ä¹ˆçš„ã€‚ <code>@dev</code> ï¼ˆå¼€å‘è€…ï¼‰ æ˜¯å‘å¼€å‘è€…è§£é‡Šæ›´å¤šçš„ç»†èŠ‚ã€‚</p>
<p><code>@param</code> ï¼ˆå‚æ•°ï¼‰å’Œ <code>@return</code> ï¼ˆè¿”å›ï¼‰ ç”¨æ¥æè¿°è¿™ä¸ªæ–¹æ³•éœ€è¦ä¼ å…¥ä»€ä¹ˆå‚æ•°ä»¥åŠè¿”å›ä»€ä¹ˆå€¼ã€‚</p>
<p>æ³¨æ„ä½ å¹¶ä¸éœ€è¦æ¯æ¬¡éƒ½ç”¨ä¸Šæ‰€æœ‰çš„æ ‡ç­¾ï¼Œå®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚ä¸è¿‡æœ€å°‘ï¼Œå†™ä¸‹ä¸€ä¸ª <code>@dev</code> æ³¨é‡Šæ¥è§£é‡Šæ¯ä¸ªæ–¹æ³•æ˜¯åšä»€ä¹ˆçš„ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>å¦‚æœä½ è¿˜æ²¡æ³¨æ„åˆ°ï¼šCryptoZombies çš„ç­”æ¡ˆæ£€æŸ¥å™¨åœ¨å·¥ä½œçš„æ—¶å€™å°†å¿½ç•¥æ‰€æœ‰çš„æ³¨é‡Šã€‚æ‰€ä»¥è¿™ä¸€ç« æˆ‘ä»¬å…¶å®æ— æ³•æ£€æŸ¥ä½ çš„ natspec æ³¨é‡Šäº†ã€‚å…¨é ä½ è‡ªå·±å’¯ã€‚</p>
<p>è¯è¯´å›æ¥ï¼Œåˆ°ç°åœ¨ä½ åº”è¯¥å·²ç»æ˜¯ä¸€ä¸ª Solidity å°èƒ½æ‰‹äº†ã€‚æˆ‘ä»¬å°±å‡å®šä½ å·²ç»å­¦ä¼šè¿™äº›äº†ã€‚</p>
<p>å¤§èƒ†å»åšäº›å°è¯•æŠŠï¼Œç»™ <code>ZombieOwnership</code> åŠ ä¸Šä¸€äº› natspec æ ‡ç­¾:</p>
<ol>
<li><code>@title</code> â€” ä¾‹å¦‚ï¼šä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</li>
<li><code>@author</code> â€” ä½ çš„åå­—</li>
<li><code>@dev</code> â€” ä¾‹å¦‚ï¼šç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</li>
</ol>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">pragma solidity ^0.4.19;</span><br><span class="line"></span><br><span class="line">import "./zombieattack.sol";</span><br><span class="line">import "./erc721.sol";</span><br><span class="line">import "./safemath.sol";</span><br><span class="line"></span><br><span class="line">/// TODO: æŠŠè¿™é‡Œå˜æˆ natspec æ ‡å‡†çš„æ³¨é‡ŠæŠŠ</span><br><span class="line">/// @title ä¸€ä¸ªç®¡ç†è½¬ç§»åƒµå°¸æ‰€æœ‰æƒçš„åˆçº¦</span><br><span class="line">/// @author 0xMx1@0</span><br><span class="line">/// @dev ç¬¦åˆ OpenZeppelin å¯¹ ERC721 æ ‡å‡†è‰æ¡ˆçš„å®ç°</span><br></pre></td></tr></tbody></table></figure>

<h4 id="æ€»ç»“ä¸€ä¸‹"><a href="#æ€»ç»“ä¸€ä¸‹" class="headerlink" title="æ€»ç»“ä¸€ä¸‹"></a>æ€»ç»“ä¸€ä¸‹</h4><p>è¿™èŠ‚è¯¾é‡Œé¢æˆ‘ä»¬å­¦åˆ°äº†</p>
<ul>
<li>ä»£å¸, ERC721 æ ‡å‡†ï¼Œä»¥åŠå¯äº¤æ˜“çš„ç‰©ä»¶/åƒµå°¸</li>
<li>åº“ä»¥åŠå¦‚ä½•ä½¿ç”¨åº“</li>
<li>å¦‚ä½•åˆ©ç”¨ SafeMath æ¥é˜²æ­¢æº¢å‡ºå’Œä¸‹æº¢</li>
<li>ä»£ç æ³¨é‡Šå’Œ natspec æ ‡å‡†</li>
</ul>
<p>åœ¨æ¥ä¸‹æ¥çš„ä¸¤èŠ‚è¯¾ä¸­ï¼Œæˆ‘ä»¬å°†å­¦ä¹ å¦‚ä½•å°†æ¸¸æˆéƒ¨ç½²åˆ°ä»¥å¤ªåŠä»¥åŠå’Œ *<strong>web3.js*</strong> äº¤äº’ ï¼ˆè¿™æ ·ä½ å°±èƒ½ä¸ºä½ çš„ DApp æ‰“é€ ä¸€ä¸ªç•Œé¢äº† ï¼‰ã€‚</p>
<h2 id="lesson6-åº”ç”¨å‰ç«¯å’Œ-Web3-js"><a href="#lesson6-åº”ç”¨å‰ç«¯å’Œ-Web3-js" class="headerlink" title="lesson6 åº”ç”¨å‰ç«¯å’Œ Web3.js"></a>lesson6 åº”ç”¨å‰ç«¯å’Œ Web3.js</h2><h3 id="ç¬¬1ç« -ä»‹ç»-Web3-js"><a href="#ç¬¬1ç« -ä»‹ç»-Web3-js" class="headerlink" title="ç¬¬1ç« : ä»‹ç» Web3.js"></a>ç¬¬1ç« : ä»‹ç» Web3.js</h3><p>å®Œæˆç¬¬äº”è¯¾ä»¥åï¼Œæˆ‘ä»¬çš„åƒµå°¸ DApp çš„ Solidity åˆçº¦éƒ¨åˆ†å°±å®Œæˆäº†ã€‚ç°åœ¨æˆ‘ä»¬æ¥åšä¸€ä¸ªåŸºæœ¬çš„ç½‘é¡µå¥½è®©ä½ çš„ç”¨æˆ·èƒ½ç©å®ƒã€‚ è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥å¤ªåŠåŸºé‡‘å‘å¸ƒçš„ JavaScript åº“ â€”â€” *<strong>Web3.js*</strong>.</p>
<p><strong>ä»€ä¹ˆæ˜¯ Web3.js?</strong></p>
<p>è¿˜è®°å¾—ä¹ˆï¼Ÿä»¥å¤ªåŠç½‘ç»œæ˜¯ç”±èŠ‚ç‚¹ç»„æˆçš„ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½åŒ…å«äº†åŒºå—é“¾çš„ä¸€ä»½æ‹·è´ã€‚å½“ä½ æƒ³è¦è°ƒç”¨ä¸€ä»½æ™ºèƒ½åˆçº¦çš„ä¸€ä¸ªæ–¹æ³•ï¼Œä½ éœ€è¦ä»å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹ä¸­æŸ¥æ‰¾å¹¶å‘Šè¯‰å®ƒ:</p>
<ol>
<li>æ™ºèƒ½åˆçº¦çš„åœ°å€</li>
<li>ä½ æƒ³è°ƒç”¨çš„æ–¹æ³•ï¼Œä»¥åŠ</li>
<li>ä½ æƒ³ä¼ å…¥é‚£ä¸ªæ–¹æ³•çš„å‚æ•°</li>
</ol>
<p>ä»¥å¤ªåŠèŠ‚ç‚¹åªèƒ½è¯†åˆ«ä¸€ç§å«åš <u>*<strong>JSON-RPC*</strong></u> çš„è¯­è¨€ã€‚è¿™ç§è¯­è¨€ç›´æ¥è¯»èµ·æ¥å¹¶ä¸å¥½æ‡‚ã€‚å½“ä½ ä½ æƒ³è°ƒç”¨ä¸€ä¸ªåˆçº¦çš„æ–¹æ³•çš„æ—¶å€™ï¼Œéœ€è¦å‘é€çš„æŸ¥è¯¢è¯­å¥å°†ä¼šæ˜¯è¿™æ ·çš„ï¼š</p>
<figure class="highlight json"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å“ˆâ€¦â€¦ç¥ä½ å†™æ‰€æœ‰è¿™æ ·çš„å‡½æ•°è°ƒç”¨çš„æ—¶å€™éƒ½ä¸€æ¬¡é€šè¿‡</span></span><br><span class="line"><span class="comment">// å¾€å³è¾¹æ‹‰â€¦â€¦ ==&gt;</span></span><br><span class="line"><span class="punctuation">{</span><span class="attr">"jsonrpc"</span><span class="punctuation">:</span><span class="string">"2.0"</span><span class="punctuation">,</span><span class="attr">"method"</span><span class="punctuation">:</span><span class="string">"eth_sendTransaction"</span><span class="punctuation">,</span><span class="attr">"params"</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">{</span><span class="attr">"from"</span><span class="punctuation">:</span><span class="string">"0xb60e8dd61c5d32be8058bb8eb970870f07233155"</span><span class="punctuation">,</span><span class="attr">"to"</span><span class="punctuation">:</span><span class="string">"0xd46e8dd67c5d32be8058bb8eb970870f07244567"</span><span class="punctuation">,</span><span class="attr">"gas"</span><span class="punctuation">:</span><span class="string">"0x76c0"</span><span class="punctuation">,</span><span class="attr">"gasPrice"</span><span class="punctuation">:</span><span class="string">"0x9184e72a000"</span><span class="punctuation">,</span><span class="attr">"value"</span><span class="punctuation">:</span><span class="string">"0x9184e72a"</span><span class="punctuation">,</span><span class="attr">"data"</span><span class="punctuation">:</span><span class="string">"0xd46e8dd67c5d32be8d46e8dd67c5d32be8058bb8eb970870f072445675058bb8eb970870f072445675"</span><span class="punctuation">}</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">"id"</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">}</span></span><br></pre></td></tr></tbody></table></figure>

<p>å¹¸è¿çš„æ˜¯ Web3.js æŠŠè¿™äº›ä»¤äººè®¨åŒçš„æŸ¥è¯¢è¯­å¥éƒ½éšè—èµ·æ¥äº†ï¼Œ æ‰€ä»¥ä½ åªéœ€è¦ä¸æ–¹ä¾¿æ˜“æ‡‚çš„ JavaScript ç•Œé¢è¿›è¡Œäº¤äº’å³å¯ã€‚</p>
<p>ä½ ä¸éœ€è¦æ„å»ºä¸Šé¢çš„æŸ¥è¯¢è¯­å¥ï¼Œåœ¨ä½ çš„ä»£ç ä¸­è°ƒç”¨ä¸€ä¸ªå‡½æ•°çœ‹èµ·æ¥å°†æ˜¯è¿™æ ·ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CryptoZombies.methods.createRandomZombie("Vitalik Nakamoto ğŸ¤”")</span><br><span class="line">  .send({ from: "0xb60e8dd61c5d32be8058bb8eb970870f07233155", gas: "3000000" })</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å°†åœ¨æ¥ä¸‹æ¥çš„å‡ ç« è¯¦ç»†è§£é‡Šè¿™äº›è¯­å¥ï¼Œä¸è¿‡é¦–å…ˆæˆ‘ä»¬æ¥æŠŠ Web3.js ç¯å¢ƒæ­å»ºèµ·æ¥ã€‚</p>
<p><strong>å‡†å¤‡å¥½äº†ä¹ˆï¼Ÿ</strong></p>
<p>å–å†³äºä½ çš„é¡¹ç›®å·¥ä½œæµç¨‹å’Œä½ çš„çˆ±å¥½ï¼Œä½ å¯ä»¥ç”¨ä¸€äº›å¸¸ç”¨å·¥å…·æŠŠ Web3.js æ·»åŠ è¿›æ¥ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">// ç”¨ NPM</span><br><span class="line">npm install web3</span><br><span class="line"></span><br><span class="line">// ç”¨ Yarn</span><br><span class="line">yarn add web3</span><br><span class="line"></span><br><span class="line">// ç”¨ Bower</span><br><span class="line">bower install web3</span><br><span class="line"></span><br><span class="line">// ...æˆ–è€…å…¶ä»–ã€‚</span><br></pre></td></tr></tbody></table></figure>

<p>ç”šè‡³ï¼Œä½ å¯ä»¥ä» <a target="_blank" rel="noopener" href="https://github.com/ethereum/web3.js/blob/1.0/dist/web3.min.js">github</a> ç›´æ¥ä¸‹è½½å‹ç¼©åçš„ <code>.js</code> æ–‡ä»¶ ç„¶ååŒ…å«åˆ°ä½ çš„é¡¹ç›®æ–‡ä»¶ä¸­ï¼š</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=<span class="string">"javascript"</span> type=<span class="string">"text/javascript"</span> src=<span class="string">"web3.min.js"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></tbody></table></figure>

<p>å› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©ä½ èŠ±å¤ªå¤šåœ¨é¡¹ç›®ç¯å¢ƒæ­å»ºä¸Šï¼Œåœ¨æœ¬æ•™ç¨‹ä¸­æˆ‘ä»¬å°†ä½¿ç”¨ä¸Šé¢çš„ <code>script</code> æ ‡ç­¾æ¥å°† Web3.js å¼•å…¥ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬ä¸ºä½ å»ºç«‹äº†ä¸€ä¸ªHTML é¡¹ç›®ç©ºå£³ â€”â€” <code>index.html</code>ã€‚å‡è®¾åœ¨å’Œ <code>index.html</code> åŒä¸ªæ–‡ä»¶å¤¹é‡Œæœ‰ä¸€ä»½ <code>web3.min.js</code></p>
<ol>
<li>ä½¿ç”¨ä¸Šé¢çš„ <code>script</code> æ ‡ç­¾ä»£ç æŠŠ <code>web3.js</code> æ·»åŠ è¿›å»ä»¥å¤‡æ¥ä¸‹æ¥ä½¿ç”¨ã€‚</li>
</ol>
<figure class="highlight javascript"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- Include web3.js here --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬2ç« -Web3-æä¾›è€…"><a href="#ç¬¬2ç« -Web3-æä¾›è€…" class="headerlink" title="ç¬¬2ç« : Web3 æä¾›è€…"></a>ç¬¬2ç« : Web3 æä¾›è€…</h3><p>å¤ªæ£’äº†ã€‚ç°åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ‰äº†Web3.js, æ¥åˆå§‹åŒ–å®ƒç„¶åå’ŒåŒºå—é“¾å¯¹è¯å§ã€‚</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ *<strong>Web3 Provider*</strong>.</p>
<p>è¦è®°ä½ï¼Œä»¥å¤ªåŠæ˜¯ç”±å…±äº«åŒä¸€ä»½æ•°æ®çš„ç›¸åŒæ‹·è´çš„ <strong><em>èŠ‚ç‚¹</em></strong> æ„æˆçš„ã€‚ åœ¨ Web3.js é‡Œè®¾ç½® Web3 çš„ <code>Provider</code>ï¼ˆæä¾›è€…ï¼‰ å‘Šè¯‰æˆ‘ä»¬çš„ä»£ç åº”è¯¥å’Œ <strong>å“ªä¸ªèŠ‚ç‚¹</strong> äº¤äº’æ¥å¤„ç†æˆ‘ä»¬çš„è¯»å†™ã€‚è¿™å°±å¥½åƒåœ¨ä¼ ç»Ÿçš„ Web åº”ç”¨ç¨‹åºä¸­ä¸ºä½ çš„ API è°ƒç”¨è®¾ç½®è¿œç¨‹ Web æœåŠ¡å™¨çš„ç½‘å€ã€‚</p>
<p>ä½ å¯ä»¥è¿è¡Œä½ è‡ªå·±çš„ä»¥å¤ªåŠèŠ‚ç‚¹æ¥ä½œä¸º Providerã€‚ ä¸è¿‡ï¼Œæœ‰ä¸€ä¸ªç¬¬ä¸‰æ–¹çš„æœåŠ¡ï¼Œå¯ä»¥è®©ä½ çš„ç”Ÿæ´»å˜å¾—è½»æ¾ç‚¹ï¼Œè®©ä½ ä¸å¿…ä¸ºäº†ç»™ä½ çš„ç”¨æˆ·æä¾›DAppè€Œç»´æŠ¤ä¸€ä¸ªä»¥å¤ªåŠèŠ‚ç‚¹â€” *<strong>Infura*</strong>.</p>
<p><strong>Infura</strong></p>
<p><a target="_blank" rel="noopener" href="https://infura.io/">Infura</a> æ˜¯ä¸€ä¸ªæœåŠ¡ï¼Œå®ƒç»´æŠ¤äº†å¾ˆå¤šä»¥å¤ªåŠèŠ‚ç‚¹å¹¶æä¾›äº†ä¸€ä¸ªç¼“å­˜å±‚æ¥å®ç°é«˜é€Ÿè¯»å–ã€‚ä½ å¯ä»¥ç”¨ä»–ä»¬çš„ API æ¥å…è´¹è®¿é—®è¿™ä¸ªæœåŠ¡ã€‚ ç”¨ Infura ä½œä¸ºèŠ‚ç‚¹æä¾›è€…ï¼Œä½ å¯ä»¥ä¸ç”¨è‡ªå·±è¿è¥èŠ‚ç‚¹å°±èƒ½å¾ˆå¯é åœ°å‘ä»¥å¤ªåŠå‘é€ã€æ¥æ”¶ä¿¡æ¯ã€‚</p>
<p>ä½ å¯ä»¥é€šè¿‡è¿™æ ·æŠŠ Infura ä½œä¸ºä½ çš„ Web3 èŠ‚ç‚¹æä¾›è€…ï¼š</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var web3 = new Web3(new Web3.providers.WebsocketProvider("wss://mainnet.infura.io/ws"));</span><br></pre></td></tr></tbody></table></figure>

<p>ä¸è¿‡ï¼Œå› ä¸ºæˆ‘ä»¬çš„ DApp å°†è¢«å¾ˆå¤šäººä½¿ç”¨ï¼Œè¿™äº›ç”¨æˆ·ä¸å•ä¼šä»åŒºå—é“¾è¯»å–ä¿¡æ¯ï¼Œè¿˜ä¼šå‘åŒºå—é“¾ <strong><em>å†™</em></strong> å…¥ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦ç”¨ä¸€ä¸ªæ–¹æ³•è®©ç”¨æˆ·å¯ä»¥ç”¨ä»–ä»¬çš„ç§é’¥ç»™äº‹åŠ¡ç­¾åã€‚</p>
<blockquote>
<p>æ³¨æ„: ä»¥å¤ªåŠ (ä»¥åŠé€šå¸¸æ„ä¹‰ä¸Šçš„ blockchains )ä½¿ç”¨ä¸€ä¸ªå…¬é’¥/ç§é’¥å¯¹æ¥å¯¹ç»™äº‹åŠ¡åšæ•°å­—ç­¾åã€‚æŠŠå®ƒæƒ³æˆä¸€ä¸ªæ•°å­—ç­¾åçš„å¼‚å¸¸å®‰å…¨çš„å¯†ç ã€‚è¿™æ ·å½“æˆ‘ä¿®æ”¹åŒºå—é“¾ä¸Šçš„æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘å¯ä»¥ç”¨æˆ‘çš„å…¬é’¥æ¥ <strong>è¯æ˜</strong> æˆ‘å°±æ˜¯ç­¾åçš„é‚£ä¸ªã€‚ä½†æ˜¯å› ä¸ºæ²¡äººçŸ¥é“æˆ‘çš„ç§é’¥ï¼Œæ‰€ä»¥æ²¡äººèƒ½ä¼ªé€ æˆ‘çš„äº‹åŠ¡ã€‚</p>
</blockquote>
<p>åŠ å¯†å­¦éå¸¸å¤æ‚ï¼Œæ‰€ä»¥é™¤éä½ æ˜¯ä¸ªä¸“å®¶å¹¶ä¸”çš„ç¡®çŸ¥é“è‡ªå·±åœ¨åšä»€ä¹ˆï¼Œä½ æœ€å¥½ä¸è¦åœ¨ä½ åº”ç”¨çš„å‰ç«¯ä¸­ç®¡ç†ä½ ç”¨æˆ·çš„ç§é’¥ã€‚</p>
<p>ä¸è¿‡å¹¸è¿çš„æ˜¯ï¼Œä½ å¹¶ä¸éœ€è¦ï¼Œå·²ç»æœ‰å¯ä»¥å¸®ä½ å¤„ç†è¿™ä»¶äº‹çš„æœåŠ¡äº†ï¼š *<strong>Metamask*</strong>.</p>
<p><strong>Metamask</strong></p>
<p><a target="_blank" rel="noopener" href="https://metamask.io/">Metamask</a> æ˜¯ Chrome å’Œ Firefox çš„æµè§ˆå™¨æ‰©å±•ï¼Œ å®ƒèƒ½è®©ç”¨æˆ·å®‰å…¨åœ°ç»´æŠ¤ä»–ä»¬çš„ä»¥å¤ªåŠè´¦æˆ·å’Œç§é’¥ï¼Œ å¹¶ç”¨ä»–ä»¬çš„è´¦æˆ·å’Œä½¿ç”¨ Web3.js çš„ç½‘ç«™äº’åŠ¨ï¼ˆå¦‚æœä½ è¿˜æ²¡ç”¨è¿‡å®ƒï¼Œä½ è‚¯å®šä¼šæƒ³å»å®‰è£…çš„â€”â€”è¿™æ ·ä½ çš„æµè§ˆå™¨å°±èƒ½ä½¿ç”¨ Web3.js äº†ï¼Œç„¶åä½ å°±å¯ä»¥å’Œä»»ä½•ä¸ä»¥å¤ªåŠåŒºå—é“¾é€šä¿¡çš„ç½‘ç«™äº¤äº’äº†ï¼‰</p>
<p>ä½œä¸ºå¼€å‘è€…ï¼Œå¦‚æœä½ æƒ³è®©ç”¨æˆ·ä»ä»–ä»¬çš„æµè§ˆå™¨é‡Œé€šè¿‡ç½‘ç«™å’Œä½ çš„DAppäº¤äº’ï¼ˆå°±åƒæˆ‘ä»¬åœ¨ CryptoZombies æ¸¸æˆé‡Œä¸€æ ·ï¼‰ï¼Œä½ è‚¯å®šä¼šæƒ³è¦å…¼å®¹ Metamask çš„ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„</strong>: Metamask é»˜è®¤ä½¿ç”¨ Infura çš„æœåŠ¡å™¨åšä¸º web3 æä¾›è€…ã€‚ å°±åƒæˆ‘ä»¬ä¸Šé¢åšçš„é‚£æ ·ã€‚ä¸è¿‡å®ƒè¿˜ä¸ºç”¨æˆ·æä¾›äº†é€‰æ‹©ä»–ä»¬è‡ªå·± Web3 æä¾›è€…çš„é€‰é¡¹ã€‚æ‰€ä»¥ä½¿ç”¨ Metamask çš„ web3 æä¾›è€…ï¼Œä½ å°±ç»™äº†ç”¨æˆ·é€‰æ‹©æƒï¼Œè€Œè‡ªå·±æ— éœ€æ“å¿ƒè¿™ä¸€å—ã€‚</p>
</blockquote>
<p><strong>ä½¿ç”¨ Metamask çš„ web3 æä¾›è€…</strong></p>
<p>Metamask æŠŠå®ƒçš„ web3 æä¾›è€…æ³¨å…¥åˆ°æµè§ˆå™¨çš„å…¨å±€ JavaScriptå¯¹è±¡<code>web3</code>ä¸­ã€‚æ‰€ä»¥ä½ çš„åº”ç”¨å¯ä»¥æ£€æŸ¥ <code>web3</code> æ˜¯å¦å­˜åœ¨ã€‚è‹¥å­˜åœ¨å°±ä½¿ç”¨ <code>web3.currentProvider</code> ä½œä¸ºå®ƒçš„æä¾›è€…ã€‚</p>
<p>è¿™é‡Œæ˜¯ä¸€äº› Metamask æä¾›çš„ç¤ºä¾‹ä»£ç ï¼Œç”¨æ¥æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å®‰è£…äº†MetaMaskï¼Œå¦‚æœæ²¡æœ‰å®‰è£…å°±å‘Šè¯‰ç”¨æˆ·éœ€è¦å®‰è£…MetaMaskæ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨ã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">window.addEventListener('load', function() {</span><br><span class="line"></span><br><span class="line">  // æ£€æŸ¥web3æ˜¯å¦å·²ç»æ³¨å…¥åˆ°(Mist/MetaMask)</span><br><span class="line">  if (typeof web3 !== 'undefined') {</span><br><span class="line">    // ä½¿ç”¨ Mist/MetaMask çš„æä¾›è€…</span><br><span class="line">    web3js = new Web3(web3.currentProvider);</span><br><span class="line">  } else {</span><br><span class="line">    // å¤„ç†ç”¨æˆ·æ²¡å®‰è£…çš„æƒ…å†µï¼Œ æ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯</span><br><span class="line">    // å‘Šè¯‰ä»–ä»¬è¦å®‰è£… MetaMask æ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨</span><br><span class="line">  }</span><br><span class="line"></span><br><span class="line">  // ç°åœ¨ä½ å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨å¹¶è‡ªç”±è®¿é—® Web3.js:</span><br><span class="line">  startApp()</span><br><span class="line"></span><br><span class="line">})</span><br></pre></td></tr></tbody></table></figure>

<p>ä½ å¯ä»¥åœ¨ä½ æ‰€æœ‰çš„åº”ç”¨ä¸­ä½¿ç”¨è¿™æ®µæ ·æ¿ä»£ç ï¼Œå¥½æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å®‰è£…ä»¥åŠå‘Šè¯‰ç”¨æˆ·å®‰è£… MetaMaskã€‚</p>
<blockquote>
<p>æ³¨æ„: é™¤äº†MetaMaskï¼Œä½ çš„ç”¨æˆ·ä¹Ÿå¯èƒ½åœ¨ä½¿ç”¨å…¶ä»–ä»–çš„ç§é’¥ç®¡ç†åº”ç”¨ï¼Œæ¯”å¦‚ <strong>Mist</strong> æµè§ˆå™¨ã€‚ä¸è¿‡ï¼Œå®ƒä»¬éƒ½å®ç°äº†ç›¸åŒçš„æ¨¡å¼æ¥æ³¨å…¥ <code>web3</code> å˜é‡ã€‚æ‰€ä»¥æˆ‘è¿™é‡Œæè¿°çš„æ–¹æ³•å¯¹ä¸¤è€…æ˜¯é€šç”¨çš„ã€‚</p>
</blockquote>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬åœ¨HTMLæ–‡ä»¶ä¸­çš„ <code>&lt;/body&gt;</code> æ ‡ç­¾å‰é¢æ”¾ç½®äº†ä¸€ä¸ªç©ºçš„ <code>script</code> æ ‡ç­¾ã€‚å¯ä»¥æŠŠè¿™èŠ‚è¯¾çš„ JavaScript ä»£ç å†™åœ¨é‡Œé¢ã€‚</p>
<ol>
<li>æŠŠä¸Šé¢ç”¨æ¥æ£€æµ‹ MetaMask æ˜¯å¦å®‰è£…çš„æ¨¡æ¿ä»£ç ç²˜è´´è¿›æ¥ã€‚è¯·ç²˜è´´åˆ°ä»¥ <code>window.addEventListener</code> å¼€å¤´çš„ä»£ç å—ä¸­ã€‚</li>
</ol>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// Start here</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">'load'</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// æ£€æŸ¥web3æ˜¯å¦å·²ç»æ³¨å…¥åˆ°(Mist/MetaMask)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) {</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// ä½¿ç”¨ Mist/MetaMask çš„æä¾›è€…</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        web3js = <span class="keyword">new</span> <span class="title class_">Web3</span>(web3.<span class="property">currentProvider</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      } <span class="keyword">else</span> {</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// å¤„ç†ç”¨æˆ·æ²¡å®‰è£…çš„æƒ…å†µï¼Œ æ¯”å¦‚æ˜¾ç¤ºä¸€ä¸ªæ¶ˆæ¯</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// å‘Šè¯‰ä»–ä»¬è¦å®‰è£… MetaMask æ¥ä½¿ç”¨æˆ‘ä»¬çš„åº”ç”¨</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      }</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// ç°åœ¨ä½ å¯ä»¥å¯åŠ¨ä½ çš„åº”ç”¨å¹¶è‡ªç”±è®¿é—® Web3.js:</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="title function_">startApp</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    })</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬3ç« -å’Œåˆçº¦å¯¹è¯"><a href="#ç¬¬3ç« -å’Œåˆçº¦å¯¹è¯" class="headerlink" title="ç¬¬3ç« : å’Œåˆçº¦å¯¹è¯"></a>ç¬¬3ç« : å’Œåˆçº¦å¯¹è¯</h3><p>ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ç”¨ MetaMask çš„ Web3 æä¾›è€…åˆå§‹åŒ–äº† Web3.jsã€‚æ¥ä¸‹æ¥å°±è®©å®ƒå’Œæˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦å¯¹è¯å§ã€‚</p>
<p>Web3.js éœ€è¦ä¸¤ä¸ªä¸œè¥¿æ¥å’Œä½ çš„åˆçº¦å¯¹è¯: å®ƒçš„ <strong><em>åœ°å€</em></strong> å’Œå®ƒçš„ ***ABI***ã€‚</p>
<p><strong>åˆçº¦åœ°å€</strong></p>
<p>åœ¨ä½ å†™å®Œäº†ä½ çš„æ™ºèƒ½åˆçº¦åï¼Œä½ éœ€è¦ç¼–è¯‘å®ƒå¹¶æŠŠå®ƒéƒ¨ç½²åˆ°ä»¥å¤ªåŠã€‚æˆ‘ä»¬å°†åœ¨<strong>ä¸‹ä¸€è¯¾</strong>ä¸­è¯¦è¿°<strong>éƒ¨ç½²</strong>ï¼Œå› ä¸ºå®ƒå’Œå†™ä»£ç æ˜¯æˆªç„¶ä¸åŒçš„è¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬å†³å®šæ‰“ä¹±é¡ºåºï¼Œå…ˆæ¥è®² Web3.jsã€‚</p>
<p>åœ¨ä½ éƒ¨ç½²æ™ºèƒ½åˆçº¦ä»¥åï¼Œå®ƒå°†è·å¾—ä¸€ä¸ªä»¥å¤ªåŠä¸Šçš„æ°¸ä¹…åœ°å€ã€‚å¦‚æœä½ è¿˜è®°å¾—ç¬¬äºŒè¯¾ï¼ŒCryptoKitties åœ¨ä»¥å¤ªåŠä¸Šçš„åœ°å€æ˜¯ <code>0x06012c8cf97BEaD5deAe237070F9587f8E7A266d</code>ã€‚</p>
<p>ä½ éœ€è¦åœ¨éƒ¨ç½²åå¤åˆ¶è¿™ä¸ªåœ°å€ä»¥æ¥å’Œä½ çš„æ™ºèƒ½åˆçº¦å¯¹è¯ã€‚</p>
<p><strong>åˆçº¦ ABI</strong></p>
<p>å¦ä¸€ä¸ª Web3.js ä¸ºäº†è¦å’Œä½ çš„æ™ºèƒ½åˆçº¦å¯¹è¯è€Œéœ€è¦çš„ä¸œè¥¿æ˜¯ ***ABI***ã€‚</p>
<p>ABI æ„ä¸ºåº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆApplication Binary Interfaceï¼‰ã€‚ åŸºæœ¬ä¸Šï¼Œå®ƒæ˜¯ä»¥ JSON æ ¼å¼è¡¨ç¤ºåˆçº¦çš„æ–¹æ³•ï¼Œå‘Šè¯‰ Web3.js å¦‚ä½•ä»¥åˆåŒç†è§£çš„æ–¹å¼æ ¼å¼åŒ–å‡½æ•°è°ƒç”¨ã€‚</p>
<p>å½“ä½ ç¼–è¯‘ä½ çš„åˆçº¦å‘ä»¥å¤ªåŠéƒ¨ç½²æ—¶(æˆ‘ä»¬å°†åœ¨ç¬¬ä¸ƒè¯¾è¯¦è¿°)ï¼Œ Solidity ç¼–è¯‘å™¨ä¼šç»™ä½  ABIï¼Œæ‰€ä»¥é™¤äº†åˆçº¦åœ°å€ï¼Œä½ è¿˜éœ€è¦æŠŠè¿™ä¸ªä¹Ÿå¤åˆ¶ä¸‹æ¥ã€‚</p>
<p>å› ä¸ºæˆ‘ä»¬è¿™ä¸€è¯¾ä¸ä¼šè®²è¿°éƒ¨ç½²ï¼Œæ‰€ä»¥ç°åœ¨æˆ‘ä»¬å·²ç»å¸®ä½ ç¼–è¯‘äº† ABI å¹¶æ”¾åœ¨äº†åä¸º<code>cryptozombies_abi.js</code>ï¼Œæ–‡ä»¶ä¸­ï¼Œä¿å­˜åœ¨ä¸€ä¸ªåä¸º <code>cryptoZombiesABI</code> çš„å˜é‡ä¸­ã€‚</p>
<p>å¦‚æœæˆ‘ä»¬å°†<code>cryptozombies_abi.js</code> åŒ…å«è¿›æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡é‚£ä¸ªå˜é‡è®¿é—® CryptoZombies ABI ã€‚</p>
<p><strong>å®ä¾‹åŒ– Web3.js</strong></p>
<p>ä¸€æ—¦ä½ æœ‰äº†åˆçº¦çš„åœ°å€å’Œ ABIï¼Œä½ å¯ä»¥åƒè¿™æ ·æ¥å®ä¾‹åŒ– Web3.jsã€‚</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">// å®ä¾‹åŒ– myContract</span><br><span class="line">var myContract = new web3js.eth.Contract(myABI, myContractAddress);</span><br></pre></td></tr></tbody></table></figure>

<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<ol>
<li>åœ¨æ–‡ä»¶çš„ <code>&lt;head&gt;</code> æ ‡ç­¾å—ä¸­ï¼Œç”¨ <code>script</code> æ ‡ç­¾å¼•å…¥<code>cryptozombies_abi.js</code>ï¼Œå¥½æŠŠ ABI çš„å®šä¹‰å¼•å…¥é¡¹ç›®ã€‚</li>
<li>åœ¨ <code>&lt;body&gt;</code> é‡Œçš„ <code>&lt;script&gt;</code> å¼€å¤´ , å®šä¹‰ä¸€ä¸ª<code>var</code>ï¼Œå–å <code>cryptoZombies</code>ï¼Œ ä¸è¿‡ä¸è¦å¯¹å…¶èµ‹å€¼ï¼Œç¨åæˆ‘ä»¬å°†ç”¨è¿™ä¸ªè¿™ä¸ªå˜é‡æ¥å­˜å‚¨æˆ‘ä»¬å®ä¾‹åŒ–åˆçº¦ã€‚</li>
<li>æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º <code>startApp()</code> çš„ <code>function</code>ã€‚ æ¥ä¸‹æ¥ä¸¤æ­¥æ¥å®Œæˆè¿™ä¸ªæ–¹æ³•ã€‚</li>
<li><code>startApp()</code> é‡Œåº”è¯¥åšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯å®šä¹‰ä¸€ä¸ªåä¸º<code>cryptoZombiesAddress</code> çš„å˜é‡å¹¶èµ‹å€¼ä¸º<code>"ä½ çš„åˆçº¦åœ°å€"</code> (è¿™æ˜¯ä½ çš„åˆçº¦åœ¨ä»¥å¤ªåŠä¸»ç½‘ä¸Šçš„åœ°å€)ã€‚</li>
<li>æœ€åï¼Œæ¥å®ä¾‹åŒ–æˆ‘ä»¬çš„åˆçº¦ã€‚æ¨¡ä»¿æˆ‘ä»¬ä¸Šé¢çš„ä»£ç ï¼Œå°† <code>cryptoZombies</code> èµ‹å€¼ä¸º <code>new</code> <code>web3js.eth.Contract</code> (ä½¿ç”¨æˆ‘ä»¬ä¸Šé¢ä»£ç ä¸­é€šè¿‡ <code>script</code> å¼•å…¥çš„ <code>cryptoZombiesABI</code> å’Œ <code>cryptoZombiesAddress</code>)ã€‚</li>
</ol>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;!<span class="variable constant_">DOCTYPE</span> html&gt;</span><br><span class="line"><span class="language-xml"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>CryptoZombies front-end<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"web3.min.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="comment">&lt;!-- 1. Include cryptozombies_abi.js here --&gt;</span></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">language</span>=<span class="string">"javascript"</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span> <span class="attr">src</span>=<span class="string">"cryptozombies_abi.js"</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br><span class="line"><span class="language-xml">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="comment">// 2. Start code here</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">var</span> cryptoZombies;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="keyword">function</span> <span class="title function_">startApp</span>(<span class="params"></span>){</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"ä½ çš„åˆçº¦åœ°å€"</span>;</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        cryptoZombies = <span class="keyword">new</span> web3js.<span class="property">eth</span>.<span class="title class_">Contract</span>(cryptoZombiesABI, cryptoZombiesAddress);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      }</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      <span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">'load'</span>, <span class="keyword">function</span>(<span class="params"></span>) {</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// Checking if Web3 has been injected by the browser (Mist/MetaMask)</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="keyword">if</span> (<span class="keyword">typeof</span> web3 !== <span class="string">'undefined'</span>) {</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// Use Mist/MetaMask's provider</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          web3js = <span class="keyword">new</span> <span class="title class_">Web3</span>(web3.<span class="property">currentProvider</span>);</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        } <span class="keyword">else</span> {</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// Handle the case where the user doesn't have Metamask installed</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">          <span class="comment">// Probably show them a message prompting them to install Metamask</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        }</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="comment">// Now you can start your app &amp; access web3 freely:</span></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">        <span class="title function_">startApp</span>()</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml"></span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">      })</span></span></span><br><span class="line"><span class="language-javascript"><span class="language-xml">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">  <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="language-xml"></span></span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬4ç« -è°ƒç”¨å’Œåˆçº¦å‡½æ•°"><a href="#ç¬¬4ç« -è°ƒç”¨å’Œåˆçº¦å‡½æ•°" class="headerlink" title="ç¬¬4ç« : è°ƒç”¨å’Œåˆçº¦å‡½æ•°"></a>ç¬¬4ç« : è°ƒç”¨å’Œåˆçº¦å‡½æ•°</h3><p>æˆ‘ä»¬çš„åˆçº¦é…ç½®å¥½äº†ï¼ç°åœ¨æ¥ç”¨ Web3.js å’Œå®ƒå¯¹è¯ã€‚</p>
<p>Web3.js æœ‰ä¸¤ä¸ªæ–¹æ³•æ¥è°ƒç”¨æˆ‘ä»¬åˆçº¦çš„å‡½æ•°: <code>call</code> and <code>send</code>.</p>
<p><strong>Call</strong></p>
<p><code>call</code> ç”¨æ¥è°ƒç”¨ <code>view</code> å’Œ <code>pure</code> å‡½æ•°ã€‚å®ƒåªè¿è¡Œåœ¨æœ¬åœ°èŠ‚ç‚¹ï¼Œä¸ä¼šåœ¨åŒºå—é“¾ä¸Šåˆ›å»ºäº‹åŠ¡ã€‚</p>
<blockquote>
<p><strong>å¤ä¹ :</strong> <code>view</code> å’Œ <code>pure</code> å‡½æ•°æ˜¯åªè¯»çš„å¹¶ä¸ä¼šæ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ã€‚å®ƒä»¬ä¹Ÿä¸ä¼šæ¶ˆè€—ä»»ä½•gasã€‚ç”¨æˆ·ä¹Ÿä¸ä¼šè¢«è¦æ±‚ç”¨MetaMaskå¯¹äº‹åŠ¡ç­¾åã€‚</p>
</blockquote>
<p>ä½¿ç”¨ Web3.jsï¼Œä½ å¯ä»¥å¦‚ä¸‹ <code>call</code> ä¸€ä¸ªåä¸º<code>myMethod</code>çš„æ–¹æ³•å¹¶ä¼ å…¥ä¸€ä¸ª <code>123</code> ä½œä¸ºå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myContract.<span class="property">methods</span>.<span class="title function_">myMethod</span>(<span class="number">123</span>).<span class="title function_">call</span>()</span><br></pre></td></tr></tbody></table></figure>

<p><strong>Send</strong></p>
<p><code>send</code> å°†åˆ›å»ºä¸€ä¸ªäº‹åŠ¡å¹¶æ”¹å˜åŒºå—é“¾ä¸Šçš„æ•°æ®ã€‚ä½ éœ€è¦ç”¨ <code>send</code> æ¥è°ƒç”¨ä»»ä½•é <code>view</code> æˆ–è€… <code>pure</code> çš„å‡½æ•°ã€‚</p>
<blockquote>
<p><strong>æ³¨æ„:</strong> <code>send</code> ä¸€ä¸ªäº‹åŠ¡å°†è¦æ±‚ç”¨æˆ·æ”¯ä»˜gasï¼Œå¹¶ä¼šè¦æ±‚å¼¹å‡ºå¯¹è¯æ¡†è¯·æ±‚ç”¨æˆ·ä½¿ç”¨ Metamask å¯¹äº‹åŠ¡ç­¾åã€‚åœ¨æˆ‘ä»¬ä½¿ç”¨ Metamask ä½œä¸ºæˆ‘ä»¬çš„ web3 æä¾›è€…çš„æ—¶å€™ï¼Œæ‰€æœ‰è¿™ä¸€åˆ‡éƒ½ä¼šåœ¨æˆ‘ä»¬è°ƒç”¨ <code>send()</code> çš„æ—¶å€™è‡ªåŠ¨å‘ç”Ÿã€‚è€Œæˆ‘ä»¬è‡ªå·±æ— éœ€åœ¨ä»£ç ä¸­æ“å¿ƒè¿™ä¸€åˆ‡ï¼ŒæŒºçˆ½çš„å§ã€‚</p>
</blockquote>
<p>ä½¿ç”¨ Web3.js, ä½ å¯ä»¥åƒè¿™æ · <code>send</code> ä¸€ä¸ªäº‹åŠ¡è°ƒç”¨<code>myMethod</code> å¹¶ä¼ å…¥ <code>123</code> ä½œä¸ºå‚æ•°ï¼š</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">myContract.<span class="property">methods</span>.<span class="title function_">myMethod</span>(<span class="number">123</span>).<span class="title function_">send</span>()</span><br></pre></td></tr></tbody></table></figure>

<p>è¯­æ³•å‡ ä¹ <code>call()</code>ä¸€æ¨¡ä¸€æ ·ã€‚</p>
<p><strong>è·å–åƒµå°¸æ•°æ®</strong></p>
<p>æ¥çœ‹ä¸€ä¸ªä½¿ç”¨ <code>call</code> è¯»å–æˆ‘ä»¬åˆçº¦æ•°æ®çš„çœŸå®ä¾‹å­</p>
<p>å›å¿†ä¸€ä¸‹ï¼Œæˆ‘ä»¬å®šä¹‰æˆ‘ä»¬çš„åƒµå°¸æ•°ç»„ä¸º <code>å…¬å¼€</code>(public):</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Zombie[] public zombies;</span><br></pre></td></tr></tbody></table></figure>

<p><u><strong>åœ¨ Solidity é‡Œï¼Œå½“ä½ å®šä¹‰ä¸€ä¸ª <code>public</code>å˜é‡çš„æ—¶å€™ï¼Œ å®ƒå°†è‡ªåŠ¨å®šä¹‰ä¸€ä¸ªå…¬å¼€çš„ â€œgetterâ€ åŒåæ–¹æ³•</strong></u>ï¼Œ æ‰€ä»¥å¦‚æœä½ åƒè¦æŸ¥çœ‹ id ä¸º <code>15</code> çš„åƒµå°¸ï¼Œä½ å¯ä»¥åƒä¸€ä¸ªå‡½æ•°ä¸€æ ·è°ƒç”¨å®ƒï¼š <code>zombies(15)</code>.</p>
<p>è¿™æ˜¯å¦‚ä½•åœ¨å¤–é¢çš„å‰ç«¯ç•Œé¢ä¸­å†™ä¸€ä¸ª JavaScript æ–¹æ³•æ¥ä¼ å…¥ä¸€ä¸ªåƒµå°¸ idï¼Œåœ¨æˆ‘ä»¬çš„åˆåŒä¸­æŸ¥è¯¢é‚£ä¸ªåƒµå°¸å¹¶è¿”å›ç»“æœ</p>
<blockquote>
<p>æ³¨æ„: æœ¬è¯¾ä¸­æ‰€æœ‰çš„ç¤ºä¾‹ä»£ç éƒ½ä½¿ç”¨ Web3.js çš„ <strong>1.0 ç‰ˆ</strong>ï¼Œæ­¤ç‰ˆæœ¬ä½¿ç”¨çš„æ˜¯ Promises è€Œä¸æ˜¯å›è°ƒå‡½æ•°ã€‚ä½ åœ¨çº¿ä¸Šçœ‹åˆ°çš„å…¶ä»–æ•™ç¨‹å¯èƒ½è¿˜åœ¨ä½¿ç”¨è€ç‰ˆçš„ Web3.jsã€‚åœ¨1.0ç‰ˆä¸­ï¼Œè¯­æ³•æ”¹å˜äº†ä¸å°‘ã€‚å¦‚æœä½ ä»å…¶ä»–æ•™ç¨‹ä¸­å¤åˆ¶ä»£ç ï¼Œå…ˆç¡®ä¿ä½ ä»¬ä½¿ç”¨çš„æ˜¯ç›¸åŒç‰ˆæœ¬çš„Web3.jsã€‚</p>
</blockquote>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getZombieDetails</span>(<span class="params">id</span>) {</span><br><span class="line">  <span class="keyword">return</span> cryptoZombies.<span class="property">methods</span>.<span class="title function_">zombies</span>(id).<span class="title function_">call</span>()</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">// è°ƒç”¨å‡½æ•°å¹¶åšä¸€äº›å…¶ä»–äº‹æƒ…</span></span><br><span class="line"><span class="title function_">getZombieDetails</span>(<span class="number">15</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="keyword">function</span>(<span class="params">result</span>) {</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">"Zombie 15: "</span> + <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result));</span><br><span class="line">});</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬æ¥çœ‹çœ‹è¿™é‡Œéƒ½åšäº†ä»€ä¹ˆ</p>
<p><code>cryptoZombies.methods.zombies(id).call()</code> å°†å’Œ Web3 æä¾›è€…èŠ‚ç‚¹é€šä¿¡ï¼Œå‘Šè¯‰å®ƒè¿”å›ä»æˆ‘ä»¬çš„åˆçº¦ä¸­çš„ <code>Zombie[] public zombies</code>ï¼Œ<code>id</code>ä¸ºä¼ å…¥å‚æ•°çš„åƒµå°¸ä¿¡æ¯ã€‚</p>
<p>æ³¨æ„è¿™æ˜¯ <strong>å¼‚æ­¥çš„</strong>ï¼Œå°±åƒä»å¤–éƒ¨æœåŠ¡å™¨ä¸­è°ƒç”¨APIã€‚æ‰€ä»¥ Web3 åœ¨è¿™é‡Œè¿”å›äº†ä¸€ä¸ª Promises. (å¦‚æœä½ å¯¹ JavaScriptçš„ Promises ä¸äº†è§£ï¼Œæœ€å¥½å…ˆå»å­¦ä¹ ä¸€ä¸‹è¿™æ–¹é¢çŸ¥è¯†å†ç»§ç»­)ã€‚</p>
<p>ä¸€æ—¦é‚£ä¸ª <code>promise</code> è¢« <code>resolve</code>, (æ„å‘³ç€æˆ‘ä»¬ä» Web3 æä¾›è€…é‚£é‡Œè·å¾—äº†å“åº”)ï¼Œæˆ‘ä»¬çš„ä¾‹å­ä»£ç å°†æ‰§è¡Œ <code>then</code> è¯­å¥ä¸­çš„ä»£ç ï¼Œåœ¨æ§åˆ¶å°æ‰“å‡º <code>result</code>ã€‚</p>
<p><code>result</code> æ˜¯ä¸€ä¸ªåƒè¿™æ ·çš„ JavaScript å¯¹è±¡ï¼š</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">{</span><br><span class="line">  <span class="string">"name"</span>: <span class="string">"H4XF13LD MORRIS'S COOLER OLDER BROTHER"</span>,</span><br><span class="line">  <span class="string">"dna"</span>: <span class="string">"1337133713371337"</span>,</span><br><span class="line">  <span class="string">"level"</span>: <span class="string">"9999"</span>,</span><br><span class="line">  <span class="string">"readyTime"</span>: <span class="string">"1522498671"</span>,</span><br><span class="line">  <span class="string">"winCount"</span>: <span class="string">"999999999"</span>,</span><br><span class="line">  <span class="string">"lossCount"</span>: <span class="string">"0"</span> <span class="comment">// Obviously.</span></span><br><span class="line">}</span><br></pre></td></tr></tbody></table></figure>

<p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸€äº›å‰ç«¯é€»è¾‘ä»£ç æ¥è§£æè¿™ä¸ªå¯¹è±¡å¹¶åœ¨å‰ç«¯ç•Œé¢å‹å¥½å±•ç¤ºã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬å·²ç»å¸®ä½ æŠŠ <code>getZombieDetails</code> å¤åˆ¶è¿›äº†ä»£ç ã€‚</p>
<ol>
<li><p>å…ˆä¸º<code>zombieToOwner</code> åˆ›å»ºä¸€ä¸ªç±»ä¼¼çš„å‡½æ•°ã€‚å¦‚æœä½ è¿˜è®°å¾— <code>ZombieFactory.sol</code>ï¼Œæˆ‘ä»¬æœ‰ä¸€ä¸ªé•¿è¿™æ ·çš„æ˜ å°„ï¼š</p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mapping (uint =&gt; address) public zombieToOwner;</span><br></pre></td></tr></tbody></table></figure>

<p> å®šä¹‰ä¸€ä¸ª JavaScript æ–¹æ³•ï¼Œèµ·åä¸º <code>zombieToOwner</code>ã€‚å’Œä¸Šé¢çš„ <code>getZombieDetails</code> ç±»ä¼¼ï¼Œ å®ƒå°†æ¥æ”¶ä¸€ä¸ª<code>id</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª Web3.js <code>call</code> æˆ‘ä»¬åˆçº¦é‡Œçš„<code>zombieToOwner</code> ã€‚</p>
</li>
<li><p>ä¹‹ååœ¨ä¸‹é¢ï¼Œä¸º <code>getZombiesByOwner</code> å®šä¹‰ä¸€ä¸ªæ–¹æ³•ã€‚å¦‚æœä½ è¿˜èƒ½è®°èµ· <code>ZombieHelper.sol</code>ï¼Œè¿™ä¸ªæ–¹æ³•å®šä¹‰åƒè¿™æ ·ï¼š</p>
 <figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function getZombiesByOwner(address _owner)</span><br></pre></td></tr></tbody></table></figure>

<p> æˆ‘ä»¬çš„ <code>getZombiesByOwner</code> æ–¹æ³•å°†æ¥æ”¶ <code>owner</code> ä½œä¸ºå‚æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯¹æˆ‘ä»¬å‡½æ•° <code>getZombiesByOwner</code>çš„ Web3.js <code>call</code></p>
</li>
</ol>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. Define `zombieToOwner` here</span></span><br><span class="line">     <span class="keyword">function</span> <span class="title function_">zombieToOwner</span>(<span class="params">id</span>){</span><br><span class="line">       <span class="keyword">return</span> cryptoZombies.<span class="property">methods</span>.<span class="title function_">zombieToOwner</span>(id).<span class="title function_">call</span>()</span><br><span class="line">     }</span><br><span class="line">     <span class="comment">// 2. Define `getZombiesByOwner` here</span></span><br><span class="line">     <span class="keyword">function</span> <span class="title function_">getZombiesByOwner</span>(<span class="params">owner</span>){</span><br><span class="line">       <span class="keyword">return</span> cryptoZombies.<span class="property">methods</span>.<span class="title function_">getZombiesByOwner</span>(owner).<span class="title function_">call</span>()</span><br><span class="line">     }</span><br></pre></td></tr></tbody></table></figure>



<h3 id="ç¬¬5ç« -MetaMask-å’Œè´¦æˆ·"><a href="#ç¬¬5ç« -MetaMask-å’Œè´¦æˆ·" class="headerlink" title="ç¬¬5ç« : MetaMask å’Œè´¦æˆ·"></a>ç¬¬5ç« : MetaMask å’Œè´¦æˆ·</h3><p>å¤ªæ£’äº†ï¼ä½ æˆåŠŸåœ°å†™äº†ä¸€äº›å‰ç«¯ä»£ç æ¥å’Œä½ çš„ç¬¬ä¸€ä¸ªæ™ºèƒ½åˆçº¦äº¤äº’ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»¼åˆä¸€ä¸‹â€”â€”æ¯”å¦‚æˆ‘ä»¬æƒ³è®©æˆ‘ä»¬åº”ç”¨çš„é¦–é¡µæ˜¾ç¤ºç”¨æˆ·çš„æ•´ä¸ªåƒµå°¸å¤§å†›ã€‚</p>
<p>æ¯«æ— ç–‘é—®æˆ‘ä»¬é¦–å…ˆéœ€è¦ç”¨ <code>getZombiesByOwner(owner)</code> æ¥æŸ¥è¯¢å½“å‰ç”¨æˆ·çš„æ‰€æœ‰åƒµå°¸IDã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬çš„ Solidity åˆçº¦éœ€è¦ <code>owner</code> ä½œä¸º Solidity <code>address</code>ã€‚æˆ‘ä»¬å¦‚ä½•èƒ½çŸ¥é“åº”ç”¨ç”¨æˆ·çš„åœ°å€å‘¢ï¼Ÿ</p>
<p><strong>è·å¾— MetaMaskä¸­çš„ç”¨æˆ·è´¦æˆ·</strong></p>
<p>MetaMask å…è®¸ç”¨æˆ·åœ¨æ‰©å±•ä¸­ç®¡ç†å¤šä¸ªè´¦æˆ·ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·æ¥è·å– <code>web3</code> å˜é‡ä¸­æ¿€æ´»çš„å½“å‰è´¦æˆ·ï¼š</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> userAccount = web3.<span class="property">eth</span>.<span class="property">accounts</span>[<span class="number">0</span>]</span><br></pre></td></tr></tbody></table></figure>

<p>å› ä¸ºç”¨æˆ·å¯ä»¥éšæ—¶åœ¨ MetaMask ä¸­åˆ‡æ¢è´¦æˆ·ï¼Œæˆ‘ä»¬çš„åº”ç”¨éœ€è¦ç›‘æ§è¿™ä¸ªå˜é‡ï¼Œä¸€æ—¦æ”¹å˜å°±è¦ç›¸åº”æ›´æ–°ç•Œé¢ã€‚ä¾‹å¦‚ï¼Œè‹¥ç”¨æˆ·çš„é¦–é¡µå±•ç¤ºå®ƒä»¬çš„åƒµå°¸å¤§å†›ï¼Œå½“ä»–ä»¬åœ¨ MetaMask ä¸­åˆ‡æ¢äº†è´¦å·ï¼Œæˆ‘ä»¬å°±éœ€è¦æ›´æ–°é¡µé¢æ¥å±•ç¤ºæ–°é€‰æ‹©çš„è´¦æˆ·çš„åƒµå°¸å¤§å†›ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥é€šè¿‡ <code>setInterval</code> æ–¹æ³•æ¥åš:</p>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> accountInterval = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">  <span class="comment">// æ£€æŸ¥è´¦æˆ·æ˜¯å¦åˆ‡æ¢</span></span><br><span class="line">  <span class="keyword">if</span> (web3.<span class="property">eth</span>.<span class="property">accounts</span>[<span class="number">0</span>] !== userAccount) {</span><br><span class="line">    userAccount = web3.<span class="property">eth</span>.<span class="property">accounts</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="comment">// è°ƒç”¨ä¸€äº›æ–¹æ³•æ¥æ›´æ–°ç•Œé¢</span></span><br><span class="line">    <span class="title function_">updateInterface</span>();</span><br><span class="line">  }</span><br><span class="line">}, <span class="number">100</span>);</span><br></pre></td></tr></tbody></table></figure>

<p>è¿™æ®µä»£ç åšçš„æ˜¯ï¼Œæ¯100æ¯«ç§’æ£€æŸ¥ä¸€æ¬¡ <code>userAccount</code> æ˜¯å¦è¿˜ç­‰äº <code>web3.eth.accounts[0]</code> (æ¯”å¦‚ï¼šç”¨æˆ·æ˜¯å¦è¿˜æ¿€æ´»äº†é‚£ä¸ªè´¦æˆ·)ã€‚è‹¥ä¸ç­‰ï¼Œåˆ™å°† å½“å‰æ¿€æ´»ç”¨æˆ·èµ‹å€¼ç»™ <code>userAccount</code>ï¼Œç„¶åè°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥æ›´æ–°ç•Œé¢ã€‚</p>
<p><strong>å®æˆ˜æ¼”ä¹ </strong></p>
<p>æˆ‘ä»¬æ¥è®©åº”ç”¨åœ¨é¡µé¢ç¬¬ä¸€æ¬¡åŠ è½½çš„æ—¶å€™æ˜¾ç¤ºç”¨æˆ·çš„åƒµå°¸å¤§å†›ï¼Œç›‘æ§å½“å‰ MetaMask ä¸­çš„æ¿€æ´»è´¦æˆ·ï¼Œå¹¶åœ¨è´¦æˆ·å‘ç”Ÿæ”¹å˜çš„æ—¶å€™åˆ·æ–°æ˜¾ç¤ºã€‚</p>
<ol>
<li><p>å®šä¹‰ä¸€ä¸ªåä¸º<code>userAccount</code>çš„å˜é‡ï¼Œä¸ç»™ä»»ä½•åˆå§‹å€¼ã€‚</p>
</li>
<li><p>åœ¨ <code>startApp()</code>å‡½æ•°çš„æœ€åï¼Œå¤åˆ¶ç²˜è´´ä¸Šé¢æ ·æ¿ä»£ç ä¸­çš„ <code>accountInterval</code> æ–¹æ³•è¿›å»ã€‚</p>
</li>
<li><p>å°† <code>updateInterface();</code>æ›¿æ¢æˆä¸€ä¸ª <code>getZombiesByOwner</code> çš„ <code>call</code> å‡½æ•°ï¼Œå¹¶ä¼ å…¥ <code>userAccount</code>ã€‚</p>
</li>
<li><p>åœ¨ <code>getZombiesByOwner</code> åé¢é“¾å¼è°ƒç”¨<code>then</code> è¯­å¥ï¼Œå¹¶å°†è¿”å›çš„ç»“æœä¼ å…¥åä¸º <code>displayZombies</code> çš„å‡½æ•°ã€‚ (è¯­å¥åƒè¿™æ ·: <code>.then(displayZombies);</code>).</p>
<p> æˆ‘ä»¬è¿˜æ²¡æœ‰ <code>displayZombies</code> å‡½æ•°ï¼Œå°†äºä¸‹ä¸€ç« å®ç°ã€‚</p>
</li>
</ol>
<figure class="highlight js"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. declare `userAccount` here</span></span><br><span class="line">      <span class="keyword">var</span> userAccount;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">function</span> <span class="title function_">startApp</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="keyword">var</span> cryptoZombiesAddress = <span class="string">"YOUR_CONTRACT_ADDRESS"</span>;</span><br><span class="line">        cryptoZombies = <span class="keyword">new</span> web3js.<span class="property">eth</span>.<span class="title class_">Contract</span>(cryptoZombiesABI, cryptoZombiesAddress);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. Create `setInterval` code here</span></span><br><span class="line">        <span class="keyword">var</span> accountInterval = <span class="built_in">setInterval</span>(<span class="keyword">function</span>(<span class="params"></span>) {</span><br><span class="line">        <span class="comment">// æ£€æŸ¥è´¦æˆ·æ˜¯å¦åˆ‡æ¢</span></span><br><span class="line">        <span class="keyword">if</span> (web3.<span class="property">eth</span>.<span class="property">accounts</span>[<span class="number">0</span>] !== userAccount) {</span><br><span class="line">          userAccount = web3.<span class="property">eth</span>.<span class="property">accounts</span>[<span class="number">0</span>];</span><br><span class="line">          <span class="comment">// è°ƒç”¨ä¸€äº›æ–¹æ³•æ¥æ›´æ–°ç•Œé¢</span></span><br><span class="line">          <span class="title function_">getZombiesByOwner</span>(userAccount).<span class="title function_">then</span>(displayZombies);</span><br><span class="line">        }</span><br><span class="line">      }, <span class="number">100</span>);</span><br><span class="line">    }</span><br></pre></td></tr></tbody></table></figure>




















      
    </div>
    <footer class="article-footer">
      
      
      
      
      
      
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/Solidity/" rel="tag">Solidity</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/%E6%99%BA%E8%83%BD%E5%90%88%E7%BA%A6/" rel="tag">æ™ºèƒ½åˆçº¦</a></li><li class="article-tag-list-item" data-aos="zoom-in"><a class="article-tag-list-link" href="/tags/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" rel="tag">ç¼–ç¨‹è¯­è¨€</a></li></ul>


    </footer>
  </div>
  
  <nav id="article-nav" data-aos="fade-up">
    
      
      <div class="article-nav-link-wrap article-nav-link-left">
        
          
          
            <img data-src="/covers/21.jpg" data-sizes="auto" alt="OpenZeppelinçš„æ™ºèƒ½åˆçº¦æ”»é˜²æŒ‘æˆ˜é¢˜è§£" class="lazyload">
          
        
        <a href="/2025/08/12/openzeppelin-de-zhi-neng-he-yue-gong-fang-tiao-zhan-ti-jie/"></a>
        <div class="article-nav-caption">Prev</div>
        <h3 class="article-nav-title">
          
            OpenZeppelinçš„æ™ºèƒ½åˆçº¦æ”»é˜²æŒ‘æˆ˜é¢˜è§£
          
        </h3>
      </div>
    
    
    
    <div class="article-nav-link-wrap article-nav-link-right">
      
        
        
          <img data-src="/covers/7.jpg" data-sizes="auto" alt="Unphishableé˜²é’“é±¼æ”»é˜²æŒ‘æˆ˜" class="lazyload">
        
      
      <a href="/2025/08/10/unphishable-fang-diao-yu-gong-fang-tiao-zhan/"></a>
      <div class="article-nav-caption">Next</div>
      <h3 class="article-nav-title">
        
          Unphishableé˜²é’“é±¼æ”»é˜²æŒ‘æˆ˜
        
      </h3>
    </div>
    
  </nav>


</article>










</section>
        </div>
        <footer id="footer">
  <div style="width: 100%; overflow: hidden">
    <div class="footer-line"></div>
  </div>
  <div id="footer-info">
    
    <div>
      <span class="icon-copyright"></span>
      
      
      
        2024-2025
      
      <span class="footer-info-sep "></span>
      mX1@0
    </div>
    
      <div>
        Powered by&nbsp;<a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a>&nbsp;
        Theme.<a href="https://github.com/D-Sketon/hexo-theme-reimu" rel="noopener external nofollow noreferrer" target="_blank">Reimu</a>
      </div>
    
    
      <div>
        <span class="icon-brush"></span>
        286.1k
        &nbsp;|&nbsp;
        <span class="icon-coffee"></span>
        17:51
      </div>
    
    
    
    
    
      <div>
        <span class="icon-eye"></span>
        <span id="busuanzi_container_site_pv">Number of visits&nbsp;<span id="busuanzi_value_site_pv"></span></span>
        &nbsp;|&nbsp;
        <span class="icon-user"></span>
        <span id="busuanzi_container_site_uv">Number of visitors&nbsp;<span id="busuanzi_value_site_uv"></span></span>
      </div>
    
  </div>
</footer>

        
          <div class="sidebar-top">
            <div class="sidebar-top-taichi rotate"></div>
            <div class="arrow-up"></div>
          </div>
        
        <div id="mask" class="hide"></div>
      </div>
      <nav id="mobile-nav">
  <div class="sidebar-wrap">
    
      
        <div class="sidebar-toc-sidebar"><div class="sidebar-toc">
  <h3 class="toc-title">Contents</h3>
  <div class="sidebar-toc-wrapper toc-div-class" >
      
        <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CryptoZombiesx%E7%9A%84solidity%E5%AD%A6%E4%B9%A0"><span class="toc-text">CryptoZombiesxçš„solidityå­¦ä¹ </span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Solidity-Beginner-to-Intermediate-Smart-Contracts"><span class="toc-text">Solidity: Beginner to Intermediate Smart Contracts</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson1-%E6%90%AD%E5%BB%BA%E5%83%B5%E5%B0%B8%E5%B7%A5%E5%8E%82"><span class="toc-text">lesson1 æ­å»ºåƒµå°¸å·¥å‚</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E5%90%88%E7%BA%A6"><span class="toc-text">ç¬¬2ç« : åˆçº¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E7%8A%B6%E6%80%81%E5%8F%98%E9%87%8F%E5%92%8C%E6%95%B4%E6%95%B0"><span class="toc-text">ç¬¬3ç« : çŠ¶æ€å˜é‡å’Œæ•´æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="toc-text">ç¬¬4ç« : æ•°å­¦è¿ç®—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E7%BB%93%E6%9E%84%E4%BD%93"><span class="toc-text">ç¬¬5ç« : ç»“æ„ä½“</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E6%95%B0%E7%BB%84"><span class="toc-text">ç¬¬6ç« : æ•°ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0"><span class="toc-text">ç¬¬7ç« : å®šä¹‰å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E4%BD%BF%E7%94%A8%E7%BB%93%E6%9E%84%E4%BD%93%E5%92%8C%E6%95%B0%E7%BB%84"><span class="toc-text">ç¬¬8ç« : ä½¿ç”¨ç»“æ„ä½“å’Œæ•°ç»„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E7%A7%81%E6%9C%89-%E5%85%AC%E5%85%B1%E5%87%BD%E6%95%B0"><span class="toc-text">ç¬¬9ç« : ç§æœ‰ &#x2F; å…¬å…±å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%87%BD%E6%95%B0%E7%9A%84%E6%9B%B4%E5%A4%9A%E5%B1%9E%E6%80%A7"><span class="toc-text">ç¬¬10ç« : å‡½æ•°çš„æ›´å¤šå±æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-Keccak256-%E5%92%8C-%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2"><span class="toc-text">ç¬¬11ç« : Keccak256 å’Œ ç±»å‹è½¬æ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-text">ç¬¬12ç« : æ”¾åœ¨ä¸€èµ·</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E4%BA%8B%E4%BB%B6"><span class="toc-text">ç¬¬13ç« : äº‹ä»¶</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC14%E7%AB%A0-Web3-js"><span class="toc-text">ç¬¬14ç« : Web3.js</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson2-%E5%83%B5%E5%B0%B8%E6%94%BB%E5%87%BB%E4%BA%BA%E7%B1%BB"><span class="toc-text">lesson2 åƒµå°¸æ”»å‡»äººç±»</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E6%98%A0%E5%B0%84%EF%BC%88Mapping%EF%BC%89%E5%92%8C%E5%9C%B0%E5%9D%80%EF%BC%88Address%EF%BC%89"><span class="toc-text">ç¬¬2ç« : æ˜ å°„ï¼ˆMappingï¼‰å’Œåœ°å€ï¼ˆAddressï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-Msg-sender"><span class="toc-text">ç¬¬3ç« : Msg.sender</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-Require"><span class="toc-text">ç¬¬4ç« : Require</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E7%BB%A7%E6%89%BF%EF%BC%88Inheritance%EF%BC%89"><span class="toc-text">ç¬¬5ç« : ç»§æ‰¿ï¼ˆInheritanceï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E5%BC%95%E5%85%A5%EF%BC%88Import%EF%BC%89"><span class="toc-text">ç¬¬6ç« : å¼•å…¥ï¼ˆImportï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-Storage%E4%B8%8EMemory"><span class="toc-text">ç¬¬7ç« : Storageä¸Memory</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E5%83%B5%E5%B0%B8%E7%9A%84DNA"><span class="toc-text">ç¬¬8ç« : åƒµå°¸çš„DNA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E6%9B%B4%E5%A4%9A%E5%85%B3%E4%BA%8E%E5%87%BD%E6%95%B0%E5%8F%AF%E8%A7%81%E6%80%A7"><span class="toc-text">ç¬¬9ç« : æ›´å¤šå…³äºå‡½æ•°å¯è§æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%90%83%E4%BB%80%E4%B9%88"><span class="toc-text">ç¬¬10ç« : åƒµå°¸åƒä»€ä¹ˆ?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E4%BD%BF%E7%94%A8%E6%8E%A5%E5%8F%A3"><span class="toc-text">ç¬¬11ç« : ä½¿ç”¨æ¥å£</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-%E5%A4%84%E7%90%86%E5%A4%9A%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-text">ç¬¬12ç« : å¤„ç†å¤šè¿”å›å€¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E5%A5%96%E5%8A%B1-Kitty-%E5%9F%BA%E5%9B%A0"><span class="toc-text">ç¬¬13ç« : å¥–åŠ±: Kitty åŸºå› </span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC14%E7%AB%A0-%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-text">ç¬¬14ç« : æ”¾åœ¨ä¸€èµ·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson3-%E9%AB%98%E7%BA%A7-Solidity-%E7%90%86%E8%AE%BA"><span class="toc-text">lesson3 é«˜çº§ Solidity ç†è®º</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E6%99%BA%E8%83%BD%E5%8D%8F%E8%AE%AE%E7%9A%84%E6%B0%B8%E5%9B%BA%E6%80%A7"><span class="toc-text">ç¬¬1ç« : æ™ºèƒ½åè®®çš„æ°¸å›ºæ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-Ownable-Contracts"><span class="toc-text">ç¬¬2ç« : Ownable Contracts</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-onlyOwner-%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-text">ç¬¬3ç« : onlyOwner å‡½æ•°ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-Gas"><span class="toc-text">ç¬¬4ç« : Gas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E6%97%B6%E9%97%B4%E5%8D%95%E4%BD%8D"><span class="toc-text">ç¬¬5ç« : æ—¶é—´å•ä½</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%86%B7%E5%8D%B4"><span class="toc-text">ç¬¬6ç« : åƒµå°¸å†·å´</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E5%85%AC%E6%9C%89%E5%87%BD%E6%95%B0%E5%92%8C%E5%AE%89%E5%85%A8%E6%80%A7"><span class="toc-text">ç¬¬7ç« : å…¬æœ‰å‡½æ•°å’Œå®‰å…¨æ€§</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E8%BF%9B%E4%B8%80%E6%AD%A5%E4%BA%86%E8%A7%A3%E5%87%BD%E6%95%B0%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-text">ç¬¬8ç« : è¿›ä¸€æ­¥äº†è§£å‡½æ•°ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E5%83%B5%E5%B0%B8%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-text">ç¬¬9ç« : åƒµå°¸ä¿®é¥°ç¬¦</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%88%A9%E7%94%A8-%E2%80%98View%E2%80%99-%E5%87%BD%E6%95%B0%E8%8A%82%E7%9C%81-Gas"><span class="toc-text">ç¬¬10ç« : åˆ©ç”¨ â€˜Viewâ€™ å‡½æ•°èŠ‚çœ Gas</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E5%AD%98%E5%82%A8%E9%9D%9E%E5%B8%B8%E6%98%82%E8%B4%B5"><span class="toc-text">ç¬¬11ç« : å­˜å‚¨éå¸¸æ˜‚è´µ</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-For-%E5%BE%AA%E7%8E%AF"><span class="toc-text">ç¬¬12ç« : For å¾ªç¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E6%94%BE%E5%9C%A8%E4%B8%80%E8%B5%B7"><span class="toc-text">ç¬¬13ç« : æ”¾åœ¨ä¸€èµ·</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson4-%E5%83%B5%E5%B0%B8%E4%BD%9C%E6%88%98%E7%B3%BB%E7%BB%9F"><span class="toc-text">lesson4 åƒµå°¸ä½œæˆ˜ç³»ç»Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E5%8F%AF%E6%94%AF%E4%BB%98"><span class="toc-text">ç¬¬1ç« : å¯æ”¯ä»˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-%E6%8F%90%E7%8E%B0"><span class="toc-text">ç¬¬2ç« : æç°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E5%83%B5%E5%B0%B8%E6%88%98%E6%96%97"><span class="toc-text">ç¬¬3ç« : åƒµå°¸æˆ˜æ–—</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E9%9A%8F%E6%9C%BA%E6%95%B0"><span class="toc-text">ç¬¬4ç« : éšæœºæ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%AF%B9%E6%88%98"><span class="toc-text">ç¬¬5ç« : åƒµå°¸å¯¹æˆ˜</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-%E9%87%8D%E6%9E%84%E9%80%9A%E7%94%A8%E9%80%BB%E8%BE%91"><span class="toc-text">ç¬¬6ç« : é‡æ„é€šç”¨é€»è¾‘</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-%E6%9B%B4%E5%A4%9A%E9%87%8D%E6%9E%84"><span class="toc-text">ç¬¬7ç« : æ›´å¤šé‡æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-%E5%9B%9E%E5%88%B0%E6%94%BB%E5%87%BB%EF%BC%81"><span class="toc-text">ç¬¬8ç« : å›åˆ°æ”»å‡»ï¼</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E5%83%B5%E5%B0%B8%E7%9A%84%E8%BE%93%E8%B5%A2"><span class="toc-text">ç¬¬9ç« : åƒµå°¸çš„è¾“èµ¢</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-%E5%83%B5%E5%B0%B8%E8%83%9C%E5%88%A9%E4%BA%86-%F0%9F%98%84"><span class="toc-text">ç¬¬10ç« : åƒµå°¸èƒœåˆ©äº† ğŸ˜„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-%E5%83%B5%E5%B0%B8%E5%A4%B1%E8%B4%A5-%F0%9F%98%9E"><span class="toc-text">ç¬¬11ç« : åƒµå°¸å¤±è´¥ ğŸ˜</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson5-ERC721-%E6%A0%87%E5%87%86%E5%92%8C%E5%8A%A0%E5%AF%86%E6%94%B6%E8%97%8F%E5%93%81"><span class="toc-text">lesson5 ERC721 æ ‡å‡†å’ŒåŠ å¯†æ”¶è—å“</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E4%BB%A5%E5%A4%AA%E5%9D%8A%E4%B8%8A%E7%9A%84%E4%BB%A3%E5%B8%81"><span class="toc-text">ç¬¬1ç« : ä»¥å¤ªåŠä¸Šçš„ä»£å¸</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-ERC721-%E6%A0%87%E5%87%86-%E5%A4%9A%E9%87%8D%E7%BB%A7%E6%89%BF"><span class="toc-text">ç¬¬2ç« : ERC721 æ ‡å‡†, å¤šé‡ç»§æ‰¿</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-balanceOf-%E5%92%8C-ownerOf"><span class="toc-text">ç¬¬3ç« : balanceOf å’Œ ownerOf</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E9%87%8D%E6%9E%84"><span class="toc-text">ç¬¬4ç« : é‡æ„</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-ERC721-%E8%BD%AC%E7%A7%BB%E6%A0%87%E5%87%86"><span class="toc-text">ç¬¬5ç« : ERC721: è½¬ç§»æ ‡å‡†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC6%E7%AB%A0-ERC721-%E8%BD%AC%E7%A7%BB-%E7%BB%AD"><span class="toc-text">ç¬¬6ç« : ERC721: è½¬ç§»-ç»­</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC7%E7%AB%A0-ERC721-%E6%89%B9%E5%87%86"><span class="toc-text">ç¬¬7ç« : ERC721: æ‰¹å‡†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC8%E7%AB%A0-ERC721-takeOwnership"><span class="toc-text">ç¬¬8ç« : ERC721: takeOwnership</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC9%E7%AB%A0-%E9%A2%84%E9%98%B2%E6%BA%A2%E5%87%BA"><span class="toc-text">ç¬¬9ç« : é¢„é˜²æº¢å‡º</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC10%E7%AB%A0-SafeMath-%E7%AC%AC%E4%BA%8C%E9%83%A8%E5%88%86"><span class="toc-text">ç¬¬10ç« : SafeMath ç¬¬äºŒéƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC11%E7%AB%A0-SafeMath-%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86"><span class="toc-text">ç¬¬11ç« : SafeMath ç¬¬ä¸‰éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC12%E7%AB%A0-SafeMath-%E7%AC%AC4%E9%83%A8%E5%88%86"><span class="toc-text">ç¬¬12ç« : SafeMath ç¬¬4éƒ¨åˆ†</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC13%E7%AB%A0-%E6%B3%A8%E9%87%8A"><span class="toc-text">ç¬¬13ç« : æ³¨é‡Š</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%80%E4%B8%8B"><span class="toc-text">æ€»ç»“ä¸€ä¸‹</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#lesson6-%E5%BA%94%E7%94%A8%E5%89%8D%E7%AB%AF%E5%92%8C-Web3-js"><span class="toc-text">lesson6 åº”ç”¨å‰ç«¯å’Œ Web3.js</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC1%E7%AB%A0-%E4%BB%8B%E7%BB%8D-Web3-js"><span class="toc-text">ç¬¬1ç« : ä»‹ç» Web3.js</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC2%E7%AB%A0-Web3-%E6%8F%90%E4%BE%9B%E8%80%85"><span class="toc-text">ç¬¬2ç« : Web3 æä¾›è€…</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC3%E7%AB%A0-%E5%92%8C%E5%90%88%E7%BA%A6%E5%AF%B9%E8%AF%9D"><span class="toc-text">ç¬¬3ç« : å’Œåˆçº¦å¯¹è¯</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC4%E7%AB%A0-%E8%B0%83%E7%94%A8%E5%92%8C%E5%90%88%E7%BA%A6%E5%87%BD%E6%95%B0"><span class="toc-text">ç¬¬4ç« : è°ƒç”¨å’Œåˆçº¦å‡½æ•°</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AC%AC5%E7%AB%A0-MetaMask-%E5%92%8C%E8%B4%A6%E6%88%B7"><span class="toc-text">ç¬¬5ç« : MetaMask å’Œè´¦æˆ·</span></a></li></ol></li></ol></li></ol>
      
  </div>
</div>
</div>
        <div class="sidebar-common-sidebar hidden"><div class="sidebar-author">
  <img data-src="/avatar/avatar.webp" data-sizes="auto" alt="mX1@0" class="lazyload">
  <div class="sidebar-author-name">mX1@0</div>
  <div class="sidebar-description"></div>
</div>
<div class="sidebar-state">
  <div class="sidebar-state-article">
    <div>Post</div>
    <div class="sidebar-state-number">54</div>
  </div>
  <div class="sidebar-state-category">
    <div>Category</div>
    <div class="sidebar-state-number">25</div>
  </div>
  <div class="sidebar-state-tag">
    <div>Tag</div>
    <div class="sidebar-state-number">65</div>
  </div>
</div>
<div class="sidebar-social">
  
    <div class="icon-twitter sidebar-social-icon">
      <a href=https://x.com/0xMx1a0 itemprop="url" target="_blank" aria-label="twitter" rel="noopener external nofollow noreferrer"></a>
    </div>
  
</div>
<div class="sidebar-menu">
  
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/" aria-label="é¦–é¡µ"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">é¦–é¡µ</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/archives" aria-label="å½’ç±»"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">å½’ç±»</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/about" aria-label="å…³äº"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">å…³äº</div>
      </div>
    
      <div class="sidebar-menu-link-wrap">
        <a class="sidebar-menu-link-dummy" href="/friend" aria-label="å‹é“¾"></a>
        <div class="sidebar-menu-icon icon rotate">
          
            &#xe62b;
          
        </div>
        <div class="sidebar-menu-link">å‹é“¾</div>
      </div>
    
  
</div>
</div>
      
    
  </div>
  
    
      <div class="sidebar-btn-wrapper">
        <div class="sidebar-toc-btn current"></div>
        <div class="sidebar-common-btn"></div>
      </div>
    
  
</nav>

    </div>
    
    
    
    
<script src="https://npm.webcache.cn/lazysizes@5.3.2/lazysizes.min.js" integrity="sha384-3gT&#x2F;vsepWkfz&#x2F;ff7PpWNUeMzeWoH3cDhm&#x2F;A8jM7ouoAK0&#x2F;fP&#x2F;9bcHHR5kHq2nf+e" crossorigin="anonymous"></script>


<script src="https://npm.webcache.cn/clipboard@2.0.11/dist/clipboard.min.js" integrity="sha384-J08i8An&#x2F;QeARD9ExYpvphB8BsyOj3Gh2TSh1aLINKO3L0cMSH2dN3E22zFoXEi0Q" crossorigin="anonymous"></script>





<script src="/js/script.js"></script>



  
<script src="/js/aos.js"></script>

  <script>
    var aosInit = () => {
      AOS.init({
        duration: 1000,
        easing: "ease",
        once: true,
        offset: 50,
      });
    };
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', aosInit);
    } else {
      aosInit();
    }
  </script>



<script src="/js/pjax_script.js" data-pjax></script>







  
<script src="https://npm.webcache.cn/mouse-firework@0.1.1/dist/index.umd.js" integrity="sha384-8LyaidD9GPxQQgLJO&#x2F;WRw&#x2F;O2h3BoNq&#x2F;ApI&#x2F;ecpvM6RsrCz2qP2ppBXUKihP4V&#x2F;2d" crossorigin="anonymous"></script>

  <script>
    window.firework && window.firework(JSON.parse('{"excludeElements":["a","button"],"particles":[{"shape":"circle","move":["emit"],"easing":"easeOutExpo","colors":["var(--red-1)","var(--red-2)","var(--red-3)","var(--red-4)"],"number":20,"duration":[1200,1800],"shapeOptions":{"radius":[16,32],"alpha":[0.3,0.5]}},{"shape":"circle","move":["diffuse"],"easing":"easeOutExpo","colors":["var(--red-0)"],"number":1,"duration":[1200,1800],"shapeOptions":{"radius":20,"alpha":[0.2,0.5],"lineWidth":6}}]}'))
  </script>










<div id="lazy-script">
  <div>
    
      
      
      <script data-pjax>
        window.REIMU_POST = {
          author: "mX1@0",
          title: "CryptoZombiesxçš„Solidityå­¦ä¹ ",
          url: "http://example.com/2025/08/10/cryptozombiesx-de-solidity-xue-xi/",
          excerpt: "",
          description: "",
          stripContent: "CryptoZombiesxçš„solidityå­¦ä¹ Solidity: Beginner to Intermediate Smart Contractslesson1 æ­å»ºåƒµå°¸å·¥å‚ç¬¬2ç« : åˆçº¦ä»æœ€åŸºæœ¬çš„å¼€å§‹å…¥æ‰‹: Solidity çš„ä»£ç éƒ½åŒ…è£¹åœ¨åˆçº¦é‡Œé¢. ä¸€ä»½åˆçº¦å°±æ˜¯ä»¥å¤ªåº”å¸åº”ç”¨çš„åŸºæœ¬æ¨¡å—ï¼Œ æ‰€æœ‰çš„å˜é‡å’Œå‡½æ•°éƒ½å±äºä¸€ä»½åˆçº¦, å®ƒæ˜¯ä½ æ‰€æœ‰åº”ç”¨çš„èµ·ç‚¹. ä¸€ä»½åä¸º HelloWorld çš„ç©ºåˆçº¦å¦‚ä¸‹: 123contract HelloWorld {}  ç‰ˆæœ¬æŒ‡ä»¤ æ‰€æœ‰çš„ Solidity æºç éƒ½å¿…",
          date: "Sun Aug 10 2025 23:38:00 GMT+0800",
          updated: "Wed Aug 20 2025 17:38:52 GMT+0800",
          cover: "/images/%E7%8E%9B%E8%8E%8E%E6%8B%89%E8%92%82.jpg",
        };
      </script>
       
    
    
      
        
<script src="/js/insert_highlight.js" data-pjax></script>

        
      
    
    
      <script type="module" data-pjax>
        const PhotoSwipeLightbox = (await safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe-lightbox.esm.min.js", "sha384-DiL6M/gG+wmTxmCRZyD1zee6lIhawn5TGvED0FOh7fXcN9B0aZ9dexSF/N6lrZi/")).default;
        
        const pswp = () => {
          if (_$$('.article-entry a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-entry',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          if(_$$('.article-gallery a.article-gallery-item').length > 0) {
            new PhotoSwipeLightbox({
              gallery: '.article-gallery',
              children: 'a.article-gallery-item',
              pswpModule: () => safeImport("https://npm.webcache.cn/photoswipe@5.4.4/dist/photoswipe.esm.min.js", "sha384-WkkO3GCmgkC3VQWpaV8DqhKJqpzpF9JoByxDmnV8+oTJ7m3DfYEWX1fu1scuS4+s")
            }).init();
          }
          window.lightboxStatus = 'done';
          window.removeEventListener('lightbox:ready', pswp);
        }
        if(window.lightboxStatus === 'ready') {
          pswp()
        } else {
          window.addEventListener('lightbox:ready', pswp);
        }
      </script>
      
        








      
    
  </div>
</div>


  <script>
    console.log(String.raw`%c 
 ______     ______     __     __    __     __  __    
/\  == \   /\  ___\   /\ \   /\ "-./  \   /\ \/\ \   
\ \  __<   \ \  __\   \ \ \  \ \ \-./\ \  \ \ \_\ \  
 \ \_\ \_\  \ \_____\  \ \_\  \ \_\ \ \_\  \ \_____\ 
  \/_/ /_/   \/_____/   \/_/   \/_/  \/_/   \/_____/ 
                                                  
`,'color: #ff5252;')
    console.log('%c Theme.Reimu v' + '1.9.0' + ' %c https://github.com/D-Sketon/hexo-theme-reimu ', 'color: white; background: #ff5252; padding:5px 0;', 'padding:4px;border:1px solid #ff5252;')
  </script>
  



  
<script src="https://npm.webcache.cn/busuanzi@2.3.0/bsz.pure.mini.js" integrity="sha384-0M75wtSkhjIInv4coYlaJU83+OypaRCIq2SukQVQX04eGTCBXJDuWAbJet56id+S" crossorigin="anonymous" async></script>




<script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.getRegistrations().then((registrations) => {
      for (let registration of registrations) {
        registration.unregister();
      }
    });
  }
</script>









    
  </body>
  </html>

